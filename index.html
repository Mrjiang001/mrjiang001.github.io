<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Mr Jiang</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="野生程序员一枚，对我温柔点。。。。。。">
<meta property="og:type" content="website">
<meta property="og:title" content="Mr Jiang">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Mr Jiang">
<meta property="og:description" content="野生程序员一枚，对我温柔点。。。。。。">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Mr Jiang">
<meta property="article:tag" content="Python">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Mr Jiang" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 4.2.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Mr Jiang</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">头发还够，那就再多学点</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-Docker镜像容器操作" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/03/28/Docker%E9%95%9C%E5%83%8F%E5%AE%B9%E5%99%A8%E6%93%8D%E4%BD%9C/" class="article-date">
  <time datetime="2020-03-28T15:46:14.000Z" itemprop="datePublished">2020-03-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/03/28/Docker%E9%95%9C%E5%83%8F%E5%AE%B9%E5%99%A8%E6%93%8D%E4%BD%9C/">Docker镜像容器操作</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="一-镜像相关"><a href="#一-镜像相关" class="headerlink" title="一.镜像相关"></a>一.镜像相关</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"># 镜像当成是一个没有启动的操作系统</span><br><span class="line"># redis镜像，mysql镜像，nginx镜像，django镜像，python镜像,指的是：linux+xx软件----》镜像跑起来就是--》容器：操作系统上运行着redis服务</span><br><span class="line"></span><br><span class="line"># 查找镜像： </span><br><span class="line">   # 命令行：</span><br><span class="line">docker search helloworld</span><br><span class="line">docker search centos</span><br><span class="line">   #官方搜索：https:&#x2F;&#x2F;hub.docker.com&#x2F;</span><br><span class="line">   # 如下图</span><br><span class="line"></span><br><span class="line"># 获取镜像：</span><br><span class="line"></span><br><span class="line">docker pull centos     # 拉取最新的：相当于docker pull centos:latest  </span><br><span class="line">docker pull centos:centos7  # 拉取一个centos7</span><br><span class="line">docker pull centos:centos6.7</span><br><span class="line">docker pull centos:centos10 # 这个 没有，就报错</span><br><span class="line">  </span><br><span class="line"># 查看本地镜像</span><br><span class="line">docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">centos              latest              470671670cac        3 months ago        237MB</span><br><span class="line">centos              centos7             5e35e350aded        5 months ago        203MB</span><br><span class="line"></span><br><span class="line"># 删除本地镜像</span><br><span class="line">docker rmi 470671670cac  # 通过id号删除</span><br><span class="line">docker rmi centos:centos7 # 通过名字删除</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"># docker rmi &#96;docker images -q&#96;</span><br><span class="line">docker images -q相当于获取所有的id号</span><br><span class="line">docker rim  470671670cac 5e35e350aded</span><br></pre></td></tr></table></figure>

<p>命令行查找镜像</p>
<p><img src="https://img2020.cnblogs.com/blog/1843708/202005/1843708-20200502163056689-233487209.png" alt="img"></p>
<p> 官方搜索</p>
<p><img src="https://img2020.cnblogs.com/blog/1843708/202005/1843708-20200502163101828-1107713707.png" alt="img"></p>
<p> 详细信息</p>
<p><img src="https://img2020.cnblogs.com/blog/1843708/202005/1843708-20200502163107536-134898467.png" alt="img"></p>
<h2 id="二-Docker容器操作"><a href="#二-Docker容器操作" class="headerlink" title="二.Docker容器操作"></a>二.Docker容器操作</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line">docker ps   # 查看正在运行的容器#########</span><br><span class="line">docker ps –a  # 查看所有容器（暂停的，停止，正在运行的。。。）##########</span><br><span class="line"></span><br><span class="line">docker ps –l # 查看最后一次运行的容器</span><br><span class="line">docker ps -f status&#x3D;exited  # 查看停止的容器</span><br><span class="line"></span><br><span class="line"># 重点：通过镜像创建并运行容器（两步并做一步）</span><br><span class="line">创建容器命令：docker run</span><br><span class="line">-i：表示运行容器</span><br><span class="line">-t：表示容器启动后会进入其命令行。加入这两个参数后，容器创建就能登录进去。即分配一个伪终端。</span><br><span class="line">--name :为创建的容器命名。容器名字不能重</span><br><span class="line">-v：表示目录映射关系（前者是宿主机目录，后者是容器的目录），可以使用多个－v做多个目录或文件映射。注意：最好做目录映射，在宿主机上做修改，然后共享到容器上。</span><br><span class="line">-d：在run后面加上-d参数,则会创建一个守护式容器在后台运行（这样创建容器后不会自动登录容器，只是操作宿主机，如果只加-i -t两个参数，创建后就会自动进去容器）。</span><br><span class="line">-p：表示端口映射，前者是宿主机端口，后者是容器内的映射端口。可以使用多个-p做多个端口映射</span><br><span class="line"></span><br><span class="line"># -v：数据卷，做目录映射</span><br><span class="line"># -p 网络，做端口映射</span><br><span class="line">#举例：在宿主机内部跑django的容器如何链接跑mysql的容器</span><br><span class="line">#1.容器也是有ip地址的，django可以直接链接</span><br><span class="line">#2.将mysql的端口映射到宿主机中，比如还是映射3306，django通过访问宿主机来访问，但是注意修改端口号，否则宿主机和容器只能起一个，同一个端口只能被一个软件监听</span><br><span class="line"></span><br><span class="line"># 演示</span><br><span class="line">#基于哪个镜像跑容器：centos:centos7   如果写成centos表示跑最新的 </span><br><span class="line">#如果没有这个镜像呢？去远程拉，拉下来再跑</span><br><span class="line"># 容器要运行，需要有一个前台进程，可以通过守护进程的方式运行容器（解释：下面这个容器的运行，是有一个bash终端挂在这，表示容器有一个进程在存活，bash关闭，容器也就关闭了，因此容器要运行，需要有一个前台进程）</span><br><span class="line">docker run -it --name&#x3D;mycentos7 centos:centos7 &#x2F;bin&#x2F;bash</span><br><span class="line"> </span><br><span class="line"># it表示运行并进入容器，-i -t缩写</span><br><span class="line">#--name：起一个名字</span><br><span class="line">#centos:centos7：表示基于centos的centos7版本，若不加centos7表示基于最新版</span><br><span class="line"># bin&#x2F;bash:表示bin路径下的base文件，他是一个软件，是进入启动容器的bash终端，可以有多个终端，用来执行命令的，可以通过执行exit逐层退出bash，最后一层bash退出就会退出docker</span><br><span class="line"> </span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">[root@localhost ~]# docker run -it --name&#x3D;mycentos7 centos:centos7 &#x2F;bin&#x2F;bash</span><br><span class="line">[root@29b72b8c9766 &#x2F;]# docker -v   &#x2F;&#x2F; 这就进入容器了，这是一个纯净的centos7的容器</span><br><span class="line">bash: docker: command not found</span><br><span class="line">[root@29b72b8c9766 &#x2F;]# exit  &#x2F;&#x2F; 退出</span><br><span class="line">exit</span><br><span class="line"></span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"># 以守护进程形式跑（会有一个&#x2F;bin&#x2F;bash前台进程命令在执行，只是并没有进入到容器内部）</span><br><span class="line">docker run -di  --name&#x3D;mycentos2_2 centos:centos7</span><br><span class="line">  </span><br><span class="line"># 进入到容器内部操作容器</span><br><span class="line">1 exec（用的最多）：在docker中执行命令</span><br><span class="line">    docker exec -it mycentos2_2 &#x2F;bin&#x2F;bash</span><br><span class="line">    exit 退出（此时退出还有一个前台进程在存活）</span><br><span class="line"></span><br><span class="line">    docker exec mycentos2_2 ls  （表示进入并执行ls命令）</span><br><span class="line"></span><br><span class="line">2 attach （当没有）</span><br><span class="line">3 ssh连接(容器要启动ssh服务22端口没有服务在监听)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 容器的启动与停止</span><br><span class="line">docker stop 容器id&#x2F;名字</span><br><span class="line">docker start 容器id&#x2F;名字</span><br><span class="line">docker restart 容器id&#x2F;名字</span><br><span class="line"></span><br><span class="line"># 文件拷贝</span><br><span class="line"># 从宿主机copy到容器内部</span><br><span class="line">docker cp 要拷贝的文件或者目录 容器名称：容器目录</span><br><span class="line">docker cp untitled3.tar mycentos2_2:&#x2F;home</span><br><span class="line"> # 从容器内部copy出来 （.&#x2F;表示当前目录下）</span><br><span class="line">docker cp mycentos2_2:&#x2F;home&#x2F;untitled3.tar .&#x2F;</span><br><span class="line"></span><br><span class="line">   </span><br><span class="line"># 数据卷（目录映射）</span><br><span class="line"># 1.比如容器的软件是mysql，有一个root&#x2F;data目录，里面放着数据信息，同步映射到宿主机的一个home&#x2F;data目录，这样不论在容器中还是宿主机中增删改查data的信息都会影响到另一个，但是如过整个容器突然没了，宿主机还在，可以重新建一个容器重新挂上root&#x2F;data,就可以恢复宿主机的信息到容器中，类似于文件共享。这就是数据卷</span><br><span class="line"></span><br><span class="line"># 2.比如容器中跑的django，也可以做映射到外部宿主机上，这样在宿主机中装git，拉去最新的代码，只要重启一下容器，django就能跑最新的代码了，可以实现快速更新</span><br><span class="line"></span><br><span class="line">docker run -di  --name&#x3D;mycentos2_3 -v &#x2F;root&#x2F;test:&#x2F;home centos:centos7</span><br><span class="line"># 以后操作宿主机目录和操作容器目录会相互影响（在-v后面添加宿主机和容器的映射目录）</span><br><span class="line"></span><br><span class="line"># 查看容器信息</span><br><span class="line">docker inspect 容器名字&#x2F;容器id</span><br><span class="line"># 查看ip地址</span><br><span class="line">docker inspect --format&#x3D;&#39;&#123;&#123;.NetworkSettings.IPAddress&#125;&#125;&#39; 容器id&#x2F;名字</span><br><span class="line"></span><br><span class="line">#主机内部的容器会公用一个虚拟的网关，宿主机本身也有一个，并且和容器共享另外这个虚拟的ip，这就是一个小的局域网，因此容器间可以通信方便</span><br><span class="line"></span><br><span class="line"># 删除容器</span><br><span class="line"># 停止才能删</span><br><span class="line">docker rm 容器名字&#x2F;id</span><br><span class="line"></span><br><span class="line"># 删除镜像，如果有容器，能删除吗？支持，可以强制删，但是不推荐</span><br><span class="line">docker rmi -f centos:centos7</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">自动化运维脚本：人输命令，shell脚本，python：subprocess执行命令</span><br><span class="line">自动化运维平台：web框架，在网页上点点点，就可以完成一些事（宝塔：python2.7+flask做的）</span><br><span class="line">正在运行的容器，启动</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 总结：</span><br><span class="line">docker run  -di&#x2F;-it --name&#x3D;名字  -v 目录映射，可以有多个  images:tag</span><br><span class="line">docker exec -it 名字 &#x2F;bin&#x2F;bash</span><br><span class="line">docker cp</span><br><span class="line">docker stop&#x2F;start&#x2F;restart 容器名字</span><br><span class="line">docker rm 容器名字</span><br><span class="line">docker inspect 容器名字</span><br></pre></td></tr></table></figure>

<p>容器与容器直接可以是相互隔离的，每个容器里面装地方软件可以不一样，相互也可以不影响</p>
<p>容器映射一个端口，外部访问宿主机的时候可以转到容器中访问容器中的软件</p>
<p>容器不可以直接拿到另外一个宿主机上执行，但是可以备份转成镜像，镜像就包含了原来容器中的环境，就可以放在另一个装有docker的宿主机上，实现快速集群化部署，避免了环境的不一致等影响（补充：go更香一点，直接放可执行文件，但是也要考虑下redis等）</p>
<p>可以将mysql，nigx，redis等等分别装在不同的容器中，做好容器间的通信，有利于后面的项目完善</p>
<p><img src="https://img2020.cnblogs.com/blog/1843708/202005/1843708-20200502163245222-1271422411.png" alt="img"></p>
<h2 id="三-Docker应用部署"><a href="#三-Docker应用部署" class="headerlink" title="三.Docker应用部署"></a>三.Docker应用部署</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># mysql服务 在docker中运行 -e表示环境变量，root密码,这个环境变量不加就会报错，一启动容器就停止</span><br><span class="line">docker run -id --name&#x3D;mysql1 -p 33306:3306 -e MYSQL_ROOT_PASSWORD&#x3D;123456 mysql:5.7</span><br><span class="line"># redis服务 在docker中运行</span><br><span class="line">docker run -id --name&#x3D;myredis -p 6379:6379 redis</span><br><span class="line"> </span><br><span class="line"># docker中部署django项目 nginx + django +uwsgi</span><br></pre></td></tr></table></figure>

<p>映射成功后，通过虚拟机的ip和宿主机的33306端口，账号为root，密码为123456，就能链接到容器中的mysql数据库了，也可以进入容器直接操作数据库</p>
<p><img src="https://img2020.cnblogs.com/blog/1843708/202005/1843708-20200502163328340-247725184.png" alt="img"></p>
<h2 id="四-迁移备份"><a href="#四-迁移备份" class="headerlink" title="四.迁移备份"></a>四.迁移备份</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># 把容器打包成镜像</span><br><span class="line">docker run -di --name&#x3D;mydjango python:3.6</span><br><span class="line">  </span><br><span class="line"># 安装django环境</span><br><span class="line">pip install django&#x3D;&#x3D;1.11.9</span><br><span class="line">apt-get update</span><br><span class="line">apt-get install vim </span><br><span class="line"></span><br><span class="line"># 把容器打包成镜像</span><br><span class="line">docker commit 容器名字 镜像名字</span><br><span class="line">docker commit mydjango mydjango_i</span><br><span class="line"></span><br><span class="line"># 基于镜像再跑起容器</span><br><span class="line">docker run -di --name&#x3D;mydjango2 mydjango_i</span><br><span class="line"></span><br><span class="line"># 把本地的镜像拷贝到其他机器上去，在跑起容器来</span><br><span class="line"># 打成一个tar包，压缩一下（在当前目有个mydjango.tar）</span><br><span class="line">docker  save -o mydjango.tar mydjango_i</span><br><span class="line"></span><br><span class="line"># copy这个压缩包到任意的机器上（装了docker）</span><br><span class="line">根据压缩包，恢复成镜像</span><br><span class="line">docker load -i mydjango.tar</span><br><span class="line"></span><br><span class="line">容器里装了python3.6 mysql，django， uwsgi ，redis 项目在里面---》镜像--》容器</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/03/28/Docker%E9%95%9C%E5%83%8F%E5%AE%B9%E5%99%A8%E6%93%8D%E4%BD%9C/" data-id="ckd49wrbu000fl4ut53y036tk" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Docker/" rel="tag">Docker</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Docker" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/03/27/Docker/" class="article-date">
  <time datetime="2020-03-27T08:44:39.000Z" itemprop="datePublished">2020-03-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/03/27/Docker/">Docker</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Centos-7环境安装Docker"><a href="#Centos-7环境安装Docker" class="headerlink" title="Centos 7环境安装Docker"></a>Centos 7环境安装Docker</h1><h2 id="一-docker安装启动"><a href="#一-docker安装启动" class="headerlink" title="一.docker安装启动"></a>一.docker安装启动</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Docker官方建议在Ubuntu中安装，因为Docker是基于Ubuntu发布的，而且一般Docker出现的问题Ubuntu是最先更新或者打补丁的。在很多版本的CentOS中是不支持更新最新的一些补丁包的。而下面的安装方式是基于centos的。</span><br><span class="line">注意：这里建议安装在CentOS7.x以上的版本，在CentOS6.x的版本中，安装前需要安装其他很多的环境而且Docker很多补丁不支持更新。</span><br></pre></td></tr></table></figure>

<h2 id="第一步：yum-包更新到最新"><a href="#第一步：yum-包更新到最新" class="headerlink" title="第一步：yum 包更新到最新"></a>第一步：yum 包更新到最新</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum update</span><br></pre></td></tr></table></figure>

<h2 id="第二步：安装需要的软件包"><a href="#第二步：安装需要的软件包" class="headerlink" title="第二步：安装需要的软件包"></a>第二步：安装需要的软件包</h2><p>yum-util 提供yum-config-manager功能，另外两个是devicemapper驱动依赖的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y yum-utils device-mapper-persistent-data lvm2</span><br></pre></td></tr></table></figure>

<h2 id="第三步：设置yum源为阿里云"><a href="#第三步：设置yum源为阿里云" class="headerlink" title="第三步：设置yum源为阿里云"></a>第三步：设置yum源为阿里云</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum-config-manager --add-repo http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;docker-ce&#x2F;linux&#x2F;centos&#x2F;docker-ce.repo</span><br></pre></td></tr></table></figure>

<h2 id="第四步：安装docker"><a href="#第四步：安装docker" class="headerlink" title="第四步：安装docker"></a>第四步：安装docker</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install docker-ce</span><br></pre></td></tr></table></figure>

<h2 id="第五步：安装后查看docker版本"><a href="#第五步：安装后查看docker版本" class="headerlink" title="第五步：安装后查看docker版本"></a>第五步：安装后查看docker版本</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker -v</span><br></pre></td></tr></table></figure>

<h2 id="第六步：设置ustc的镜像"><a href="#第六步：设置ustc的镜像" class="headerlink" title="第六步：设置ustc的镜像"></a>第六步：设置ustc的镜像</h2><p>ustc是老牌的linux镜像服务提供者了，还在遥远的ubuntu 5.04版本的时候就在用。ustc的docker镜像加速器速度很快。ustc docker mirror的优势之一就是不需要注册，是真正的公共服务。</p>
<p><a href="https://lug.ustc.edu.cn/wiki/mirrors/help/docker" target="_blank" rel="noopener">https://lug.ustc.edu.cn/wiki/mirrors/help/docker</a></p>
<p>编辑该文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi &#x2F;etc&#x2F;docker&#x2F;daemon.json</span><br></pre></td></tr></table></figure>

<p>在该文件中输入如下内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">&quot;registry-mirrors&quot;: [&quot;https:&#x2F;&#x2F;docker.mirrors.ustc.edu.cn&quot;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="第七步：Docker的启动与停止"><a href="#第七步：Docker的启动与停止" class="headerlink" title="第七步：Docker的启动与停止"></a>第七步：Docker的启动与停止</h2><p><strong>systemctl</strong>命令是系统服务管理器指令</p>
<p>启动docker：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start docker</span><br></pre></td></tr></table></figure>

<p>停止docker：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop docker</span><br></pre></td></tr></table></figure>

<p>重启docker：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure>

<p>查看docker状态：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl status docker</span><br></pre></td></tr></table></figure>

<p>开机启动：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable docker</span><br></pre></td></tr></table></figure>

<p>查看docker概要信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker info</span><br></pre></td></tr></table></figure>

<p>查看docker帮助文档</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker --help</span><br></pre></td></tr></table></figure>

<h1 id="Ubuntu-16-04安装docker详细步骤"><a href="#Ubuntu-16-04安装docker详细步骤" class="headerlink" title="Ubuntu 16.04安装docker详细步骤"></a>Ubuntu 16.04安装docker详细步骤</h1><p>因需要安装opendronemap,而这个依赖于docker,所以记录了一下安装docker的步骤,比较简单.通过apt的docker官方源安装最新的Docker CE(Community Edition)，即Docker社区版，是开发人员和小型团队的理想选择。</p>
<h2 id="开始安装"><a href="#开始安装" class="headerlink" title="开始安装"></a>开始安装</h2><p>由于apt官方库里的docker版本可能比较旧，所以先卸载可能存在的旧版本： <code>$ sudo apt-get remove docker docker-engine docker-ce docker.io</code></p>
<h2 id="更新apt包索引："><a href="#更新apt包索引：" class="headerlink" title="更新apt包索引："></a>更新apt包索引：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get update</span><br></pre></td></tr></table></figure>

<h2 id="安装以下包以使apt可以通过HTTPS使用存储库（repository）："><a href="#安装以下包以使apt可以通过HTTPS使用存储库（repository）：" class="headerlink" title="安装以下包以使apt可以通过HTTPS使用存储库（repository）："></a>安装以下包以使apt可以通过HTTPS使用存储库（repository）：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install -y apt-transport-https ca-certificates curl software-properties-common</span><br></pre></td></tr></table></figure>

<h2 id="添加Docker官方的GPG密钥："><a href="#添加Docker官方的GPG密钥：" class="headerlink" title="添加Docker官方的GPG密钥："></a>添加Docker官方的GPG密钥：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ curl -fsSL https:&#x2F;&#x2F;download.docker.com&#x2F;linux&#x2F;ubuntu&#x2F;gpg | sudo apt-key add -</span><br></pre></td></tr></table></figure>

<h2 id="使用下面的命令来设置stable存储库："><a href="#使用下面的命令来设置stable存储库：" class="headerlink" title="使用下面的命令来设置stable存储库："></a>使用下面的命令来设置stable存储库：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo add-apt-repository &quot;deb [arch&#x3D;amd64] https:&#x2F;&#x2F;download.docker.com&#x2F;linux&#x2F;ubuntu $(lsb_release -cs) stable&quot;</span><br></pre></td></tr></table></figure>

<h2 id="再更新一下apt包索引："><a href="#再更新一下apt包索引：" class="headerlink" title="再更新一下apt包索引："></a>再更新一下apt包索引：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get update</span><br></pre></td></tr></table></figure>

<h2 id="安装最新版本的Docker-CE："><a href="#安装最新版本的Docker-CE：" class="headerlink" title="安装最新版本的Docker CE："></a>安装最新版本的Docker CE：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install -y docker-ce</span><br></pre></td></tr></table></figure>

<h2 id="验证docker，查看docker服务是否启动："><a href="#验证docker，查看docker服务是否启动：" class="headerlink" title="验证docker，查看docker服务是否启动："></a>验证docker，查看docker服务是否启动：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ systemctl status docker</span><br></pre></td></tr></table></figure>

<p><img src="https://img2020.cnblogs.com/blog/1843708/202005/1843708-20200502162006236-1413838977.png" alt="img"></p>
<h2 id="若未启动，则启动docker服务："><a href="#若未启动，则启动docker服务：" class="headerlink" title="若未启动，则启动docker服务："></a>若未启动，则启动docker服务：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl start docker</span><br></pre></td></tr></table></figure>

<h2 id="经典的hello-world："><a href="#经典的hello-world：" class="headerlink" title="经典的hello world："></a>经典的hello world：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker run hello-world</span><br></pre></td></tr></table></figure>

<p>有以上输出,表示docker安装成功</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/03/27/Docker/" data-id="ckd49wrbs000dl4ut7f7s5typ" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Docker/" rel="tag">Docker</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-request模块" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/09/18/request%E6%A8%A1%E5%9D%97/" class="article-date">
  <time datetime="2019-09-18T13:34:23.000Z" itemprop="datePublished">2019-09-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/09/18/request%E6%A8%A1%E5%9D%97/">request模块</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="request模块"><a href="#request模块" class="headerlink" title="request模块"></a>request模块</h1><ul>
<li>介绍</li>
</ul>
<p>可以模拟发送http请求，基于urlib2：内置库，不太好用，繁琐，封装出requests模块，应用非常广泛（公司，人）</p>
<ul>
<li>安装</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install requests</span><br></pre></td></tr></table></figure>

<ul>
<li>使用</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"># 1 request模块基本使用</span><br><span class="line"></span><br><span class="line">import requests</span><br><span class="line"></span><br><span class="line"># 发送http请求</span><br><span class="line"># 请求方法get,delete,post。。本质都是调用request函数</span><br><span class="line">ret&#x3D;requests.get(&#39;https:&#x2F;&#x2F;www.cnblogs.com&#39;)</span><br><span class="line">print(ret.status_code) # 响应状态码</span><br><span class="line">print(ret.text)  # 响应体，转成了字符串</span><br><span class="line">print(ret.content) # 响应体，二进制</span><br><span class="line"># ret&#x3D;requests.post()</span><br><span class="line"># requests.get()和requests.request(&quot;get&quot;,)是一样的</span><br><span class="line"># ret&#x3D;requests.request(&quot;get&quot;,)</span><br><span class="line"># ret&#x3D;requests.delete()</span><br><span class="line"></span><br><span class="line"># 2 get 请求带参数</span><br><span class="line"># 方式一(直接携带参数需要考虑转码的问题)</span><br><span class="line">ret &#x3D; requests.get(&#39;https:&#x2F;&#x2F;www.baidu.com&#x2F;?name&#x3D;wd&#x3D;%E7%BE%8E%E5%A5%B3&#39;,</span><br><span class="line">                   headers&#x3D;&#123;&#39;User-Agent&#39;: &#39;Mozilla&#x2F;5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebK  it&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;80.0.3987.132 Safari&#x2F;537.36&#39;</span><br><span class="line">                            &#125;)</span><br><span class="line"> print(ret.text)</span><br><span class="line"># 方式2（建议用方式二）中文会自动转码</span><br><span class="line">ret&#x3D;requests.get(&#39;http:&#x2F;&#x2F;0.0.0.0:8001&#x2F;&#39;,params&#x3D;&#123;&#39;name&#39;:&quot;美女&quot;,&#39;age&#39;:18&#125;)</span><br><span class="line">print(ret.text)</span><br><span class="line"># 3 带headers</span><br><span class="line">ret &#x3D; requests.get(&#39;http:&#x2F;&#x2F;0.0.0.0:8001&#x2F;?name&#x3D;%E7%BE%8E%E5%A5%B3&#39;,</span><br><span class="line">                    headers&#x3D;&#123;</span><br><span class="line">                       # 标志，什么东西发出的请求以及浏览器信息，在django框架从meta中获取</span><br><span class="line">                        &#39;User-Agent&#39;: &#39;Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;79.0.3945.130 Safari&#x2F;537.36&#39;,</span><br><span class="line">                       # 上一个页面的地址，图片防盗链</span><br><span class="line">#                        &#39;Referer&#39;: &#39;xxx&#39;</span><br><span class="line">#                    &#125;)</span><br><span class="line"># print(ret)</span><br><span class="line"></span><br><span class="line"># 图片防盗链：如果图片的referer不是我自己的网站，就直接禁止掉</span><br><span class="line"># &lt;img src&#x3D;&quot;https:&#x2F;&#x2F;www.lgstatic.com&#x2F;lg-community-fed&#x2F;community&#x2F;modules&#x2F;common&#x2F;img&#x2F;avatar_default_7225407.png&quot;&gt;</span><br></pre></td></tr></table></figure>

<p><img src="https://img2020.cnblogs.com/blog/1843708/202004/1843708-20200408012957830-341060668.png" alt="img"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"># 4 带cookie,随机字符串(用户信息：也代表session)，不管后台用的token认证，还是session认证</span><br><span class="line"># 一旦登陆了，带着cookie发送请求，表示登陆了（下单，12306买票，评论）</span><br><span class="line"># 第一种方式</span><br><span class="line"># ret &#x3D; requests.get(&#39;http:&#x2F;&#x2F;0.0.0.0:8001&#x2F;?name&#x3D;%E7%BE%8E%E5%A5%B3&#39;,</span><br><span class="line">#                    headers&#x3D;&#123;</span><br><span class="line">#                        &#39;cookie&#39;: &#39;key3&#x3D;value;key2&#x3D;value&#39;,</span><br><span class="line">#                    &#125;)</span><br><span class="line"># 第二种方式</span><br><span class="line"># ret &#x3D; requests.get(&#39;http:&#x2F;&#x2F;0.0.0.0:8001&#x2F;?name&#x3D;%E7%BE%8E%E5%A5%B3&#39;,</span><br><span class="line">#                    cookies&#x3D;&#123;&quot;islogin&quot;:&quot;xxx&quot;&#125;)</span><br><span class="line"># print(ret)</span><br><span class="line"># 5 发送post请求（注册，登陆），携带数据（body）</span><br><span class="line">#两种数据格式data&#x3D;None, json&#x3D;None</span><br><span class="line"># data:urlencoded编码</span><br><span class="line">ret&#x3D;requests.post(&#39;http:&#x2F;&#x2F;0.0.0.0:8001&#x2F;&#39;,data&#x3D;&#123;&#39;name&#39;:&quot;lqz&quot;,&#39;age&#39;:18&#125;)</span><br><span class="line"># json:json编码</span><br><span class="line">import json</span><br><span class="line">data&#x3D;json.dumps(&#123;&#39;name&#39;:&quot;lqz&quot;,&#39;age&#39;:18&#125;)</span><br><span class="line">ret&#x3D;requests.post(&#39;http:&#x2F;&#x2F;0.0.0.0:8001&#x2F;&#39;,json&#x3D;data)</span><br><span class="line">print(ret)</span><br><span class="line"># 注意：编码格式是请求头中带的，所有我可以手动修改，在headers中改</span><br><span class="line"></span><br><span class="line"># 6 session对象</span><br><span class="line"> session&#x3D;requests.session()</span><br><span class="line"># 跟requests.get&#x2F;post用起来完全一样，但是它处理了cookie</span><br><span class="line"># # 假设是一个登陆功能，并且成功</span><br><span class="line"> session.post()</span><br><span class="line"># # 再向该网站发请求，就是登陆状态，不需要手动携带cookie</span><br><span class="line"> session.get(&quot;地址&quot;)</span><br><span class="line"># 7 响应对象</span><br><span class="line"># print(respone.text)   # 响应体转成str</span><br><span class="line"># print(respone.content) # 响应体二进制（图片，视频）</span><br><span class="line">#</span><br><span class="line"># print(respone.status_code) # 响应状态码</span><br><span class="line"># print(respone.headers) # 响应头</span><br><span class="line"># print(respone.cookies) # 服务端返回的cookie</span><br><span class="line"># print(respone.cookies.get_dict()) # 转成字典</span><br><span class="line"># print(respone.cookies.items())</span><br><span class="line">#</span><br><span class="line"># print(respone.url)  # 当次请求的地址</span><br><span class="line"># print(respone.history) # 如果有重定向，放到一个列表中</span><br><span class="line"># ret&#x3D;requests.post(&#39;http:&#x2F;&#x2F;0.0.0.0:8001&#x2F;&#39;)</span><br><span class="line"># ret&#x3D;requests.get(&#39;http:&#x2F;&#x2F;0.0.0.0:8001&#x2F;admin&#39;)</span><br><span class="line"># #不要误解，是当次访问对象里面的重定向地址</span><br><span class="line"># ret&#x3D;requests.get(&#39;http:&#x2F;&#x2F;0.0.0.0:8001&#x2F;user&#39;)</span><br><span class="line"># print(ret.history)</span><br><span class="line"></span><br><span class="line"># print(respone.encoding) # 编码方式</span><br><span class="line"># 乱码问题</span><br><span class="line"># 加载回来的页面，打印出来，乱码（我们用的是utf8编码），如果网站用gbk，</span><br><span class="line"># ret.encoding&#x3D;&#39;gbk&#39;</span><br><span class="line"></span><br><span class="line">#response.iter_content() # 视频，图片太大不能一次性取完，可以循环迭代取值</span><br><span class="line"># with open(&quot;a.mp4&quot;,&#39;wb&#39;) as f:</span><br><span class="line">#     for line in response.iter_content():</span><br><span class="line">#         f.write(line)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># ret&#x3D;requests.get(&#39;http:&#x2F;&#x2F;0.0.0.0:8001&#x2F;user&#39;)</span><br><span class="line"># # ret.apparent_encoding获取当前页面的编码</span><br><span class="line"># ret.encoding&#x3D;ret.apparent_encoding</span><br></pre></td></tr></table></figure>

<p><img src="https://img2020.cnblogs.com/blog/1843708/202004/1843708-20200408012950116-702733837.png" alt="img"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># 8 解析json</span><br><span class="line"># 返回数据，有可能是json格式，有可能是html格式</span><br><span class="line"># ret&#x3D;requests.get(&#39;http:&#x2F;&#x2F;0.0.0.0:8001&#x2F;&#39;)</span><br><span class="line"># print(type(ret.text))# text拿到的是字符串格式</span><br><span class="line"># print(ret.text)</span><br><span class="line">#ret.json()可以自动转为json格式</span><br><span class="line"># a&#x3D;ret.json()</span><br><span class="line"># print(a[&#39;name&#39;])</span><br><span class="line"># print(type(a))</span><br><span class="line">#9.超时设置</span><br><span class="line">#两种超时:float or tuple</span><br><span class="line">#timeout&#x3D;0.1 #代表接收数据的超时时间</span><br><span class="line">#timeout&#x3D;(0.1,0.2)#0.1代表链接超时  0.2代表接收数据的超时时间</span><br><span class="line"></span><br><span class="line">import requests</span><br><span class="line">respone&#x3D;requests.get(&#39;https:&#x2F;&#x2F;www.baidu.com&#39;,</span><br><span class="line">                     timeout&#x3D;0.0001)</span><br><span class="line"># 10 异常处理</span><br><span class="line"># 用try except捕获一下 就用它就可以了：Exception</span><br><span class="line"></span><br><span class="line"># 12 上传文件(爬虫用的比较少，后台写服务，)</span><br><span class="line">file&#x3D;&#123;&#39;myfile&#39;:open(&quot;1.txt&quot;,&#39;rb&#39;)&#125;</span><br><span class="line">ret&#x3D;requests.post(&#39;http:&#x2F;&#x2F;0.0.0.0:8001&#x2F;&#39;,files&#x3D;file)</span><br><span class="line">print(ret.content)</span><br></pre></td></tr></table></figure>

<h2 id="四-代理"><a href="#四-代理" class="headerlink" title="四.代理"></a>四.代理</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># proxies参数中可设置代理地址</span><br><span class="line">ret&#x3D;requests.get(&#39;http:&#x2F;&#x2F;0.0.0.0:8001&#x2F;&#39;,proxies&#x3D;&#123;&#39;http&#39;:&#39;地址&#39;&#125;)</span><br><span class="line">#django如何拿到客户端ip地址 </span><br><span class="line">META.get(&quot;REMOTE_ADDR&quot;) </span><br><span class="line"># 如果设置了代理则get得到的就是我们设置的代理而不是真实ip地址</span><br><span class="line">代理池：列表，其实就是代理池的一种</span><br></pre></td></tr></table></figure>

<p><img src="https://img2020.cnblogs.com/blog/1843708/202004/1843708-20200408013013170-763315805.png" alt="img"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/09/18/request%E6%A8%A1%E5%9D%97/" data-id="ckd49wrd0001el4uthw25heok" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%88%AC%E8%99%AB/" rel="tag">爬虫</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-爬虫基础" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/09/17/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80/" class="article-date">
  <time datetime="2019-09-17T08:33:49.000Z" itemprop="datePublished">2019-09-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/09/17/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80/">爬虫基础</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="一-爬虫介绍"><a href="#一-爬虫介绍" class="headerlink" title="一. 爬虫介绍"></a>一. 爬虫介绍</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">1) 本质：模拟发送http请求（requests）----》解析返回数据（re，bs4，lxml，json）---》入库（redis，mysql，mongodb）</span><br><span class="line">    #1、发起请求</span><br><span class="line">    使用http库向目标站点发起请求，即发送一个Request</span><br><span class="line">    Request包含：请求头、请求体等</span><br><span class="line"></span><br><span class="line">    #2、获取响应内容</span><br><span class="line">    如果服务器能正常响应，则会得到一个Response</span><br><span class="line">    Response包含：html，json，图片，视频等</span><br><span class="line"></span><br><span class="line">    #3、解析内容 </span><br><span class="line">    解析html数据：正则表达式，第三方解析库如Beautifulsoup，pyquery等</span><br><span class="line">    解析json数据：json模块</span><br><span class="line">    解析二进制数据:以b的方式写入文件</span><br><span class="line"></span><br><span class="line">    #4、保存数据</span><br><span class="line">    数据库</span><br><span class="line">    文件</span><br><span class="line">2.为什么python做爬虫最好：包多，爬虫框架：scrapy：性能很高的爬虫框架，爬虫界的django，大而全（爬虫相关的东西都集成了）</span><br></pre></td></tr></table></figure>

<h2 id="二-HTTP协议回顾"><a href="#二-HTTP协议回顾" class="headerlink" title="二.HTTP协议回顾"></a>二.HTTP协议回顾</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">特点：</span><br><span class="line">(1)HTTP协议，即超文本协议，基于TCP&#x2F;IP协议之上的应用层协议</span><br><span class="line"></span><br><span class="line">扩展：cs架构的软件（例如：mysql，redis，mongodb），他们的客户端（Navicate，python代码pymysql）与服务端通信都是通过底层socket实现（这就相当于自己定制的协议）， 而HTTP的底层也是socket，他的通信协议就是应用层协议。后面出现的docker和es，底层也是socket，遵循HTTP协议里的resful规范</span><br><span class="line"></span><br><span class="line">（2）基于请求－响应模式：</span><br><span class="line">客户端主动发起请求---》服务端才能响应</span><br><span class="line">服务端不能主动推送消息：了解轮询和长轮询</span><br><span class="line">轮询：某个客户端可以通过ajax不停的向服务端发送请求获取数据</span><br><span class="line">长轮询：某个客户端发送请求到服务端，但是会等待了一段时间再重新发送请求，如下图</span><br><span class="line">这样可以实现类似于服务端主动发送消息。</span><br><span class="line">websocket协议：主动推送消息</span><br><span class="line"></span><br><span class="line">（3）无状态保存（解决方法:cookie，session，token）</span><br><span class="line">    </span><br><span class="line">（4）无连接：发送一次请求，响应完就断开，性能影响</span><br><span class="line">  http协议版本：0.9，</span><br><span class="line">  http协议版本1.1和2.0的区别</span><br><span class="line">  1.1:多次请求，共用一个socket连接，</span><br><span class="line">  2.0:一次请求，可以携带多个http请求</span><br></pre></td></tr></table></figure>

<p><img src="https://img2020.cnblogs.com/blog/1843708/202004/1843708-20200408012650049-1256109781.png" alt="img"></p>
<h3 id="HTTP请求协议"><a href="#HTTP请求协议" class="headerlink" title="HTTP请求协议"></a>HTTP请求协议</h3><p><img src="https://img2020.cnblogs.com/blog/1843708/202004/1843708-20200408012659014-1293490793.png" alt="img"></p>
<p>类似这种-127.0.0.1/name=lqz&amp;age=18是放在请求首行中</p>
<p>post请求在请求体中放数据：name=lqz&amp;age=18 放在请求体中</p>
<p>问：-post请求，可以这样发么：127.0.0.1/name=lqz&amp;age=18，这样发怎么取？</p>
<p>答：django中数据通过requtes.GET获取 放在体中通过request.POST获取</p>
<p>问：请求体的格式（编码格式）：</p>
<p>urlencode:name=lqz&amp;age=18 —》request.POST json:{name:lqz,age:18} —-&gt;request.POST取不出来(为什么？django框架没有做这个事，json数据直接放在body中，可以通过drf框架等自己取出来) formdata:传文件，5g大文件， —-》request.POST</p>
<p><strong>GET请求</strong></p>
<p>HTTP默认的请求方法就是GET * 没有请求体 * 数据必须在1K之内！ * GET请求数据会暴露在浏览器的地址栏中</p>
<p>GET请求常用的操作：</p>
<ol>
<li>在浏览器的地址栏中直接给出URL，那么就一定是GET请求<ol>
<li>点击页面上的超链接也一定是GET请求<ol>
<li>提交表单时，表单默认使用GET请求，但可以设置为POST</li>
</ol>
</li>
</ol>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F; HTTP&#x2F;1.1</span><br><span class="line">Host: www.sina.com.cn</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Windows NT 6.1; WOW64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;55.0.2883.87 Safari&#x2F;537.36</span><br><span class="line">Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;webp,*&#x2F;*;q&#x3D;0.8</span><br><span class="line">Accept-Encoding: gzip, deflate, sdch</span><br><span class="line">Accept-Language: zh-CN,zh;q&#x3D;0.8</span><br><span class="line">Cookie: SINAGLOBAL&#x3D;223.71.229.3_1484011627.259786; Apache&#x3D;223.71.229.3_1484011627.259788</span><br></pre></td></tr></table></figure>

<ul>
<li><p>GET / HTTP/1.1：GET请求，请求服务器路径为 <a href="http://www.sina.com.cn/" target="_blank" rel="noopener">http://www.sina.com.cn/</a> ，协议为1.1；</p>
</li>
<li><p>Host:<a href="https://www.cnblogs.com/jiangxianseng/p/www.sina.com.cn" target="_blank" rel="noopener">www.sina.com.cn</a> 请求的主机名为<a href="https://www.cnblogs.com/jiangxianseng/p/www.sina.com.cn" target="_blank" rel="noopener">www.sina.com.cn</a>；</p>
</li>
<li><p>Connection: keep-alive：客户端支持的链接方式，保持一段时间链接，默认为3000ms；</p>
</li>
<li><p>User-Agent:…….：与浏览器和OS相关的信息。有些网站会显示用户的系统版本和浏览器版本信息，这都是通过获取User-Agent头信息而来的；</p>
</li>
<li><p>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,<em>/</em>;q=0.8：告诉服务器，当前客户端可以接收的文档类型，其实这里包含了<em>/</em>，就表示什么都可以接收；</p>
</li>
<li><p>Accept-Encoding: gzip, deflate,sdch：支持的压缩格式。数据在网络上传递时，可能服务器会把数据压缩后再发送；</p>
</li>
<li><p>Accept-Language: zh-cn,zh;q=0.5：当前客户端支持的语言，可以在浏览器的工具选项中找到语言相关信息；</p>
</li>
<li><p>Cookie:SINAGLOBAL=223.71.229.3_1484011627.259786; Apache=223.71.229.3_1484011627.259788</p>
</li>
</ul>
<p>  因为不是第一次访问这个地址，所以会在请求中把上一次服务器响应中发送过来的Cookie在请求中一并发送去过；这个Cookie的名字为SINAGLOBAL</p>
<p><strong>POST请求</strong></p>
<p>(1). 数据不会出现在地址栏中 (2). 数据的大小没有上限 (3). 有请求体 (4). 请求体中如果存在中文，会使用URL编码！</p>
<p>表单测试</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;form method&#x3D;&quot;post&quot;&gt;</span><br><span class="line">用户名:&lt;br&gt;</span><br><span class="line">&lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;username&quot;&gt;</span><br><span class="line">&lt;br&gt;</span><br><span class="line">密码:&lt;br&gt;</span><br><span class="line">&lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;password&quot;&gt;</span><br><span class="line">&lt;input type&#x3D;&quot;submit&quot; value&#x3D;&quot;登录&quot;&gt;</span><br><span class="line">&lt;&#x2F;form&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br><span class="line"></span><br><span class="line">表单测试</span><br></pre></td></tr></table></figure>

<p><img src="https://images2015.cnblogs.com/blog/1036857/201701/1036857-20170110102405447-1927945464.png" alt="img"></p>
<p>为什么要进行URL编码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">我们都知道Http协议中参数的传输是&quot;key&#x3D;value&quot;这种简直对形式的，如果要传多个参数就需要用“&amp;”符号对键值对进行分割。如&quot;?name1&#x3D;value1&amp;name2&#x3D;value2&quot;，这样在服务端在收到这种字符串的时候，会用“&amp;”分割出每一个参数，然后再用“&#x3D;”来分割出参数值。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">针对“name1&#x3D;value1&amp;name2&#x3D;value2”我们来说一下客户端到服务端的概念上解析过程: </span><br><span class="line">  上述字符串在计算机中用ASCII吗表示为： </span><br><span class="line">  6E616D6531 3D 76616C756531 26 6E616D6532 3D 76616C756532。 </span><br><span class="line">   6E616D6531：name1 </span><br><span class="line">   3D：&#x3D; </span><br><span class="line">   76616C756531：value1 </span><br><span class="line">   26：&amp;</span><br><span class="line">   6E616D6532：name2 </span><br><span class="line">   3D：&#x3D; </span><br><span class="line">   76616C756532：value2 </span><br><span class="line">   服务端在接收到该数据后就可以遍历该字节流，首先一个字节一个字节的吃，当吃到3D这字节后，服务端就知道前面吃得字节表示一个key，再想后吃，如果遇到26，说明从刚才吃的3D到26子节之间的是上一个key的value，以此类推就可以解析出客户端传过来的参数。</span><br><span class="line"></span><br><span class="line">   现在有这样一个问题，如果我的参数值中就包含&#x3D;或&amp;这种特殊字符的时候该怎么办。 </span><br><span class="line">比如说“name1&#x3D;value1”,其中value1的值是“va&amp;lu&#x3D;e1”字符串，那么实际在传输过程中就会变成这样“name1&#x3D;va&amp;lu&#x3D;e1”。我们的本意是就只有一个键值对，但是服务端会解析成两个键值对，这样就产生了奇异。</span><br><span class="line"></span><br><span class="line">如何解决上述问题带来的歧义呢？解决的办法就是对参数进行URL编码 </span><br><span class="line">   URL编码只是简单的在特殊字符的各个字节前加上%，例如，我们对上述会产生奇异的字符进行URL编码后结果：“name1&#x3D;va%26lu%3D”，这样服务端会把紧跟在“%”后的字节当成普通的字节，就是不会把它当成各个参数或键值对的分隔符。</span><br></pre></td></tr></table></figure>

<p>POST请求是可以有体的，而GET请求不能有请求体。</p>
<p><img src="https://images2015.cnblogs.com/blog/1036857/201701/1036857-20170110102650244-1301022438.png" alt="img"></p>
<ul>
<li><strong>Referer</strong>: <a href="http://localhost:63342/test/test.html：请求来自哪个页面，例如你在百度上点击链接到了这里，那么Referer:[http://www.baidu.com](http://www.baidu.com/)；如果你是在浏览器的地址栏中直接输入的地址，那么就没有Referer这个请求头了；" target="_blank" rel="noopener">http://localhost:63342/test/test.html：请求来自哪个页面，例如你在百度上点击链接到了这里，那么Referer:[http://www.baidu.com](http://www.baidu.com/)；如果你是在浏览器的地址栏中直接输入的地址，那么就没有Referer这个请求头了；</a></li>
<li>Content-Type: application/x-www-form-urlencoded：表单的数据类型，说明会使用url格式编码数据；url编码的数据都是以“%”为前缀，后面跟随两位的16进制。</li>
<li>Content-Length:49：请求体的长度，这里表示13个字节。</li>
<li>username=‘林海峰’：请求体内容！hello是在表单中输入的数据，keyword是表单字段的名字</li>
</ul>
<p>Referer的应用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Referer请求头是比较有用的一个请求头，它可以用来做统计工作，也可以用来做防盗链。</span><br><span class="line">统计工作：我公司网站在百度上做了广告，但不知道在百度上做广告对我们网站的访问量是否有影响，那么可以对每个请求中的Referer进行分析，如果Referer为百度的很多，那么说明用户都是通过百度找到我们公司网站的。</span><br><span class="line">防盗链：我公司网站上有一个下载链接，而其他网站盗链了这个地址，例如在我网站上的index.html页面中有一个链接，点击即可下载JDK7.0，但有某个人的微博中盗链了这个资源，它也有一个链接指向我们网站的JDK7.0，也就是说登录它的微博，点击链接就可以从我网站上下载JDK7.0，这导致我们网站的广告没有看，但下载的却是我网站的资源。这时可以使用Referer进行防盗链，在资源被下载之前，我们对Referer进行判断，如果请求来自本网站，那么允许下载，如果非本网站，先跳转到本网站看广告，然后再允许下载。</span><br></pre></td></tr></table></figure>

<h3 id="HTTP响应协议"><a href="#HTTP响应协议" class="headerlink" title="HTTP响应协议"></a>HTTP响应协议</h3><p><img src="https://img2020.cnblogs.com/blog/1843708/202004/1843708-20200408012711003-1461199756.png" alt="img"></p>
<p>响应内容是由服务器发送给浏览器的内容，浏览器会根据响应内容来显示。遇到<img src=''>会开一个新的线程加载，所以有时图片多的话，内容会先显示出来，然后图片才一张张加载出来。 wsgi server</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#_*_coding:utf-8_*_</span><br><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"></span><br><span class="line">from wsgiref.simple_server import make_server</span><br><span class="line"># 定义application函数:</span><br><span class="line">def application(environ, start_response):</span><br><span class="line">    print(environ)</span><br><span class="line">    start_response(&#39;200 OK&#39;, [(&#39;Content-Type&#39;, &#39;text&#x2F;html&#39;)])</span><br><span class="line"></span><br><span class="line">    f&#x3D;open(&#39;test.html&#39;,&#39;rb&#39;)</span><br><span class="line">    return [f.read()]</span><br><span class="line"></span><br><span class="line"># 创建一个服务器，IP地址为空，端口是8000，处理函数是application:</span><br><span class="line">httpd &#x3D; make_server(&#39;&#39;, 8000, application)</span><br><span class="line">print(&#39;Serving HTTP on port 8000...&#39;)</span><br><span class="line"># 开始监听HTTP请求:</span><br><span class="line">httpd.serve_forever()</span><br></pre></td></tr></table></figure>

<p>test.html</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;form&gt;</span><br><span class="line">用户名:&lt;br&gt;</span><br><span class="line">&lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;username&quot;&gt;</span><br><span class="line">&lt;br&gt;</span><br><span class="line">密码:&lt;br&gt;</span><br><span class="line">&lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;password&quot;&gt;</span><br><span class="line">&lt;input type&#x3D;&quot;submit&quot; value&#x3D;&quot;登录&quot;&gt;</span><br><span class="line">&lt;&#x2F;form&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br><span class="line"></span><br><span class="line">test.html</span><br></pre></td></tr></table></figure>

<p><img src="https://images2015.cnblogs.com/blog/1036857/201701/1036857-20170110105232947-533137779.png" alt="img"></p>
<ul>
<li>HTTP/1.1 200 OK：响应协议为HTTP1.1，状态码为200，表示请求成功，OK是对状态码的解释；</li>
<li>Server:WSGIServer/0.2 CPython/3.6.0：服务器的版本信息；</li>
<li>Content-Type: text/html;charset=UTF-8：响应体使用的编码为UTF-8；</li>
<li>Content-Length: 217：响应体为217字节；</li>
<li>Set-Cookie: JSESSIONID=C97E2B4C55553EAB46079A4F263435A4; Path=/hello：响应给客户端的Cookie；</li>
<li>Date: Wed, 25 Sep 2012 04:15:03 GMT：响应的时间，这可能会有8小时的时区差；</li>
<li>Cache-Control:缓存控制</li>
</ul>
<p><strong>状态码</strong></p>
<p>响应头对浏览器来说很重要，它说明了响应的真正含义。例如200表示响应成功了，302表示重定向，这说明浏览器需要再发一个新的请求。</p>
<ul>
<li><p>200：请求成功，浏览器会把响应体内容（通常是html）显示在浏览器中；</p>
</li>
<li><p>404：请求的资源没有找到，说明客户端错误的请求了不存在的资源；</p>
</li>
<li><p>500：请求资源找到了，但服务器内部出现了错误；</p>
</li>
<li><p>302：重定向，当响应码为302时，表示服务器要求浏览器重新再发一个请求，服务器会发送一个响应头Location，它指定了新请求的URL地址；</p>
</li>
<li><p>304：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">当用户第一次请求index.html时，服务器会添加一个名为Last-Modified响应头，这个头说明了</span><br><span class="line">index.html的最后修改时间，浏览器会把index.html内容，以及最后响应时间缓存下来。当用户第</span><br><span class="line">二次请求index.html时，在请求中包含一个名为If-Modified-Since请求头，它的值就是第一次请</span><br><span class="line">求时服务器通过Last-Modified响应头发送给浏览器的值，即index.html最后的修改时间，</span><br><span class="line">If-Modified-Since请求头就是在告诉服务器，我这里浏览器缓存的index.html最后修改时间是这个,</span><br><span class="line">您看看现在的index.html最后修改时间是不是这个，如果还是，那么您就不用再响应这个index.html</span><br><span class="line">内容了，我会把缓存的内容直接显示出来。而服务器端会获取If-Modified-Since值，与index.html</span><br><span class="line">的当前最后修改时间比对，如果相同，服务器会发响应码304，表示index.html与浏览器上次缓存的相</span><br><span class="line">同，无需再次发送，浏览器可以显示自己的缓存页面，如果比对不同，那么说明index.html已经做了修</span><br><span class="line">改，服务器会响应200。</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p><img src="https://images2015.cnblogs.com/blog/1036857/201701/1036857-20170110105721947-1666405322.png" alt="img"></p>
<p><strong>其他响应头</strong></p>
<p>告诉浏览器不要缓存的响应头：</p>
<ul>
<li>Expires: -1；</li>
<li>Cache-Control: no-cache；</li>
<li>Pragma: no-cache；</li>
</ul>
<p>自动刷新响应头，浏览器会在3秒之后请求<a href="http://www.baidu.com/" target="_blank" rel="noopener">http://www.baidu.com</a>：</p>
<ul>
<li>Refresh: 3;url=<a href="http://www.baidu.com/" target="_blank" rel="noopener">http://www.baidu.com</a></li>
</ul>
<p><strong>HTML中指定响应头</strong></p>
<p>在HTMl页面中可以使用<meta http-equiv="" content="">来指定响应头，例如在index.html页面中给出<meta http-equiv="Refresh" content="3;url=http://www.baidu.com">，表示浏览器只会显示index.html页面3秒，然后自动跳转到<a href="http://www.baidu.com/" target="_blank" rel="noopener">http://www.baidu.com</a>.</p>
<p><strong>响应体</strong></p>
<p>响应体中可以使html格式或者json格式</p>
<h3 id="浏览器调试"><a href="#浏览器调试" class="headerlink" title="浏览器调试"></a>浏览器调试</h3><p>-右键检查–》调试模式</p>
<p>-elements：响应体，html格式 -console：调试窗口（js输出的内容，在这能看到） -network：发送的所有请求，all xhr：ajax请求</p>
<p><strong>补充:</strong></p>
<p>爬虫协议： 在url后面加上/robots.txt即可看到 网站哪些信息允许获取和不允许获取</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;www.baidu.com&#x2F;robots.txt</span><br></pre></td></tr></table></figure>

<p><img src="https://img2020.cnblogs.com/blog/1843708/202004/1843708-20200408214254090-901820730.png" alt="img"></p>
<p>RPC介绍</p>
<p><a href="https://www.jianshu.com/p/7d6853140e13" target="_blank" rel="noopener">https://www.jianshu.com/p/7d6853140e13</a></p>
<p>消息队列</p>
<p><a href="https://www.jianshu.com/p/36a7775b04ec" target="_blank" rel="noopener">https://www.jianshu.com/p/36a7775b04ec</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/09/17/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80/" data-id="ckd49wrd4001jl4ut10nv1rf6" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%88%AC%E8%99%AB/" rel="tag">爬虫</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Django框架之Ajax" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/01/02/Django%E6%A1%86%E6%9E%B6%E4%B9%8BAjax/" class="article-date">
  <time datetime="2019-01-02T15:17:01.000Z" itemprop="datePublished">2019-01-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/01/02/Django%E6%A1%86%E6%9E%B6%E4%B9%8BAjax/">Django框架之Ajax</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="一-多对多关系创建的三种方式"><a href="#一-多对多关系创建的三种方式" class="headerlink" title="一.多对多关系创建的三种方式"></a>一.多对多关系创建的三种方式</h1><h2 id="1）全自动（较为常用）"><a href="#1）全自动（较为常用）" class="headerlink" title="1）全自动（较为常用）"></a>1）全自动（较为常用）</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1 class Book(models.Model)</span><br><span class="line">2     titile &#x3D; models.CharField(max_length&#x3D;32)</span><br><span class="line">3     </span><br><span class="line">4     # 通过Django的ManyToManyField类方法快速创建第三张中间表</span><br><span class="line">5     authors &#x3D; models.ManyToManyField(to&#x3D;&#39;author&#39;)</span><br><span class="line">6     </span><br><span class="line">7     </span><br><span class="line">8 class Author(models.Model)</span><br><span class="line">9     name &#x3D; CharField(max_length&#x3D;32)</span><br></pre></td></tr></table></figure>

<ul>
<li>优点：自动创建第三章表，快速</li>
<li>缺点：第三张表只有三个字段，无法添加其余的字段</li>
</ul>
<h2 id="2-纯手动"><a href="#2-纯手动" class="headerlink" title="2)纯手动"></a>2)纯手动</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> 1 class Book(models.Model)</span><br><span class="line"> 2     titile &#x3D; models.CharField(max_length&#x3D;32)</span><br><span class="line"> 3 </span><br><span class="line"> 4     </span><br><span class="line"> 5     </span><br><span class="line"> 6 class Author(models.Model)</span><br><span class="line"> 7     name &#x3D; CharField(max_length&#x3D;32)</span><br><span class="line"> 8     </span><br><span class="line"> 9     </span><br><span class="line">10 # 手动创建第三张表并添加外键关系    </span><br><span class="line">11 class Book2Author(models.Model)</span><br><span class="line">12     book &#x3D; models.ForeignKey(to&#x3D;&#39;Book&#39;)</span><br><span class="line">13     author&#x3D;models.ForeignKey(to&#x3D;&#39;Author&#39;)</span><br><span class="line">14     create_time &#x3D; models.DateField(auto_now_add&#x3D;True)</span><br></pre></td></tr></table></figure>

<ul>
<li>优点：第三张表可以添加自己的扩展字段</li>
<li>缺点：orm查询的时候会带来不变</li>
</ul>
<h2 id="2）半自动（推荐使用）"><a href="#2）半自动（推荐使用）" class="headerlink" title="2）半自动（推荐使用）"></a>2）半自动（推荐使用）</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> 1 class Book(models.Model)</span><br><span class="line"> 2     titile &#x3D; models.CharField(max_length&#x3D;32)</span><br><span class="line"> 3     # 需要建一个外键字段，额外添加两个参数，through表示通过那一张表来表示第三张表，through_field表示哪两个字段是用来链接的</span><br><span class="line"> 4         authors &#x3D; models.ManyToManyField(to&#x3D;&#39;author&#39;，through&#x3D;‘Book2Author’， through_fields&#x3D;(&#39;book&#39;, &#39;author&#39;))</span><br><span class="line"> 5     </span><br><span class="line"> 6      </span><br><span class="line"> 7 class Author(models.Model)</span><br><span class="line"> 8     name &#x3D; CharField(max_length&#x3D;32)</span><br><span class="line"> 9     </span><br><span class="line">10   </span><br><span class="line">11 </span><br><span class="line">12 class Book2Author(models.Model)</span><br><span class="line">13     book &#x3D; models.ForeignKey(to&#x3D;&#39;Book&#39;)</span><br><span class="line">14     author&#x3D;models.ForeignKey(to&#x3D;&#39;Author&#39;)</span><br><span class="line">15     create_time &#x3D; models.DateField(auto_now_add&#x3D;True)</span><br></pre></td></tr></table></figure>

<ul>
<li><p>优点：第三张表可以任意扩展额外的字段，还可以使用orm的正反向查询</p>
</li>
<li><p>缺点：无法利用add，set，remove，claer这些方法</p>
</li>
</ul>
<p>虽然无法使用了 但是你还可以自己直接操作第三表</p>
<h1 id="二-Ajax介绍"><a href="#二-Ajax介绍" class="headerlink" title="二.Ajax介绍"></a>二.Ajax介绍</h1><h2 id="1）什么是Ajax？"><a href="#1）什么是Ajax？" class="headerlink" title="1）什么是Ajax？"></a>1）什么是Ajax？</h2><p>AJAX（Asynchronous Javascript And XML）翻译成中文就是“异步的Javascript和XML”。即使用Javascript语言与服务器进行异步交互，传输的数据为XML（当然，传输的数据不只是XML）。</p>
<p>AJAX 不是新的编程语言，而是一种使用现有标准的新方法。</p>
<p>AJAX 最大的优点是在不重新加载整个页面的情况下，可以与服务器交换数据并更新部分网页内容。（这一特点给用户的感受是在不知不觉中完成请求和响应过程）</p>
<p>AJAX 不需要任何浏览器插件，但需要用户允许JavaScript在浏览器上执行。</p>
<p>简单概括就是：异步提交，局部刷新</p>
<ul>
<li><p>同步交互：客户端发出一个请求后，需要等待服务器响应结束后，才能发出第二个请求；</p>
</li>
<li><p>异步交互：客户端发出一个请求后，无需等待服务器响应结束，就可以发出第二个请求。任务的结果是是通过异步回调机制 callback()</p>
</li>
<li><p>与后端交互的方法：</p>
</li>
</ul>
<table>
<thead>
<tr>
<th align="left">交互方式</th>
<th align="left">请求方式</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1.浏览器窗口输入回车</td>
<td align="left">get</td>
</tr>
<tr>
<td align="left">2.a标签href属性填写url点击</td>
<td align="left">get</td>
</tr>
<tr>
<td align="left">3.form表单</td>
<td align="left">get/post</td>
</tr>
<tr>
<td align="left">4.Ajax</td>
<td align="left">get/post</td>
</tr>
</tbody></table>
<p>Ajax并不是一门新的语言 它其实就是基于js写的一个功能模块而已 由于原生js书写ajax较为繁琐 所以我们直接学jQuery封装号的ajax模块操作</p>
<h2 id="2）Ajax的语法"><a href="#2）Ajax的语法" class="headerlink" title="2）Ajax的语法"></a>2）Ajax的语法</h2><p>举例：</p>
<p>需求：<img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200112224154791-255794900.png" alt="img"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> 1 # views.py</span><br><span class="line"> 2 def index(request):</span><br><span class="line"> 3     if request.method &#x3D;&#x3D; &#39;POST&#39;:</span><br><span class="line"> 4         i1 &#x3D; request.POST.get(&#39;i1&#39;)</span><br><span class="line"> 5         i2 &#x3D; request.POST.get(&#39;i2&#39;)</span><br><span class="line"> 6         # i1 和 i2 是字符串类型  需要先做类型转换</span><br><span class="line"> 7         i3 &#x3D; int(i1) + int(i2)</span><br><span class="line"> 8         return HttpResponse(i3)</span><br><span class="line"> 9     return render(request,&#39;index.html&#39;)</span><br><span class="line">10</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"> 1 # index.py</span><br><span class="line"> 2 </span><br><span class="line"> 3 &lt;input type&#x3D;&quot;text&quot; id&#x3D;&quot;i1&quot;&gt; + &lt;input type&#x3D;&quot;text&quot; id&#x3D;&quot;i2&quot;&gt; &#x3D; &lt;input type&#x3D;&quot;text&quot; id&#x3D;&quot;i3&quot;&gt;</span><br><span class="line"> 4 &lt;button id&#x3D;&quot;d1&quot;&gt;按钮&lt;&#x2F;button&gt;</span><br><span class="line"> 5 &lt;script&gt;</span><br><span class="line"> 6     &#x2F;&#x2F;绑定事件</span><br><span class="line"> 7     $(&#39;#d1&#39;).click(function () &#123;</span><br><span class="line"> 8         &#x2F;&#x2F; 获取两个框里面内容 朝后端提交异步请求</span><br><span class="line"> 9         &#x2F;&#x2F; ajax基本语法</span><br><span class="line">10         $.ajax(&#123;</span><br><span class="line">11             &#x2F;&#x2F; 1.到底朝哪个后端提交数据</span><br><span class="line">12             url:&#39;&#39;,  &#x2F;&#x2F; 控制数据的提交路径  有三种写法 跟form表单的action属性一致</span><br><span class="line">13             &#x2F;&#x2F; 2.指定当前请求方式</span><br><span class="line">14             type:&#39;post&#39;,</span><br><span class="line">15             &#x2F;&#x2F; 3.提交的数据</span><br><span class="line">16             data:&#123;&#39;i1&#39;:$(&#39;#i1&#39;).val(),&#39;i2&#39;:$(&#39;#i2&#39;).val()&#125;,</span><br><span class="line">17             &#x2F;&#x2F; 4.ajax是异步提交 所以需要给一个回调函数来处理返回的结果</span><br><span class="line">18             success:function (data) &#123;  &#x2F;&#x2F; data就是异步提交的返回结果</span><br><span class="line">19                 &#x2F;&#x2F; 将异步回调的结果通过DOM操作渲染到第三个input框中</span><br><span class="line">20                 $(&#39;#i3&#39;).val(data)</span><br><span class="line">21             &#125;</span><br><span class="line">22         &#125;)</span><br><span class="line">23     &#125;)</span><br><span class="line">24 &lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>

<p>3)前后端传输数据的编码格式</p>
<ul>
<li>urlencoded</li>
<li>formdata</li>
<li>application/json</li>
</ul>
<h3 id="1-form表单提交的数据"><a href="#1-form表单提交的数据" class="headerlink" title="1).form表单提交的数据"></a>1).form表单提交的数据</h3><p>默认是urlencoded编码格式传输数据 <strong>urlencoded数据格式:</strong>username=jason&amp;password=123</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1 # 简单代码</span><br><span class="line">2 &lt;form action&#x3D;&quot;&quot; method&#x3D;&quot;post&quot;&gt;</span><br><span class="line">3     &lt;p&gt;&lt;&#x2F;p&gt;</span><br><span class="line">4     &lt;p&gt;&lt;&#x2F;p&gt;</span><br><span class="line">5     &lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;username&quot;&gt;</span><br><span class="line">6     &lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;password&quot;&gt;</span><br><span class="line">7     &lt;input type&#x3D;&quot;submit&quot; &gt;</span><br><span class="line">8</span><br></pre></td></tr></table></figure>

<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200112224307350-625986349.png" alt="img"></p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200112224404240-542235347.png" alt="img"></p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200112224326500-1113744219.png" alt="img"></p>
<p>补充：django后端针对该格式的数据 会自动解析并帮你打包到request.POST中以键值对的形式存在</p>
<p>取出数据的方式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if request.method &#x3D;&#x3D; &#39;POST&#39;:    print(request.POST)</span><br><span class="line">    </span><br><span class="line"># &lt;QueryDict: &#123;&#39;username&#39;: [&#39;ajska&#39;], &#39;password&#39;: [&#39;123&#39;]&#125;&gt;</span><br></pre></td></tr></table></figure>

<p><strong>若再form表单中的enctype属性是以默认urlencoded格式,input中type属性是file格式，上传文件，只是上传的文件名，具体文件内容并没有上传上去，只有将格式改为form-data格式，通过request.files才能拿到最终数据</strong>,<strong>并且此时在网页中通过检查也无法轻易获取数据了</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action&#x3D;&quot;&quot; method&#x3D;&quot;post&quot; enctype&#x3D;&quot;multipart&#x2F;form-data&quot;&gt;</span><br><span class="line">    &lt;input type&#x3D;&quot;file&quot; name&#x3D;&quot;myfile&quot;&gt;</span><br></pre></td></tr></table></figure>

<p><strong>formdata数据格式还是可以传普通送键值对数据</strong> ，django后端针对符合urlencoded编码格式数据(普通键值对)还是统一解析到request.POST中 而针对formdata文件数据就会自动解析放到request.FILES中</p>
<h3 id="2-ajax提交的数据"><a href="#2-ajax提交的数据" class="headerlink" title="2)ajax提交的数据"></a>2)ajax提交的数据</h3><p><strong>前后端数据交互 编码格式与数据格式一定要一致</strong></p>
<ul>
<li><strong>默认也是urlnecoded编码格式</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> 1 &lt;script&gt;</span><br><span class="line"> 2 </span><br><span class="line"> 3     $(&#39;#d1&#39;).click(function () &#123;</span><br><span class="line"> 4         $.ajax(&#123;</span><br><span class="line"> 5             url:&#39;&#39;,</span><br><span class="line"> 6             type:&#39;post&#39;,</span><br><span class="line"> 7             data:&#123;&#39;username&#39;:&#39;jason&#39;,&#39;password&#39;:123&#125;,</span><br><span class="line"> 8             success:function (data) &#123;</span><br><span class="line"> 9                 alert(data)</span><br><span class="line">10             &#125;</span><br><span class="line">11         &#125;)</span><br><span class="line">12     &#125;)</span><br><span class="line">13  &lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>

<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200112224507577-2131318994.png" alt="img"></p>
<ul>
<li><p><strong>但是Ajax也能发送application/json格式数据</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> 1 $(&#39;#d2&#39;).on(&#39;click&#39;,function () &#123;</span><br><span class="line"> 2         $.ajax(&#123;</span><br><span class="line"> 3             url:&#39;&#39;,</span><br><span class="line"> 4             type:&#39;post&#39;,</span><br><span class="line"> 5             &#x2F;&#x2F; 修改content-Type参数</span><br><span class="line"> 6             contentType:&#39;application&#x2F;json&#39;,&#x2F;&#x2F;通过JSON.stringify出来成json格式</span><br><span class="line"> 7             data:JSON.stringify(&#123;&#39;username&#39;:&#39;jason&#39;,&#39;password&#39;:123&#125;),  &#x2F;&#x2F; 将数据序列化成json格式字符串</span><br><span class="line"> 8             success:function (data) &#123;</span><br><span class="line"> 9                 alert(data)</span><br><span class="line">10             &#125;</span><br><span class="line">11         &#125;)</span><br><span class="line">12     &#125;)</span><br></pre></td></tr></table></figure>

<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200112224544008-1699987451.png" alt="img"> </p>
</li>
</ul>
<p>此时后端无法拿到数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1 def ab_ct(request):</span><br><span class="line">2     if request.method &#x3D;&#x3D; &#39;POST&#39;:</span><br><span class="line">3         print(request.POST)</span><br><span class="line">4         print(request.FILES)</span><br></pre></td></tr></table></figure>

<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200112224601890-2000378963.png" alt="img"></p>
<p>数据已经传到requset.body中了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(request.body)</span><br></pre></td></tr></table></figure>

<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200112224717875-1786093194.png" alt="img"></p>
<p>这个数据既不在POST中，也不在FILES中，以json格式存在body中</p>
<p>我们可以自己解码反序列化拿到数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1 # 自己处理json格式数据</span><br><span class="line">2 json_bytes &#x3D; request.body</span><br><span class="line">3 # 先解码</span><br><span class="line">4 json_str &#x3D; json_bytes.decode(&#39;utf-8&#39;)</span><br><span class="line">5 # 再反序列化</span><br><span class="line">6 json_dict &#x3D; json.loads(json_str)</span><br><span class="line">7 #补充：json.loads能够自动解码并序列化</span><br><span class="line">8 json_dict &#x3D; json.loads(json_bytes)</span><br><span class="line">9 print(json_dict,type(json_dict))</span><br></pre></td></tr></table></figure>

<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200112224810533-416708605.png" alt="img"></p>
<ul>
<li><strong>ajax也能提交文件格式</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"> 1 &lt;input type&#x3D;&quot;file&quot; name&#x3D;&quot;myfile&quot; id&#x3D;&quot;i1&quot;&gt;</span><br><span class="line"> 2 &lt;button id&#x3D;&quot;d3&quot;&gt;ajax发送文件数据&lt;&#x2F;button&gt;</span><br><span class="line"> 3 &lt;script&gt;</span><br><span class="line"> 4  $(&#39;#d3&#39;).click(function () &#123;</span><br><span class="line"> 5         &#x2F;&#x2F; 1 需要先借助new方法生成一个内置对象</span><br><span class="line"> 6         var myFormData &#x3D; new FormData();</span><br><span class="line"> 7         &#x2F;&#x2F; 2 传普通键值对  当普通键值对较多的时候 我们可以利用for循环来添加</span><br><span class="line"> 8         myFormData.append(&#39;username&#39;,&#39;jason&#39;);</span><br><span class="line"> 9         myFormData.append(&#39;password&#39;,123);</span><br><span class="line">10         &#x2F;&#x2F; 3 传文件</span><br><span class="line">11         myFormData.append(&#39;myfile&#39;,$(&#39;#i1&#39;)[0].files[0]);  &#x2F;&#x2F; 获取input框内部用户上传的文件对象</span><br><span class="line">12         &#x2F;&#x2F; 发送ajax请求</span><br><span class="line">13         $.ajax(&#123;</span><br><span class="line">14             url:&#39;&#39;,</span><br><span class="line">15             type:&#39;post&#39;,</span><br><span class="line">16             data:myFormData,</span><br><span class="line">17             &#x2F;&#x2F; 发送formdata对象需要指定两个关键性的参数</span><br><span class="line">18 </span><br><span class="line">19             processData:false,  &#x2F;&#x2F; 让浏览器不要对你的数据进行任何的操作</span><br><span class="line">20             contentType:false,  &#x2F;&#x2F; 不要使用任何编码格式 对象formdata自带编码格式并且django能够识别该对象</span><br><span class="line">21 </span><br><span class="line">22             success:function (data) &#123;</span><br><span class="line">23                 alert(data)</span><br><span class="line">24             &#125;</span><br><span class="line">25         &#125;)</span><br><span class="line">26     &#125;)</span><br><span class="line">27 &lt;&#x2F;script&gt;</span><br><span class="line">28 def ab_ct(request):</span><br><span class="line">29     if request.method &#x3D;&#x3D; &#39;POST&#39;:</span><br><span class="line">30         print(request.POST)</span><br><span class="line">31         print(request.FILES)</span><br><span class="line">32     return render(request,&#39;ab_ct.html&#39;)</span><br></pre></td></tr></table></figure>



<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200112224836636-1700755797.png" alt="img"></p>
<h1 id="三-django内置序列化"><a href="#三-django内置序列化" class="headerlink" title="三.django内置序列化"></a>三.django内置序列化</h1><p>举例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> 1 def ab_se(request):</span><br><span class="line"> 2     # 拿到所有数据库的对象集</span><br><span class="line"> 3     user_queryset &#x3D; models.Userinfo.objects.all()</span><br><span class="line"> 4     user_list &#x3D; []</span><br><span class="line"> 5     for user_obj in user_queryset:</span><br><span class="line"> 6         user_list.append(&#123;</span><br><span class="line"> 7             &#39;username&#39;:user_obj.username,</span><br><span class="line"> 8             &#39;password&#39;:user_obj.password,</span><br><span class="line"> 9             &#39;gender&#39;:user_obj.get_gender_display(),</span><br><span class="line">10         &#125;)</span><br><span class="line">11      # 变成json格式</span><br><span class="line">12     res &#x3D; json.dumps(user_list)    </span><br><span class="line">13     return render(request,&#39;ab_se.html&#39;,locals())</span><br><span class="line">14</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">&#123;&#123; res &#125;&#125;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br></pre></td></tr></table></figure>

<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200112224918251-1672914133.png" alt="img"></p>
<p><strong>将数据库里面的数据通过json序列化 变成大字典的形式就是序列化</strong></p>
<p>通过 <a href="http://www.bejson.com/" target="_blank" rel="noopener">http://www.bejson.com/</a> 这个网站可以在线校验</p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200112224937996-2115546218.png" alt="img"></p>
<p>以上操作完全可以用Django的内置序列化模块 serializers处理，并且处理的更好</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1 from app01 import models</span><br><span class="line">2 from django.core import serializers</span><br><span class="line">3 def ab_se(request):</span><br><span class="line">4     user_queryset &#x3D; models.Userinfo.objects.all()</span><br><span class="line">5     # 传入需要修改的格式，以及需要序列化的对象集合</span><br><span class="line">6     res &#x3D; serializers.serialize(&#39;json&#39;,user_queryset) </span><br><span class="line">7     return HttpResponse(res)</span><br></pre></td></tr></table></figure>

<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200112225000406-492490093.png" alt="img"></p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200112225009636-276363465.png" alt="img"></p>
<h1 id="四：Django批量插入"><a href="#四：Django批量插入" class="headerlink" title="四：Django批量插入"></a>四：Django批量插入</h1><h2 id="1-普通批量插入"><a href="#1-普通批量插入" class="headerlink" title="1).普通批量插入"></a>1).普通批量插入</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> 1 def ab_bc(request):</span><br><span class="line"> 2     # 先插入1000条件数据</span><br><span class="line"> 3     for i in range(1,1001):</span><br><span class="line"> 4         models.Book.objects.create(title&#x3D;&#39;第%s本书&#39;%i)</span><br><span class="line"> 5     book_queryset &#x3D; models.Book.objects.all()</span><br><span class="line"> 6     return render(request,&#39;ab_bc.html&#39;,locals())</span><br><span class="line"> 7 &lt;&#x2F;head&gt;</span><br><span class="line"> 8 &lt;body&gt;</span><br><span class="line"> 9 &#123;% for book_obj in page_queryset %&#125;</span><br><span class="line">10     &lt;p&gt;&#123;&#123; book_obj.title &#125;&#125;&lt;&#x2F;p&gt;</span><br><span class="line">11 &#123;% endfor %&#125;</span><br><span class="line">12 &lt;&#x2F;body&gt;</span><br></pre></td></tr></table></figure>

<h2 id="2-快速批量插入"><a href="#2-快速批量插入" class="headerlink" title="2)快速批量插入"></a>2)快速批量插入</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> 1 def ab_bc(request):</span><br><span class="line"> 2     book_list &#x3D; []</span><br><span class="line"> 3     for i in range(1,10001):</span><br><span class="line"> 4         book_list.append(models.Book(title&#x3D;&#39;新的%s书&#39;%i))</span><br><span class="line"> 5     models.Book.objects.bulk_create(book_list)  # 批量插入数据的方式</span><br><span class="line"> 6     book_queryset &#x3D; models.Book.objects.all()</span><br><span class="line"> 7     return render(request,&#39;ab_bc.html&#39;,locals())</span><br><span class="line"> 8 &lt;&#x2F;head&gt;</span><br><span class="line"> 9 &lt;body&gt;</span><br><span class="line">10 &#123;% for book_obj in page_queryset %&#125;</span><br><span class="line">11     &lt;p&gt;&#123;&#123; book_obj.title &#125;&#125;&lt;&#x2F;p&gt;</span><br><span class="line">12 &#123;% endfor %&#125;</span><br><span class="line">13 &lt;&#x2F;body&gt;</span><br></pre></td></tr></table></figure>

<h1 id="五-自定义分页器"><a href="#五-自定义分页器" class="headerlink" title="五.自定义分页器"></a>五.自定义分页器</h1><p>分页器模板</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line">  1 class Pagination(object):</span><br><span class="line">  2     def __init__(self,current_page,all_count,per_page_num&#x3D;2,pager_count&#x3D;11):</span><br><span class="line">  3         &quot;&quot;&quot;</span><br><span class="line">  4         封装分页相关数据</span><br><span class="line">  5         :param current_page: 当前页</span><br><span class="line">  6         :param all_count:    数据库中的数据总条数</span><br><span class="line">  7         :param per_page_num: 每页显示的数据条数</span><br><span class="line">  8         :param pager_count:  最多显示的页码个数</span><br><span class="line">  9         </span><br><span class="line"> 10         用法:</span><br><span class="line"> 11         queryset &#x3D; model.objects.all()</span><br><span class="line"> 12         page_obj &#x3D; Pagination(current_page,all_count)</span><br><span class="line"> 13         page_data &#x3D; queryset[page_obj.start:page_obj.end]</span><br><span class="line"> 14         获取数据用page_data而不再使用原始的queryset</span><br><span class="line"> 15         获取前端分页样式用page_obj.page_html</span><br><span class="line"> 16         &quot;&quot;&quot;</span><br><span class="line"> 17         try:</span><br><span class="line"> 18             current_page &#x3D; int(current_page)</span><br><span class="line"> 19         except Exception as e:</span><br><span class="line"> 20             current_page &#x3D; 1</span><br><span class="line"> 21 </span><br><span class="line"> 22         if current_page &lt;1:</span><br><span class="line"> 23             current_page &#x3D; 1</span><br><span class="line"> 24 </span><br><span class="line"> 25         self.current_page &#x3D; current_page</span><br><span class="line"> 26 </span><br><span class="line"> 27         self.all_count &#x3D; all_count</span><br><span class="line"> 28         self.per_page_num &#x3D; per_page_num</span><br><span class="line"> 29 </span><br><span class="line"> 30 </span><br><span class="line"> 31         # 总页码</span><br><span class="line"> 32         all_pager, tmp &#x3D; divmod(all_count, per_page_num)</span><br><span class="line"> 33         if tmp:</span><br><span class="line"> 34             all_pager +&#x3D; 1</span><br><span class="line"> 35         self.all_pager &#x3D; all_pager</span><br><span class="line"> 36 </span><br><span class="line"> 37         self.pager_count &#x3D; pager_count</span><br><span class="line"> 38         self.pager_count_half &#x3D; int((pager_count - 1) &#x2F; 2)</span><br><span class="line"> 39 </span><br><span class="line"> 40     @property</span><br><span class="line"> 41     def start(self):</span><br><span class="line"> 42         return (self.current_page - 1) * self.per_page_num</span><br><span class="line"> 43 </span><br><span class="line"> 44     @property</span><br><span class="line"> 45     def end(self):</span><br><span class="line"> 46         return self.current_page * self.per_page_num</span><br><span class="line"> 47 </span><br><span class="line"> 48     def page_html(self):</span><br><span class="line"> 49         # 如果总页码 &lt; 11个：</span><br><span class="line"> 50         if self.all_pager &lt;&#x3D; self.pager_count:</span><br><span class="line"> 51             pager_start &#x3D; 1</span><br><span class="line"> 52             pager_end &#x3D; self.all_pager + 1</span><br><span class="line"> 53         # 总页码  &gt; 11</span><br><span class="line"> 54         else:</span><br><span class="line"> 55             # 当前页如果&lt;&#x3D;页面上最多显示11&#x2F;2个页码</span><br><span class="line"> 56             if self.current_page &lt;&#x3D; self.pager_count_half:</span><br><span class="line"> 57                 pager_start &#x3D; 1</span><br><span class="line"> 58                 pager_end &#x3D; self.pager_count + 1</span><br><span class="line"> 59 </span><br><span class="line"> 60             # 当前页大于5</span><br><span class="line"> 61             else:</span><br><span class="line"> 62                 # 页码翻到最后</span><br><span class="line"> 63                 if (self.current_page + self.pager_count_half) &gt; self.all_pager:</span><br><span class="line"> 64                     pager_end &#x3D; self.all_pager + 1</span><br><span class="line"> 65                     pager_start &#x3D; self.all_pager - self.pager_count + 1</span><br><span class="line"> 66                 else:</span><br><span class="line"> 67                     pager_start &#x3D; self.current_page - self.pager_count_half</span><br><span class="line"> 68                     pager_end &#x3D; self.current_page + self.pager_count_half + 1</span><br><span class="line"> 69 </span><br><span class="line"> 70         page_html_list &#x3D; []</span><br><span class="line"> 71         # 添加前面的nav和ul标签</span><br><span class="line"> 72         page_html_list.append(&#39;&#39;&#39;</span><br><span class="line"> 73                     &lt;nav aria-label&#x3D;&#39;Page navigation&gt;&#39;</span><br><span class="line"> 74                     &lt;ul class&#x3D;&#39;pagination&#39;&gt;</span><br><span class="line"> 75                 &#39;&#39;&#39;)</span><br><span class="line"> 76         first_page &#x3D; &#39;&lt;li&gt;&lt;a href&#x3D;&quot;?page&#x3D;%s&quot;&gt;首页&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;&#39; % (1)</span><br><span class="line"> 77         page_html_list.append(first_page)</span><br><span class="line"> 78 </span><br><span class="line"> 79         if self.current_page &lt;&#x3D; 1:</span><br><span class="line"> 80             prev_page &#x3D; &#39;&lt;li class&#x3D;&quot;disabled&quot;&gt;&lt;a href&#x3D;&quot;#&quot;&gt;上一页&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;&#39;</span><br><span class="line"> 81         else:</span><br><span class="line"> 82             prev_page &#x3D; &#39;&lt;li&gt;&lt;a href&#x3D;&quot;?page&#x3D;%s&quot;&gt;上一页&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;&#39; % (self.current_page - 1,)</span><br><span class="line"> 83 </span><br><span class="line"> 84         page_html_list.append(prev_page)</span><br><span class="line"> 85 </span><br><span class="line"> 86         for i in range(pager_start, pager_end):</span><br><span class="line"> 87             if i &#x3D;&#x3D; self.current_page:</span><br><span class="line"> 88                 temp &#x3D; &#39;&lt;li class&#x3D;&quot;active&quot;&gt;&lt;a href&#x3D;&quot;?page&#x3D;%s&quot;&gt;%s&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;&#39; % (i, i,)</span><br><span class="line"> 89             else:</span><br><span class="line"> 90                 temp &#x3D; &#39;&lt;li&gt;&lt;a href&#x3D;&quot;?page&#x3D;%s&quot;&gt;%s&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;&#39; % (i, i,)</span><br><span class="line"> 91             page_html_list.append(temp)</span><br><span class="line"> 92 </span><br><span class="line"> 93         if self.current_page &gt;&#x3D; self.all_pager:</span><br><span class="line"> 94             next_page &#x3D; &#39;&lt;li class&#x3D;&quot;disabled&quot;&gt;&lt;a href&#x3D;&quot;#&quot;&gt;下一页&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;&#39;</span><br><span class="line"> 95         else:</span><br><span class="line"> 96             next_page &#x3D; &#39;&lt;li&gt;&lt;a href&#x3D;&quot;?page&#x3D;%s&quot;&gt;下一页&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;&#39; % (self.current_page + 1,)</span><br><span class="line"> 97         page_html_list.append(next_page)</span><br><span class="line"> 98 </span><br><span class="line"> 99         last_page &#x3D; &#39;&lt;li&gt;&lt;a href&#x3D;&quot;?page&#x3D;%s&quot;&gt;尾页&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;&#39; % (self.all_pager,)</span><br><span class="line">100         page_html_list.append(last_page)</span><br><span class="line">101         # 尾部添加标签</span><br><span class="line">102         page_html_list.append(&#39;&#39;&#39;</span><br><span class="line">103                                            &lt;&#x2F;nav&gt;</span><br><span class="line">104                                            &lt;&#x2F;ul&gt;</span><br><span class="line">105                                        &#39;&#39;&#39;)</span><br><span class="line">106         return &#39;&#39;.join(page_html_list)</span><br></pre></td></tr></table></figure>

<p><strong>使用方式</strong></p>
<p>先在app01下面新建一个utils文件夹，并在其中建一个mypage.py文件，再将上面的模版复制进文件中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"> 1 from app01.utils.mypage import Pagination</span><br><span class="line"> 2 def ab_bc(request):</span><br><span class="line"> 3     # 先插入1000条件数据</span><br><span class="line"> 4     book_list &#x3D; []</span><br><span class="line"> 5     for i in range(1,10001):</span><br><span class="line"> 6         book_list.append(models.Book(title&#x3D;&#39;新的%s书&#39;%i))</span><br><span class="line"> 7     models.Book.objects.bulk_create(book_list)  # 批量插入数据的方式</span><br><span class="line"> 8     book_queryset &#x3D; models.Book.o   </span><br><span class="line"> 9     # 获取当前页</span><br><span class="line">10     current_page &#x3D; request.GET.get(&#39;page&#39;, 1)</span><br><span class="line">11     # 数据总条数</span><br><span class="line">12     all_count &#x3D; book_queryset.count()</span><br><span class="line">13     # 1 现生成一个自定义分页器类对象</span><br><span class="line">14     page_obj &#x3D; Pagination(current_page&#x3D;current_page,all_count&#x3D;all_count,pager_count&#x3D;9)</span><br><span class="line">15     # 2 针对真实的queryset数据进行切片操作</span><br><span class="line">16     page_queryset &#x3D; book_queryset[page_obj.start:page_obj.end]</span><br><span class="line">17     return render(request,&#39;ab_bc.html&#39;,locals())bjects.all()</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1 &lt;body&gt;</span><br><span class="line">2 &#123;% for book_obj in page_queryset %&#125;</span><br><span class="line">3     &lt;p&gt;&#123;&#123; book_obj.title &#125;&#125;&lt;&#x2F;p&gt;</span><br><span class="line">4 &#123;% endfor %&#125;</span><br><span class="line">5  &lt;!--渲染页面--&gt;</span><br><span class="line">6 &#123;&#123; page_obj.page_html|safe &#125;&#125;</span><br><span class="line">7 &lt;&#x2F;body&gt;</span><br><span class="line">8 &lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<h1 id="六-Ajax结合sweetalert实现二次删除"><a href="#六-Ajax结合sweetalert实现二次删除" class="headerlink" title="六.Ajax结合sweetalert实现二次删除"></a>六.Ajax结合sweetalert实现二次删除</h1><p>前期准备： <a href="https://github.com/lipis/bootstrap-sweetalert" target="_blank" rel="noopener">下载项目文件</a></p>
<p>建立一个satatic文件夹将此文件导入，在html文件中导入文件路径</p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200112225221952-1228871190.png" alt="img"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"> 1 # views.py</span><br><span class="line"> 2 </span><br><span class="line"> 3 from django.http import JsonResponse  # 可以实现返回一个字典</span><br><span class="line"> 4 import time</span><br><span class="line"> 5 def show_user(request):</span><br><span class="line"> 6     &quot;&quot;&quot;</span><br><span class="line"> 7     前后端如果是通过ajax进行交互 那么交互的媒介一般情况下都是一个字典</span><br><span class="line"> 8     :param request:</span><br><span class="line"> 9     :return:</span><br><span class="line">10     &quot;&quot;&quot;</span><br><span class="line">11     if request.method &#x3D;&#x3D; &#39;POST&#39;:</span><br><span class="line">12         time.sleep(3)</span><br><span class="line">13         </span><br><span class="line">14         back_dic &#x3D; &#123;&quot;code&quot;:1000,&#39;msg&#39;:&#39;&#39;&#125;</span><br><span class="line">15         </span><br><span class="line">16         delete_id &#x3D; request.POST.get(&#39;delete_id&#39;)</span><br><span class="line">17         </span><br><span class="line">18         models.Userinfo.objects.filter(pk&#x3D;delete_id).delete()</span><br><span class="line">19         </span><br><span class="line">20         back_dic[&#39;msg&#39;] &#x3D; &#39;删除成功，准备跑路！！！&#39;</span><br><span class="line">21         </span><br><span class="line">22         return JsonResponse(back_dic)</span><br><span class="line">23     user_queryset &#x3D; models.Userinfo.objects.all()</span><br><span class="line">24     return render(request,&#39;show_user.html&#39;,locals())</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"> 1 &lt;!DOCTYPE html&gt;</span><br><span class="line"> 2 &lt;html lang&#x3D;&quot;en&quot;&gt;</span><br><span class="line"> 3 &lt;head&gt;</span><br><span class="line"> 4     &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class="line"> 5     &lt;title&gt;Title&lt;&#x2F;title&gt;</span><br><span class="line"> 6     &lt;script src&#x3D;&quot;https:&#x2F;&#x2F;cdn.bootcss.com&#x2F;jquery&#x2F;3.4.1&#x2F;jquery.min.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line"> 7     &lt;link href&#x3D;&quot;https:&#x2F;&#x2F;cdn.bootcss.com&#x2F;twitter-bootstrap&#x2F;3.4.1&#x2F;css&#x2F;bootstrap.min.css&quot; rel&#x3D;&quot;stylesheet&quot;&gt;</span><br><span class="line"> 8     &lt;script src&#x3D;&quot;https:&#x2F;&#x2F;cdn.bootcss.com&#x2F;twitter-bootstrap&#x2F;3.4.1&#x2F;js&#x2F;bootstrap.min.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line"> 9     &#123;% load  static %&#125;</span><br><span class="line">10     &lt;link rel&#x3D;&quot;stylesheet&quot; href&#x3D;&quot;&#123;% static &#39;dist&#x2F;sweetalert.css&#39; %&#125;&quot;&gt;</span><br><span class="line">11     &lt;script src&#x3D;&quot;&#123;% static &#39;dist&#x2F;sweetalert.min.js&#39; %&#125;&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line">12     &lt;style&gt;</span><br><span class="line">13         div.sweet-alert h2 &#123;</span><br><span class="line">14             padding-top: 10px;</span><br><span class="line">15         &#125;</span><br><span class="line">16     &lt;&#x2F;style&gt;</span><br><span class="line">17 &lt;&#x2F;head&gt;</span><br><span class="line">18 &lt;body&gt;</span><br><span class="line">19 &lt;div class&#x3D;&quot;container&quot;&gt;</span><br><span class="line">20     &lt;div class&#x3D;&quot;row&quot;&gt;</span><br><span class="line">21         &lt;div class&#x3D;&quot;col-md-8 col-md-offset-2&quot;&gt;</span><br><span class="line">22             &lt;h2 class&#x3D;&quot;text-center&quot;&gt;数据展示&lt;&#x2F;h2&gt;</span><br><span class="line">23             &lt;table class&#x3D;&quot;table-hover table table-striped&quot;&gt;</span><br><span class="line">24                 &lt;thead&gt;</span><br><span class="line">25                 &lt;tr&gt;</span><br><span class="line">26                     &lt;th&gt;主键&lt;&#x2F;th&gt;</span><br><span class="line">27                     &lt;th&gt;用户名&lt;&#x2F;th&gt;</span><br><span class="line">28                     &lt;th&gt;密码&lt;&#x2F;th&gt;</span><br><span class="line">29                     &lt;th&gt;性别&lt;&#x2F;th&gt;</span><br><span class="line">30                     &lt;th&gt;操作&lt;&#x2F;th&gt;</span><br><span class="line">31                 &lt;&#x2F;tr&gt;</span><br><span class="line">32                 &lt;&#x2F;thead&gt;</span><br><span class="line">33                 &lt;tbody&gt;</span><br><span class="line">34                 &#123;% for user_obj in user_queryset %&#125;</span><br><span class="line">35                     &lt;tr&gt;</span><br><span class="line">36                         &lt;td&gt;&#123;&#123; user_obj.pk &#125;&#125;&lt;&#x2F;td&gt;</span><br><span class="line">37                         &lt;td&gt;&#123;&#123; user_obj.username &#125;&#125;&lt;&#x2F;td&gt;</span><br><span class="line">38                         &lt;td&gt;&#123;&#123; user_obj.password &#125;&#125;&lt;&#x2F;td&gt;</span><br><span class="line">39                         &lt;td&gt;&#123;&#123; user_obj.get_gender_display &#125;&#125;&lt;&#x2F;td&gt;</span><br><span class="line">40                         &lt;td&gt;</span><br><span class="line">41                             &lt;a href&#x3D;&quot;#&quot; class&#x3D;&quot;btn btn-primary btn-xs&quot;&gt;编辑&lt;&#x2F;a&gt;</span><br><span class="line">42                             &lt;a href&#x3D;&quot;#&quot; class&#x3D;&quot;btn btn-danger btn-xs cancel&quot; data_id&#x3D;&quot;&#123;&#123; user_obj.pk &#125;&#125;&quot;&gt;删除&lt;&#x2F;a&gt;</span><br><span class="line">43                         &lt;&#x2F;td&gt;</span><br><span class="line">44                     &lt;&#x2F;tr&gt;</span><br><span class="line">45                 &#123;% endfor %&#125;</span><br><span class="line">46                 &lt;&#x2F;tbody&gt;</span><br><span class="line">47 </span><br><span class="line">48             &lt;&#x2F;table&gt;</span><br><span class="line">49         &lt;&#x2F;div&gt;</span><br><span class="line">50     &lt;&#x2F;div&gt;</span><br><span class="line">51 &lt;&#x2F;div&gt;</span><br><span class="line">52 </span><br><span class="line">53 </span><br><span class="line">54 &lt;script&gt;</span><br><span class="line">55     $(&#39;.cancel&#39;).click(function () &#123;</span><br><span class="line">56         var $aEle &#x3D; $(this);</span><br><span class="line">57         swal(&#123;</span><br><span class="line">58                 title: &quot;你确定要删吗?&quot;,</span><br><span class="line">59                 text: &quot;你如果删了，你可要准备跑路啊!&quot;,</span><br><span class="line">60                 type: &quot;warning&quot;,</span><br><span class="line">61                 showCancelButton: true,</span><br><span class="line">62                 confirmButtonClass: &quot;btn-danger&quot;,</span><br><span class="line">63                 confirmButtonText: &quot;是的,老子就要删!&quot;,</span><br><span class="line">64                 cancelButtonText: &quot;惹不起惹不起!&quot;,</span><br><span class="line">65                 closeOnConfirm: false,</span><br><span class="line">66                 closeOnCancel: false,</span><br><span class="line">67                 showLoaderOnConfirm: true</span><br><span class="line">68             &#125;,</span><br><span class="line">69             function (isConfirm) &#123;</span><br><span class="line">70                 if (isConfirm) &#123;</span><br><span class="line">71                     &#x2F;&#x2F; 发送ajax请求</span><br><span class="line">72                     $.ajax(&#123;</span><br><span class="line">73                         url:&#39;&#39;,</span><br><span class="line">74                         type:&#39;post&#39;,</span><br><span class="line">75                         data:&#123;&#39;delete_id&#39;:$aEle.attr(&quot;data_id&quot;)&#125;,</span><br><span class="line">76                         success:function (data) &#123;  &#x2F;&#x2F; 回调函数会自动将二进制的json格式数据 解码并反序列成js中的数据类型</span><br><span class="line">77                             if (data.code &#x3D;&#x3D; 1000)&#123;</span><br><span class="line">78                                 swal(&quot;删了!&quot;, &quot;你准备跑路吧!&quot;, &quot;success&quot;);</span><br><span class="line">79                                 &#x2F;&#x2F; 方式1</span><br><span class="line">80                                 &#123;#window.location.reload()#&#125;</span><br><span class="line">81                                 &#x2F;&#x2F; 方式2 DOM操作动态修改</span><br><span class="line">82                                 $aEle.parent().parent().remove()  &#x2F;&#x2F; 将标签直接移除</span><br><span class="line">83                             &#125;else&#123;</span><br><span class="line">84                                 swal(&#39;发生了未知的错误&#39;, &quot;error&quot;);</span><br><span class="line">85                             &#125;</span><br><span class="line">86                         &#125;</span><br><span class="line">87                     &#125;);</span><br><span class="line">88 </span><br><span class="line">89                 &#125; else &#123;</span><br><span class="line">90                     swal(&quot;怂笔&quot;, &quot;你成功的刷新我对你的认知&quot;, &quot;error&quot;);</span><br><span class="line">91                 &#125;</span><br><span class="line">92             &#125;);</span><br><span class="line">93     &#125;)</span><br><span class="line">94 &lt;&#x2F;script&gt;</span><br><span class="line">95 &lt;&#x2F;body&gt;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/01/02/Django%E6%A1%86%E6%9E%B6%E4%B9%8BAjax/" data-id="ckd49wraz0000l4utft0z5jto" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Django/" rel="tag">Django</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Django框架模型层常用字段和事物操作" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/12/27/Django%E6%A1%86%E6%9E%B6%E6%A8%A1%E5%9E%8B%E5%B1%82%E5%B8%B8%E7%94%A8%E5%AD%97%E6%AE%B5%E5%92%8C%E4%BA%8B%E7%89%A9%E6%93%8D%E4%BD%9C/" class="article-date">
  <time datetime="2018-12-27T13:12:59.000Z" itemprop="datePublished">2018-12-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/12/27/Django%E6%A1%86%E6%9E%B6%E6%A8%A1%E5%9E%8B%E5%B1%82%E5%B8%B8%E7%94%A8%E5%AD%97%E6%AE%B5%E5%92%8C%E4%BA%8B%E7%89%A9%E6%93%8D%E4%BD%9C/">Django框架模型层常用字段和事物操作</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="一-models中常用的字段及参数"><a href="#一-models中常用的字段及参数" class="headerlink" title="一.models中常用的字段及参数"></a>一.models中常用的字段及参数</h1><h2 id="常用字段"><a href="#常用字段" class="headerlink" title="常用字段"></a>常用字段</h2><p><strong>AutoField</strong></p>
<p>int自增列，必须填入参数 primary_key=True。当model中如果没有自增列，则自动会创建一个列名为id的列。</p>
<p><strong>IntegerField</strong></p>
<p>一个整数类型,范围在 -2147483648 to 2147483647。(一般不用它来存手机号（自带正负号导致位数不够)，直接用字符串存，)</p>
<p><strong>CharField</strong></p>
<p>字符类型，必须提供max_length参数， max_length表示字符长度。</p>
<p>补充注意： 这里需要知道的是Django中的CharField对应的MySQL数据库中的varchar类型，没有设置对应char类型的字段，但是Django允许我们自定义新的字段</p>
<p>如何自定义char字段类型</p>
<ul>
<li>大胆推测，字段是不是类</li>
</ul>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200109212854513-1453222851.png" alt="img"></p>
<ul>
<li>自己根据源码写类似的Char字段</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> 1 # 在models.py文件下创建自己的Char字段</span><br><span class="line"> 2 # 导入模块</span><br><span class="line"> 3 from django.db.models import Field</span><br><span class="line"> 4 </span><br><span class="line"> 5 # 自定义继承field的Char类型字段</span><br><span class="line"> 6 class RealCharField(Fied)</span><br><span class="line"> 7     # 也需要长度设置</span><br><span class="line"> 8     def __init__(self, max_length, *args, **kwargs)</span><br><span class="line"> 9         self.max_length &#x3D; max_length</span><br><span class="line">10     # 拦截父类的方法，操作完之后利用super调用父类的方法，让其带着数据再回去</span><br><span class="line">11         super().__init__(max_length&#x3D;max_length,*args,**kwargs)</span><br><span class="line">12     def db_type(self, connection):</span><br><span class="line">13         return &#39;char(%s)&#39;%self.max_length</span><br><span class="line">14</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1 #上面已经写好了自定义Char字段</span><br><span class="line">2 </span><br><span class="line">3 # 在models.py中直接引用我们设置好的models就可以了</span><br><span class="line">4 class Movie(models.Model):</span><br><span class="line">5     testfield &#x3D; RealCharField(max_length&#x3D;32, null&#x3D;True)</span><br><span class="line">6 </span><br><span class="line">7 # 这样在通过数据库迁移命令就可以导入数据库了</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line">  1 AutoField(Field)</span><br><span class="line">  2         - int自增列，必须填入参数 primary_key&#x3D;True</span><br><span class="line">  3 </span><br><span class="line">  4     BigAutoField(AutoField)</span><br><span class="line">  5         - bigint自增列，必须填入参数 primary_key&#x3D;True(值超过十位数可以用的字段)</span><br><span class="line">  6 </span><br><span class="line">  7         注：当model中如果没有自增列，则自动会创建一个列名为id的列 </span><br><span class="line">  8         from django.db import models</span><br><span class="line">  9 </span><br><span class="line"> 10         class UserInfo(models.Model):</span><br><span class="line"> 11             # 自动创建一个列名为id的且为自增的整数列</span><br><span class="line"> 12             username &#x3D; models.CharField(max_length&#x3D;32)</span><br><span class="line"> 13 </span><br><span class="line"> 14         class Group(models.Model):</span><br><span class="line"> 15             # 自定义自增列</span><br><span class="line"> 16             nid &#x3D; models.AutoField(primary_key&#x3D;True)</span><br><span class="line"> 17             name &#x3D; models.CharField(max_length&#x3D;32)</span><br><span class="line"> 18 </span><br><span class="line"> 19     SmallIntegerField(IntegerField):</span><br><span class="line"> 20         - 小整数 -32768 ～ 32767</span><br><span class="line"> 21 </span><br><span class="line"> 22     PositiveSmallIntegerField(PositiveIntegerRelDbTypeMixin, IntegerField)</span><br><span class="line"> 23         - 正小整数(不带符号）) 0 ～ 32767</span><br><span class="line"> 24     IntegerField(Field)</span><br><span class="line"> 25         - 整数列(有符号的) -2147483648 ～ 2147483647</span><br><span class="line"> 26 </span><br><span class="line"> 27     PositiveIntegerField(PositiveIntegerRelDbTypeMixin, IntegerField)</span><br><span class="line"> 28         - 正整数 0 ～ 2147483647</span><br><span class="line"> 29 </span><br><span class="line"> 30     BigIntegerField(IntegerField):</span><br><span class="line"> 31         - 长整型(有符号的) -9223372036854775808 ～ 9223372036854775807</span><br><span class="line"> 32 </span><br><span class="line"> 33     BooleanField(Field)</span><br><span class="line"> 34         - 布尔值类型（给该字段传值，传True对应生成1，传False对应生成0）</span><br><span class="line"> 35 </span><br><span class="line"> 36     NullBooleanField(Field):</span><br><span class="line"> 37         - 可以为空的布尔值</span><br><span class="line"> 38 </span><br><span class="line"> 39     CharField(Field)</span><br><span class="line"> 40         - 字符类型</span><br><span class="line"> 41         - 必须提供max_length参数， max_length表示字符长度</span><br><span class="line"> 42 </span><br><span class="line"> 43     TextField(Field)</span><br><span class="line"> 44         - 文本类型（存储大段文本，图片等）</span><br><span class="line"> 45 </span><br><span class="line"> 46     EmailField(CharField)：</span><br><span class="line"> 47         - 字符串类型，Django Admin以及ModelForm中提供验证机制（用校验组件可以校验必须是邮箱格式）</span><br><span class="line"> 48 </span><br><span class="line"> 49     IPAddressField(Field)</span><br><span class="line"> 50         - 字符串类型，Django Admin以及ModelForm中提供验证 IPV4 机制</span><br><span class="line"> 51 </span><br><span class="line"> 52     GenericIPAddressField(Field)</span><br><span class="line"> 53         - 字符串类型，Django Admin以及ModelForm中提供验证 Ipv4和Ipv6</span><br><span class="line"> 54         - 参数：</span><br><span class="line"> 55             protocol，用于指定Ipv4或Ipv6， &#39;both&#39;,&quot;ipv4&quot;,&quot;ipv6&quot;</span><br><span class="line"> 56             unpack_ipv4， 如果指定为True，则输入::ffff:192.0.2.1时候，可解析为192.0.2.1，开启此功能，需要protocol&#x3D;&quot;both&quot;</span><br><span class="line"> 57 </span><br><span class="line"> 58     URLField(CharField)</span><br><span class="line"> 59         - 字符串类型，Django Admin以及ModelForm中提供验证 URL</span><br><span class="line"> 60 </span><br><span class="line"> 61     SlugField(CharField)</span><br><span class="line"> 62         - 字符串类型，Django Admin以及ModelForm中提供验证支持 字母、数字、下划线、连接符（减号）</span><br><span class="line"> 63 </span><br><span class="line"> 64     CommaSeparatedIntegerField(CharField)</span><br><span class="line"> 65         - 字符串类型，格式必须为逗号分割的数字</span><br><span class="line"> 66 </span><br><span class="line"> 67     UUIDField(Field)</span><br><span class="line"> 68         - 字符串类型，Django Admin以及ModelForm中提供对UUID格式的验证</span><br><span class="line"> 69 </span><br><span class="line"> 70     FilePathField(Field)</span><br><span class="line"> 71         - 字符串，Django Admin以及ModelForm中提供读取文件夹下文件的功能</span><br><span class="line"> 72         - 参数：</span><br><span class="line"> 73                 path,                      文件夹路径</span><br><span class="line"> 74                 match&#x3D;None,                正则匹配</span><br><span class="line"> 75                 recursive&#x3D;False,           递归下面的文件夹</span><br><span class="line"> 76                 allow_files&#x3D;True,          允许文件</span><br><span class="line"> 77                 allo w_folders&#x3D;False,       允许文件夹</span><br><span class="line"> 78 </span><br><span class="line"> 79     FileField(Field)</span><br><span class="line"> 80         - 字符串，路径保存在数据库，文件上传到指定目录</span><br><span class="line"> 81         - 参数：</span><br><span class="line"> 82             upload_to &#x3D; &quot;指定文件路径&quot;      上传文件的保存路径（通过这个参数可以直接自动将数据保存到指定路径）</span><br><span class="line"> 83             storage &#x3D; None      存储组件，默认django.core.files.storage.FileSystemStorage</span><br><span class="line"> 84 </span><br><span class="line"> 85     ImageField(FileField)</span><br><span class="line"> 86         - 字符串，路径保存在数据库，文件上传到指定目录</span><br><span class="line"> 87         - 参数：</span><br><span class="line"> 88             upload_to &#x3D; &quot;&quot;      上传文件的保存路径</span><br><span class="line"> 89             storage &#x3D; None      存储组件，默认django.core.files.storage.FileSystemStorage</span><br><span class="line"> 90             width_field&#x3D;None,   上传图片的高度保存的数据库字段名（字符串）</span><br><span class="line"> 91             height_field&#x3D;None   上传图片的宽度保存的数据库字段名（字符串）</span><br><span class="line"> 92 </span><br><span class="line"> 93     DateTimeField(DateField)</span><br><span class="line"> 94         - 日期+时间格式 YYYY-MM-DD HH:MM[:ss[.uuuuuu]][TZ]</span><br><span class="line"> 95 </span><br><span class="line"> 96     DateField(DateTimeCheckMixin, Field)</span><br><span class="line"> 97         - 日期格式      YYYY-MM-DD</span><br><span class="line"> 98 </span><br><span class="line"> 99     TimeField(DateTimeCheckMixin, Field)</span><br><span class="line">100         - 时间格式      HH:MM[:ss[.uuuuuu]]</span><br><span class="line">101 </span><br><span class="line">102     DurationField(Field)</span><br><span class="line">103         - 长整数，时间间隔，数据库中按照bigint存储，ORM中获取的值为datetime.timedelta类型</span><br><span class="line">104 </span><br><span class="line">105     FloatField(Field)</span><br><span class="line">106         - 浮点型</span><br><span class="line">107 </span><br><span class="line">108     DecimalField(Field)</span><br><span class="line">109         - 10进制小数</span><br><span class="line">110         - 参数：</span><br><span class="line">111             max_digits，小数总长度</span><br><span class="line">112             decimal_places，小数位长度</span><br><span class="line">113 </span><br><span class="line">114     BinaryField(Field)</span><br><span class="line">115         - 二进制类型</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"> 1 ORM字段与mysql字段的对应关系 </span><br><span class="line"> 2 </span><br><span class="line"> 3 对应关系：</span><br><span class="line"> 4     &#39;AutoField&#39;: &#39;integer AUTO_INCREMENT&#39;,</span><br><span class="line"> 5     &#39;BigAutoField&#39;: &#39;bigint AUTO_INCREMENT&#39;,</span><br><span class="line"> 6     &#39;BinaryField&#39;: &#39;longblob&#39;,</span><br><span class="line"> 7     &#39;BooleanField&#39;: &#39;bool&#39;,</span><br><span class="line"> 8     &#39;CharField&#39;: &#39;varchar(%(max_length)s)&#39;,</span><br><span class="line"> 9     &#39;CommaSeparatedIntegerField&#39;: &#39;varchar(%(max_length)s)&#39;,</span><br><span class="line">10     &#39;DateField&#39;: &#39;date&#39;,</span><br><span class="line">11     &#39;DateTimeField&#39;: &#39;datetime&#39;,</span><br><span class="line">12     &#39;DecimalField&#39;: &#39;numeric(%(max_digits)s, %(decimal_places)s)&#39;,</span><br><span class="line">13     &#39;DurationField&#39;: &#39;bigint&#39;,</span><br><span class="line">14     &#39;FileField&#39;: &#39;varchar(%(max_length)s)&#39;,</span><br><span class="line">15     &#39;FilePathField&#39;: &#39;varchar(%(max_length)s)&#39;,</span><br><span class="line">16     &#39;FloatField&#39;: &#39;double precision&#39;,</span><br><span class="line">17     &#39;IntegerField&#39;: &#39;integer&#39;,</span><br><span class="line">18     &#39;BigIntegerField&#39;: &#39;bigint&#39;,</span><br><span class="line">19     &#39;IPAddressField&#39;: &#39;char(15)&#39;,</span><br><span class="line">20     &#39;GenericIPAddressField&#39;: &#39;char(39)&#39;,</span><br><span class="line">21     &#39;NullBooleanField&#39;: &#39;bool&#39;,</span><br><span class="line">22     &#39;OneToOneField&#39;: &#39;integer&#39;,</span><br><span class="line">23     &#39;PositiveIntegerField&#39;: &#39;integer UNSIGNED&#39;,</span><br><span class="line">24     &#39;PositiveSmallIntegerField&#39;: &#39;smallint UNSIGNED&#39;,</span><br><span class="line">25     &#39;SlugField&#39;: &#39;varchar(%(max_length)s)&#39;,</span><br><span class="line">26     &#39;SmallIntegerField&#39;: &#39;smallint&#39;,</span><br><span class="line">27     &#39;TextField&#39;: &#39;longtext&#39;,</span><br><span class="line">28     &#39;TimeField&#39;: &#39;time&#39;,</span><br><span class="line">29     &#39;UUIDField&#39;: &#39;char(32)&#39;,</span><br></pre></td></tr></table></figure>

<h2 id="字段参数"><a href="#字段参数" class="headerlink" title="字段参数"></a>字段参数</h2><p><strong>null</strong></p>
<p>用于表示某个字段可以为空。</p>
<p><strong>unique</strong></p>
<p>如果设置为unique=True 则该字段在此表中必须是唯一的 。</p>
<p><strong>db_index</strong></p>
<p>如果db_index=True 则代表着为此字段设置索引。</p>
<p><strong>default</strong></p>
<p>为该字段设置默认值。</p>
<p><strong>DateField和DateTimeField</strong></p>
<p>两个参数</p>
<p><strong>auto_now_add</strong></p>
<p>配置auto_now_add=True，创建数据记录的时候会把当前时间添加到数据库。</p>
<p><strong>auto_now</strong></p>
<p>配置上auto_now=True，每次更新数据记录的时候会更新该字段。</p>
<h2 id="关系字段"><a href="#关系字段" class="headerlink" title="关系字段"></a>关系字段</h2><p><strong>ForeignKey</strong></p>
<p>外键类型在ORM中用来表示外键关联关系，一般把ForeignKey字段设置在 ‘一对多’中’多’的一方。</p>
<p>ForeignKey可以和其他表做关联关系同时也可以和自身做关联关系。</p>
<h2 id="字段参数-1"><a href="#字段参数-1" class="headerlink" title="字段参数"></a>字段参数</h2><p><strong>to</strong></p>
<p>设置要关联的表</p>
<p><strong>to_field</strong></p>
<p>设置要关联的表的字段</p>
<p><strong>on_delete</strong></p>
<p>当删除关联表中的数据时，当前表与其关联的行的行为。</p>
<p><strong>models.CASCADE</strong></p>
<p>删除关联数据，与之关联也删除（jdango1.x版本默认级联跟新级联删除）</p>
<p><strong>db_constraint</strong></p>
<p>是否在数据库中创建外键约束，默认为True。</p>
<p><strong>models.DO_NOTHING</strong> 删除关联数据，引发错误IntegrityError</p>
<p><strong>models.PROTECT</strong> 删除关联数据，引发错误ProtectedError</p>
<p><strong>models.SET_NULL</strong> 删除关联数据，与之关联的值设置为null（前提FK字段需要设置为可空）</p>
<p><strong>models.SET_DEFAULT</strong> 删除关联数据，与之关联的值设置为默认值（前提FK字段需要设置默认值）</p>
<p><strong>models.SET</strong></p>
<p>删除关联数据， a. 与之关联的值设置为指定值，设置：models.SET(值) b. 与之关联的值设置为可执行对象的返回值，设置：models.SET(可执行对象)</p>
<p><strong>OneToOneField</strong></p>
<p>一对一字段。</p>
<p>通常一对一字段用来扩展已有字段。(通俗的说就是一个人的所有信息不是放在一张表里面的，简单的信息一张表，隐私的信息另一张表，之间通过一对一外键关联)</p>
<p><strong>字段参数</strong></p>
<p><strong>to</strong></p>
<p>设置要关联的表。</p>
<p><strong>to_field</strong></p>
<p>设置要关联的字段。</p>
<p><strong>on_delete</strong></p>
<p>当删除关联表中的数据时，当前表与其关联的行的行为。(参考上面的例子)</p>
<h1 id="二-choices参数"><a href="#二-choices参数" class="headerlink" title="二.choices参数"></a>二.choices参数</h1><p>当数据能够被完全列举（例如用户的性别，学历，婚否，在职状态，客户来源等），你就可以考虑使用choices参数</p>
<p>通过choices参数我们可以解决一个问题：将能够列举的数据存入数据库时只存入对应数据的数字，取出来的时候会将此数字对应的数据展示给用户</p>
<p>下面是具体操作示范</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">class Userinfo(models.Model):</span><br><span class="line">    name &#x3D; models.CharField(max_length&#x3D;32)</span><br><span class="line">    # 将gender字段提前列举并通过choices参数传给下面的gender</span><br><span class="line">    gender_choices &#x3D; (</span><br><span class="line">        (1,&#39;男&#39;),</span><br><span class="line">        (2, &#39;女&#39;),</span><br><span class="line">        (3, &#39;其他&#39;),</span><br><span class="line">    )</span><br><span class="line">    gender &#x3D; models.IntegerField(choices&#x3D;gender_choices)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1 # 此时gender以数字的形式 </span><br><span class="line">2     models.Userinfo.objects.create(name&#x3D;&#39;jason&#39;,gender&#x3D;1)</span><br><span class="line">3     models.Userinfo.objects.create(name&#x3D;&#39;tank&#39;,gender&#x3D;2)</span><br><span class="line">4     models.Userinfo.objects.create(name&#x3D;&#39;egon&#39;,gender&#x3D;3)</span><br><span class="line">5     models.Userinfo.objects.create(name&#x3D;&#39;sean&#39;,gender&#x3D;10)</span><br><span class="line">6  # 可以存入没有对应关系的数字，但是取的时候由于没有对应关系取出来的还是数字</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> 1 # 取出数据</span><br><span class="line"> 2 user_obj &#x3D; models.Userinfo.objects.get(pk&#x3D;1)</span><br><span class="line"> 3     print(user_obj.name)</span><br><span class="line"> 4     print(user_obj.gender)</span><br><span class="line"> 5     # 输出结果</span><br><span class="line"> 6     # jason</span><br><span class="line"> 7     # 1</span><br><span class="line"> 8     # 取出的时候要以get_字段名_display()的方式</span><br><span class="line"> 9     print(user_obj.get_gender_display())</span><br><span class="line">10     # 男</span><br><span class="line">11 </span><br><span class="line">12     user_obj1 &#x3D; models.Userinfo.objects.get(pk&#x3D;4)</span><br><span class="line">13     print(user_obj1.get_gender_display())</span><br><span class="line">14     # 10</span><br></pre></td></tr></table></figure>

<h1 id="三-数据库查询优化"><a href="#三-数据库查询优化" class="headerlink" title="三.数据库查询优化"></a>三.数据库查询优化</h1><h2 id="1）惰性查询"><a href="#1）惰性查询" class="headerlink" title="1）惰性查询"></a>1）惰性查询</h2><p>当你只是去命令查询操作数据库而不需要用这个数据的时候，django就不会去查询以增加效率，除非你要打印或者使用，才会帮你去调用</p>
<h2 id="2）only与defer"><a href="#2）only与defer" class="headerlink" title="2）only与defer"></a>2）only与defer</h2><ul>
<li><strong>only作用</strong></li>
</ul>
<p>括号内传字段 得到的结果是一个列表套数据对象 该对象内只含有括号内指定的字段属性<br>对象点该字段属性是不会走数据库的 但是你一旦点了非括号内的字段 也能够拿到数据，但是是重新走的数据库查询</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1  res &#x3D; models.Book.objects.only(&#39;title&#39;)  # 這些對象内部只有title屬性</span><br><span class="line">2     # print(res)</span><br><span class="line">3     for r in res:</span><br><span class="line">4         # print(r.title)</span><br><span class="line">5         print(r.price)</span><br><span class="line">6         # 此时需要重新走数据库查询</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>defer作用</strong></li>
</ul>
<p>defer与only相反<br>括号内传字段 得到的结果是一个列表套数据对象 该对象内没有括号内指定的字段属性<br>对象点该字段属性会重复走数据库 但是你一旦点了非括号内的字段 就不走数据库了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1  res &#x3D; models.Book.objects.defer(&#39;title&#39;)  # defer与only互为反关系</span><br><span class="line">2     for r in res:</span><br><span class="line">3         print(r.title)</span><br><span class="line">4         # 此时查title需要重新做数据库</span><br></pre></td></tr></table></figure>

<h2 id="3）selected-related与prefetch-related"><a href="#3）selected-related与prefetch-related" class="headerlink" title="3）selected_related与prefetch_related"></a>3）selected_related与prefetch_related</h2><ul>
<li>selectd_relted作用</li>
</ul>
<p>内部是连表操作 现将关系表全部链接起来 之后再一次性查询出来 封装到对象中<br>数据对象之后在获取任意表中的数据的时候都不需要再走数据库了 因为全部封装成了对象的属性</p>
<p>select_related括号内只能传外键字段 并且不能是多对多字段 只能是一对多和一对一，但是可以多个字段一起查<br>select_related(外键字段1__外键字段2__外键字段3…)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1 res &#x3D; models.Book.objects.select_related(&#39;authors&#39;)</span><br><span class="line">2 for r in res:</span><br><span class="line">3     print(r.publish.name)</span><br><span class="line">4     print(r.publish.addr)</span><br></pre></td></tr></table></figure>

<ul>
<li>prefetch_related作用：</li>
</ul>
<p>prefetch_related内部是子查询 但是给你的感觉是连表操作<br>内部通过子查询将外键管理表中的数据页全部给你封装到对象中<br>之后对象点当前表或者外键关联表中的字段也都不需要走数据库了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1 res &#x3D; models.Book.objects.prefetch_related(&#39;publish&#39;)</span><br><span class="line">2     # print(res)</span><br><span class="line">3 </span><br><span class="line">4 for r in res:</span><br><span class="line">5     print(r.publish.name)</span><br></pre></td></tr></table></figure>

<p>优缺点比较：各有优劣，具体情况具体分析</p>
<ul>
<li><p>select_related连表操作 好处在于只走一次sql查询</p>
<p>耗时耗在 连接表的操作 ,表的数据越大连接时间越长</p>
</li>
<li><p>prefetch_related子查询操作给人的感觉很像联表查询，他走数据库的查询次数取决于你要查询的数据多少，耗时耗在查询次数</p>
</li>
</ul>
<h1 id="四-事物操作"><a href="#四-事物操作" class="headerlink" title="四.事物操作"></a>四.事物操作</h1><p>django orm开启事务操作</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">from django.db import transaction</span><br><span class="line">with transaction.atomic():    </span><br><span class="line"># 在with代码块中执行的orm语句同属于一个事务    </span><br><span class="line">    pass</span><br><span class="line"># 代码块运行结束 事务就结束了，可以直接在下面写其他代码了</span><br></pre></td></tr></table></figure>

<h1 id="五-MTV与MVC模型框架"><a href="#五-MTV与MVC模型框架" class="headerlink" title="五.MTV与MVC模型框架"></a>五.MTV与MVC模型框架</h1><p>MTV模型：Django是MTV框架</p>
<p>M:models T:templates V:views</p>
<p>MVC M:models V:views C:controller # 控制器(路由分发 urls.py)</p>
<p>本质:MTV本质也是MVC</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/12/27/Django%E6%A1%86%E6%9E%B6%E6%A8%A1%E5%9E%8B%E5%B1%82%E5%B8%B8%E7%94%A8%E5%AD%97%E6%AE%B5%E5%92%8C%E4%BA%8B%E7%89%A9%E6%93%8D%E4%BD%9C/" data-id="ckd49wrbi0004l4utbzqxdzoo" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Django框架模型层和ORM" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/12/19/Django%E6%A1%86%E6%9E%B6%E6%A8%A1%E5%9E%8B%E5%B1%82%E5%92%8CORM/" class="article-date">
  <time datetime="2018-12-19T12:02:38.000Z" itemprop="datePublished">2018-12-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/12/19/Django%E6%A1%86%E6%9E%B6%E6%A8%A1%E5%9E%8B%E5%B1%82%E5%92%8CORM/">Django框架模型层和ORM</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="模型层以及orm查询"><a href="#模型层以及orm查询" class="headerlink" title="模型层以及orm查询"></a>模型层以及orm查询</h1><h2 id="一-单表查询"><a href="#一-单表查询" class="headerlink" title="一.单表查询"></a>一.单表查询</h2><h3 id="1）前期准备工作"><a href="#1）前期准备工作" class="headerlink" title="1）前期准备工作"></a>1）前期准备工作</h3><p>新建一个数据库（用navicate就行）<br><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200109013101922-919973169.png" alt="img"></p>
<ul>
<li>修改settings配置</li>
</ul>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200109013313971-115501094.png" alt="img"></p>
<ul>
<li>添加代码</li>
</ul>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200109013326554-1818424613.png" alt="img"></p>
<ul>
<li>开始在models.py文件中创建表类</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1 class Movie(models.Model):</span><br><span class="line">2     title &#x3D; models.CharField(max_length&#x3D;32)</span><br><span class="line">3     price &#x3D; models.DecimalField(max_digits&#x3D;8, decimal_places&#x3D;2)</span><br><span class="line">4     publish_time &#x3D; models.DateField()   # 表示添加的时间是年月日</span><br><span class="line">5     &#39;&#39;&#39;</span><br><span class="line">6     补充：DateField中有两个参数，一个是auto_now:表示每一次修改数据都会将时间保存跟新，</span><br><span class="line">7     另一个是auto_now_add,表示只添加开始创建的时间，后面不会改变</span><br><span class="line">8     &#39;&#39;&#39;</span><br><span class="line">9     # publish_time &#x3D; models.DateTimeField() 表示添加的时间是年月日时分秒（带有time）</span><br></pre></td></tr></table></figure>

<ul>
<li>通过python mange.py makemigrations和python mange.py migration执行数据库迁移命令</li>
</ul>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200109013420173-1949453893.png" alt="img"></p>
<ul>
<li>设置如何在Django中单独测试某一个py文件</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"> 1 # 将manage.py文件中的前四行代码（添加环境变量用的）拷贝到test.py(任意一个test.py文件都可以），然后再在test.py文件中写上下面两句代码即可</span><br><span class="line"> 2 import django、</span><br><span class="line"> 3 django.setup()</span><br><span class="line"> 4 </span><br><span class="line"> 5 from app01 import models</span><br><span class="line"> 6 models.Movie.objects.all</span><br><span class="line"> 7 </span><br><span class="line"> 8 # 这样在test文件中直接运行py文件就可以执行并看到效果</span><br><span class="line"> 9 </span><br><span class="line">10 </span><br><span class="line">11 # 整体设置代码如下</span><br><span class="line">12 import os</span><br><span class="line">13 if __name__ &#x3D;&#x3D; &quot;__main__&quot;:   os.environ.setdefault(&quot;DJANGO_SETTINGS_MODULE&quot;, &quot;day53.settings&quot;)</span><br><span class="line">14     import django</span><br><span class="line">15     django.setup()</span><br><span class="line">16 </span><br><span class="line">17     from app01 import models</span><br><span class="line">18     models.Movie.objects.all()</span><br></pre></td></tr></table></figure>

<h3 id="2-单表查询必知必会16条"><a href="#2-单表查询必知必会16条" class="headerlink" title="2)单表查询必知必会16条"></a>2)单表查询必知必会16条</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">1.create()</span><br><span class="line">2.all()</span><br><span class="line">3.filter()</span><br><span class="line">4.update()</span><br><span class="line">5.delete()</span><br><span class="line">6.first()</span><br><span class="line">7.last()</span><br><span class="line">8.get()</span><br><span class="line">9.values()</span><br><span class="line">10.values_list()</span><br><span class="line">11.order_by()</span><br><span class="line">12.count()</span><br><span class="line">13.exclude()</span><br><span class="line">14.exists()</span><br><span class="line">15.reverse()</span><br><span class="line">16.distinct()</span><br></pre></td></tr></table></figure>

<h4 id="补充："><a href="#补充：" class="headerlink" title="补充："></a>补充：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"> 1 # 只要是queryset对象就可以无限制的调用queryset对象的方法</span><br><span class="line"> 2                 res &#x3D; models.User.objects.filter(**kwargs).filter().filter().update()&#x2F;delete()&#x2F;values()</span><br><span class="line"> 3 #只要是queryset对象就可以直接点query查看当前queryset对象内部的sql语句</span><br><span class="line"> 4                 queryset_obj.query</span><br><span class="line"> 5 #公告的方法 查看所有orm语句内部的sql语句</span><br><span class="line"> 6 #有一段固定的日志文件配置 拷贝到配置文件中即可</span><br><span class="line"> 7 LOGGING &#x3D; &#123;</span><br><span class="line"> 8     &#39;version&#39;: 1,</span><br><span class="line"> 9     &#39;disable_existing_loggers&#39;: False,</span><br><span class="line">10     &#39;handlers&#39;: &#123;</span><br><span class="line">11         &#39;console&#39;: &#123;</span><br><span class="line">12             &#39;level&#39;: &#39;DEBUG&#39;,</span><br><span class="line">13             &#39;class&#39;: &#39;logging.StreamHandler&#39;,</span><br><span class="line">14         &#125;,</span><br><span class="line">15     &#125;,</span><br><span class="line">16     &#39;loggers&#39;: &#123;</span><br><span class="line">17         &#39;django.db.backends&#39;: &#123;</span><br><span class="line">18             &#39;handlers&#39;: [&#39;console&#39;],</span><br><span class="line">19             &#39;propagate&#39;: True,</span><br><span class="line">20             &#39;level&#39;: &#39;DEBUG&#39;,</span><br><span class="line">21         &#125;,</span><br><span class="line">22     &#125;</span><br><span class="line">23 &#125;</span><br></pre></td></tr></table></figure>

<h4 id="1-create"><a href="#1-create" class="headerlink" title="1.create()"></a>1.create()</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> 1  # 1. create() :给数据库表添加内容，注意使用create是有返回值的，返回值就是当前被创建的数据的对象本身</span><br><span class="line"> 2     # 由于之前设置的时候没有给默认时间，这里可以手动填写时间</span><br><span class="line"> 3     models.Movie.objects.create(title&#x3D;&#39;西游记&#39;, price&#x3D;666.66, publish_time&#x3D;&#39;2018-1-1&#39;)</span><br><span class="line"> 4     res &#x3D; models.Movie.objects.create(title&#x3D;&#39;红楼梦&#39;, price&#x3D;555.55, publish_time&#x3D;&#39;2018-1-1&#39;)</span><br><span class="line"> 5     print(res)</span><br><span class="line"> 6     # 也可以进行修改让其自动添加时间（现在是为了方便）</span><br><span class="line"> 7     from datetime import date</span><br><span class="line"> 8     ctime &#x3D; date.today()</span><br><span class="line"> 9     models.Movie.objects.create(title&#x3D;&#39;水浒传&#39;, price&#x3D;888.88, publish_time&#x3D;ctime)</span><br><span class="line">10     models.Movie.objects.create(title&#x3D;&#39;三国演义&#39;, price&#x3D;999.99, publish_time&#x3D;ctime)</span><br><span class="line">11</span><br></pre></td></tr></table></figure>

<h4 id="2-all"><a href="#2-all" class="headerlink" title="2.all()"></a>2.all()</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1  # 2.all()查询数据库所有内容对象返回的是一个queryset</span><br><span class="line">2     # res &#x3D; models.Movie.objects.all()</span><br><span class="line">3     # print(res)</span><br></pre></td></tr></table></figure>

<h4 id="3-filter"><a href="#3-filter" class="headerlink" title="3.filter()"></a>3.filter()</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> 1 # 3.filter() 指定条件筛选，返回的是queryset对象 &lt;QuerySet [&lt;Movie: Movie object&gt;]&gt;,若不指定条件则查询所有</span><br><span class="line"> 2     res &#x3D; models.Movie.objects.filter(id&#x3D;1)</span><br><span class="line"> 3     print(res)</span><br><span class="line"> 4     # pk表示主键</span><br><span class="line"> 5     res &#x3D; models.Movie.objects.filter(pk&#x3D;1)</span><br><span class="line"> 6     print(res)</span><br><span class="line"> 7     # 括号内可以传多个条件，条件之间是and关系</span><br><span class="line"> 8     res &#x3D; models.Movie.objects.filter(pk&#x3D;1, title&#x3D;&#39;水浒传&#39;)</span><br><span class="line"> 9     print(res)</span><br><span class="line">10     # 只要是queryset对象  就可以通过 点query 的方式查看到获取到当前对象内部sql语句</span><br><span class="line">11     print(res.query)  # SELECT &#96;app01_movie&#96;.&#96;id&#96;, &#96;app01_movie&#96;.&#96;title&#96;, &#96;app01_movie&#96;.&#96;price&#96;, &#96;app01_movie&#96;.&#96;publish_time&#96; FROM &#96;app01_movie&#96; WHERE (&#96;app01_movie&#96;.&#96;id&#96; &#x3D; 1 AND &#96;app01_movie&#96;.&#96;title&#96; &#x3D; 水浒传)</span><br></pre></td></tr></table></figure>

<h4 id="4-get"><a href="#4-get" class="headerlink" title="4.get()"></a>4.get()</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1  # 4.get() 直接获取条件查询得到的数据的对象本身(和create创建时返回的是一样的）  不推荐使用  当查询条件不存在的时候直接报错</span><br><span class="line">2     res &#x3D; models.Movie.objects.get(pk&#x3D;1)</span><br><span class="line">3     print(res)</span><br><span class="line">4     res &#x3D; models.Movie.objects.get(pk&#x3D;5)</span><br><span class="line">5     print(res)  # 报错信息：app01.models.DoesNotExist: Movie matching query does not exist.</span><br><span class="line">6     res &#x3D; models.Movie.objects.filter(pk&#x3D;5)  # 而使用filter查询找不到会返回一个空列表</span><br><span class="line">7     print(res)</span><br></pre></td></tr></table></figure>

<h4 id="5-values"><a href="#5-values" class="headerlink" title="5.values()"></a>5.values()</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1 # 5.values()  查询指定字段下的所有值，可以多个字段一起查，结果是列表套字典的形式</span><br><span class="line">2     res &#x3D; models.Movie.objects.values(&#39;title&#39;, &#39;price&#39;)</span><br><span class="line">3     #查询结果：&lt;QuerySet [&#123;&#39;title&#39;: &#39;西游记&#39;, &#39;price&#39;: Decimal(&#39;666.66&#39;)&#125;, &#123;&#39;title&#39;: &#39;水浒传&#39;, &#39;price&#39;: Decimal(&#39;888.88&#39;)&#125;, &#123;&#39;title&#39;: &#39;三国演义&#39;, &#39;price&#39;: Decimal(&#39;999.99&#39;)&#125;, &#123;&#39;title&#39;: &#39;西游记&#39;, &#39;price&#39;: Decimal(&#39;666.66&#39;)&#125;]&gt;</span><br><span class="line">4     print(res)</span><br><span class="line">5     print(res.query)</span><br><span class="line">6     # SELECT &#96;app01_movie&#96;.&#96;title&#96;, &#96;app01_movie&#96;.&#96;price&#96; FROM &#96;app01_movie&#96;</span><br></pre></td></tr></table></figure>

<h4 id="6-values-list"><a href="#6-values-list" class="headerlink" title="6.values_list()"></a>6.values_list()</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1  # 6.values_list() 查询指定字段下的所有值，可以多个字段一起查，结果是列表套元组的形式</span><br><span class="line">2     res &#x3D; models.Movie.objects.values_list(&#39;title&#39;, &#39;price&#39;)</span><br><span class="line">3     # &lt; QuerySet[(&#39;西游记&#39;, Decimal(&#39;666.66&#39;)), (&#39;水浒传&#39;, Decimal(&#39;888.88&#39;)), (&#39;三国演义&#39;, Decimal(&#39;999.99&#39;)), (</span><br><span class="line">4     # &#39;红楼梦&#39;, Decimal(&#39;666.66&#39;))] &gt;</span><br><span class="line">5     print(res)</span><br></pre></td></tr></table></figure>

<h4 id="7-first"><a href="#7-first" class="headerlink" title="7.first()"></a>7.first()</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1     # # 7.first() 查询所得结果的第一个元素对象，若不给前置条件则默认获得全部数据的第一个数据对象</span><br><span class="line">2     res1 &#x3D; models.Movie.objects.filter() # &lt;QuerySet [&lt;Movie: Movie object&gt;, &lt;Movie: Movie object&gt;, &lt;Movie: Movie object&gt;, &lt;Movie: Movie object&gt;]&gt;</span><br><span class="line">3     res2 &#x3D; models.Movie.objects.filter().first() # Movie object</span><br><span class="line">4     res3 &#x3D; models.Movie.objects.first()</span><br><span class="line">5 </span><br><span class="line">6     print(res1)</span><br><span class="line">7     print(res2)</span><br><span class="line">8     print(res3)</span><br></pre></td></tr></table></figure>

<h4 id="8-last"><a href="#8-last" class="headerlink" title="8.last()"></a>8.last()</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1   # 8.last()  查询所得结果的最后一个元素对象，若不给前置条件则默认获得全部数据的最后一个数据对象</span><br><span class="line">2     res1 &#x3D; models.Movie.objects.filter().last()</span><br><span class="line">3     res &#x3D; models.Movie.objects.last()</span><br><span class="line">4     print(res1)</span><br><span class="line">5     print(res)</span><br></pre></td></tr></table></figure>

<h4 id="9-update"><a href="#9-update" class="headerlink" title="9.update()"></a>9.update()</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1     # 9.update()  表示跟新数据,获取指定数据对象后可以进行修改，但不能在未有此数据的情况下添加数据，并且也有返回值，返回值是被影响的行数</span><br><span class="line">2     res &#x3D; models.Movie.objects.filter(pk&#x3D;1).update(title&#x3D;&#39;聊斋志异&#39;)</span><br><span class="line">3     res2 &#x3D; models.Movie.objects.filter(pk&#x3D;5).update(title&#x3D;&#39;西游记&#39;, price&#x3D;777.77, publish_time&#x3D;&#39;2018-10-1&#39;)</span><br><span class="line">4     print(res)</span><br><span class="line">5     print(res2)</span><br></pre></td></tr></table></figure>

<h4 id="10-delete"><a href="#10-delete" class="headerlink" title="10.delete()"></a>10.delete()</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1     # 10.delete()  删除数据 返回结果(1, &#123;&#39;app01.Movie&#39;: 1&#125;)</span><br><span class="line">2     res &#x3D; models.Movie.objects.filter(pk &#x3D; 1).delete()</span><br><span class="line">3     # 不用主键为条件可以删除多个同一条件的元素 (3, &#123;&#39;app01.Movie&#39;: 3&#125;)</span><br><span class="line">4     res &#x3D; models.Movie.objects.filter(price &#x3D; 11).delete()</span><br><span class="line">5     print(res)</span><br></pre></td></tr></table></figure>

<h4 id="11-count"><a href="#11-count" class="headerlink" title="11.count()"></a>11.count()</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1  # 11.count()  统计数据条数，返回值是数据条数</span><br><span class="line">2         # 不给条件会查询所有数据条数，</span><br><span class="line">3         res &#x3D; models.Movie.objects.count()</span><br><span class="line">4         # 会通过条件来查询数据条数</span><br><span class="line">5         res2 &#x3D; models.Movie.objects.filter(price&#x3D;100).count()</span><br><span class="line">6         print(res)</span><br><span class="line">7         print(res2)</span><br></pre></td></tr></table></figure>

<h4 id="12-order-by"><a href="#12-order-by" class="headerlink" title="12.order_by"></a>12.order_by</h4><p>order_by</p>
<h4 id="13-exclude"><a href="#13-exclude" class="headerlink" title="13.exclude()"></a>13.exclude()</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1         # 13.exclude()  将指定筛选条件的数据对象排除之后获取剩下的所有数据对象</span><br><span class="line">2         # 返回结果是一个queryset，&lt;QuerySet [&lt;Movie: 三国演义&gt;, &lt;Movie: 红楼梦&gt;, &lt;Movie: sjal&gt;, &lt;Movie: nqks&gt;, &lt;Movie: skxsl&gt;]&gt;</span><br><span class="line">3         res &#x3D; models.Movie.objects.exclude(pk&#x3D;2)</span><br><span class="line">4         print(res)</span><br><span class="line">5         print(res.query)</span><br><span class="line">6         # SELECT &#96;app01_movie&#96;.&#96;id&#96;, &#96;app01_movie&#96;.&#96;title&#96;, &#96;app01_movie&#96;.&#96;price&#96;, &#96;app01_movie&#96;.&#96;publish_time&#96; FROM &#96;app01_movie&#96; WHERE NOT (&#96;app01_movie&#96;.&#96;id&#96; &#x3D; 2)</span><br></pre></td></tr></table></figure>

<h4 id="14-exists"><a href="#14-exists" class="headerlink" title="14.exists()"></a>14.exists()</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1     # 14.exists()   返回的是布尔值  判断指定筛选条件的数据是否存在</span><br><span class="line">2     res &#x3D; models.Movie.objects.filter(pk&#x3D;1000).exists()</span><br><span class="line">3     print(res)</span><br></pre></td></tr></table></figure>

<h4 id="15-reverse"><a href="#15-reverse" class="headerlink" title="15.reverse()"></a>15.reverse()</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">    # 15.reverse()  反转, 将升序改为降序，返回的结果是一个queryset对象</span><br><span class="line">    res &#x3D; models.Movie.objects.order_by(&#39;price&#39;).reverse()</span><br><span class="line">    print(res)</span><br><span class="line">    print(res.query)</span><br><span class="line"># SELECT &#96;app01_movie&#96;.&#96;id&#96;, &#96;app01_movie&#96;.&#96;title&#96;, &#96;app01_movie&#96;.&#96;price&#96;, &#96;app01_movie&#96;.&#96;publish_time&#96; FROM &#96;app01_movie&#96; ORDER BY &#96;app01_movie&#96;.&#96;price&#96; DESC</span><br></pre></td></tr></table></figure>

<h4 id="16-distinct"><a href="#16-distinct" class="headerlink" title="16.distinct()"></a>16.distinct()</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 16.distinct()  去重:把重复的数据去掉，去重的前提 必须是由完全一样的数据的才可以</span><br><span class="line">#返回的结果是一个queryset</span><br><span class="line">res &#x3D; models.Movie.objects.values(&#39;price&#39;).distinct()</span><br><span class="line">print(res)</span><br><span class="line">print(res.query)</span><br><span class="line"># SELECT DISTINCT &#96;app01_movie&#96;.&#96;price&#96; FROM &#96;app01_movie&#96;</span><br></pre></td></tr></table></figure>

<h3 id="3-神奇的双下划线查询"><a href="#3-神奇的双下划线查询" class="headerlink" title="3)神奇的双下划线查询"></a>3)神奇的双下划线查询</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"> 1     # 1.__gt:表是大于</span><br><span class="line"> 2     # 查询价格大于100的电影</span><br><span class="line"> 3     res &#x3D; models.Movie.objects.filter(price__gt&#x3D;100)</span><br><span class="line"> 4     # 返回的结果是一个queryset数据对象列表</span><br><span class="line"> 5     print(res)</span><br><span class="line"> 6     print(res.query)</span><br><span class="line"> 7     # # SELECT &#96;app01_movie&#96;.&#96;id&#96;, &#96;app01_movie&#96;.&#96;title&#96;, &#96;app01_movie&#96;.&#96;price&#96;, &#96;app01_movie&#96;.&#96;publish_time&#96; FROM &#96;app01_movie&#96; WHERE &#96;app01_movie&#96;.&#96;price&#96; &gt; 100</span><br><span class="line"> 8 </span><br><span class="line"> 9      # 2.__lt:表示小于</span><br><span class="line">10         # 查询价格小于200的电影</span><br><span class="line">11         res &#x3D; models.Movie.objects.filter(price__lt&#x3D;200)</span><br><span class="line">12         # 返回的结果是一个queryset数据对象列表</span><br><span class="line">13         print(res)</span><br><span class="line">14         print(res.query)</span><br><span class="line">15     # SELECT &#96;app01_movie&#96;.&#96;id&#96;, &#96;app01_movie&#96;.&#96;title&#96;, &#96;app01_movie&#96;.&#96;price&#96;, &#96;app01_movie&#96;.&#96;publish_time&#96; FROM &#96;app01_movie&#96; WHERE &#96;app01_movie&#96;.&#96;price&#96; &lt; 200</span><br><span class="line">16 </span><br><span class="line">17     # 3.__gte:表示大于等于</span><br><span class="line">18     # 查询价格大于等于888.88的电影</span><br><span class="line">19     res &#x3D; models.Movie.objects.filter(price__gte&#x3D;888.88)</span><br><span class="line">20     print(res)</span><br><span class="line">21     print(res.query)</span><br><span class="line">22     # SELECT &#96;app01_movie&#96;.&#96;id&#96;, &#96;app01_movie&#96;.&#96;title&#96;, &#96;app01_movie&#96;.&#96;price&#96;, &#96;app01_movie&#96;.&#96;publish_time&#96; FROM &#96;app01_movie&#96; WHERE &#96;app01_movie&#96;.&#96;price&#96; &gt;&#x3D; 88.8799999999999954525264911353588104248046875</span><br><span class="line">23     # 4.__lte:表示小于等于</span><br><span class="line">24     # 查询价格小于等于666.66的电影</span><br><span class="line">25     res &#x3D; models.Movie.objects.filter(price__lte&#x3D;666.66)</span><br><span class="line">26     print(res)</span><br><span class="line">27     print(res.query)</span><br><span class="line">28     # SELECT &#96;app01_movie&#96;.&#96;id&#96;, &#96;app01_movie&#96;.&#96;title&#96;, &#96;app01_movie&#96;.&#96;price&#96;, &#96;app01_movie&#96;.&#96;publish_time&#96; FROM &#96;app01_movie&#96; WHERE &#96;app01_movie&#96;.&#96;price&#96; &lt;&#x3D; 666.6599999999999681676854379475116729736328125</span><br><span class="line">29 </span><br><span class="line">30     # 5.__in:表示获取一个可迭代对象里面的数据</span><br><span class="line">31     #查询价格是666 或888 或999(注意：由于python解释器的精度问题，查询的时候可能会出现找不到数据的情况）</span><br><span class="line">32     res &#x3D; models.Movie.objects.filter(price__in&#x3D;[888.88, 666.66, 999.99])</span><br><span class="line">33     print(res)</span><br><span class="line">34     # # &lt;QuerySet []&gt;</span><br><span class="line">35     print(res.query)</span><br><span class="line">36     # # #SELECT &#96;app01_movie&#96;.&#96;id&#96;, &#96;app01_movie&#96;.&#96;title&#96;, &#96;app01_movie&#96;.&#96;price&#96;, &#96;app01_movie&#96;.&#96;publish_time&#96; FROM &#96;app01_movie&#96; WHERE &#96;app01_movie&#96;.&#96;price&#96; IN (888.8799999999999954525264911353588104248046875, 666.6599999999999681676854379475116729736328125, 999.990000000000009094947017729282379150390625)</span><br><span class="line">37     res1 &#x3D; models.Movie.objects.filter(price__in&#x3D;(888, 666, 999))</span><br><span class="line">38     # 元组字典都可以，都是返回一个queryset数据对象列表</span><br><span class="line">39     res2 &#x3D; models.Movie.objects.filter(price__in&#x3D;[888, 666, 999])</span><br><span class="line">40     print(res1)</span><br><span class="line">41     print(res2)</span><br><span class="line">42     # # &lt; QuerySet[ &lt; Movie: 水浒传 &gt;, &lt; Movie: 三国演义 &gt;, &lt; Movie: 红楼梦 &gt;] &gt;</span><br><span class="line">43     print(res1.query)</span><br><span class="line">44     # # SELECT &#96;app01_movie&#96;.&#96;id&#96;, &#96;app01_movie&#96;.&#96;title&#96;, &#96;app01_movie&#96;.&#96;price&#96;, &#96;app01_movie&#96;.&#96;publish_time&#96; FROM &#96;app01_movie&#96; WHERE &#96;app01_movie&#96;.&#96;price&#96; IN (888, 666, 999)</span><br><span class="line">45 </span><br><span class="line">46     # 6.__range:表示在一个可迭代对象里面循环遍历，顾头顾尾</span><br><span class="line">47     # 查询价格在200到900之间的电影</span><br><span class="line">48     res &#x3D; models.Movie.objects.filter(price__range&#x3D;(200,999))</span><br><span class="line">49     print(res)</span><br><span class="line">50     print(res.query)</span><br><span class="line">51     # &lt;QuerySet [&lt;Movie: 水浒传&gt;, &lt;Movie: 三国演义&gt;, &lt;Movie: 红楼梦&gt;]&gt;</span><br><span class="line">52     # SELECT &#96;app01_movie&#96;.&#96;id&#96;, &#96;app01_movie&#96;.&#96;title&#96;, &#96;app01_movie&#96;.&#96;price&#96;, &#96;app01_movie&#96;.&#96;publish_time&#96; FROM &#96;app01_movie&#96; WHERE &#96;app01_movie&#96;.&#96;price&#96; BETWEEN 200 AND 999</span><br><span class="line">53 </span><br><span class="line">54     # 7.__contains：模糊查询，有大小写区别</span><br><span class="line">55     #   __icontains:模糊查询，忽略大小写</span><br><span class="line">56 </span><br><span class="line">57     # 查询电影名中包含字母s的电影</span><br><span class="line">58     &#39;&#39;&#39;</span><br><span class="line">59     模糊查询：</span><br><span class="line">60         关键字 like</span><br><span class="line">61         关键符号：%  _</span><br><span class="line">62     &#39;&#39;&#39;</span><br><span class="line">63 res1 &#x3D; models.Movie.objects.filter(title__contains&#x3D;&#39;s&#39;) # 默认是区分大小写</span><br><span class="line">64 print(res1)</span><br><span class="line">65 print(res1.query)</span><br><span class="line">66 # &lt;QuerySet [&lt;Movie: sjal&gt;, &lt;Movie: nqks&gt;, &lt;Movie: skxsl&gt;]&gt;</span><br><span class="line">67 # SELECT &#96;app01_movie&#96;.&#96;id&#96;, &#96;app01_movie&#96;.&#96;title&#96;, &#96;app01_movie&#96;.&#96;price&#96;, &#96;app01_movie&#96;.&#96;publish_time&#96; FROM &#96;app01_movie&#96; WHERE &#96;app01_movie&#96;.&#96;title&#96; LIKE BINARY %s%</span><br><span class="line">68 </span><br><span class="line">69 res2 &#x3D; models.Movie.objects.filter(title__icontains&#x3D;&#39;s&#39;) # 默认是不区分大小的</span><br><span class="line">70 print(res2)</span><br><span class="line">71 print(res2.query)</span><br><span class="line">72 # &lt;QuerySet [&lt;Movie: sjal&gt;, &lt;Movie: nqks&gt;, &lt;Movie: skxsl&gt;, &lt;Movie: SNAJD&gt;, &lt;Movie: SNAKJK&gt;]&gt;</span><br><span class="line">73 # SELECT &#96;app01_movie&#96;.&#96;id&#96;, &#96;app01_movie&#96;.&#96;title&#96;, &#96;app01_movie&#96;.&#96;price&#96;, &#96;app01_movie&#96;.&#96;publish_time&#96; FROM &#96;app01_movie&#96; WHERE &#96;app01_movie&#96;.&#96;title&#96; LIKE %s%</span><br><span class="line">74 </span><br><span class="line">75 # 8.__year:指定年份查询</span><br><span class="line">76 #   __month:指定月份查询</span><br><span class="line">77 res &#x3D; models.Movie.objects.filter(publish_time__year&#x3D;2019)</span><br><span class="line">78 print(res)</span><br><span class="line">79 print(res.query)</span><br><span class="line">80 # &lt;QuerySet [&lt;Movie: sjal&gt;, &lt;Movie: nqks&gt;]&gt;</span><br><span class="line">81 # SELECT &#96;app01_movie&#96;.&#96;id&#96;, &#96;app01_movie&#96;.&#96;title&#96;, &#96;app01_movie&#96;.&#96;price&#96;, &#96;app01_movie&#96;.&#96;publish_time&#96; FROM &#96;app01_movie&#96; WHERE &#96;app01_movie&#96;.&#96;publish_time&#96; BETWEEN 2019-01-01 AND 2019-12-31</span><br><span class="line">82 </span><br><span class="line">83 res &#x3D; models.Movie.objects.filter(publish_time__month&#x3D;1)</span><br><span class="line">84 print(res)</span><br><span class="line">85 print(res.query)</span><br><span class="line">86 # &lt;QuerySet [&lt;Movie: 水浒传&gt;, &lt;Movie: 三国演义&gt;, &lt;Movie: 红楼梦&gt;]&gt;</span><br><span class="line">87 # SELECT &#96;app01_movie&#96;.&#96;id&#96;, &#96;app01_movie&#96;.&#96;title&#96;, &#96;app01_movie&#96;.&#96;price&#96;, &#96;app01_movie&#96;.&#96;publish_time&#96; FROM &#96;app01_movie&#96; WHERE EXTRACT(MONTH FROM &#96;app01_movie&#96;.&#96;publish_time&#96;) &#x3D; 1</span><br><span class="line">88 </span><br><span class="line">89 #</span><br></pre></td></tr></table></figure>

<h3 id="4）外键字段的增删改查"><a href="#4）外键字段的增删改查" class="headerlink" title="4）外键字段的增删改查"></a>4）外键字段的增删改查</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"> 1 # 外键字段的增删改查</span><br><span class="line"> 2 # 一对多  书籍对出版社</span><br><span class="line"> 3 # 1.增 create</span><br><span class="line"> 4 # 可以通过直接赋值的方式</span><br><span class="line"> 5 models.Book.objects.create(title&#x3D;&#39;三国演义&#39;, price&#x3D;123.12,publish_id&#x3D;2)</span><br><span class="line"> 6 # 或者通过数据对象(在models类中创建书籍对出版社时建立了一个publish外键字段，这个字段支持传对象给他）</span><br><span class="line"> 7 publish_obj &#x3D; models.Publish.objects.get(pk&#x3D;1)</span><br><span class="line"> 8 print(publish_obj)</span><br><span class="line"> 9 # # Publish object</span><br><span class="line">10 models.Book.objects.create(title&#x3D;&#39;水浒传&#39;, price&#x3D;134.12, publish&#x3D;publish_obj)</span><br><span class="line">11 </span><br><span class="line">12 #改 update</span><br><span class="line">13 models.Book.objects.filter(pk&#x3D;1).update(publish_id&#x3D;3)</span><br><span class="line">14 </span><br><span class="line">15 # 通过get直接拿到主键值为4的出版社数据对象</span><br><span class="line">16 publish_obj &#x3D; models.Publish.objects.get(pk&#x3D;4)</span><br><span class="line">17 # 将此对象传给Book里面主键为1的创建时用到的publish虚拟外键字段</span><br><span class="line">18 models.Book.objects.filter(pk&#x3D;1).update(publish&#x3D;publish_obj)</span><br><span class="line">19 </span><br><span class="line">20 # 删</span><br><span class="line">21 &#39;&#39;&#39;</span><br><span class="line">22   外键字段在1.X版本中默认就是级联更新级联删除的</span><br><span class="line">23 &#39;&#39;&#39;</span><br><span class="line">24 </span><br><span class="line">25 # 多对多</span><br><span class="line">26 # 1.给书籍作者绑定关系 add</span><br><span class="line">27 </span><br><span class="line">28 # 通过获取书籍对象来对跨表找到作者信息并人为添加一个主键信息</span><br><span class="line">29 book_obj &#x3D; models.Book.objects.filter(pk&#x3D;1).first()</span><br><span class="line">30 print(book_obj.authors)  # 打印结果app01.Author.None  书籍对象点虚拟字段authors就类似于已经跨到书籍和作者的第三张关系表中</span><br><span class="line">31 book_obj.authors.add(1)  #给书籍绑定一个主键为1的作者</span><br><span class="line">32 book_obj.authors.add(2,3)  # 也支持同时传多个参数</span><br><span class="line">33 </span><br><span class="line">34 </span><br><span class="line">35 # 通过方法获取某一条作者信息数据对象，通过add的方法将对象添加进去</span><br><span class="line">36 author_obj &#x3D; models.Author.objects.get(pk&#x3D;1)</span><br><span class="line">37 author_obj1 &#x3D; models.Author.objects.get(pk&#x3D;3)</span><br><span class="line">38 </span><br><span class="line">39 book_obj.authors.add(author_obj)</span><br><span class="line">40 book_obj.authors.add(author_obj1)</span><br><span class="line">41 &#39;&#39;&#39;</span><br><span class="line">42 总结</span><br><span class="line">43    add专门给第三张关系表添加数据</span><br><span class="line">44         括号内即可以传数字也可以传对象  并且都支持传多个</span><br><span class="line">45 &#39;&#39;&#39;</span><br><span class="line">46 # 2 移除书籍与作者的绑定关系  remove</span><br><span class="line">47 book_obj &#x3D; models.Book.objects.filter(pk&#x3D;1).first()</span><br><span class="line">48 book_obj.authors.remove(2)</span><br><span class="line">49 book_obj.authors.remove(1,3)</span><br><span class="line">50 author_obj &#x3D; models.Author.objects.get(pk&#x3D;2)</span><br><span class="line">51 author_obj1 &#x3D; models.Author.objects.get(pk&#x3D;3)</span><br><span class="line">52 book_obj.authors.remove(author_obj)</span><br><span class="line">53 book_obj.authors.remove(author_obj,author_obj1)</span><br><span class="line">54 &quot;&quot;&quot;</span><br><span class="line">55 remove专门给第三张关系表移除数据</span><br><span class="line">56     括号内即可以传数字也可以传对象  并且都支持传多个</span><br><span class="line">57 &quot;&quot;&quot;</span><br><span class="line">58 # 3 修改书籍与作者的关系   set</span><br><span class="line">59 book_obj &#x3D; models.Book.objects.filter(pk&#x3D;1).first()</span><br><span class="line">60 book_obj.authors.set((3,))</span><br><span class="line">61 book_obj.authors.set((2,3))</span><br><span class="line">62 author_obj &#x3D; models.Author.objects.get(pk&#x3D;2)</span><br><span class="line">63 author_obj1 &#x3D; models.Author.objects.get(pk&#x3D;3)</span><br><span class="line">64 book_obj.authors.set((author_obj,))</span><br><span class="line">65 book_obj.authors.set([author_obj,author_obj1])</span><br><span class="line">66 </span><br><span class="line">67 &quot;&quot;&quot;</span><br><span class="line">68 set 修改书籍与作者的关系</span><br><span class="line">69     括号内支持传数字和对象 但是需要是可迭代对象</span><br><span class="line">70 &quot;&quot;&quot;</span><br><span class="line">71 # 4 清空书籍与作者关系</span><br><span class="line">72 book_obj &#x3D; models.Book.objects.filter(pk&#x3D;1).first()</span><br><span class="line">73 book_obj.authors.clear()  # 去第三张表中清空书籍为1的所有数据</span><br><span class="line">74 &quot;&quot;&quot;</span><br><span class="line">75 clear()  清空关系</span><br><span class="line">76 不需要任何的参数</span><br><span class="line">77 &quot;&quot;&quot;</span><br></pre></td></tr></table></figure>

<h1 id="二-跨表查询"><a href="#二-跨表查询" class="headerlink" title="二.跨表查询"></a>二.跨表查询</h1><h3 id="1-跨表查询的方式"><a href="#1-跨表查询的方式" class="headerlink" title="1) 跨表查询的方式"></a>1) 跨表查询的方式</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">    1.子查询  将一张表的查询结果当做另外一张表的查询条件</span><br><span class="line">        正常解决问题的思路 分步操作</span><br><span class="line">    2.链表查询</span><br><span class="line">        inner join</span><br><span class="line">        left join</span><br><span class="line">        right join</span><br><span class="line">        union</span><br><span class="line">建议:在写sql语句或者orm语句的时候 千万不要想着一次性将语句写完 一定要写一点查一点再写一点</span><br></pre></td></tr></table></figure>

<h3 id="2-正反向查询"><a href="#2-正反向查询" class="headerlink" title="2)正反向查询"></a>2)正反向查询</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">正向</span><br><span class="line">    跨表查询的时候 外键字段是否在当前数据对象中 如果在</span><br><span class="line">    查询另外一张关系表  叫正向</span><br><span class="line"></span><br><span class="line">反向</span><br><span class="line">    如果不在叫反向</span><br><span class="line"></span><br><span class="line">口诀</span><br><span class="line">    正向查询按外键字段</span><br><span class="line">    反向查询按表名小写以及视情况添加添加_set.all()</span><br></pre></td></tr></table></figure>

<h3 id="3）基于对象的跨表查询（子查询）"><a href="#3）基于对象的跨表查询（子查询）" class="headerlink" title="3）基于对象的跨表查询（子查询）"></a>3）基于对象的跨表查询（子查询）</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"> 1 # 基于对象的跨表查询（子查询）</span><br><span class="line"> 2 1.查询书籍pk为1的出版社名称</span><br><span class="line"> 3 book_obj &#x3D; models.Book.objects.filter(pk&#x3D;1).first()</span><br><span class="line"> 4 print(book_obj.publish)  #  结果：Publish object</span><br><span class="line"> 5 print(book_obj.publish.name)  # 西方出版社</span><br><span class="line"> 6 print(book_obj.publish.addr)  # 白宫</span><br><span class="line"> 7 </span><br><span class="line"> 8 # 2.查询书籍pk为2的所有作者的姓名</span><br><span class="line"> 9 book_obj &#x3D; models.Book.objects.filter(pk&#x3D;1).first()</span><br><span class="line">10 # 正向查询看外键字段</span><br><span class="line">11 print(book_obj.authors)</span><br><span class="line">12 # 结果：app01.Author.None 意味这没有写错</span><br><span class="line">13 print(book_obj.authors.all())  # 因为书籍对应的有多个作者，添加all获取所有，</span><br><span class="line">14 # 结果为：&lt;QuerySet [&lt;Author: Author object&gt;, &lt;Author: Author object&gt;, &lt;Author: Author object&gt;]&gt;</span><br><span class="line">15 author_list &#x3D; book_obj.authors.all()</span><br><span class="line">16 for author_obj in author_list:</span><br><span class="line">17     print(author_obj.name)</span><br><span class="line">18 </span><br><span class="line">19 </span><br><span class="line">20 # 3.查询作者pk为1的电话号码</span><br><span class="line">21 author_obj &#x3D; models.Author.objects.filter(pk&#x3D;1).first()</span><br><span class="line">22 print(author_obj.author_detail)</span><br><span class="line">23 print(author_obj.author_detail.phone)</span><br><span class="line">24 print(author_obj.author_detail.addr)</span><br></pre></td></tr></table></figure>

<h4 id="总结1："><a href="#总结1：" class="headerlink" title="总结1："></a>总结1：</h4><p>正向查询的时候 当外键字段对应的数据可以有多个的时候需要加.all()，这样就可以获取所有的对应信息，否则查到的结果为app.表名.None</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"> 1 # 4.查询出版社名称为东方出版社出版过的书籍</span><br><span class="line"> 2 publish_obj &#x3D; models.Publish.objects.filter(name&#x3D;&#39;东方出版社&#39;).first()</span><br><span class="line"> 3 print(publish_obj.book)  # 这样直接小写会报错AttributeError: &#39;Publish&#39; object has no attribute &#39;book&#39;</span><br><span class="line"> 4 改成</span><br><span class="line"> 5 print(publish_obj.book_set)  # app01.Book.None</span><br><span class="line"> 6 print(publish_obj.book_set.all())  # &lt;QuerySet [&lt;Book: Book object&gt;]&gt;</span><br><span class="line"> 7 print(publish_obj.book_set.all().first().title)</span><br><span class="line"> 8 </span><br><span class="line"> 9 # 5.查询作者为李四写过的书</span><br><span class="line">10 author_obj &#x3D; models.Author.objects.filter(name&#x3D;&#39;李四&#39;).first()</span><br><span class="line">11 print(author_obj.book_set)  # app01.Book.None</span><br><span class="line">12 print(author_obj.book_set.all())</span><br><span class="line">13 </span><br><span class="line">14 # 6.查询手机号为11234的作者姓名</span><br><span class="line">15 author_detail_obj &#x3D; models.AuthorDetail.objects.filter(phone&#x3D;11234).first()</span><br><span class="line">16 print(author_detail_obj.author)  # Author object  基于一对一关系不需要_set_all</span><br><span class="line">17 print(author_detail_obj.author.name)</span><br><span class="line">18 print(author_detail_obj.author.age)</span><br></pre></td></tr></table></figure>

<h4 id="总结2："><a href="#总结2：" class="headerlink" title="总结2："></a>总结2：</h4><p>　　基于对象的反向查询 表名小写是否需要加_set.all()　　</p>
<p>　　一对多和多对多的时候需要加　　</p>
<p>　　一对一不需要</p>
<h3 id="4）基于双下划线跨表查询-链表查询"><a href="#4）基于双下划线跨表查询-链表查询" class="headerlink" title="4）基于双下划线跨表查询(链表查询)"></a>4）基于双下划线跨表查询(链表查询)</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"> 1 # 基于双下划线跨表查询(链表查询)</span><br><span class="line"> 2 # 1.查询书籍pk为1的出版社名称</span><br><span class="line"> 3 # 正向</span><br><span class="line"> 4 res1 &#x3D; models.Book.objects.filter(pk&#x3D;1).values(&#39;title&#39;)</span><br><span class="line"> 5 print(res1)</span><br><span class="line"> 6 # 结果：&lt;QuerySet [&#123;&#39;title&#39;: &#39;三国演义&#39;&#125;]&gt;</span><br><span class="line"> 7 res2 &#x3D; models.Book.objects.filter(pk&#x3D;1).values(&#39;publish&#39;) # 写外键字段 就意味着你已经在外键字段管理的那张表中</span><br><span class="line"> 8 print(res2)</span><br><span class="line"> 9 # 结果：&lt;QuerySet [&#123;&#39;publish&#39;: 4&#125;]&gt;</span><br><span class="line">10 res3 &#x3D; models.Book.objects.filter(pk&#x3D;1).values(&#39;publish__name&#39;)</span><br><span class="line">11 print(res3)</span><br><span class="line">12 # &lt;QuerySet [&#123;&#39;publish__name&#39;: &#39;西方出版社&#39;&#125;]&gt;</span><br><span class="line">13 </span><br><span class="line">14 </span><br><span class="line">15 # 反向</span><br><span class="line">16 res &#x3D; models.Publish.objects.filter(book__pk&#x3D;1)</span><br><span class="line">17 print(res)</span><br><span class="line">18 # 结果：&lt;QuerySet [&lt;Publish: Publish object&gt;]&gt;</span><br><span class="line">19 res1 &#x3D; models.Publish.objects.filter(book__pk&#x3D;1).first()</span><br><span class="line">20 print(res1)</span><br><span class="line">21 # 结果： Publish object 后面再加.name就能拿到具体名字</span><br><span class="line">22 res2 &#x3D; models.Publish.objects.filter(book__pk&#x3D;1).values(&#39;name&#39;)</span><br><span class="line">23 print(res2)</span><br><span class="line">24 # 结果：&lt;QuerySet [&#123;&#39;name&#39;: &#39;西方出版社&#39;&#125;]&gt;</span><br><span class="line">25 </span><br><span class="line">26 # 3.查询作者是李四的年龄和手机号</span><br><span class="line">27     # 正向</span><br><span class="line">28     res &#x3D; models.Author.objects.filter(name&#x3D;&#39;李四&#39;).values(&#39;age&#39;,&#39;author_detail__phone&#39;)</span><br><span class="line">29     print(res)</span><br><span class="line">30     # 反向</span><br><span class="line">31     res &#x3D; models.AuthorDetail.objects.filter(author__name&#x3D;&#39;李四&#39;)  # 拿到jason的个人详情</span><br><span class="line">32     res &#x3D; models.AuthorDetail.objects.filter(author__name&#x3D;&#39;李四&#39;).values(&#39;phone&#39;,&#39;author__age&#39;)</span><br><span class="line">33     print(res)</span><br><span class="line">34 </span><br><span class="line">35     # 查询书籍pk为的1的作者的手机号</span><br><span class="line">36     res &#x3D; models.Book.objects.filter(pk&#x3D;1).values(&#39;authors__author_detail__phone&#39;)</span><br><span class="line">37     print(res)</span><br><span class="line">38 </span><br><span class="line">39     res &#x3D; models.AuthorDetail.objects.filter(author__book__pk&#x3D;1).values(&#39;phone&#39;)</span><br><span class="line">40     print(res)</span><br><span class="line">41 </span><br><span class="line">42     &quot;&quot;&quot;</span><br><span class="line">43     只要表之间有关系  你就可以通过正向的外键字段或者反向的表名小写 连续跨表操作</span><br><span class="line">44     &quot;&quot;&quot;</span><br></pre></td></tr></table></figure>

<h2 id="三-聚合查询"><a href="#三-聚合查询" class="headerlink" title="三.聚合查询"></a>三.聚合查询</h2><p>关键字<br>aggregate</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> 1    from django.db.models import Max,Min,Avg,Count,Sum</span><br><span class="line"> 2     # 聚合查询要导入的模块</span><br><span class="line"> 3     # 查询所有书的平均价格</span><br><span class="line"> 4     res &#x3D; models.Book.objects.aggregate(avg_num&#x3D;Avg(&#39;price&#39;))</span><br><span class="line"> 5     print(res)</span><br><span class="line"> 6     # 查询价格最贵的书</span><br><span class="line"> 7     res &#x3D; models.Book.objects.aggregate(max_num&#x3D;Max(&#39;price&#39;))</span><br><span class="line"> 8     print(res)</span><br><span class="line"> 9     # 全部使用一遍</span><br><span class="line">10     res &#x3D; models.Book.objects.aggregate(Avg(&quot;price&quot;), Max(&quot;price&quot;), Min(&quot;price&quot;),Count(&quot;pk&quot;),Sum(&#39;price&#39;))</span><br><span class="line">11     print(res)</span><br></pre></td></tr></table></figure>

<h2 id="四-分组查询"><a href="#四-分组查询" class="headerlink" title="四.分组查询"></a>四.分组查询</h2><p>关键字<br>annotate</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"> 1     # 1.统计每一本书的作者个数</span><br><span class="line"> 2     res &#x3D; models.Book.objects.annotate(author_num&#x3D;Count(&#39;authors&#39;)).values(&#39;title&#39;,&#39;author_num&#39;)</span><br><span class="line"> 3     print(res)</span><br><span class="line"> 4 </span><br><span class="line"> 5     # 2.统计出每个出版社卖的最便宜的书的价格</span><br><span class="line"> 6     res &#x3D; models.Publish.objects.annotate(min_price&#x3D;Min(&#39;book__price&#39;)).values(&#39;name&#39;,&#39;min_price&#39;,&#39;book__title&#39;)</span><br><span class="line"> 7     print(res)</span><br><span class="line"> 8 </span><br><span class="line"> 9     # 3.统计不止一个作者的图书</span><br><span class="line">10     res &#x3D; models.Book.objects.annotate(author_num&#x3D;Count(&#39;authors&#39;)).filter(author_num__gt&#x3D;1).values(&#39;title&#39;)</span><br><span class="line">11     print(res)</span><br><span class="line">12 </span><br><span class="line">13     # 4.查询各个作者出的书的总价格</span><br><span class="line">14     res &#x3D; models.Author.objects.annotate(price_sum&#x3D;Sum(&#39;book__price&#39;)).values(&#39;name&#39;,&#39;price_sum&#39;)</span><br><span class="line">15     print(res)</span><br><span class="line">16 </span><br><span class="line">17     # 5.如何按照表中的某一个指定字段分组</span><br><span class="line">18     &quot;&quot;&quot;</span><br><span class="line">19     res &#x3D; models.Book.objects.values(&#39;price&#39;).annotate()  就是以价格分组</span><br><span class="line">20     &quot;&quot;&quot;</span><br></pre></td></tr></table></figure>

<h2 id="五-F与Q查询"><a href="#五-F与Q查询" class="headerlink" title="五.F与Q查询"></a>五.F与Q查询</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"> 1     from django.db.models import F,Q</span><br><span class="line"> 2     # 1.查询库存数大于卖出数的书籍</span><br><span class="line"> 3     res &#x3D; models.Book.objects.filter(kucun__gt&#x3D;F(&#39;maichu&#39;))</span><br><span class="line"> 4     print(res)</span><br><span class="line"> 5 </span><br><span class="line"> 6     # 2.将所有书的价格提高100</span><br><span class="line"> 7     res &#x3D; models.Book.objects.update(price&#x3D;F(&#39;price&#39;) + 100)</span><br><span class="line"> 8     &quot;&quot;&quot;</span><br><span class="line"> 9     帮你获取到表中某个字段对应的值</span><br><span class="line">10     &quot;&quot;&quot;</span><br><span class="line">11     # Q能够改变查询的条件关系  and or not</span><br><span class="line">12     # 1.查询书的名字是python入门或者价格是1000的书籍</span><br><span class="line">13     res &#x3D; models.Book.objects.filter(title&#x3D;&#39;python入门&#39;,price&#x3D;1000)  # and关系</span><br><span class="line">14     res &#x3D; models.Book.objects.filter(Q(title&#x3D;&#39;python入门&#39;),Q(price&#x3D;1000))  # 逗号是and关系</span><br><span class="line">15     res &#x3D; models.Book.objects.filter(Q(title&#x3D;&#39;python入门&#39;)|Q(price&#x3D;1000))  # |是or关系</span><br><span class="line">16     res &#x3D; models.Book.objects.filter(~Q(title&#x3D;&#39;python入门&#39;)|Q(price&#x3D;1000))  # ~是not关系</span><br><span class="line">17     print(res.query)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> 1 高阶用法(了解)</span><br><span class="line"> 2                 应用场景</span><br><span class="line"> 3                     当你写的业务逻辑有组合查询</span><br><span class="line"> 4                         title price        1000</span><br><span class="line"> 5                         查询title中包含1000或者price中包含1000的数据   __icontains</span><br><span class="line"> 6                         参考点:django admin后台管理搜索功能  </span><br><span class="line"> 7                 q &#x3D; Q()</span><br><span class="line"> 8                 q.connector &#x3D; &#39;or&#39;  # 可以修改查询关系  and  or</span><br><span class="line"> 9                 q.children.append((&#39;title&#39;,1000))</span><br><span class="line">10                 q.children.append((&#39;price&#39;,1000))</span><br><span class="line">11                 res &#x3D; models.Book.objects.filter(q)  # 默认还是and关系  但是可以修改为or</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/12/19/Django%E6%A1%86%E6%9E%B6%E6%A8%A1%E5%9E%8B%E5%B1%82%E5%92%8CORM/" data-id="ckd49wrbd0003l4utfk9w91pe" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Django/" rel="tag">Django</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Django框架模板层" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/12/16/Django%E6%A1%86%E6%9E%B6%E6%A8%A1%E6%9D%BF%E5%B1%82/" class="article-date">
  <time datetime="2018-12-16T15:59:57.000Z" itemprop="datePublished">2018-12-16</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/12/16/Django%E6%A1%86%E6%9E%B6%E6%A8%A1%E6%9D%BF%E5%B1%82/">Django框架模板层</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="模版层"><a href="#模版层" class="headerlink" title="模版层"></a>模版层</h1><p><strong>模板语法符号</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&#125;&#125; 变量相关</span><br><span class="line">&#123;%%&#125; 逻辑相关</span><br></pre></td></tr></table></figure>

<h2 id="一-模版语法之传值"><a href="#一-模版语法之传值" class="headerlink" title="一.模版语法之传值"></a>一.模版语法之传值</h2><ul>
<li>python基本数据类型全部支持传递给html文件</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># views.py</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="comment"># python所有的数据类型都支持传递给html页面</span></span><br><span class="line">    i = <span class="number">11</span></span><br><span class="line">    f = <span class="number">11.11</span></span><br><span class="line">    str = <span class="string">'hello world'</span></span><br><span class="line">    list = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]</span><br><span class="line">    d = &#123;<span class="string">"username"</span>: <span class="string">'jason'</span>, <span class="string">'password'</span>: <span class="number">123</span>, <span class="string">'hobby'</span>: [<span class="string">'read'</span>, &#123;<span class="string">'username'</span>: [<span class="string">'jason'</span>, <span class="string">'egon'</span>]&#125;]&#125;</span><br><span class="line">    t = (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>,)</span><br><span class="line">    se = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>&#125;</span><br><span class="line">    b = <span class="literal">True</span></span><br><span class="line">    ff = <span class="literal">False</span></span><br><span class="line">    </span><br><span class="line">	<span class="comment"># python后端传给前端值的两种方式</span></span><br><span class="line">    <span class="comment"># 第一种传值方式</span></span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'index.html'</span>, &#123;<span class="string">'i'</span>:i, <span class="string">'f'</span>:f, <span class="string">'str'</span>: str &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 第二种传值方式</span></span><br><span class="line">    <span class="comment"># 会将当前名称空间所有的变量名都全部传递给html页面</span></span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'index.html'</span>, locals())</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">    &lt;script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"&gt;&lt;/script&gt;</span><br><span class="line">    &lt;link href=<span class="string">"https://cdn.bootcss.com/twitter-bootstrap/3.4.1/css/bootstrap.min.css"</span> rel=<span class="string">"stylesheet"</span>&gt;</span><br><span class="line">    &lt;script src="https://cdn.bootcss.com/twitter-bootstrap/3.4.1/js/bootstrap.min.js"&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;p&gt;&#123;&#123; i &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;&#123;&#123; f &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;&#123;&#123; str &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;&#123;&#123; list &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;&#123;&#123; d &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;&#123;&#123; t &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;&#123;&#123; se &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;&#123;&#123; b&#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;&#123;&#123; ff &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>

<p><img src="https://img2018.cnblogs.com/blog/1843708/202001/1843708-20200108004532201-2027287951.png" alt="img"></p>
<ul>
<li>python后端函数发送到前端html页面</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="comment"># 写一个示例函数</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">()</span>:</span></span><br><span class="line">        print(<span class="string">'views'</span>)</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'index.html'</span>, locals())</span><br><span class="line">&lt;!--这下面带<span class="comment">#号的注释前端浏览器是不展示的，但是html自身的注释是可以看到的--&gt;</span></span><br><span class="line">&#123;<span class="comment">#&lt;p&gt;&#123;&#123; i &#125;&#125;&lt;/p&gt;#&#125;</span></span><br><span class="line">&#123;<span class="comment">#&lt;p&gt;&#123;&#123; f &#125;&#125;&lt;/p&gt;#&#125;</span></span><br><span class="line">&#123;<span class="comment">#&lt;p&gt;&#123;&#123; str &#125;&#125;&lt;/p&gt;#&#125;</span></span><br><span class="line">&#123;<span class="comment">#&lt;p&gt;&#123;&#123; list &#125;&#125;&lt;/p&gt;#&#125;</span></span><br><span class="line">&#123;<span class="comment">#&lt;p&gt;&#123;&#123; d &#125;&#125;&lt;/p&gt;#&#125;</span></span><br><span class="line">&#123;<span class="comment">#&lt;p&gt;&#123;&#123; t &#125;&#125;&lt;/p&gt;#&#125;</span></span><br><span class="line">&#123;<span class="comment">#&lt;p&gt;&#123;&#123; se &#125;&#125;&lt;/p&gt;#&#125;</span></span><br><span class="line">&#123;<span class="comment">#&lt;p&gt;&#123;&#123; b&#125;&#125;&lt;/p&gt;#&#125;</span></span><br><span class="line">&#123;<span class="comment">#&lt;p&gt;&#123;&#123; ff &#125;&#125;&lt;/p&gt;#&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;p&gt;&#123;&#123; func &#125;&#125;&lt;/p&gt;</span><br></pre></td></tr></table></figure>

<p><img src="https://img2018.cnblogs.com/blog/1843708/202001/1843708-20200108005242307-1683979717.png" alt="img"></p>
<p><strong>所以，当传递函数名的时候，函数名会自动加括号进行执行，展示的只是函数的返回值，若不设置返回值，默认返回None</strong></p>
<p>注意：模板语法不支持给函数传参</p>
<ul>
<li>python后端传递类给前端html页面</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">MyClass</span><span class="params">(object)</span>:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">get_self</span><span class="params">(self)</span>:</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">'from self'</span></span><br><span class="line">        </span><br><span class="line"><span class="meta">        @staticmethod</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">get_func</span><span class="params">()</span>:</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">'from func'</span></span><br><span class="line"></span><br><span class="line"><span class="meta">        @classmethod</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">get_cls</span><span class="params">(cls)</span>:</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">'from cls'</span></span><br><span class="line"></span><br><span class="line">    obj = MyClass()</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'index.html'</span>, locals())</span><br><span class="line">&lt;p&gt;&#123;&#123; MyClass &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;&#123;&#123; obj &#125;&#125;&lt;/p&gt;</span><br></pre></td></tr></table></figure>

<p><img src="https://img2018.cnblogs.com/blog/1843708/202001/1843708-20200108005309107-423906066.png" alt="img"></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; MyClass.get_cls &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; MyClass.get_func &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; MyClass.get_self &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; obj.get_cls &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; obj.get_func&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; obj.get_self&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://img2018.cnblogs.com/blog/1843708/202001/1843708-20200108005338282-440192074.png" alt="img"></p>
<p>同样，传递类名给前端html时候的也会加括号执行获取类的对象,也不支持传参</p>
<ul>
<li>取值方法</li>
</ul>
<p>django模板语法取值 只有一种操作方式 通过句点符 .</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span>  </span><br><span class="line">    d = &#123;<span class="string">"username"</span>:<span class="string">'jason'</span>,<span class="string">'password'</span>:<span class="number">123</span>,<span class="string">'hobby'</span>:[<span class="string">'read'</span>,&#123;<span class="string">'username'</span>:[<span class="string">'jason'</span>,<span class="string">'egon'</span>]&#125;]&#125;</span><br><span class="line">    <span class="string">")</span></span><br><span class="line"><span class="string">    return render(request,'index.html',locals())  </span></span><br><span class="line"><span class="string">&lt;p&gt;&#123;&#123; d.hobby.1.username.1 &#125;&#125;&lt;/p&gt;</span></span><br></pre></td></tr></table></figure>

<p>句可以通过多个句点符的方式去获取需要的数据</p>
<h2 id="二-模版语法之过滤器"><a href="#二-模版语法之过滤器" class="headerlink" title="二.模版语法之过滤器"></a>二.模版语法之过滤器</h2><ul>
<li>|length:获取长度</li>
<li>|add:加法运算</li>
<li>|default:判断是否为空</li>
<li>|truncatechars:截取字符(指定数量字符中会包括三个点)</li>
<li>|truncatewords:截取单词(截取指定单词数目，会额外添加三个点)</li>
<li>|filesizeformat:自动计算文件大小（MB,GB等）</li>
<li>|slice:切片</li>
<li>|date:日期格式化</li>
<li>|safe:转义</li>
</ul>
<p>过滤器语法：过滤器 |左边的会当做过滤器的第一个参数 过滤器名右边的会当做过滤器的第二个参数</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="comment"># 该模块可以帮助后端直接转义前端标签</span></span><br><span class="line"><span class="keyword">from</span> django.utils.safestring <span class="keyword">import</span> mark_safe</span><br><span class="line"><span class="comment"># Create your views here.</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="comment"># python所有的数据类型都支持传递给html页面</span></span><br><span class="line">    i = <span class="number">11</span></span><br><span class="line">    f = <span class="number">11.11</span></span><br><span class="line">    s = <span class="string">'hello world'</span></span><br><span class="line">    str = <span class="string">'hello world'</span></span><br><span class="line">    list = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]</span><br><span class="line">    d = &#123;<span class="string">"username"</span>: <span class="string">'jason'</span>, <span class="string">'password'</span>: <span class="number">123</span>, <span class="string">'hobby'</span>: [<span class="string">'read'</span>, &#123;<span class="string">'username'</span>: [<span class="string">'jason'</span>, <span class="string">'egon'</span>]&#125;]&#125;</span><br><span class="line">    t = (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>,)</span><br><span class="line">    se = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>&#125;</span><br><span class="line">    b = <span class="literal">True</span></span><br><span class="line">    ff = <span class="literal">False</span></span><br><span class="line">    ff = <span class="literal">False</span></span><br><span class="line">    ss = <span class="string">'kjasdklas ksd;lk  akjsdkl da  kjda k;lak d k;a dk  ska d'</span></span><br><span class="line">    sss = <span class="string">'卡时间 冻结 鲨科 技的 卡拉 手动 卡萨 丁卡'</span></span><br><span class="line">    file_size = <span class="number">32213213424</span></span><br><span class="line">    ddd = datetime.now()</span><br><span class="line">    <span class="comment">#可以传入前端转义</span></span><br><span class="line">    res = <span class="string">"&lt;h1&gt;你好啊&lt;/h1&gt;"</span></span><br><span class="line">    <span class="comment"># 直接传是不会被前端识别并展示到浏览器中的</span></span><br><span class="line">    res1 = <span class="string">"&lt;script&gt;alert(123)&lt;/script&gt;"</span></span><br><span class="line">    <span class="comment">#可以直接在后端就进行转义</span></span><br><span class="line">    res2 = mark_safe(<span class="string">"&lt;h1&gt;你好啊&lt;/h1&gt;"</span>)</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'index.html'</span>, locals())</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">    &lt;script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"&gt;&lt;/script&gt;</span><br><span class="line">    &lt;link href=<span class="string">"https://cdn.bootcss.com/twitter-bootstrap/3.4.1/css/bootstrap.min.css"</span> rel=<span class="string">"stylesheet"</span>&gt;</span><br><span class="line">    &lt;script src="https://cdn.bootcss.com/twitter-bootstrap/3.4.1/js/bootstrap.min.js"&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;p&gt;&#123;&#123; s|length &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;&#123;&#123; i|add:10 &#125;&#125;&lt;/p&gt;  &lt;!--加法运算必须前后都是数字或者字符串--&gt;</span><br><span class="line">&lt;p&gt;&#123;&#123; b|default:'判断是否为空，得到的是布尔值' &#125;&#125;&lt;/p&gt; &lt;!--若有值返回True，没有值返回|右面的参数--&gt;</span><br><span class="line">&lt;p&gt;&#123;&#123; s|truncatechars:8 &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;&#123;&#123; ss|truncatewords:3 &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;&#123;&#123; file_size|filesizeformat &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;&#123;&#123; s|slice:'0:3:2' &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;&#123;&#123; ddd|date:'Y年/m月/d日' &#125;&#125;&lt;/p&gt; &lt;!--注意time模块时间戳不可以转换--&gt;</span><br><span class="line">&lt;p&gt;&#123;&#123; res1 &#125;&#125;&lt;/p&gt;  &lt;!--后端标签语言传入前端是失效的，防止一些恶意脚本攻击--&gt;</span><br><span class="line">&lt;p&gt;&#123;&#123; res|safe &#125;&#125;&lt;/p&gt;&lt;!--可以通过safe转义--&gt;</span><br><span class="line">&lt;p&gt;&#123;&#123; res2 &#125;&#125;&lt;/p&gt;&lt;!--也可以在前端通过from django.utils.safestring import mark_safe中的mark_safe方法--&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p><img src="https://img2018.cnblogs.com/blog/1843708/202001/1843708-20200108005435077-247151037.png" alt="img"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">前后端取消转义</span><br><span class="line">	前端</span><br><span class="line">		|safe</span><br><span class="line">	后端</span><br><span class="line">		<span class="keyword">from</span> django.utils.safestring <span class="keyword">import</span> mark_safe</span><br><span class="line">		mark_safe(<span class="string">'&lt;h1&gt;安全滴&lt;/h1&gt;'</span>)</span><br><span class="line">总结:前端代码不一定非要在前端页面写,可以在后端写好传递给前端页面使用</span><br><span class="line">这样的话 你就可以利用到后端更加多的逻辑语法</span><br></pre></td></tr></table></figure>

<h2 id="三-模版语法之标签"><a href="#三-模版语法之标签" class="headerlink" title="三.模版语法之标签"></a>三.模版语法之标签</h2><ul>
<li>前端for循环中forloop参数</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for foo in list %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; forloop &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>

<p>得到下图，可以看到有first，last等方法</p>
<p><img src="https://img2018.cnblogs.com/blog/1843708/202001/1843708-20200108005528846-471312970.png" alt="img"></p>
<ul>
<li>前端if条件</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for foo in list %&#125;</span><br><span class="line">    &#123;% if forloop.first %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>这是第一个值<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    &#123;% elif forloop.last %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>这是第一个值<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    &#123;% else %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; foo &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://img2018.cnblogs.com/blog/1843708/202001/1843708-20200108005604810-1783722273.png" alt="img"></p>
<p>补充：for循环的对象必须是可迭代对象或者不为空，否则无法执行，可以通过empty方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">a = []</span><br><span class="line">&#123;% <span class="keyword">for</span> foo <span class="keyword">in</span> a %&#125;</span><br><span class="line">    &#123;% <span class="keyword">if</span> forloop.first %&#125;</span><br><span class="line">        &lt;p&gt;这是第一个值&lt;/p&gt;</span><br><span class="line">    &#123;% <span class="keyword">elif</span> forloop.last %&#125;</span><br><span class="line">        &lt;p&gt;这是第一个值&lt;/p&gt;</span><br><span class="line">    &#123;% <span class="keyword">else</span> %&#125;</span><br><span class="line">        &lt;p&gt;&#123;&#123; foo &#125;&#125;&lt;/p&gt;</span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line">    &#123;% empty %&#125;</span><br><span class="line">        &lt;p&gt;for循环的对象内没有值&lt;/p&gt;</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://img2018.cnblogs.com/blog/1843708/202001/1843708-20200108005637262-1709933675.png" alt="img"></p>
<p><strong>keys，vlues，items同样可以使用</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">d = &#123;<span class="string">"username"</span>: <span class="string">'jason'</span>, <span class="string">'password'</span>: <span class="number">123</span>, <span class="string">'hobby'</span>: [<span class="string">'read'</span>, &#123;<span class="string">'username'</span>: [<span class="string">'jason'</span>, <span class="string">'egon'</span>]&#125;]&#125;</span><br><span class="line">&#123;% <span class="keyword">for</span> foo <span class="keyword">in</span> d.items %&#125;</span><br><span class="line">    &lt;p&gt;键值对:&#123;&#123; foo &#125;&#125;&lt;/p&gt;</span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% <span class="keyword">for</span> foo <span class="keyword">in</span> d.keys %&#125;</span><br><span class="line">    &lt;p&gt;key:&#123;&#123; foo &#125;&#125;&lt;/p&gt;</span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% <span class="keyword">for</span> foo <span class="keyword">in</span> d.values %&#125;</span><br><span class="line">    &lt;p&gt;值:&#123;&#123; foo &#125;&#125;&lt;/p&gt;</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://img2018.cnblogs.com/blog/1843708/202001/1843708-20200108005906346-62677865.png" alt="img"></p>
<p>补充：可以通过with起别名快速获取值</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>当一个值获取的步骤非常繁琐 但是又需要在很多地方用到 我们可以用起别名的方式来简化代码<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; d.hobby.1.username.1 &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--或者通过with起一个别名，就可以快速调用--&gt;</span></span><br><span class="line"></span><br><span class="line">&#123;% with d.hobby.1.username.1 as ag %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; ag &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">&#123;% endwith %&#125;</span><br></pre></td></tr></table></figure>

<h2 id="四-自定义过滤器，标签，inclusion-tag"><a href="#四-自定义过滤器，标签，inclusion-tag" class="headerlink" title="四.自定义过滤器，标签，inclusion_tag"></a>四.自定义过滤器，标签，inclusion_tag</h2><ul>
<li>前戏准备工作</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>在应用名下新建一个名字必须叫templatetags文件夹</span><br><span class="line">	<span class="number">2.</span>在该文件夹内新建一个任意名称的py文件(eg:mytag)</span><br><span class="line">	<span class="number">3.</span>在该文件内 必须先写以下两句代码</span><br><span class="line">		<span class="keyword">from</span> django.template <span class="keyword">import</span> Library		</span><br><span class="line">		register = Library()</span><br><span class="line"><span class="comment"># 自定义过滤器的创建和使用</span></span><br><span class="line"></span><br><span class="line"><span class="number">1.</span>在应用名下新建一个名字必须叫templatetags文件夹</span><br><span class="line"><span class="number">2.</span>在该文件夹内新建一个名称为mytag.py的文件</span><br><span class="line">mytag.py</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django.template <span class="keyword">import</span> Library		</span><br><span class="line">register = Library()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 自定义过滤器,给过滤器起个名字my_sum</span></span><br><span class="line"><span class="meta">@register.filter(name='my_sum')</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="comment"># 注意此处省略了逻辑校验</span></span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">index.html文件中使用过滤器</span><br><span class="line"></span><br><span class="line">&lt;p&gt;自定义过滤器的使用&lt;/p&gt;</span><br><span class="line">&#123;<span class="comment">#先将自定义的过滤器加载过来#&#125;</span></span><br><span class="line">    </span><br><span class="line">&#123;% load mytag %&#125;</span><br><span class="line">&lt;p&gt;&#123;&#123; 10|my_sum:90 &#125;&#125;&lt;/p&gt;</span><br></pre></td></tr></table></figure>

<p>注意：过滤器最多只能传两个参数，即|左右(如果非要传多个参数，可以通过x|name:[1,2,3,4]等方式手动处理)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 自定义标签的创建和使用</span></span><br><span class="line"></span><br><span class="line"><span class="number">1.</span>在应用名下新建一个名字必须叫templatetags文件夹</span><br><span class="line"><span class="number">2.</span>在该文件夹内新建一个名称为mytag.py的文件</span><br><span class="line">mytag.py</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django.template <span class="keyword">import</span> Library		</span><br><span class="line">register = Library()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 自定义标签</span></span><br><span class="line"><span class="meta">@register.simple_tag(name='my_simpletag')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">newtag</span><span class="params">(a, b, c, d)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'%s?%s?%s?%s'</span>%(a, b, c, d)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">index.html文件中使用过滤器</span><br><span class="line"></span><br><span class="line">&lt;p&gt;自定义标签的使用&lt;/p&gt;</span><br><span class="line">&#123;% load mytag %&#125;</span><br><span class="line">&lt;p&gt;&#123;% my_simpletag 1 2 3 4 %&#125;&lt;/p&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 这里可以得出：标签是&#123;%  %&#125;,并且可以传多个参数，过滤器是&#123;&#123;&#125;&#125;,只能传两个参数，并且通过simple_tag创建的标签不能作为条件使用for循环和if逻辑语句，而通过filter创建的过滤器就可以使用if逻辑语句</span></span><br><span class="line"><span class="comment"># 自定义inclusion_tag的创建和使用</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#inclusion_tag的作用：</span></span><br><span class="line"><span class="comment">#    比如在一个html页面上调用一个inclusion_tag,这个inclusion_tag会调用一个函数并生成一些数据，这些数据会放到一个html页面上进行渲染，将渲染好的页面再传回inclusion_tag的位置（类似于函数的装饰器，可以额外添加到某个已经写好的html页面</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 第一步：自定义inclusion_tag</span></span><br><span class="line"><span class="meta">@register.inclusion_tag('demo.html',name='my_name')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index1</span><span class="params">(n)</span>:</span></span><br><span class="line">    list1 = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">        list1.append(i)</span><br><span class="line">    <span class="comment"># 将列表数据传递给demo.html</span></span><br><span class="line">    <span class="comment"># 注意用locals传的时候是传全部变量</span></span><br><span class="line">    <span class="keyword">return</span> locals()</span><br><span class="line">    <span class="comment">#或者使用字典的形式是指定参数传值</span></span><br><span class="line">    <span class="comment"># return &#123;'list':list&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 第二步，可以新建一个demo.html文件接收数据(只需要部分能实现功能的代码就好)</span></span><br><span class="line">&lt;div&gt;</span><br><span class="line">    &#123;% <span class="keyword">for</span> foo <span class="keyword">in</span> list1 %&#125;</span><br><span class="line">        &lt;li&gt;&#123;&#123; foo &#125;&#125;&lt;/li&gt;</span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line"></span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 第三步：调用inclusion_tag</span></span><br><span class="line">&lt;p&gt;自定义inclusion_tag的使用&lt;/p&gt;</span><br><span class="line">&#123;% load mytag %&#125;</span><br><span class="line">&#123;% my_name <span class="number">10</span> %&#125;</span><br></pre></td></tr></table></figure>

<h2 id="五-模版的继承和导入"><a href="#五-模版的继承和导入" class="headerlink" title="五.模版的继承和导入"></a>五.模版的继承和导入</h2><ul>
<li>继承</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">模板的继承</span><br><span class="line">	某一个页面大部分区域都是公用的 那这个页面就可以作为模板页面</span><br><span class="line">	当别人继承这个页面之后 如何修改对应的区域</span><br><span class="line">	</span><br><span class="line">	先在模板页面上通过block实现划定区域</span><br><span class="line">		&#123;% block content %&#125;	</span><br><span class="line">			模板页面内容</span><br><span class="line">		&#123;% endblock %&#125;</span><br><span class="line">	</span><br><span class="line">	子页面中先导入整个模板</span><br><span class="line">		&#123;% extends <span class="string">'模板页面.html'</span>%&#125;</span><br><span class="line">		修改特定的区域  通过实现划定好的区域名称</span><br><span class="line">		&#123;% block content %&#125;</span><br><span class="line">			子页面内容</span><br><span class="line">		&#123;% endblock %&#125;</span><br><span class="line">	</span><br><span class="line">	通常情况下 模板页面页面应该起码有三块区域</span><br><span class="line">		&#123;% block css %&#125;	</span><br><span class="line">			模板页面内容</span><br><span class="line">		&#123;% endblock %&#125;</span><br><span class="line">		&#123;% block content %&#125;	</span><br><span class="line">			模板页面内容</span><br><span class="line">		&#123;% endblock %&#125;</span><br><span class="line">		&#123;% block js %&#125;	</span><br><span class="line">			模板页面内容</span><br><span class="line">		&#123;% endblock %&#125;</span><br><span class="line">	<span class="comment"># 模板的block块越多 可扩展性越高</span></span><br><span class="line">	</span><br><span class="line">	还支持子页面调用父页面对应区域的内容 并且可以无限次调用</span><br><span class="line">		&#123;&#123; block.super &#125;&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>导入</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">模板的导入</span><br><span class="line">	将html页面当做模块使用 哪里需要导哪里  这个html页面通常都不是完整的 只是一个局部样式</span><br><span class="line">	&#123;% include <span class="string">'left.html'</span> %&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/12/16/Django%E6%A1%86%E6%9E%B6%E6%A8%A1%E6%9D%BF%E5%B1%82/" data-id="ckd49wrbk0005l4ut89y68dqg" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Django/" rel="tag">Django</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Django框架路由层和视图层" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/12/15/Django%E6%A1%86%E6%9E%B6%E8%B7%AF%E7%94%B1%E5%B1%82%E5%92%8C%E8%A7%86%E5%9B%BE%E5%B1%82/" class="article-date">
  <time datetime="2018-12-15T13:11:33.000Z" itemprop="datePublished">2018-12-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/12/15/Django%E6%A1%86%E6%9E%B6%E8%B7%AF%E7%94%B1%E5%B1%82%E5%92%8C%E8%A7%86%E5%9B%BE%E5%B1%82/">Django框架路由层和视图层</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="一-Django框架中rom的表关系创建"><a href="#一-Django框架中rom的表关系创建" class="headerlink" title="一.Django框架中rom的表关系创建"></a>一.Django框架中rom的表关系创建</h2><h3 id="1-表与表的关系"><a href="#1-表与表的关系" class="headerlink" title="1).表与表的关系"></a>1).表与表的关系</h3><ul>
<li><p>一对一</p>
</li>
<li><p>一对多</p>
</li>
<li><p>多对多</p>
<p>具体sql语句及关系请查看[数据库基础链接](<a href="https://www.cnblogs.com/jiangxianseng/p/" target="_blank" rel="noopener">https://www.cnblogs.com/jiangxianseng/p/</a> <a href="https://www.cnblogs.com/jiangxianseng/p/12031335.html" target="_blank" rel="noopener">https://www.cnblogs.com/jiangxianseng/p/12031335.html</a> )</p>
</li>
</ul>
<h3 id="2-以图书管理系统为例，创建几张关系表"><a href="#2-以图书管理系统为例，创建几张关系表" class="headerlink" title="2)以图书管理系统为例，创建几张关系表"></a>2)以图书管理系统为例，创建几张关系表</h3><p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200107014522821-1473613271.png" alt="img"></p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200107014530203-264805306.png" alt="img"></p>
<p>注意：**在models.py中书写表关系的时候，要先写好基表，再写外键关系</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"> 1 # 先建立好三张基表</span><br><span class="line"> 2 from django.db import models</span><br><span class="line"> 3 </span><br><span class="line"> 4 # Create your models here.</span><br><span class="line"> 5 #书表</span><br><span class="line"> 6 class Book(models.Model):</span><br><span class="line"> 7     # id 是自动创建的，除非id名自定义</span><br><span class="line"> 8     title &#x3D; models.CharField(max_length&#x3D;255)</span><br><span class="line"> 9     # price为小数字段，表示总共8位数，其中小数占2位</span><br><span class="line">10     price &#x3D; models.DecimalField(max_digits&#x3D;8, decimal_places&#x3D;2)</span><br><span class="line">11 </span><br><span class="line">12 </span><br><span class="line">13 #出版社表</span><br><span class="line">14 class Publsh(models.Model):</span><br><span class="line">15     name &#x3D; models.CharField(max_length&#x3D;64)</span><br><span class="line">16     addr &#x3D; models.CharField(max_length&#x3D;64)</span><br><span class="line">17 </span><br><span class="line">18 </span><br><span class="line">19 # 作者表</span><br><span class="line">20 class Author(models.Model):</span><br><span class="line">21     name &#x3D; models.CharField(max_length&#x3D;64)</span><br><span class="line">22     # 比Int类型长一些</span><br><span class="line">23     phone &#x3D; models.BigIntegerField()</span><br></pre></td></tr></table></figure>

<ul>
<li><p>图书表</p>
<p>图书和出版社是一对多的关系</p>
<p>外键字段应该建立在多的一方</p>
</li>
</ul>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200107014543536-921336729.png" alt="img"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> 1 #书表</span><br><span class="line"> 2 class Book(models.Model):</span><br><span class="line"> 3     # id 是自动创建的，除非id名自定义</span><br><span class="line"> 4     title &#x3D; models.CharField(max_length&#x3D;255)</span><br><span class="line"> 5     # price为小数字段，表示总共8位数，其中小数占2位</span><br><span class="line"> 6     price &#x3D; models.DecimalField(max_digits&#x3D;8, decimal_places&#x3D;2)</span><br><span class="line"> 7     # 书籍表和出版社表是一对多关系，外键字段要建立在书籍表中</span><br><span class="line"> 8     Publish &#x3D; models.ForeignKey(to&#x3D;&#39;Publish&#39;) # 并且默认关联字段就是出版社表的主键字段，里面有个to_field参数能够修改关联的字段</span><br><span class="line"> 9     # 补充：to后面需要加引号，若Publish表在Book表上方，则不需要加引号</span><br><span class="line">10     # Publish &#x3D; models.ForeignKey(to&#x3D;Publish)</span><br><span class="line">11 </span><br><span class="line">12     # 书籍与作者是多对多关系,外键字段建立在较为频繁的书籍表中，通过ManytoManyField方法就能建立第三张表</span><br><span class="line">13     Authors &#x3D; models.ManyToManyField(to&#x3D;&#39;Author&#39;)</span><br><span class="line">14     # 补充注意：Authors字段只是一个虚拟字段，并不会在Book表中创建出来，只是告诉Django ORM为多对多关系创建一个第三方表</span><br><span class="line">15</span><br></pre></td></tr></table></figure>

<ul>
<li>出版社表</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1 #出版社表</span><br><span class="line">2 class Publish(models.Model):</span><br><span class="line">3     name &#x3D; models.CharField(max_length&#x3D;64)</span><br><span class="line">4     addr &#x3D; models.CharField(max_length&#x3D;64)</span><br><span class="line">5</span><br></pre></td></tr></table></figure>

<ul>
<li><p>作者表</p>
<p>图书表与作者表是多对多的关系</p>
<p>理论上外键字段在哪张表都一样，但是推荐外键字段建立在查询较为频繁的表中</p>
</li>
</ul>
<p>作者表与作者详情表是一对一关系</p>
<p>同样，还是推荐将外键字段建立在使用频率较高的表中</p>
<p>原因：就是为了方便后面我们基于ORM查询</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 作者表</span><br><span class="line">class Author(models.Model):</span><br><span class="line">    name &#x3D; models.CharField(max_length&#x3D;64)</span><br><span class="line">    # 比Int类型长一些</span><br><span class="line">    phone &#x3D; models.BigIntegerField()</span><br><span class="line"></span><br><span class="line">    # 作者表与作者详情表一对一关系</span><br><span class="line">    Author_detail &#x3D; models.OneToOneField(to&#x3D;&#39;AuthorDetail&#39;)</span><br></pre></td></tr></table></figure>

<ul>
<li>作者详情表</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1 # 作者详情表</span><br><span class="line">2 class AuthorDetail(models.Model):</span><br><span class="line">3     age &#x3D; models.IntegerField()</span><br><span class="line">4     addr &#x3D; models.CharField(max_length&#x3D;64)</span><br></pre></td></tr></table></figure>

<h3 id="3-开始创建"><a href="#3-开始创建" class="headerlink" title="3)开始创建"></a>3)开始创建</h3><p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200107014555174-1256716299.png" alt="img"></p>
<h3 id="4）查看"><a href="#4）查看" class="headerlink" title="4）查看"></a>4）查看</h3><p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200107014603374-2108214149.png" alt="img"></p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200107014648245-1772988687.png" alt="img"></p>
<p> <img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200107014657338-918332767.png" alt="img"></p>
<p>下载之后点一下apply，将新出现的数据库链接删除，重新点一下db.sqlite3,就会出现数据库了</p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200107014704103-1196569104.png" alt="img"></p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200107014715369-693269142.png" alt="img"></p>
<h2 id="二-Django请求生命周期流程图"><a href="#二-Django请求生命周期流程图" class="headerlink" title="二.Django请求生命周期流程图"></a>二.Django请求生命周期流程图</h2><p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200107014722547-1188946840.png" alt="img"></p>
<h2 id="三-路由层"><a href="#三-路由层" class="headerlink" title="三.路由层"></a>三.路由层</h2><p>一般我们刚创建好的Django框架中的urls.py里面存放的是总路由，即总的路由和视图函数或app的对应关系</p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200107014730727-809963832.png" alt="img"></p>
<p>由上面我们可以得到：</p>
<p>url方法第一个参数是一个正则表达式，路由匹配按照正则匹配， 一旦正则能够匹配到内容 会立刻执行对应的视图函数，不会再继续匹配了</p>
<p>注意：用户输入url尾缀路由若没有加最后的斜杠，django会默认将斜杠加上，看下图（将urls中的路由加上/）</p>
<p><strong>补充：</strong>你可以在配置文件settings中指定是否开启该功能<strong>APPEND_SLASH = True/False</strong>（默认是True处于打开状态，改为False则失效）</p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200107014736707-179633408.png" alt="img"></p>
<p>补充：网站首页一打开是非常不友好的，可以通过正则（^$)设置一下<img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200107014823558-1409170796.png" alt="img"></p>
<h3 id="1-无名分组和有名分组"><a href="#1-无名分组和有名分组" class="headerlink" title="1.无名分组和有名分组"></a>1.无名分组和有名分组</h3><p>基于路由层的路由是由正则表达式写的，我们可以在表达式后面来一个数字，如下,表示test后面必须加上四个一到九的数字才能访问</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url(r&#39;^test&#x2F;[0-9]&#123;4&#125;&#39;, views.test),</span><br></pre></td></tr></table></figure>

<p>但是，如果给正则表达式加一个括号，就表示分组的意思</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url(r&#39;^testadd&#x2F;([0-9]&#123;4&#125;)&#39;, views.testadd),</span><br></pre></td></tr></table></figure>

<p>会产生下面的报错信息</p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200107014900857-48030859.png" alt="img"></p>
<p>解决方法：</p>
<p>在视图函数中给一个形参接收这个数字就可以了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">def testadd(request, xxx):</span><br><span class="line">    return HttpResponse(&#39;testadd&#39;)</span><br></pre></td></tr></table></figure>

<h4 id="什么叫无名分组？"><a href="#什么叫无名分组？" class="headerlink" title="什么叫无名分组？"></a>什么叫无名分组？</h4><p>在路由匹配的时候给某段正则表达式加了括号，匹配的时候会将括号内的正则表达式匹配到的内容当作位置参数传递给对应的视图函数，因此视图函数就要多准备一个形参去接收这个位置参数</p>
<h4 id="什么叫有名分组？"><a href="#什么叫有名分组？" class="headerlink" title="什么叫有名分组？"></a>什么叫有名分组？</h4><p>给一段正则表达式起一个别名  匹配的时候会将括号内正则表达式匹配到的内容当做关键字参数传递给对应的视图函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#有名分组</span><br><span class="line"># \d+表示一个或多个数字，?P&lt;ttt&gt;固定写法，表示给正则表达式命名为ttt</span><br><span class="line">    url(r&#39;^testadd&#x2F;(?P&lt;ttt&gt;\d+)&#39;, views.testadd)</span><br></pre></td></tr></table></figure>



<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200107014955847-821524009.png" alt="img"></p>
<p><strong>解决方法:</strong>在视图函数中添加关键字形参去接收关键字实参</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># ttt就是接收关键字参数的</span><br><span class="line">def testadd(request, ttt):</span><br><span class="line">    return HttpResponse(&#39;testadd&#39;)</span><br></pre></td></tr></table></figure>

<p><strong>注意：</strong></p>
<ul>
<li><strong>无名有名不能混合使用</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">url(r&#39;^test&#x2F;(\d+)&#x2F;(?P&lt;year&gt;\d+)&#x2F;&#39;, views.test)</span><br><span class="line"># 会报找不到位置参数的错误</span><br></pre></td></tr></table></figure>

<ul>
<li>无名有名虽然不能混合使用，但是同一种命名方式 可以使用多个</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1 #无名叠加</span><br><span class="line">2 url(r&#39;^test&#x2F;(\d+)&#x2F;(\d+)&#x2F;&#39;,views.test)</span><br><span class="line">3 </span><br><span class="line">4 #有名叠加</span><br><span class="line">5 url(r&#39;^test&#x2F;(?P&lt;xxx&gt;\d+)&#x2F;(?P&lt;year&gt;\d+)&#x2F;&#39;,views.test),</span><br></pre></td></tr></table></figure>

<h3 id="2-反向解析"><a href="#2-反向解析" class="headerlink" title="2.反向解析"></a>2.反向解析</h3><p><strong>通过一些方法 能够得到一个结果 该结果可以访问到对应的url</strong></p>
<p>例如：可以通过html页面访问另一个url页面</p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200107015009858-2005594121.png" alt="img"></p>
<p>但是，如果将urls中的test名修改了，后面的html所有关于这个的url链接都将失效</p>
<p><strong>如何解决此问题？</strong></p>
<ul>
<li><p>第一步：</p>
<p>先给路由与视图函数对应关系 起一个名字（相当于赋予一个令牌）</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url(r&#39;^test&#x2F;&#39;,views.testadd,name&#x3D;&#39;add&#39;)</span><br></pre></td></tr></table></figure>

<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200107015022288-11967212.png" alt="img"></p>
<ul>
<li>第二步：若是前端解析，将｛% url ‘add’ %｝添加html中</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href&#x3D;&quot;&#123;% url &#39;add&#39; %&#125;&quot;&gt;2222&lt;&#x2F;a&gt;</span><br></pre></td></tr></table></figure>

<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200107015031571-737893503.png" alt="img"></p>
<ul>
<li>第三不：若是后端解析，<strong>先在view.py导入reverse模块</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> 1 url(r&#39;^test&#x2F;&#39;,views.testadd,name&#x3D;&#39;add&#39;)</span><br><span class="line"> 2 </span><br><span class="line"> 3 </span><br><span class="line"> 4 from django.shortcuts import  reverse</span><br><span class="line"> 5 </span><br><span class="line"> 6 def test(request):</span><br><span class="line"> 7     _url &#x3D; reverse(&#39;add&#39;)</span><br><span class="line"> 8     print(_url)</span><br><span class="line"> 9     </span><br><span class="line">10 # 通过reverse 模块就能拿到test路由名  </span><br><span class="line">11 # &#x2F;test&#x2F;</span><br><span class="line">12 # 注意：一定要提前命名name，否则reverse会找不到</span><br></pre></td></tr></table></figure>

<h3 id="3-有名无名反向解析"><a href="#3-有名无名反向解析" class="headerlink" title="3.有名无名反向解析"></a>3.有名无名反向解析</h3><p>分析：先在urls.py文件中建立有名无名分组</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 无名分组</span><br><span class="line">url(r&#39;^testadd&#x2F;([0-9]&#123;4&#125;)&#39;, views.testadd， name&#x3D;&#39;add&#39;),</span><br><span class="line">    </span><br><span class="line"> #有名分组</span><br><span class="line">url(r&#39;^test&#x2F;(?P&lt;ttt&gt;\d+)&#39;, views.test),</span><br></pre></td></tr></table></figure>

<p>然后views中导入reverse模块，运行home函数</p>
<ul>
<li>无名后端反向解析</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> 1 from django.shortcuts import render, HttpResponse, redirect, reverse</span><br><span class="line"> 2 </span><br><span class="line"> 3 def test(request, ttt):</span><br><span class="line"> 4     return HttpResponse(&#39;test&#39;)</span><br><span class="line"> 5 </span><br><span class="line"> 6 </span><br><span class="line"> 7 def testadd(request, xxx):</span><br><span class="line"> 8     return HttpResponse(&#39;testadd&#39;)</span><br><span class="line"> 9 </span><br><span class="line">10 </span><br><span class="line">11 def home(request):   </span><br><span class="line">12     _url &#x3D; reverse(&#39;add&#39;)</span><br><span class="line">13     print(_url)</span><br><span class="line">14     return HttpResponse(&#39;欢迎欢迎&#39;)</span><br></pre></td></tr></table></figure>

<p>运行后会报错，表示查找add时缺一个参数</p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200107015051134-2070155243.png" alt="img"></p>
<p><strong>报错原因：</strong> 访问这条url：<code>url(r&#39;^testadd/([0-9]{4})&#39;, views.testadd， name=&#39;add&#39;)</code></p>
<p>必须以/testadd/1234/这种形式，否则无法访问，因此结果的不确定性让Django无法做判断，因此需要人为的给予数字</p>
<p>解决方案：在<code>_url = reverse(&#39;add&#39;)</code>中随意给一个数字，例如</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">_url &#x3D; reverse(&#39;add&#39;, args&#x3D;(1234,))</span><br><span class="line"># 注意：此处要以元组的形式添加</span><br><span class="line">#补充：这个数字通常就是数据的主键值</span><br></pre></td></tr></table></figure>

<p>再次启动访问home的url就能得到<strong>/testadd/1234</strong>，通过他就能访问testadd这条url了</p>
<ul>
<li>无名前端反向解析</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">def home(request):</span><br><span class="line">    return render(request, &#39;home.html&#39;)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1 &lt;!--同样需要根据正则分组规则添加相应的数字--&gt;</span><br><span class="line">2 </span><br><span class="line">3 &lt;a href&#x3D;&quot;&#123;% url &#39;add&#39; 1234 %&#125;&quot;&gt;2222&lt;&#x2F;a&gt;</span><br><span class="line">4 &lt;a href&#x3D;&quot;&#123;% url &#39;add&#39; 5628 %&#125;&quot;&gt;2222&lt;&#x2F;a&gt;</span><br><span class="line">5 &lt;a href&#x3D;&quot;&#123;% url &#39;add&#39; 3637 %&#125;&quot;&gt;2222&lt;&#x2F;a&gt;</span><br><span class="line">6 &lt;a href&#x3D;&quot;&#123;% url &#39;add&#39; 3839 %&#125;&quot;&gt;2222&lt;&#x2F;a&gt;</span><br></pre></td></tr></table></figure>

<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200107015223134-2054748520.png" alt="img"></p>
<p>同上可以获得</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#　有名分组</span><br><span class="line">url(r&#39;^test&#x2F;(?P&lt;ttt&gt;\d+)&#39;, views.test)</span><br></pre></td></tr></table></figure>

<ul>
<li>有名后端反向解析</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1 # 在reverse中添加kwargs&#x3D;｛‘名字’：符合正则的符号｝</span><br><span class="line">2 def home(request):   </span><br><span class="line">3     _url &#x3D; reverse(&#39;add&#39;, kwargs&#x3D;&#123;&#39;year&#39;:11&#125;)  # 标准写法</span><br><span class="line">4     _url &#x3D; reverse(&#39;add&#39;, args&#x3D;(11,)</span><br><span class="line">5     print(_url)</span><br><span class="line">6     return HttpResponse(&#39;欢迎欢迎&#39;)</span><br></pre></td></tr></table></figure>

<ul>
<li>有名前端反向解析</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;% url &#39;add&#39; 1 %&#125;  # 推荐使用</span><br><span class="line">&#123;% url &#39;add&#39; year&#x3D; 1 %&#125;  # 标准的</span><br></pre></td></tr></table></figure>

<h4 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1 # 无名分组反向解析：</span><br><span class="line">2 </span><br><span class="line">3 url(r&#39;^testadd&#x2F;(\d+)&#x2F;&#39;,views.testadd,name&#x3D;&#39;add&#39;)</span><br><span class="line">4         #前端解析</span><br><span class="line">5             &#123;% url &#39;add&#39; 1 %&#125;</span><br><span class="line">6         #后端解析</span><br><span class="line">7             reverse(&#39;add&#39;,args&#x3D;(12,))</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> 1 有名分组反向解析：</span><br><span class="line"> 2 </span><br><span class="line"> 3 url(r&#39;^testadd&#x2F;(\d+)&#x2F;&#39;,views.testadd,name&#x3D;&#39;add&#39;)</span><br><span class="line"> 4 </span><br><span class="line"> 5 #前端解析</span><br><span class="line"> 6 &#123;% url &#39;add&#39; 1 %&#125;  # 推荐使用</span><br><span class="line"> 7 &#123;% url &#39;add&#39; year &#x3D; 1&#125; # 标准使用</span><br><span class="line"> 8 #后端解析</span><br><span class="line"> 9 _url &#x3D; reveerse(&#39;add&#39;, args&#x3D;(11,) # 推荐使用</span><br><span class="line">10 _url &#x3D; reveerse(&#39;add&#39;, kwargs&#x3D;&#123;&#39;year&#39;:11&#125; # 标准使用</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#伪代码</span><br><span class="line">url(r&#39;^edit_user&#x2F;(\d+)&#x2F;&#39;,views.edit_user,names&#x3D;&#39;edit&#39;)</span><br><span class="line"></span><br><span class="line">    &#123;% for user_obj in user_queryset %&#125;</span><br><span class="line">        &lt;a href&#x3D;&quot;edit_user&#x2F;&#123;&#123; user_obj.id &#125;&#125;&#x2F;&quot;&gt;编辑&lt;&#x2F;a&gt;</span><br><span class="line">        &lt;a href&#x3D;&quot;&#123;% url &#39;edit&#39; user_obj.id %&#125;&quot;&gt;编辑&lt;&#x2F;a&gt;</span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line"> def edit_user(request,edit_id):</span><br><span class="line">        reverse(&#39;edit&#39;,args&#x3D;(edit_id,))</span><br><span class="line"></span><br><span class="line">    &quot;&quot;&quot;</span><br></pre></td></tr></table></figure>

<h3 id="4-路由分发"><a href="#4-路由分发" class="headerlink" title="4.路由分发"></a>4.路由分发</h3><h4 id="1-什么是路由分发？"><a href="#1-什么是路由分发？" class="headerlink" title="1).什么是路由分发？"></a>1).什么是路由分发？</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">    当django项目比较庞大的时候 路由与视图函数对应关系较多</span><br><span class="line">总路由代码太多冗长</span><br><span class="line">考虑到总路由代码不好维护 django支持每个app都可以有自己的urls.py</span><br><span class="line">并且总路由不再做路由与视图函数的对应关系 而仅仅只做一个分发任务的操作</span><br><span class="line"></span><br><span class="line">根据请求的不同 识别出当前请求需要访问的功能属于哪个app然后自动</span><br><span class="line">下发到对应app里面的urls.py中 然后由app里面的urls.py做路由与视图函数的匹配</span><br><span class="line"></span><br><span class="line">不仅如此每个app除了可以有自己的urls.py之外 还可以有自己的static文件夹 templates模板文件</span><br><span class="line">基于上面的特点 基于django分小组开发 会变得额外的简单</span><br><span class="line">每个人只需要开发自己的app即可 之后只需要创建一个空的django项目</span><br><span class="line">将多个人的app全部拷贝项目下 配置文件注册</span><br><span class="line">总路由分发一次</span><br></pre></td></tr></table></figure>

<h4 id="2-如何实现一个简单的路由分发"><a href="#2-如何实现一个简单的路由分发" class="headerlink" title="2).如何实现一个简单的路由分发"></a>2).如何实现一个简单的路由分发</h4><p>第一步：在控制台通过命令行创建多个app文件夹，并将app在settings中注册</p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200107015242858-730497930.png" alt="img"></p>
<p>第二步：建立urls，导入include模块，各种导入，看下图</p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200107015257097-658719102.png" alt="img"></p>
<p>注意事项：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns &#x3D; [</span><br><span class="line">    url(r&#39;^admin&#x2F;&#39;, admin.site.urls),    </span><br><span class="line">    url(r&#39;^app01&#x2F;&#39;, include(app01_urls)),</span><br><span class="line">    url(r&#39;^app02&#x2F;&#39;, include(app02_urls)),</span><br><span class="line">]</span><br><span class="line"># 在总路由^app01&#x2F;后面千万不能添加$,否则无法找到</span><br></pre></td></tr></table></figure>

<p>补充：简写写法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 将导入和路由对应关系全部拿掉，用app.urls的方法</span><br><span class="line">    # from app01 import urls as app01_urls</span><br><span class="line">    # from app02 import urls as app02_urls</span><br><span class="line">    # url(r&#39;^app01&#x2F;&#39;,include(app01_urls)),</span><br><span class="line">    # url(r&#39;^app02&#x2F;&#39;,include(app02_urls))</span><br><span class="line">    </span><br><span class="line">    # 简写</span><br><span class="line">    url(r&#39;^app01&#x2F;&#39;,include(&#39;app01.urls&#39;)),</span><br><span class="line">    url(r&#39;^app02&#x2F;&#39;,include(&#39;app02.urls&#39;))</span><br></pre></td></tr></table></figure>

<h3 id="5-名称空间（了解）"><a href="#5-名称空间（了解）" class="headerlink" title="5.名称空间（了解）"></a>5.名称空间（了解）</h3><p>问题：如果在不同的app中的路由对应关系中添加了相同的name，那么在反向解析的时候能否准确找到</p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200107015313343-1932884372.png" alt="img"></p>
<p>结果是一定的，不能准确找到，那如何解决这个问题？</p>
<p><strong>可以再主路由对应列表中添加namespace属性</strong>，如下所示</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">url(r&#39;^app01&#x2F;&#39;, include(&#39;app01.urls&#39;, namespace&#x3D;&#39;app01&#39;))</span><br><span class="line">url(r&#39;^app02&#x2F;&#39;, include(&#39;app02.urls&#39;, namespace&#x3D;&#39;app02&#39;))</span><br><span class="line">后端解析</span><br><span class="line">reverse(&#39;app01:id&#39;)</span><br><span class="line">reverse(&#39;app02:id&#39;)</span><br><span class="line"></span><br><span class="line">前端解析</span><br><span class="line">&#123;% url &#39;app01:index&#39; %&#125;</span><br><span class="line">&#123;% url &#39;app02:index&#39; %&#125;</span><br></pre></td></tr></table></figure>

<p><strong>如何避免使用这种方法？</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1 # 在给路由与视图函数起别名(name的名字)的时候只需要保证永远不出现冲突的情况即可</span><br><span class="line">2 # 通常情况下我们推荐期别名的时候加上当前应用的应用名前缀</span><br><span class="line">3 #例如</span><br><span class="line">4 url(r&#39;^index&#x2F;&#39;,views.index,name&#x3D;&#39;app01_index&#39;)</span><br><span class="line">5 url(r&#39;^index&#x2F;&#39;,views.index,name&#x3D;&#39;app02_index&#39;)</span><br></pre></td></tr></table></figure>

<h3 id="6-虚拟环境"><a href="#6-虚拟环境" class="headerlink" title="6.虚拟环境"></a>6.虚拟环境</h3><p>为什么使用虚拟环境？</p>
<p>我们想做到针对不同的项目 只安装项目所需要的功能模块 项目用不到的一概不装 来避免加载资源时的消耗</p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200107015319807-385254209.png" alt="img"></p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200107015329861-74562135.png" alt="img"></p>
<p>注意：这次创建需要用以前创立好的虚拟环境来创立</p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200107015350849-487608561.png" alt="img"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">虚拟环境就类似于一个纯净的python解释器环境</span><br><span class="line">每创建一个虚拟幻境就类似于你重新下载一个python解释器</span><br><span class="line">另外虚拟环境不推荐使用太多，可以创建几个玩一玩，否则占用资源</span><br></pre></td></tr></table></figure>

<h3 id="7-DJango版本区别"><a href="#7-DJango版本区别" class="headerlink" title="7.DJango版本区别"></a>7.DJango版本区别</h3><p><strong>路由层：</strong></p>
<ul>
<li>用的是url，第一个参数是正则表达式</li>
<li>2.x和3.x用的path，第一个参数不是正则表达式，写的是什么就匹配什么，精确匹配</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1.x版本</span><br><span class="line">urlpatterns &#x3D; [</span><br><span class="line">    url(r&#39;^admin&#x2F;&#39;, admin.site.urls),</span><br><span class="line">]</span><br><span class="line">2.x和3.x版本</span><br><span class="line">urlpatterns &#x3D; [</span><br><span class="line">   path(&#39;admin&#x2F;&#39;, admin.site.urls),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>如果觉得path不好用 2.x、3.x给你提供了一个跟url一样的功能 re_path 等价于1.x里面的url功能</p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200107015405563-1384343011.png" alt="img"></p>
<p>虽然path不支持正则表达式 但是它给你提供了五种默认的转换器</p>
<ul>
<li>str:匹配除了路径分隔符（/）之外的非空字符串，这是默认的形式</li>
<li>int:匹配正整数，包含0。</li>
<li>slug,匹配字母、数字以及横杠、下划线组成的字符串。</li>
<li>uuid,匹配格式化的uuid，如 075194d3-6885-417e-a8a8-6c931e272f00。</li>
<li>path,匹配任何非空字符串，包含了路径分隔符（/）（不能用？）</li>
</ul>
<p>除了默认的五种转换器之外 还支持你自定义转换器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1 class MonthConverter:</span><br><span class="line">2         regex&#x3D;&#39;\d&#123;2&#125;&#39; # 属性名必须为regex</span><br><span class="line">3     </span><br><span class="line">4     def to_python(self, value):</span><br><span class="line">5         return int(value)</span><br><span class="line">6 </span><br><span class="line">7     def to_url(self, value):</span><br><span class="line">8         return value # 匹配的regex是两个数字，返回的结果也必须是两个数字</span><br></pre></td></tr></table></figure>

<h3 id="8-伪静态"><a href="#8-伪静态" class="headerlink" title="8.伪静态"></a>8.伪静态</h3><p>伪静态 url以.html结尾 给人的感觉好像是这个文件是写死的 内容不会轻易的改变 伪静态</p>
<p>为了提高你的网站被搜索引擎收藏的力度 提供网站的SEO查询效率</p>
<p>但是 无论你怎么做优化 都抗不过RMB玩家</p>
<h2 id="四-视图层"><a href="#四-视图层" class="headerlink" title="四.视图层"></a>四.视图层</h2><p>1)JsonResponse</p>
<p>视图函数必须要返回一个HttpResponse对象，因为比如这三板斧都是直接或间接的继承HTTresponse</p>
<ul>
<li>HttpResponse</li>
</ul>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200107015411423-503214024.png" alt="img"></p>
<ul>
<li>render</li>
</ul>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200107015418697-1926595043.png" alt="img"></p>
<ul>
<li>redirect</li>
</ul>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200107015423686-1432951746.png" alt="img"></p>
<p><strong>JsonResponse</strong></p>
<p>前后端数据交互</p>
<p>举例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">from django.http import JsonResponse</span><br><span class="line">def xxx(request):</span><br><span class="line">    user_dict &#x3D; &#123;&#39;username&#39;:&#39;jason&#39;,&#39;password&#39;:&#39;123&#39;&#125;</span><br><span class="line">    json_str&#x3D;json.dumps(user_dict)</span><br><span class="line">    return HttpResponse(json_str)</span><br></pre></td></tr></table></figure>

<p>若添加中文进去,就会发生自动转码的事情，如下图</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">from django.http import JsonResponse</span><br><span class="line">def xxx(request):</span><br><span class="line">    user_dict &#x3D; &#123;&#39;username&#39;:&#39;jason好帅哦 我好喜欢!&#39;,&#39;password&#39;:&#39;123&#39;&#125;</span><br><span class="line">    json_str&#x3D;json.dumps(user_dict)</span><br><span class="line">    return HttpResponse(json_str)</span><br></pre></td></tr></table></figure>

<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200107015441969-103073430.png" alt="img"></p>
<p>原因：</p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200107015452327-509882785.png" alt="img"></p>
<p>所以只要将ensure_ascii修改成False即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">json_str &#x3D; json.dumps(user_dict,ensure_ascii&#x3D;False)</span><br></pre></td></tr></table></figure>

<p>也可以使用JsonResponse</p>
<h3 id="return-JsonResponse-user-dict-json-dumps-params-‘ensure-ascii’-False"><a href="#return-JsonResponse-user-dict-json-dumps-params-‘ensure-ascii’-False" class="headerlink" title="return JsonResponse(user_dict,json_dumps_params={‘ensure_ascii’:False})"></a>return JsonResponse(user_dict,json_dumps_params={‘ensure_ascii’:False})</h3><p>若是一个列表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">l &#x3D; [1,2,3,4,5,6,7,8,9,]</span><br><span class="line">return JsonResponse(l,safe&#x3D;False)  # 序列化非字典格式数据 需要将safe改为False</span><br></pre></td></tr></table></figure>

<h2 id="forml表单"><a href="#forml表单" class="headerlink" title="forml表单"></a>forml表单</h2><p>1.必须做的事<br>　　method必须是post<br>　　enctype必须是formdata<br>2.暂时需要做的<br>　　提交post请求需要将中间件里面的一个csrfmiddleware注释掉</p>
<p>后端如何获取用户上传的文件<br>　　file_obj = request.FILES.get(‘前端input框name属性值’)<br>　　file_obj.name # 文件名<br>　　for line in file_obj:<br>　　print(line)</p>
<p># django中推荐以下写法<br>　　for chunk in file_obj.chunks():<br>　　print(chunk)</p>
<h2 id="render原理"><a href="#render原理" class="headerlink" title="render原理"></a>render原理</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">def ab_render(request):</span><br><span class="line">　　temp &#x3D; Template(&quot;&lt;h1&gt;&#123;&#123; user_dict &#125;&#125;&#123;&#123; user_dict.username &#125;&#125;&#123;&#123; user_dict.password &#125;&#125;&lt;&#x2F;h1&gt;&quot;)</span><br><span class="line">　　user_dict &#x3D; Context(&#123;&#39;user_dict&#39;:&#123;&#39;username&#39;:&#39;jason&#39;,&#39;password&#39;:123&#125;&#125;)</span><br><span class="line">　　res &#x3D; temp.render(user_dict)</span><br><span class="line">　　return HttpResponse(res)</span><br></pre></td></tr></table></figure>

<p>补充：视图函数不一定是函数，也有可能是类</p>
<p>FBV:基于函数的视图<br>CBV:基于类的视图</p>
<p>CBV基本写法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">from django.views import View</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class MyLogin(View):</span><br><span class="line">        def get(self,request):</span><br><span class="line">            return render(request,&#39;login.html&#39;)</span><br><span class="line">        def post(self,request):</span><br><span class="line">            return HttpResponse(&#39;我是类里面的post方法&#39;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">url(r&#39;^login&#x2F;&#39;,views.MyLogin.as_view())</span><br></pre></td></tr></table></figure>

<p>朝login提交get请求会自动执行MyLogin里面的get方法<br>而提交post请求也会自动执行MyLogin里面的post方法<br>为什么MyLogin针对不同的请求方法能够自动执行对应的方法</p>
<p>研究源码的突破口<br>url(r’^login/‘,views.MyLogin.as_view())</p>
<p>猜想</p>
<p>as_view要么是类里面定义的普通函数 @staticmethod<br>要么是类里面定义的绑定给类的方法 @classmethod<br>看源码发现是绑定给类的方法@classonlymethod，变成类绑定方法，并且as_view返回的是一个view函数<br>url(r’^login/‘,views.MyLogin.as_view())<br>等价于<br>url(r’^login/‘,views.MyLogin.view)<br>FBV和VBV在路由匹配上是一样的，都是路由与函数内存地址的对应关系<br>并且这个view函数引用了外部的类，他就是一个闭包函数，这个方法给自己定义一些属性，返回一个self.dispatch，我们都知道对象.属性的查找顺序是先查找对象自己的，再查找类的，然后再查找父类的，这里吗就会按顺序找到父类view 的dispatch方法<br>dispatch方法中会先判断请求方式是不是默认的八个请求方式：get，post，put。patch，delete，head，options，trace<br>然后通过反射getattr从我们自己写的类的对象中找请求方式，没有就会报错，该请求方式不允许，有就会调用这个方法并执行，这就是为什么cbv模式下能够自动执行我们定义的方法</p>
<p><img src="https://img2020.cnblogs.com/blog/1843708/202005/1843708-20200528004835109-1203781986.png" alt="img"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/12/15/Django%E6%A1%86%E6%9E%B6%E8%B7%AF%E7%94%B1%E5%B1%82%E5%92%8C%E8%A7%86%E5%9B%BE%E5%B1%82/" data-id="ckd49wrbq000al4ute1qw5ajk" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Django/" rel="tag">Django</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Django框架基础配置" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/12/09/Django%E6%A1%86%E6%9E%B6%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE/" class="article-date">
  <time datetime="2018-12-08T17:50:03.000Z" itemprop="datePublished">2018-12-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/12/09/Django%E6%A1%86%E6%9E%B6%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE/">Django框架基础配置</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>下面全部以登陆功能为例来演示这些功能</p>
<h2 id="一：静态文件的配置"><a href="#一：静态文件的配置" class="headerlink" title="一：静态文件的配置"></a>一：静态文件的配置</h2><ul>
<li>什么是静态文件？</li>
</ul>
<p>网站所使用的提前写好的，后面不在进行修改的配置文件，例如</p>
<p>css文件；</p>
<p>js文件；</p>
<p>常用的第三方组件：</p>
<p>bootstrap</p>
<p>sweetalert</p>
<p>fontawesome</p>
<ul>
<li><p>如何配置静态文件</p>
<p>网站所用到的html文件统一放到templates文件夹中  那针对网站所使用到的静态文件也应该单独找一个文件夹来存储  这个文件夹 默认情况下都叫static  注意：该文件夹需要手动自己创建  并且该文件夹内部通常是以下结构  static  -css  网站所用到的所有的css文件  -js  网站所用到的所有的js文件  -image  网站所用到的所有的图片文件  第三方文件</p>
</li>
</ul>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202002/1843708-20200204135357955-824414350.png" alt="img"></p>
<p>这样引入会发现无法正常引用</p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202002/1843708-20200204135409559-471794405.png" alt="img"></p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202002/1843708-20200204135454476-1136184019.png" alt="img"></p>
<p>补充：用户在浏览器窗口之所以输入网址能够拿到对应的资源 是因为后端开设相关的资源</p>
<p>那如何解决找不到资源的问题呢？</p>
<ul>
<li><p>配置django静态文件</p>
<p>django在配置文件中给你暴露了配置文件的配置信息 你只需要按照固定的写法书写即可暴露对应的静态文件资源</p>
</li>
</ul>
<p>第一步：找到位置</p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202002/1843708-20200204135505610-212321043.png" alt="img"></p>
<p>第二步：书写配置代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">STATICFILES_DIRS &#x3D; [os.path.join(BASE_DIR, &#39;static&#39;)]</span><br></pre></td></tr></table></figure>

<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202002/1843708-20200204135520284-832804882.png" alt="img"></p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202002/1843708-20200204135534677-502661780.png" alt="img"></p>
<ul>
<li><p>如何解决动态绑定问题</p>
<p>什么是接口前缀，通俗的说配置中的staic就是类似一个令牌，想访问资源必须带有staic接口前缀（可以修改，但是必须与配置中的一样）,只有接口前缀（令牌）相同，才会拿着后面的路径依次去配置文件夹中的STATICEFILES_DIRS中的文件夹路径下面列表中的每一个文件夹下查找对应的资源，顺序是从上往下依次查找 如果都没有找到才会报错</p>
</li>
</ul>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202002/1843708-20200204135545364-596887061.png" alt="img"></p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202002/1843708-20200204135551781-706644850.png" alt="img"></p>
<p>加入已经写好了一千个html页面，每一个页面都用了static接口前缀，然后有个需求，配置中的static接口前缀需要修改，如何快速解决将那一千个页面的接口前缀也修改了，这就需要用到接口前缀了</p>
<p>只需要添加下面几句代码，不论你接口前缀怎么修改，都会保持一致</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% load static %&#125;  &lt;!--加一行这个--&gt;</span><br><span class="line">    &lt;link rel&#x3D;&quot;stylesheet&quot; href&#x3D;&quot;&#123;% static &#39;bootstrap-3.3.7-dist&#x2F;css&#x2F;bootstrap.min.css&#39; %&#125;&quot;&gt;  &lt;!--在导入百分号和static即可动态绑定接口前缀--&gt;</span><br><span class="line">    &lt;script src&#x3D;&quot;&#123;% static &#39;bootstrap-3.3.7-dist&#x2F;js&#x2F;bootstrap.min.js&#39; %&#125;&quot;&gt;&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>

<h2 id="二-快速写一个简单的登陆页面"><a href="#二-快速写一个简单的登陆页面" class="headerlink" title="二.快速写一个简单的登陆页面"></a>二.快速写一个简单的登陆页面</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class&#x3D;&quot;container&quot;&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;row&quot;&gt;</span><br><span class="line">        &lt;div class&#x3D;&quot;col-md-8 col-md-offset-2&quot;&gt;</span><br><span class="line">            &lt;h2 class&#x3D;&quot;text-center&quot;&gt;登录&lt;&#x2F;h2&gt;</span><br><span class="line">            &lt;form action&#x3D;&quot;&quot; method&#x3D;&quot;post&quot;&gt;</span><br><span class="line">                &lt;p&gt;username:&lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;username&quot; class&#x3D;&quot;form-control&quot;&gt;&lt;&#x2F;p&gt;</span><br><span class="line">                &lt;p&gt;password:&lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;password&quot; class&#x3D;&quot;form-control&quot;&gt;&lt;&#x2F;p&gt;</span><br><span class="line">                &lt;input type&#x3D;&quot;submit&quot; class&#x3D;&quot;btn btn-success &quot;&gt;</span><br><span class="line">            &lt;&#x2F;form&gt;</span><br><span class="line">        &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">form表单</span><br><span class="line">    form表单默认是以get请求提交数据的(get请求会在url后面携带明文数据)</span><br><span class="line">        http:&#x2F;&#x2F;127.0.0.1:8000&#x2F;login&#x2F;?username&#x3D;admin&amp;password&#x3D;123</span><br><span class="line">    action</span><br><span class="line">        1.不写 默认朝当前地址提交数据</span><br><span class="line">        2.全路径</span><br><span class="line">        3.后缀(&#x2F;index)</span><br><span class="line">    提交post请求的时候 需要先去配置文件中的中间件注释掉一行，因为中间件类似于保安，会检查请求和响应的数据是否安全（后面中间件有重点介绍）</span><br><span class="line">        MIDDLEWARE &#x3D; [</span><br><span class="line">            &#39;django.middleware.security.SecurityMiddleware&#39;,</span><br><span class="line">            &#39;django.contrib.sessions.middleware.SessionMiddleware&#39;,</span><br><span class="line">            &#39;django.middleware.common.CommonMiddleware&#39;,</span><br><span class="line">            # &#39;django.middleware.csrf.CsrfViewMiddleware&#39;,</span><br><span class="line">            &#39;django.contrib.auth.middleware.AuthenticationMiddleware&#39;,</span><br><span class="line">            &#39;django.contrib.messages.middleware.MessageMiddleware&#39;,</span><br><span class="line">            &#39;django.middleware.clickjacking.XFrameOptionsMiddleware&#39;,</span><br><span class="line">        ]</span><br></pre></td></tr></table></figure>

<h2 id="三-request方法"><a href="#三-request方法" class="headerlink" title="三.request方法"></a>三.request方法</h2><p>1).同一个视图函数可以处理不同的请求</p>
<p>eg: get请求来 应该只需要返回一个html文件 post请求来 应该获取用户提交的数据 然后做进一步处理 因此必须要能够判断出当前请求到底是什么请求</p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202002/1843708-20200204135604696-594190163.png" alt="img"></p>
<p>request是一个对象，一个get请求就有下面这么多的方法和属性</p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202002/1843708-20200204135650630-1922126841.png" alt="img"></p>
<p>2).method方法</p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202002/1843708-20200204135816140-1493964605.png" alt="img"></p>
<p><strong>总结：method可以获取前端的请求方法，并且是一个大写的GET或POST字符串</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">通常情况下针对不同的请求应该做不同的处理 而一般情况下get请求次数要远远多于post请求</span><br><span class="line">所以我们应该针对非get请求作出逻辑判断 将get请求直接写在函数体内而不做判断</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="comment"># 要给用户返回一个登陆页面</span></span><br><span class="line">    <span class="comment"># print('我被触发了')</span></span><br><span class="line">    <span class="comment"># 获取前端请求方式</span></span><br><span class="line">    <span class="comment"># if request.method == 'GET':</span></span><br><span class="line">    <span class="comment">#     # get逻辑</span></span><br><span class="line">    <span class="comment">#     return render(request, 'login.html')</span></span><br><span class="line">    <span class="comment"># elif request.method == 'POST':</span></span><br><span class="line">    <span class="comment">#     # post逻辑</span></span><br><span class="line">    <span class="comment">#     # print(request.method,type(request.method))  # GET &lt;class 'str'&gt;  POST &lt;class 'str'&gt;</span></span><br><span class="line">    <span class="comment">#     # 获取数据 之后...</span></span><br><span class="line">    <span class="comment">#     return HttpResponse('收到了你的数据 马上处理')</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    为了减少代码的层级:一般情况下视图函数处理get请求较多 所以可以直接再函数体内先写get请求对应的逻辑</span></span><br><span class="line"><span class="string">    将其他请求利用request.method做出区分</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'POST'</span>:</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">'收到了'</span>)</span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">'login.html'</span>)</span><br></pre></td></tr></table></figure>

<p>3).request.POST</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">print(request.POST)  </span><br><span class="line"># 获取post请求携带的数据 &lt;QueryDict: &#123;&#39;username&#39;: [&#39;admin&#39;], &#39;password&#39;: [&#39;123&#39;]&#125;&gt; </span><br><span class="line"># 可以把它当成是一个大字典</span><br><span class="line"></span><br><span class="line"># 注意，总这些键是由前端传的name属性决定的</span><br><span class="line">&lt;p&gt;username:&lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;username&quot; class&#x3D;&quot;form-control&quot;&gt;&lt;&#x2F;p&gt;</span><br><span class="line"></span><br><span class="line"># 若没有name属性，即时在前端input框内提交了数据，也不会朝后端发送这个数据</span><br></pre></td></tr></table></figure>

<p><strong>因此：在input框中一定要有name属性</strong></p>
<p>4).如何获取post里面的数据（get和getlist）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"># 例如：在前端页面中有以下三个input框需要输入数据传入后端</span><br><span class="line">&lt;p&gt;username:&lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;username&quot; class&#x3D;&quot;form-control&quot;&gt;&lt;&#x2F;p&gt;</span><br><span class="line">&lt;p&gt;username:&lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;username&quot; class&#x3D;&quot;form-control&quot;&gt;&lt;&#x2F;p&gt;</span><br><span class="line"></span><br><span class="line"># 并且有两个相同的name属性</span><br><span class="line">&lt;p&gt;password:&lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;password&quot; class&#x3D;&quot;form-control&quot;&gt;&lt;&#x2F;p&gt;</span><br><span class="line"></span><br><span class="line"># 可通过get的方式</span><br><span class="line">print(request.POST)</span><br><span class="line">username &#x3D; request.POST.get(&#39;usernamr&#39;)</span><br><span class="line">password &#x3D; request.POST.get(&#39;password&#39;)</span><br><span class="line">print(username, type(usernsme))</span><br><span class="line">print(password, type(password))</span><br><span class="line"></span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">&lt;QueryDict: &#123;&#39;username&#39;: [&#39;admin&#39;, &#39;jason&#39;], &#39;password&#39;: [&#39;123&#39;]&#125;&gt;</span><br><span class="line">jason &lt;class &#39;str&#39;&gt;</span><br><span class="line">123 &lt;class &#39;str&#39;&gt;</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">#相同的name属性得到的是一个字典套集合的形式，</span><br><span class="line"></span><br><span class="line"># 通过结果我们可以发现数据都是字符串，如果数据是一个列表，那么get获取数据只能只是列表最后一个数据，不能全部获取</span><br><span class="line"></span><br><span class="line">username &#x3D; request.POST.getlist(&#39;usernamr&#39;)</span><br><span class="line"># 通过getlist的方式可以获取整个列表</span><br></pre></td></tr></table></figure>

<p>5)如何获取GET请求的数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">GET请求和POST请求是一样的，只不过GET请求获取的是url后面携带的数据：url?xxx&#x3D;xxx&amp;yyy&#x3D;yyy</span><br><span class="line"> # 获取符合get请求携带参数特点的数据  url?xxx&#x3D;xxx&amp;yyy&#x3D;yyy</span><br><span class="line"> print(request.GET)  </span><br><span class="line"># &lt;QueryDict: &#123;&#39;username&#39;: [&#39;admin&#39;], &#39;password&#39;: [&#39;123&#39;]&#125;&gt;</span><br><span class="line">print(request.GET.get(&#39;username&#39;),type(request.GET.get(&#39;username&#39;)))</span><br><span class="line"># admin &lt;class ’str‘&gt;</span><br><span class="line">print(request.GET.getlist(&#39;password&#39;),type(request.GET.getlist(&#39;password&#39;)))</span><br><span class="line"># [&#39;123&#39;] &lt;class &#39;list&#39;&gt;</span><br><span class="line"></span><br><span class="line">只要符合这个url?xxx&#x3D;xxx&amp;yyy&#x3D;yyy格式，request.GET都能获取数据</span><br></pre></td></tr></table></figure>

<h2 id="四-链接数据库"><a href="#四-链接数据库" class="headerlink" title="四.链接数据库"></a>四.链接数据库</h2><ul>
<li>先找到database</li>
</ul>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202002/1843708-20200204135828638-798318562.png" alt="img"></p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202002/1843708-20200204135840328-83318567.png" alt="img"></p>
<ul>
<li>找到对应的数据库</li>
</ul>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202002/1843708-20200204135845130-1026936053.png" alt="img"></p>
<ul>
<li>下载驱动尝试链接数据库</li>
</ul>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202002/1843708-20200204135851256-512479350.png" alt="img"></p>
<ul>
<li>链接成功后就能找到数据库表了</li>
</ul>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202002/1843708-20200204135858803-1505346103.png" alt="img"></p>
<ul>
<li>一些简单操作（注意：pycharm由于功能太多，所以不能做到面面俱到）</li>
</ul>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202002/1843708-20200204135905802-2078485201.png" alt="img"></p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202002/1843708-20200204135913705-323570701.png" alt="img"></p>
<h2 id="五-Django链接数据库"><a href="#五-Django链接数据库" class="headerlink" title="五.Django链接数据库"></a>五.Django链接数据库</h2><ul>
<li>先去配置文件中配置相关参数</li>
</ul>
<p>在settings中找到下面这个配置信息，进行修改</p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202002/1843708-20200204135922691-1432970650.png" alt="img"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">DATABASES &#x3D; &#123;</span><br><span class="line">    &#39;default&#39;: &#123;</span><br><span class="line">        &#39;ENGINE&#39;: &#39;django.db.backends.mysql&#39;,  # 数据库类别</span><br><span class="line">        &#39;NAME&#39;: &#39;day49&#39;,  # 库的名字</span><br><span class="line">        &#39;HOST&#39;: &#39;127.0.0.1&#39;,</span><br><span class="line">        &#39;PORT&#39;: 3306,</span><br><span class="line">        &#39;USER&#39;: &#39;root&#39;,</span><br><span class="line">        &#39;PASSWORD&#39;: &#39;123&#39;,</span><br><span class="line">        &#39;CHARSET&#39;: &#39;utf8&#39;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>下面的错误表示Djiango使用的是mysqldb这个模块，这个版本是不兼容的，需要切换成pymysql模块</strong></p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202002/1843708-20200204135931009-387281956.png" alt="img"></p>
<ul>
<li>在项目名或者应用名下面的__ init __.py文件中告诉django使用pymysql链接数据库而不是用默认的mysqldb</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import pymysql</span><br><span class="line">pymysql.install_as_MYSQLdb()</span><br></pre></td></tr></table></figure>

<h2 id="六-django中的ORM"><a href="#六-django中的ORM" class="headerlink" title="六.django中的ORM"></a>六.django中的ORM</h2><p>注意：django不能自动创建库，需要自己手动创建，但是可以自动创建表</p>
<p>orm对应关系如下</p>
<table>
<thead>
<tr>
<th align="center">类名</th>
<th align="center">表名</th>
</tr>
</thead>
<tbody><tr>
<td align="center">属性名</td>
<td align="center">字段值</td>
</tr>
<tr>
<td align="center">对象</td>
<td align="center">记录</td>
</tr>
</tbody></table>
<p>作用:能够让一个不会数据库操作的小白也能够通过Python面向对象语法 句点符来简单快捷的操作数据</p>
<ul>
<li>首先需要先去对应的应用下的models.py中书写你的模型类</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">class User(models.Model):</span><br><span class="line">        # id int primary key auto_increment</span><br><span class="line">        id &#x3D; models.AutoField(primary_key&#x3D;True)</span><br><span class="line">        # name varchar(32)</span><br><span class="line">        name &#x3D; models.CharField(max_length&#x3D;32)</span><br><span class="line">        # password int</span><br><span class="line">        password &#x3D; models.IntegerField()</span><br></pre></td></tr></table></figure>

<ul>
<li>执行数据库迁移命令(就是将models.py中建立的类同步到数据库中)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.python3 manage.py makemigrations  # 仅仅是将你对数据库的改动记录到某个小本本上(migrations文件夹)</span><br><span class="line"></span><br><span class="line">2.python3 manage.py migrate  # 将改动真正的同步到数据库中</span><br></pre></td></tr></table></figure>

<ul>
<li>执行第一步会产生下面的效果</li>
</ul>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202002/1843708-20200204140025505-1942172736.png" alt="img"></p>
<ul>
<li>执行第二步之后</li>
</ul>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202002/1843708-20200204140033161-1078043982.png" alt="img"> </p>
<p><strong>补充知识点：</strong></p>
<ul>
<li>快捷命令输入</li>
</ul>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202002/1843708-20200204140042541-113136339.png" alt="img"> </p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202002/1843708-20200204140047600-333526206.png" alt="img"></p>
<ul>
<li>如果主键名为id，可以不设置，django默认设置主键，如果设置了，以自定义的id为主键</li>
</ul>
<h2 id="七-如何在django中进行数据库字段的增删改查"><a href="#七-如何在django中进行数据库字段的增删改查" class="headerlink" title="七.如何在django中进行数据库字段的增删改查"></a>七.如何在django中进行数据库字段的增删改查</h2><ul>
<li>字段的增</li>
</ul>
<p>可以直接在models.py中进行字段的增，但是注意有两种方式（因为数据库中可能已经存入各种数据了，新添加一个字段，那些已经有数据的字段需要进行修改）</p>
<p>第一种是设置默认值，例如</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">email &#x3D; models.EmailField(default&#x3D;&#39;123@qq.com&#39;)</span><br></pre></td></tr></table></figure>

<p>第二种是允许新设置的字段可以为空，例如(CharField需要设置max_length)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hobby &#x3D; models.CharField(null&#x3D;True,max_length&#x3D;32)</span><br></pre></td></tr></table></figure>

<ul>
<li>字段的查改删都可以通过直接操作models.py文件中的类属性</li>
</ul>
<p>唯一需要注意的就是凡是涉及到字段的操作都需要进行数据库迁移命令，否则操作无效</p>
<h2 id="八-如何在django中进行数据库记录的增删改查"><a href="#八-如何在django中进行数据库记录的增删改查" class="headerlink" title="八.如何在django中进行数据库记录的增删改查"></a>八.如何在django中进行数据库记录的增删改查</h2><ul>
<li>查</li>
</ul>
<p>第一步，在需要进行数据库信息查询的文件中导入models文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">from app01 import models</span><br></pre></td></tr></table></figure>

<p>第二步，通过filter的方法可以拿到所需要的数据列表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">res &#x3D; models.User.objects.filter(name&#x3D;username)  # 该方法返回的结果你可以看成是一个列表套数据对象的形式，其中User表示表名，name表示字段名，后一个username是前端返回来的数据，即查询条件</span><br><span class="line">print(res) # &lt;QuerySet [&lt;User: User object&gt;]&gt;</span><br></pre></td></tr></table></figure>

<p>第三步，该数据列表支持索引取值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">user_obj &#x3D; res[0]  # QuerySet支持索引取值但是不支持负数 并且也不推荐直接索引取值</span><br><span class="line">user_obj &#x3D; res.first() # 索引和first（）这两种方法都可以</span><br><span class="line"># print(user_obj.name,user_obj.password)</span><br></pre></td></tr></table></figure>

<p>补充：当查询条件不存在的时候，是一个queryset[]空列表，不会报错</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">filter括号内直接放多个关键字参数 并且多个关键字参数之间是and关系</span><br><span class="line">res &#x3D; models.User.objects.filter(username&#x3D;&#39;jason&#39;,password&#x3D;&#39;123&#39;)  # select * from user where username&#x3D;&#39;jason&#39; and password&#x3D;&#39;123&#39;;</span><br></pre></td></tr></table></figure>

<ul>
<li>查所有数据</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1.filter() 括号内不写拿所有</span><br><span class="line">&lt;QuerySet [&lt;User: jason&gt;, &lt;User: egon&gt;, &lt;User: sean&gt;, &lt;User: admin&gt;]&gt;</span><br><span class="line"></span><br><span class="line">2.all() 查询所有数据</span><br><span class="line">&lt;QuerySet [&lt;User: jason&gt;, &lt;User: egon&gt;, &lt;User: sean&gt;, &lt;User: admin&gt;]&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>增</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1.create()</span><br><span class="line">    user_obj &#x3D; models.User.objects.create(name&#x3D;username,password&#x3D;password)</span><br><span class="line">    print(user_obj,user_obj.name)</span><br><span class="line">    # 该方法有返回值 返回值就是当前被创建的对象本身</span><br><span class="line">2.对象的绑定方法</span><br><span class="line">    # 1 先生成一个User对象</span><br><span class="line">    user_obj &#x3D; models.User(name&#x3D;username,password&#x3D;password)</span><br><span class="line">    # 2 调用对象的绑定方法</span><br><span class="line">    user_obj.save()</span><br></pre></td></tr></table></figure>

<ul>
<li>删</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># 简单的删除逻辑</span><br><span class="line"># 用户通过点击删除键就能删除数据，需要获取指定数据的id，通过这个id来操作数据的删除</span><br><span class="line">第一步：在前端删除键上可以绑定数据的id，这样发送get请求就会带上id</span><br><span class="line"></span><br><span class="line"> &lt;a href&#x3D;&quot;&#x2F;delete_user&#x2F;?delete_id&#x3D;&#123;&#123; user_obj.id &#125;&#125;&quot; class&#x3D;&quot;btn btn-danger btn-xs&quot;&gt;删除&lt;&#x2F;a&gt;</span><br><span class="line">    </span><br><span class="line">第二步：后端通过id来获取数据</span><br><span class="line"></span><br><span class="line">def del_user(request):</span><br><span class="line">    # 如何获取用户想逃删除的数据id</span><br><span class="line">    delete_id &#x3D; request.GET.get(&quot;delete_id&quot;)</span><br><span class="line">    # 直接根据id删除数据</span><br><span class="line">    models.User.objects.filter(id&#x3D;delete_id).delete()  # 将filter过滤出来的数据全部删除</span><br><span class="line">    # 重定向到展示页</span><br><span class="line">    return redirect(&#39;&#x2F;home&#x2F;&#39;)</span><br></pre></td></tr></table></figure>

<ul>
<li>改</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">改和删前面基本一致</span><br><span class="line">后面有两种方法</span><br><span class="line">def edit_user(request):</span><br><span class="line">    # 获取用户想要修改的数据id值</span><br><span class="line">    edit_id &#x3D; request.GET.get(&#39;edit_id&#39;)</span><br><span class="line">    if request.method &#x3D;&#x3D; &#39;POST&#39;:</span><br><span class="line">        # 获取用户修改之后的用户名和密码</span><br><span class="line">        username &#x3D; request.POST.get(&#39;username&#39;)</span><br><span class="line">        password &#x3D; request.POST.get(&#39;password&#39;)</span><br><span class="line">        # 修改数据</span><br><span class="line">        # 方式1(推荐)</span><br><span class="line">        # models.User.objects.filter(id&#x3D;edit_id).update(name&#x3D;username,password&#x3D;password)</span><br><span class="line">        # 方式2(了解)</span><br><span class="line">        # 1 先获取数据对象</span><br><span class="line">        edit_obj &#x3D; models.User.objects.filter(id&#x3D;edit_id).first()</span><br><span class="line">        # 2 再修改对象属性</span><br><span class="line">        edit_obj.name &#x3D; username</span><br><span class="line">        edit_obj.password &#x3D; password</span><br><span class="line">        # 3 调用对象的绑定方法保存</span><br><span class="line">        edit_obj.save()</span><br><span class="line">        # 再次跳转到数据展示页</span><br><span class="line">        return redirect(&#39;&#x2F;home&#x2F;&#39;)</span><br><span class="line">    # 根据id获取数据对象 并且展示到html页面上</span><br><span class="line">    edit_obj &#x3D; models.User.objects.filter(id&#x3D;edit_id).first()</span><br><span class="line"></span><br><span class="line">    return render(request,&#39;edit_user.html&#39;,&#123;&#39;edit_obj&#39;:edit_obj&#125;)</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/12/09/Django%E6%A1%86%E6%9E%B6%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE/" data-id="ckd49wrb90001l4ut86lv7g09" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Django/" rel="tag">Django</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">Next &amp;raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Django/" rel="tag">Django</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Docker/" rel="tag">Docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL/" rel="tag">MySQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/" rel="tag">Python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%88%AC%E8%99%AB/" rel="tag">爬虫</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BD%91%E7%BB%9C%E5%92%8C%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/" rel="tag">网络和并发编程</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Django/" style="font-size: 16.67px;">Django</a> <a href="/tags/Docker/" style="font-size: 10px;">Docker</a> <a href="/tags/MySQL/" style="font-size: 13.33px;">MySQL</a> <a href="/tags/Python/" style="font-size: 20px;">Python</a> <a href="/tags/%E7%88%AC%E8%99%AB/" style="font-size: 10px;">爬虫</a> <a href="/tags/%E7%BD%91%E7%BB%9C%E5%92%8C%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/" style="font-size: 10px;">网络和并发编程</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">三月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">九月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">一月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">十二月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">十一月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">十月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">九月 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/03/28/Docker%E9%95%9C%E5%83%8F%E5%AE%B9%E5%99%A8%E6%93%8D%E4%BD%9C/">Docker镜像容器操作</a>
          </li>
        
          <li>
            <a href="/2020/03/27/Docker/">Docker</a>
          </li>
        
          <li>
            <a href="/2019/09/18/request%E6%A8%A1%E5%9D%97/">request模块</a>
          </li>
        
          <li>
            <a href="/2019/09/17/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80/">爬虫基础</a>
          </li>
        
          <li>
            <a href="/2019/01/02/Django%E6%A1%86%E6%9E%B6%E4%B9%8BAjax/">Django框架之Ajax</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 Mr Jiang<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>