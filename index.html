<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Mr Jiang</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="野生程序员一枚，对我温柔点。。。。。。">
<meta property="og:type" content="website">
<meta property="og:title" content="Mr Jiang">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Mr Jiang">
<meta property="og:description" content="野生程序员一枚，对我温柔点。。。。。。">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Mr Jiang">
<meta property="article:tag" content="Python">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Mr Jiang" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 4.2.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Mr Jiang</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">头发还够，那就再多学点</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-Django框架模板层" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/12/16/Django%E6%A1%86%E6%9E%B6%E6%A8%A1%E6%9D%BF%E5%B1%82/" class="article-date">
  <time datetime="2020-12-16T15:59:57.000Z" itemprop="datePublished">2020-12-16</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/12/16/Django%E6%A1%86%E6%9E%B6%E6%A8%A1%E6%9D%BF%E5%B1%82/">Django框架模板层</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="模版层"><a href="#模版层" class="headerlink" title="模版层"></a>模版层</h1><p><strong>模板语法符号</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&#125;&#125; 变量相关</span><br><span class="line">&#123;%%&#125; 逻辑相关</span><br></pre></td></tr></table></figure>

<h2 id="一-模版语法之传值"><a href="#一-模版语法之传值" class="headerlink" title="一.模版语法之传值"></a>一.模版语法之传值</h2><ul>
<li>python基本数据类型全部支持传递给html文件</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># views.py</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="comment"># python所有的数据类型都支持传递给html页面</span></span><br><span class="line">    i = <span class="number">11</span></span><br><span class="line">    f = <span class="number">11.11</span></span><br><span class="line">    str = <span class="string">'hello world'</span></span><br><span class="line">    list = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]</span><br><span class="line">    d = &#123;<span class="string">"username"</span>: <span class="string">'jason'</span>, <span class="string">'password'</span>: <span class="number">123</span>, <span class="string">'hobby'</span>: [<span class="string">'read'</span>, &#123;<span class="string">'username'</span>: [<span class="string">'jason'</span>, <span class="string">'egon'</span>]&#125;]&#125;</span><br><span class="line">    t = (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>,)</span><br><span class="line">    se = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>&#125;</span><br><span class="line">    b = <span class="literal">True</span></span><br><span class="line">    ff = <span class="literal">False</span></span><br><span class="line">    </span><br><span class="line">	<span class="comment"># python后端传给前端值的两种方式</span></span><br><span class="line">    <span class="comment"># 第一种传值方式</span></span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'index.html'</span>, &#123;<span class="string">'i'</span>:i, <span class="string">'f'</span>:f, <span class="string">'str'</span>: str &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 第二种传值方式</span></span><br><span class="line">    <span class="comment"># 会将当前名称空间所有的变量名都全部传递给html页面</span></span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'index.html'</span>, locals())</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">    &lt;script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"&gt;&lt;/script&gt;</span><br><span class="line">    &lt;link href=<span class="string">"https://cdn.bootcss.com/twitter-bootstrap/3.4.1/css/bootstrap.min.css"</span> rel=<span class="string">"stylesheet"</span>&gt;</span><br><span class="line">    &lt;script src="https://cdn.bootcss.com/twitter-bootstrap/3.4.1/js/bootstrap.min.js"&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;p&gt;&#123;&#123; i &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;&#123;&#123; f &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;&#123;&#123; str &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;&#123;&#123; list &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;&#123;&#123; d &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;&#123;&#123; t &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;&#123;&#123; se &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;&#123;&#123; b&#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;&#123;&#123; ff &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>

<p><img src="https://img2018.cnblogs.com/blog/1843708/202001/1843708-20200108004532201-2027287951.png" alt="img"></p>
<ul>
<li>python后端函数发送到前端html页面</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="comment"># 写一个示例函数</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">()</span>:</span></span><br><span class="line">        print(<span class="string">'views'</span>)</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'index.html'</span>, locals())</span><br><span class="line">&lt;!--这下面带<span class="comment">#号的注释前端浏览器是不展示的，但是html自身的注释是可以看到的--&gt;</span></span><br><span class="line">&#123;<span class="comment">#&lt;p&gt;&#123;&#123; i &#125;&#125;&lt;/p&gt;#&#125;</span></span><br><span class="line">&#123;<span class="comment">#&lt;p&gt;&#123;&#123; f &#125;&#125;&lt;/p&gt;#&#125;</span></span><br><span class="line">&#123;<span class="comment">#&lt;p&gt;&#123;&#123; str &#125;&#125;&lt;/p&gt;#&#125;</span></span><br><span class="line">&#123;<span class="comment">#&lt;p&gt;&#123;&#123; list &#125;&#125;&lt;/p&gt;#&#125;</span></span><br><span class="line">&#123;<span class="comment">#&lt;p&gt;&#123;&#123; d &#125;&#125;&lt;/p&gt;#&#125;</span></span><br><span class="line">&#123;<span class="comment">#&lt;p&gt;&#123;&#123; t &#125;&#125;&lt;/p&gt;#&#125;</span></span><br><span class="line">&#123;<span class="comment">#&lt;p&gt;&#123;&#123; se &#125;&#125;&lt;/p&gt;#&#125;</span></span><br><span class="line">&#123;<span class="comment">#&lt;p&gt;&#123;&#123; b&#125;&#125;&lt;/p&gt;#&#125;</span></span><br><span class="line">&#123;<span class="comment">#&lt;p&gt;&#123;&#123; ff &#125;&#125;&lt;/p&gt;#&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;p&gt;&#123;&#123; func &#125;&#125;&lt;/p&gt;</span><br></pre></td></tr></table></figure>

<p><img src="https://img2018.cnblogs.com/blog/1843708/202001/1843708-20200108005242307-1683979717.png" alt="img"></p>
<p><strong>所以，当传递函数名的时候，函数名会自动加括号进行执行，展示的只是函数的返回值，若不设置返回值，默认返回None</strong></p>
<p>注意：模板语法不支持给函数传参</p>
<ul>
<li>python后端传递类给前端html页面</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">MyClass</span><span class="params">(object)</span>:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">get_self</span><span class="params">(self)</span>:</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">'from self'</span></span><br><span class="line">        </span><br><span class="line"><span class="meta">        @staticmethod</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">get_func</span><span class="params">()</span>:</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">'from func'</span></span><br><span class="line"></span><br><span class="line"><span class="meta">        @classmethod</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">get_cls</span><span class="params">(cls)</span>:</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">'from cls'</span></span><br><span class="line"></span><br><span class="line">    obj = MyClass()</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'index.html'</span>, locals())</span><br><span class="line">&lt;p&gt;&#123;&#123; MyClass &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;&#123;&#123; obj &#125;&#125;&lt;/p&gt;</span><br></pre></td></tr></table></figure>

<p><img src="https://img2018.cnblogs.com/blog/1843708/202001/1843708-20200108005309107-423906066.png" alt="img"></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; MyClass.get_cls &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; MyClass.get_func &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; MyClass.get_self &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; obj.get_cls &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; obj.get_func&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; obj.get_self&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://img2018.cnblogs.com/blog/1843708/202001/1843708-20200108005338282-440192074.png" alt="img"></p>
<p>同样，传递类名给前端html时候的也会加括号执行获取类的对象,也不支持传参</p>
<ul>
<li>取值方法</li>
</ul>
<p>django模板语法取值 只有一种操作方式 通过句点符 .</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span>  </span><br><span class="line">    d = &#123;<span class="string">"username"</span>:<span class="string">'jason'</span>,<span class="string">'password'</span>:<span class="number">123</span>,<span class="string">'hobby'</span>:[<span class="string">'read'</span>,&#123;<span class="string">'username'</span>:[<span class="string">'jason'</span>,<span class="string">'egon'</span>]&#125;]&#125;</span><br><span class="line">    <span class="string">")</span></span><br><span class="line"><span class="string">    return render(request,'index.html',locals())  </span></span><br><span class="line"><span class="string">&lt;p&gt;&#123;&#123; d.hobby.1.username.1 &#125;&#125;&lt;/p&gt;</span></span><br></pre></td></tr></table></figure>

<p>句可以通过多个句点符的方式去获取需要的数据</p>
<h2 id="二-模版语法之过滤器"><a href="#二-模版语法之过滤器" class="headerlink" title="二.模版语法之过滤器"></a>二.模版语法之过滤器</h2><ul>
<li>|length:获取长度</li>
<li>|add:加法运算</li>
<li>|default:判断是否为空</li>
<li>|truncatechars:截取字符(指定数量字符中会包括三个点)</li>
<li>|truncatewords:截取单词(截取指定单词数目，会额外添加三个点)</li>
<li>|filesizeformat:自动计算文件大小（MB,GB等）</li>
<li>|slice:切片</li>
<li>|date:日期格式化</li>
<li>|safe:转义</li>
</ul>
<p>过滤器语法：过滤器 |左边的会当做过滤器的第一个参数 过滤器名右边的会当做过滤器的第二个参数</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="comment"># 该模块可以帮助后端直接转义前端标签</span></span><br><span class="line"><span class="keyword">from</span> django.utils.safestring <span class="keyword">import</span> mark_safe</span><br><span class="line"><span class="comment"># Create your views here.</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="comment"># python所有的数据类型都支持传递给html页面</span></span><br><span class="line">    i = <span class="number">11</span></span><br><span class="line">    f = <span class="number">11.11</span></span><br><span class="line">    s = <span class="string">'hello world'</span></span><br><span class="line">    str = <span class="string">'hello world'</span></span><br><span class="line">    list = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]</span><br><span class="line">    d = &#123;<span class="string">"username"</span>: <span class="string">'jason'</span>, <span class="string">'password'</span>: <span class="number">123</span>, <span class="string">'hobby'</span>: [<span class="string">'read'</span>, &#123;<span class="string">'username'</span>: [<span class="string">'jason'</span>, <span class="string">'egon'</span>]&#125;]&#125;</span><br><span class="line">    t = (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>,)</span><br><span class="line">    se = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>&#125;</span><br><span class="line">    b = <span class="literal">True</span></span><br><span class="line">    ff = <span class="literal">False</span></span><br><span class="line">    ff = <span class="literal">False</span></span><br><span class="line">    ss = <span class="string">'kjasdklas ksd;lk  akjsdkl da  kjda k;lak d k;a dk  ska d'</span></span><br><span class="line">    sss = <span class="string">'卡时间 冻结 鲨科 技的 卡拉 手动 卡萨 丁卡'</span></span><br><span class="line">    file_size = <span class="number">32213213424</span></span><br><span class="line">    ddd = datetime.now()</span><br><span class="line">    <span class="comment">#可以传入前端转义</span></span><br><span class="line">    res = <span class="string">"&lt;h1&gt;你好啊&lt;/h1&gt;"</span></span><br><span class="line">    <span class="comment"># 直接传是不会被前端识别并展示到浏览器中的</span></span><br><span class="line">    res1 = <span class="string">"&lt;script&gt;alert(123)&lt;/script&gt;"</span></span><br><span class="line">    <span class="comment">#可以直接在后端就进行转义</span></span><br><span class="line">    res2 = mark_safe(<span class="string">"&lt;h1&gt;你好啊&lt;/h1&gt;"</span>)</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'index.html'</span>, locals())</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">    &lt;script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"&gt;&lt;/script&gt;</span><br><span class="line">    &lt;link href=<span class="string">"https://cdn.bootcss.com/twitter-bootstrap/3.4.1/css/bootstrap.min.css"</span> rel=<span class="string">"stylesheet"</span>&gt;</span><br><span class="line">    &lt;script src="https://cdn.bootcss.com/twitter-bootstrap/3.4.1/js/bootstrap.min.js"&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;p&gt;&#123;&#123; s|length &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;&#123;&#123; i|add:10 &#125;&#125;&lt;/p&gt;  &lt;!--加法运算必须前后都是数字或者字符串--&gt;</span><br><span class="line">&lt;p&gt;&#123;&#123; b|default:'判断是否为空，得到的是布尔值' &#125;&#125;&lt;/p&gt; &lt;!--若有值返回True，没有值返回|右面的参数--&gt;</span><br><span class="line">&lt;p&gt;&#123;&#123; s|truncatechars:8 &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;&#123;&#123; ss|truncatewords:3 &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;&#123;&#123; file_size|filesizeformat &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;&#123;&#123; s|slice:'0:3:2' &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;&#123;&#123; ddd|date:'Y年/m月/d日' &#125;&#125;&lt;/p&gt; &lt;!--注意time模块时间戳不可以转换--&gt;</span><br><span class="line">&lt;p&gt;&#123;&#123; res1 &#125;&#125;&lt;/p&gt;  &lt;!--后端标签语言传入前端是失效的，防止一些恶意脚本攻击--&gt;</span><br><span class="line">&lt;p&gt;&#123;&#123; res|safe &#125;&#125;&lt;/p&gt;&lt;!--可以通过safe转义--&gt;</span><br><span class="line">&lt;p&gt;&#123;&#123; res2 &#125;&#125;&lt;/p&gt;&lt;!--也可以在前端通过from django.utils.safestring import mark_safe中的mark_safe方法--&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p><img src="https://img2018.cnblogs.com/blog/1843708/202001/1843708-20200108005435077-247151037.png" alt="img"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">前后端取消转义</span><br><span class="line">	前端</span><br><span class="line">		|safe</span><br><span class="line">	后端</span><br><span class="line">		<span class="keyword">from</span> django.utils.safestring <span class="keyword">import</span> mark_safe</span><br><span class="line">		mark_safe(<span class="string">'&lt;h1&gt;安全滴&lt;/h1&gt;'</span>)</span><br><span class="line">总结:前端代码不一定非要在前端页面写,可以在后端写好传递给前端页面使用</span><br><span class="line">这样的话 你就可以利用到后端更加多的逻辑语法</span><br></pre></td></tr></table></figure>

<h2 id="三-模版语法之标签"><a href="#三-模版语法之标签" class="headerlink" title="三.模版语法之标签"></a>三.模版语法之标签</h2><ul>
<li>前端for循环中forloop参数</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for foo in list %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; forloop &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>

<p>得到下图，可以看到有first，last等方法</p>
<p><img src="https://img2018.cnblogs.com/blog/1843708/202001/1843708-20200108005528846-471312970.png" alt="img"></p>
<ul>
<li>前端if条件</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for foo in list %&#125;</span><br><span class="line">    &#123;% if forloop.first %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>这是第一个值<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    &#123;% elif forloop.last %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>这是第一个值<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    &#123;% else %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; foo &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://img2018.cnblogs.com/blog/1843708/202001/1843708-20200108005604810-1783722273.png" alt="img"></p>
<p>补充：for循环的对象必须是可迭代对象或者不为空，否则无法执行，可以通过empty方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">a = []</span><br><span class="line">&#123;% <span class="keyword">for</span> foo <span class="keyword">in</span> a %&#125;</span><br><span class="line">    &#123;% <span class="keyword">if</span> forloop.first %&#125;</span><br><span class="line">        &lt;p&gt;这是第一个值&lt;/p&gt;</span><br><span class="line">    &#123;% <span class="keyword">elif</span> forloop.last %&#125;</span><br><span class="line">        &lt;p&gt;这是第一个值&lt;/p&gt;</span><br><span class="line">    &#123;% <span class="keyword">else</span> %&#125;</span><br><span class="line">        &lt;p&gt;&#123;&#123; foo &#125;&#125;&lt;/p&gt;</span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line">    &#123;% empty %&#125;</span><br><span class="line">        &lt;p&gt;for循环的对象内没有值&lt;/p&gt;</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://img2018.cnblogs.com/blog/1843708/202001/1843708-20200108005637262-1709933675.png" alt="img"></p>
<p><strong>keys，vlues，items同样可以使用</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">d = &#123;<span class="string">"username"</span>: <span class="string">'jason'</span>, <span class="string">'password'</span>: <span class="number">123</span>, <span class="string">'hobby'</span>: [<span class="string">'read'</span>, &#123;<span class="string">'username'</span>: [<span class="string">'jason'</span>, <span class="string">'egon'</span>]&#125;]&#125;</span><br><span class="line">&#123;% <span class="keyword">for</span> foo <span class="keyword">in</span> d.items %&#125;</span><br><span class="line">    &lt;p&gt;键值对:&#123;&#123; foo &#125;&#125;&lt;/p&gt;</span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% <span class="keyword">for</span> foo <span class="keyword">in</span> d.keys %&#125;</span><br><span class="line">    &lt;p&gt;key:&#123;&#123; foo &#125;&#125;&lt;/p&gt;</span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% <span class="keyword">for</span> foo <span class="keyword">in</span> d.values %&#125;</span><br><span class="line">    &lt;p&gt;值:&#123;&#123; foo &#125;&#125;&lt;/p&gt;</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://img2018.cnblogs.com/blog/1843708/202001/1843708-20200108005906346-62677865.png" alt="img"></p>
<p>补充：可以通过with起别名快速获取值</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>当一个值获取的步骤非常繁琐 但是又需要在很多地方用到 我们可以用起别名的方式来简化代码<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; d.hobby.1.username.1 &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--或者通过with起一个别名，就可以快速调用--&gt;</span></span><br><span class="line"></span><br><span class="line">&#123;% with d.hobby.1.username.1 as ag %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; ag &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">&#123;% endwith %&#125;</span><br></pre></td></tr></table></figure>

<h2 id="四-自定义过滤器，标签，inclusion-tag"><a href="#四-自定义过滤器，标签，inclusion-tag" class="headerlink" title="四.自定义过滤器，标签，inclusion_tag"></a>四.自定义过滤器，标签，inclusion_tag</h2><ul>
<li>前戏准备工作</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>在应用名下新建一个名字必须叫templatetags文件夹</span><br><span class="line">	<span class="number">2.</span>在该文件夹内新建一个任意名称的py文件(eg:mytag)</span><br><span class="line">	<span class="number">3.</span>在该文件内 必须先写以下两句代码</span><br><span class="line">		<span class="keyword">from</span> django.template <span class="keyword">import</span> Library		</span><br><span class="line">		register = Library()</span><br><span class="line"><span class="comment"># 自定义过滤器的创建和使用</span></span><br><span class="line"></span><br><span class="line"><span class="number">1.</span>在应用名下新建一个名字必须叫templatetags文件夹</span><br><span class="line"><span class="number">2.</span>在该文件夹内新建一个名称为mytag.py的文件</span><br><span class="line">mytag.py</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django.template <span class="keyword">import</span> Library		</span><br><span class="line">register = Library()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 自定义过滤器,给过滤器起个名字my_sum</span></span><br><span class="line"><span class="meta">@register.filter(name='my_sum')</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="comment"># 注意此处省略了逻辑校验</span></span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">index.html文件中使用过滤器</span><br><span class="line"></span><br><span class="line">&lt;p&gt;自定义过滤器的使用&lt;/p&gt;</span><br><span class="line">&#123;<span class="comment">#先将自定义的过滤器加载过来#&#125;</span></span><br><span class="line">    </span><br><span class="line">&#123;% load mytag %&#125;</span><br><span class="line">&lt;p&gt;&#123;&#123; 10|my_sum:90 &#125;&#125;&lt;/p&gt;</span><br></pre></td></tr></table></figure>

<p>注意：过滤器最多只能传两个参数，即|左右(如果非要传多个参数，可以通过x|name:[1,2,3,4]等方式手动处理)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 自定义标签的创建和使用</span></span><br><span class="line"></span><br><span class="line"><span class="number">1.</span>在应用名下新建一个名字必须叫templatetags文件夹</span><br><span class="line"><span class="number">2.</span>在该文件夹内新建一个名称为mytag.py的文件</span><br><span class="line">mytag.py</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django.template <span class="keyword">import</span> Library		</span><br><span class="line">register = Library()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 自定义标签</span></span><br><span class="line"><span class="meta">@register.simple_tag(name='my_simpletag')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">newtag</span><span class="params">(a, b, c, d)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'%s?%s?%s?%s'</span>%(a, b, c, d)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">index.html文件中使用过滤器</span><br><span class="line"></span><br><span class="line">&lt;p&gt;自定义标签的使用&lt;/p&gt;</span><br><span class="line">&#123;% load mytag %&#125;</span><br><span class="line">&lt;p&gt;&#123;% my_simpletag 1 2 3 4 %&#125;&lt;/p&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 这里可以得出：标签是&#123;%  %&#125;,并且可以传多个参数，过滤器是&#123;&#123;&#125;&#125;,只能传两个参数，并且通过simple_tag创建的标签不能作为条件使用for循环和if逻辑语句，而通过filter创建的过滤器就可以使用if逻辑语句</span></span><br><span class="line"><span class="comment"># 自定义inclusion_tag的创建和使用</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#inclusion_tag的作用：</span></span><br><span class="line"><span class="comment">#    比如在一个html页面上调用一个inclusion_tag,这个inclusion_tag会调用一个函数并生成一些数据，这些数据会放到一个html页面上进行渲染，将渲染好的页面再传回inclusion_tag的位置（类似于函数的装饰器，可以额外添加到某个已经写好的html页面</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 第一步：自定义inclusion_tag</span></span><br><span class="line"><span class="meta">@register.inclusion_tag('demo.html',name='my_name')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index1</span><span class="params">(n)</span>:</span></span><br><span class="line">    list1 = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">        list1.append(i)</span><br><span class="line">    <span class="comment"># 将列表数据传递给demo.html</span></span><br><span class="line">    <span class="comment"># 注意用locals传的时候是传全部变量</span></span><br><span class="line">    <span class="keyword">return</span> locals()</span><br><span class="line">    <span class="comment">#或者使用字典的形式是指定参数传值</span></span><br><span class="line">    <span class="comment"># return &#123;'list':list&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 第二步，可以新建一个demo.html文件接收数据(只需要部分能实现功能的代码就好)</span></span><br><span class="line">&lt;div&gt;</span><br><span class="line">    &#123;% <span class="keyword">for</span> foo <span class="keyword">in</span> list1 %&#125;</span><br><span class="line">        &lt;li&gt;&#123;&#123; foo &#125;&#125;&lt;/li&gt;</span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line"></span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 第三步：调用inclusion_tag</span></span><br><span class="line">&lt;p&gt;自定义inclusion_tag的使用&lt;/p&gt;</span><br><span class="line">&#123;% load mytag %&#125;</span><br><span class="line">&#123;% my_name <span class="number">10</span> %&#125;</span><br></pre></td></tr></table></figure>

<h2 id="五-模版的继承和导入"><a href="#五-模版的继承和导入" class="headerlink" title="五.模版的继承和导入"></a>五.模版的继承和导入</h2><ul>
<li>继承</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">模板的继承</span><br><span class="line">	某一个页面大部分区域都是公用的 那这个页面就可以作为模板页面</span><br><span class="line">	当别人继承这个页面之后 如何修改对应的区域</span><br><span class="line">	</span><br><span class="line">	先在模板页面上通过block实现划定区域</span><br><span class="line">		&#123;% block content %&#125;	</span><br><span class="line">			模板页面内容</span><br><span class="line">		&#123;% endblock %&#125;</span><br><span class="line">	</span><br><span class="line">	子页面中先导入整个模板</span><br><span class="line">		&#123;% extends <span class="string">'模板页面.html'</span>%&#125;</span><br><span class="line">		修改特定的区域  通过实现划定好的区域名称</span><br><span class="line">		&#123;% block content %&#125;</span><br><span class="line">			子页面内容</span><br><span class="line">		&#123;% endblock %&#125;</span><br><span class="line">	</span><br><span class="line">	通常情况下 模板页面页面应该起码有三块区域</span><br><span class="line">		&#123;% block css %&#125;	</span><br><span class="line">			模板页面内容</span><br><span class="line">		&#123;% endblock %&#125;</span><br><span class="line">		&#123;% block content %&#125;	</span><br><span class="line">			模板页面内容</span><br><span class="line">		&#123;% endblock %&#125;</span><br><span class="line">		&#123;% block js %&#125;	</span><br><span class="line">			模板页面内容</span><br><span class="line">		&#123;% endblock %&#125;</span><br><span class="line">	<span class="comment"># 模板的block块越多 可扩展性越高</span></span><br><span class="line">	</span><br><span class="line">	还支持子页面调用父页面对应区域的内容 并且可以无限次调用</span><br><span class="line">		&#123;&#123; block.super &#125;&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>导入</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">模板的导入</span><br><span class="line">	将html页面当做模块使用 哪里需要导哪里  这个html页面通常都不是完整的 只是一个局部样式</span><br><span class="line">	&#123;% include <span class="string">'left.html'</span> %&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/12/16/Django%E6%A1%86%E6%9E%B6%E6%A8%A1%E6%9D%BF%E5%B1%82/" data-id="ckd3ezcwg0005t4utgq689oxh" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Django/" rel="tag">Django</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Django框架之Ajax" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/01/02/Django%E6%A1%86%E6%9E%B6%E4%B9%8BAjax/" class="article-date">
  <time datetime="2019-01-02T15:17:01.000Z" itemprop="datePublished">2019-01-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/01/02/Django%E6%A1%86%E6%9E%B6%E4%B9%8BAjax/">Django框架之Ajax</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="一-多对多关系创建的三种方式"><a href="#一-多对多关系创建的三种方式" class="headerlink" title="一.多对多关系创建的三种方式"></a>一.多对多关系创建的三种方式</h1><h2 id="1）全自动（较为常用）"><a href="#1）全自动（较为常用）" class="headerlink" title="1）全自动（较为常用）"></a>1）全自动（较为常用）</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1 class Book(models.Model)</span><br><span class="line">2     titile &#x3D; models.CharField(max_length&#x3D;32)</span><br><span class="line">3     </span><br><span class="line">4     # 通过Django的ManyToManyField类方法快速创建第三张中间表</span><br><span class="line">5     authors &#x3D; models.ManyToManyField(to&#x3D;&#39;author&#39;)</span><br><span class="line">6     </span><br><span class="line">7     </span><br><span class="line">8 class Author(models.Model)</span><br><span class="line">9     name &#x3D; CharField(max_length&#x3D;32)</span><br></pre></td></tr></table></figure>

<ul>
<li>优点：自动创建第三章表，快速</li>
<li>缺点：第三张表只有三个字段，无法添加其余的字段</li>
</ul>
<h2 id="2-纯手动"><a href="#2-纯手动" class="headerlink" title="2)纯手动"></a>2)纯手动</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> 1 class Book(models.Model)</span><br><span class="line"> 2     titile &#x3D; models.CharField(max_length&#x3D;32)</span><br><span class="line"> 3 </span><br><span class="line"> 4     </span><br><span class="line"> 5     </span><br><span class="line"> 6 class Author(models.Model)</span><br><span class="line"> 7     name &#x3D; CharField(max_length&#x3D;32)</span><br><span class="line"> 8     </span><br><span class="line"> 9     </span><br><span class="line">10 # 手动创建第三张表并添加外键关系    </span><br><span class="line">11 class Book2Author(models.Model)</span><br><span class="line">12     book &#x3D; models.ForeignKey(to&#x3D;&#39;Book&#39;)</span><br><span class="line">13     author&#x3D;models.ForeignKey(to&#x3D;&#39;Author&#39;)</span><br><span class="line">14     create_time &#x3D; models.DateField(auto_now_add&#x3D;True)</span><br></pre></td></tr></table></figure>

<ul>
<li>优点：第三张表可以添加自己的扩展字段</li>
<li>缺点：orm查询的时候会带来不变</li>
</ul>
<h2 id="2）半自动（推荐使用）"><a href="#2）半自动（推荐使用）" class="headerlink" title="2）半自动（推荐使用）"></a>2）半自动（推荐使用）</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> 1 class Book(models.Model)</span><br><span class="line"> 2     titile &#x3D; models.CharField(max_length&#x3D;32)</span><br><span class="line"> 3     # 需要建一个外键字段，额外添加两个参数，through表示通过那一张表来表示第三张表，through_field表示哪两个字段是用来链接的</span><br><span class="line"> 4         authors &#x3D; models.ManyToManyField(to&#x3D;&#39;author&#39;，through&#x3D;‘Book2Author’， through_fields&#x3D;(&#39;book&#39;, &#39;author&#39;))</span><br><span class="line"> 5     </span><br><span class="line"> 6      </span><br><span class="line"> 7 class Author(models.Model)</span><br><span class="line"> 8     name &#x3D; CharField(max_length&#x3D;32)</span><br><span class="line"> 9     </span><br><span class="line">10   </span><br><span class="line">11 </span><br><span class="line">12 class Book2Author(models.Model)</span><br><span class="line">13     book &#x3D; models.ForeignKey(to&#x3D;&#39;Book&#39;)</span><br><span class="line">14     author&#x3D;models.ForeignKey(to&#x3D;&#39;Author&#39;)</span><br><span class="line">15     create_time &#x3D; models.DateField(auto_now_add&#x3D;True)</span><br></pre></td></tr></table></figure>

<ul>
<li><p>优点：第三张表可以任意扩展额外的字段，还可以使用orm的正反向查询</p>
</li>
<li><p>缺点：无法利用add，set，remove，claer这些方法</p>
</li>
</ul>
<p>虽然无法使用了 但是你还可以自己直接操作第三表</p>
<h1 id="二-Ajax介绍"><a href="#二-Ajax介绍" class="headerlink" title="二.Ajax介绍"></a>二.Ajax介绍</h1><h2 id="1）什么是Ajax？"><a href="#1）什么是Ajax？" class="headerlink" title="1）什么是Ajax？"></a>1）什么是Ajax？</h2><p>AJAX（Asynchronous Javascript And XML）翻译成中文就是“异步的Javascript和XML”。即使用Javascript语言与服务器进行异步交互，传输的数据为XML（当然，传输的数据不只是XML）。</p>
<p>AJAX 不是新的编程语言，而是一种使用现有标准的新方法。</p>
<p>AJAX 最大的优点是在不重新加载整个页面的情况下，可以与服务器交换数据并更新部分网页内容。（这一特点给用户的感受是在不知不觉中完成请求和响应过程）</p>
<p>AJAX 不需要任何浏览器插件，但需要用户允许JavaScript在浏览器上执行。</p>
<p>简单概括就是：异步提交，局部刷新</p>
<ul>
<li><p>同步交互：客户端发出一个请求后，需要等待服务器响应结束后，才能发出第二个请求；</p>
</li>
<li><p>异步交互：客户端发出一个请求后，无需等待服务器响应结束，就可以发出第二个请求。任务的结果是是通过异步回调机制 callback()</p>
</li>
<li><p>与后端交互的方法：</p>
</li>
</ul>
<table>
<thead>
<tr>
<th align="left">交互方式</th>
<th align="left">请求方式</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1.浏览器窗口输入回车</td>
<td align="left">get</td>
</tr>
<tr>
<td align="left">2.a标签href属性填写url点击</td>
<td align="left">get</td>
</tr>
<tr>
<td align="left">3.form表单</td>
<td align="left">get/post</td>
</tr>
<tr>
<td align="left">4.Ajax</td>
<td align="left">get/post</td>
</tr>
</tbody></table>
<p>Ajax并不是一门新的语言 它其实就是基于js写的一个功能模块而已 由于原生js书写ajax较为繁琐 所以我们直接学jQuery封装号的ajax模块操作</p>
<h2 id="2）Ajax的语法"><a href="#2）Ajax的语法" class="headerlink" title="2）Ajax的语法"></a>2）Ajax的语法</h2><p>举例：</p>
<p>需求：<img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200112224154791-255794900.png" alt="img"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> 1 # views.py</span><br><span class="line"> 2 def index(request):</span><br><span class="line"> 3     if request.method &#x3D;&#x3D; &#39;POST&#39;:</span><br><span class="line"> 4         i1 &#x3D; request.POST.get(&#39;i1&#39;)</span><br><span class="line"> 5         i2 &#x3D; request.POST.get(&#39;i2&#39;)</span><br><span class="line"> 6         # i1 和 i2 是字符串类型  需要先做类型转换</span><br><span class="line"> 7         i3 &#x3D; int(i1) + int(i2)</span><br><span class="line"> 8         return HttpResponse(i3)</span><br><span class="line"> 9     return render(request,&#39;index.html&#39;)</span><br><span class="line">10</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"> 1 # index.py</span><br><span class="line"> 2 </span><br><span class="line"> 3 &lt;input type&#x3D;&quot;text&quot; id&#x3D;&quot;i1&quot;&gt; + &lt;input type&#x3D;&quot;text&quot; id&#x3D;&quot;i2&quot;&gt; &#x3D; &lt;input type&#x3D;&quot;text&quot; id&#x3D;&quot;i3&quot;&gt;</span><br><span class="line"> 4 &lt;button id&#x3D;&quot;d1&quot;&gt;按钮&lt;&#x2F;button&gt;</span><br><span class="line"> 5 &lt;script&gt;</span><br><span class="line"> 6     &#x2F;&#x2F;绑定事件</span><br><span class="line"> 7     $(&#39;#d1&#39;).click(function () &#123;</span><br><span class="line"> 8         &#x2F;&#x2F; 获取两个框里面内容 朝后端提交异步请求</span><br><span class="line"> 9         &#x2F;&#x2F; ajax基本语法</span><br><span class="line">10         $.ajax(&#123;</span><br><span class="line">11             &#x2F;&#x2F; 1.到底朝哪个后端提交数据</span><br><span class="line">12             url:&#39;&#39;,  &#x2F;&#x2F; 控制数据的提交路径  有三种写法 跟form表单的action属性一致</span><br><span class="line">13             &#x2F;&#x2F; 2.指定当前请求方式</span><br><span class="line">14             type:&#39;post&#39;,</span><br><span class="line">15             &#x2F;&#x2F; 3.提交的数据</span><br><span class="line">16             data:&#123;&#39;i1&#39;:$(&#39;#i1&#39;).val(),&#39;i2&#39;:$(&#39;#i2&#39;).val()&#125;,</span><br><span class="line">17             &#x2F;&#x2F; 4.ajax是异步提交 所以需要给一个回调函数来处理返回的结果</span><br><span class="line">18             success:function (data) &#123;  &#x2F;&#x2F; data就是异步提交的返回结果</span><br><span class="line">19                 &#x2F;&#x2F; 将异步回调的结果通过DOM操作渲染到第三个input框中</span><br><span class="line">20                 $(&#39;#i3&#39;).val(data)</span><br><span class="line">21             &#125;</span><br><span class="line">22         &#125;)</span><br><span class="line">23     &#125;)</span><br><span class="line">24 &lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>

<p>3)前后端传输数据的编码格式</p>
<ul>
<li>urlencoded</li>
<li>formdata</li>
<li>application/json</li>
</ul>
<h3 id="1-form表单提交的数据"><a href="#1-form表单提交的数据" class="headerlink" title="1).form表单提交的数据"></a>1).form表单提交的数据</h3><p>默认是urlencoded编码格式传输数据 <strong>urlencoded数据格式:</strong>username=jason&amp;password=123</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1 # 简单代码</span><br><span class="line">2 &lt;form action&#x3D;&quot;&quot; method&#x3D;&quot;post&quot;&gt;</span><br><span class="line">3     &lt;p&gt;&lt;&#x2F;p&gt;</span><br><span class="line">4     &lt;p&gt;&lt;&#x2F;p&gt;</span><br><span class="line">5     &lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;username&quot;&gt;</span><br><span class="line">6     &lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;password&quot;&gt;</span><br><span class="line">7     &lt;input type&#x3D;&quot;submit&quot; &gt;</span><br><span class="line">8</span><br></pre></td></tr></table></figure>

<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200112224307350-625986349.png" alt="img"></p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200112224404240-542235347.png" alt="img"></p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200112224326500-1113744219.png" alt="img"></p>
<p>补充：django后端针对该格式的数据 会自动解析并帮你打包到request.POST中以键值对的形式存在</p>
<p>取出数据的方式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if request.method &#x3D;&#x3D; &#39;POST&#39;:    print(request.POST)</span><br><span class="line">    </span><br><span class="line"># &lt;QueryDict: &#123;&#39;username&#39;: [&#39;ajska&#39;], &#39;password&#39;: [&#39;123&#39;]&#125;&gt;</span><br></pre></td></tr></table></figure>

<p><strong>若再form表单中的enctype属性是以默认urlencoded格式,input中type属性是file格式，上传文件，只是上传的文件名，具体文件内容并没有上传上去，只有将格式改为form-data格式，通过request.files才能拿到最终数据</strong>,<strong>并且此时在网页中通过检查也无法轻易获取数据了</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action&#x3D;&quot;&quot; method&#x3D;&quot;post&quot; enctype&#x3D;&quot;multipart&#x2F;form-data&quot;&gt;</span><br><span class="line">    &lt;input type&#x3D;&quot;file&quot; name&#x3D;&quot;myfile&quot;&gt;</span><br></pre></td></tr></table></figure>

<p><strong>formdata数据格式还是可以传普通送键值对数据</strong> ，django后端针对符合urlencoded编码格式数据(普通键值对)还是统一解析到request.POST中 而针对formdata文件数据就会自动解析放到request.FILES中</p>
<h3 id="2-ajax提交的数据"><a href="#2-ajax提交的数据" class="headerlink" title="2)ajax提交的数据"></a>2)ajax提交的数据</h3><p><strong>前后端数据交互 编码格式与数据格式一定要一致</strong></p>
<ul>
<li><strong>默认也是urlnecoded编码格式</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> 1 &lt;script&gt;</span><br><span class="line"> 2 </span><br><span class="line"> 3     $(&#39;#d1&#39;).click(function () &#123;</span><br><span class="line"> 4         $.ajax(&#123;</span><br><span class="line"> 5             url:&#39;&#39;,</span><br><span class="line"> 6             type:&#39;post&#39;,</span><br><span class="line"> 7             data:&#123;&#39;username&#39;:&#39;jason&#39;,&#39;password&#39;:123&#125;,</span><br><span class="line"> 8             success:function (data) &#123;</span><br><span class="line"> 9                 alert(data)</span><br><span class="line">10             &#125;</span><br><span class="line">11         &#125;)</span><br><span class="line">12     &#125;)</span><br><span class="line">13  &lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>

<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200112224507577-2131318994.png" alt="img"></p>
<ul>
<li><p><strong>但是Ajax也能发送application/json格式数据</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> 1 $(&#39;#d2&#39;).on(&#39;click&#39;,function () &#123;</span><br><span class="line"> 2         $.ajax(&#123;</span><br><span class="line"> 3             url:&#39;&#39;,</span><br><span class="line"> 4             type:&#39;post&#39;,</span><br><span class="line"> 5             &#x2F;&#x2F; 修改content-Type参数</span><br><span class="line"> 6             contentType:&#39;application&#x2F;json&#39;,&#x2F;&#x2F;通过JSON.stringify出来成json格式</span><br><span class="line"> 7             data:JSON.stringify(&#123;&#39;username&#39;:&#39;jason&#39;,&#39;password&#39;:123&#125;),  &#x2F;&#x2F; 将数据序列化成json格式字符串</span><br><span class="line"> 8             success:function (data) &#123;</span><br><span class="line"> 9                 alert(data)</span><br><span class="line">10             &#125;</span><br><span class="line">11         &#125;)</span><br><span class="line">12     &#125;)</span><br></pre></td></tr></table></figure>

<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200112224544008-1699987451.png" alt="img"> </p>
</li>
</ul>
<p>此时后端无法拿到数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1 def ab_ct(request):</span><br><span class="line">2     if request.method &#x3D;&#x3D; &#39;POST&#39;:</span><br><span class="line">3         print(request.POST)</span><br><span class="line">4         print(request.FILES)</span><br></pre></td></tr></table></figure>

<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200112224601890-2000378963.png" alt="img"></p>
<p>数据已经传到requset.body中了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(request.body)</span><br></pre></td></tr></table></figure>

<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200112224717875-1786093194.png" alt="img"></p>
<p>这个数据既不在POST中，也不在FILES中，以json格式存在body中</p>
<p>我们可以自己解码反序列化拿到数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1 # 自己处理json格式数据</span><br><span class="line">2 json_bytes &#x3D; request.body</span><br><span class="line">3 # 先解码</span><br><span class="line">4 json_str &#x3D; json_bytes.decode(&#39;utf-8&#39;)</span><br><span class="line">5 # 再反序列化</span><br><span class="line">6 json_dict &#x3D; json.loads(json_str)</span><br><span class="line">7 #补充：json.loads能够自动解码并序列化</span><br><span class="line">8 json_dict &#x3D; json.loads(json_bytes)</span><br><span class="line">9 print(json_dict,type(json_dict))</span><br></pre></td></tr></table></figure>

<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200112224810533-416708605.png" alt="img"></p>
<ul>
<li><strong>ajax也能提交文件格式</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"> 1 &lt;input type&#x3D;&quot;file&quot; name&#x3D;&quot;myfile&quot; id&#x3D;&quot;i1&quot;&gt;</span><br><span class="line"> 2 &lt;button id&#x3D;&quot;d3&quot;&gt;ajax发送文件数据&lt;&#x2F;button&gt;</span><br><span class="line"> 3 &lt;script&gt;</span><br><span class="line"> 4  $(&#39;#d3&#39;).click(function () &#123;</span><br><span class="line"> 5         &#x2F;&#x2F; 1 需要先借助new方法生成一个内置对象</span><br><span class="line"> 6         var myFormData &#x3D; new FormData();</span><br><span class="line"> 7         &#x2F;&#x2F; 2 传普通键值对  当普通键值对较多的时候 我们可以利用for循环来添加</span><br><span class="line"> 8         myFormData.append(&#39;username&#39;,&#39;jason&#39;);</span><br><span class="line"> 9         myFormData.append(&#39;password&#39;,123);</span><br><span class="line">10         &#x2F;&#x2F; 3 传文件</span><br><span class="line">11         myFormData.append(&#39;myfile&#39;,$(&#39;#i1&#39;)[0].files[0]);  &#x2F;&#x2F; 获取input框内部用户上传的文件对象</span><br><span class="line">12         &#x2F;&#x2F; 发送ajax请求</span><br><span class="line">13         $.ajax(&#123;</span><br><span class="line">14             url:&#39;&#39;,</span><br><span class="line">15             type:&#39;post&#39;,</span><br><span class="line">16             data:myFormData,</span><br><span class="line">17             &#x2F;&#x2F; 发送formdata对象需要指定两个关键性的参数</span><br><span class="line">18 </span><br><span class="line">19             processData:false,  &#x2F;&#x2F; 让浏览器不要对你的数据进行任何的操作</span><br><span class="line">20             contentType:false,  &#x2F;&#x2F; 不要使用任何编码格式 对象formdata自带编码格式并且django能够识别该对象</span><br><span class="line">21 </span><br><span class="line">22             success:function (data) &#123;</span><br><span class="line">23                 alert(data)</span><br><span class="line">24             &#125;</span><br><span class="line">25         &#125;)</span><br><span class="line">26     &#125;)</span><br><span class="line">27 &lt;&#x2F;script&gt;</span><br><span class="line">28 def ab_ct(request):</span><br><span class="line">29     if request.method &#x3D;&#x3D; &#39;POST&#39;:</span><br><span class="line">30         print(request.POST)</span><br><span class="line">31         print(request.FILES)</span><br><span class="line">32     return render(request,&#39;ab_ct.html&#39;)</span><br></pre></td></tr></table></figure>



<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200112224836636-1700755797.png" alt="img"></p>
<h1 id="三-django内置序列化"><a href="#三-django内置序列化" class="headerlink" title="三.django内置序列化"></a>三.django内置序列化</h1><p>举例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> 1 def ab_se(request):</span><br><span class="line"> 2     # 拿到所有数据库的对象集</span><br><span class="line"> 3     user_queryset &#x3D; models.Userinfo.objects.all()</span><br><span class="line"> 4     user_list &#x3D; []</span><br><span class="line"> 5     for user_obj in user_queryset:</span><br><span class="line"> 6         user_list.append(&#123;</span><br><span class="line"> 7             &#39;username&#39;:user_obj.username,</span><br><span class="line"> 8             &#39;password&#39;:user_obj.password,</span><br><span class="line"> 9             &#39;gender&#39;:user_obj.get_gender_display(),</span><br><span class="line">10         &#125;)</span><br><span class="line">11      # 变成json格式</span><br><span class="line">12     res &#x3D; json.dumps(user_list)    </span><br><span class="line">13     return render(request,&#39;ab_se.html&#39;,locals())</span><br><span class="line">14</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">&#123;&#123; res &#125;&#125;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br></pre></td></tr></table></figure>

<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200112224918251-1672914133.png" alt="img"></p>
<p><strong>将数据库里面的数据通过json序列化 变成大字典的形式就是序列化</strong></p>
<p>通过 <a href="http://www.bejson.com/" target="_blank" rel="noopener">http://www.bejson.com/</a> 这个网站可以在线校验</p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200112224937996-2115546218.png" alt="img"></p>
<p>以上操作完全可以用Django的内置序列化模块 serializers处理，并且处理的更好</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1 from app01 import models</span><br><span class="line">2 from django.core import serializers</span><br><span class="line">3 def ab_se(request):</span><br><span class="line">4     user_queryset &#x3D; models.Userinfo.objects.all()</span><br><span class="line">5     # 传入需要修改的格式，以及需要序列化的对象集合</span><br><span class="line">6     res &#x3D; serializers.serialize(&#39;json&#39;,user_queryset) </span><br><span class="line">7     return HttpResponse(res)</span><br></pre></td></tr></table></figure>

<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200112225000406-492490093.png" alt="img"></p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200112225009636-276363465.png" alt="img"></p>
<h1 id="四：Django批量插入"><a href="#四：Django批量插入" class="headerlink" title="四：Django批量插入"></a>四：Django批量插入</h1><h2 id="1-普通批量插入"><a href="#1-普通批量插入" class="headerlink" title="1).普通批量插入"></a>1).普通批量插入</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> 1 def ab_bc(request):</span><br><span class="line"> 2     # 先插入1000条件数据</span><br><span class="line"> 3     for i in range(1,1001):</span><br><span class="line"> 4         models.Book.objects.create(title&#x3D;&#39;第%s本书&#39;%i)</span><br><span class="line"> 5     book_queryset &#x3D; models.Book.objects.all()</span><br><span class="line"> 6     return render(request,&#39;ab_bc.html&#39;,locals())</span><br><span class="line"> 7 &lt;&#x2F;head&gt;</span><br><span class="line"> 8 &lt;body&gt;</span><br><span class="line"> 9 &#123;% for book_obj in page_queryset %&#125;</span><br><span class="line">10     &lt;p&gt;&#123;&#123; book_obj.title &#125;&#125;&lt;&#x2F;p&gt;</span><br><span class="line">11 &#123;% endfor %&#125;</span><br><span class="line">12 &lt;&#x2F;body&gt;</span><br></pre></td></tr></table></figure>

<h2 id="2-快速批量插入"><a href="#2-快速批量插入" class="headerlink" title="2)快速批量插入"></a>2)快速批量插入</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> 1 def ab_bc(request):</span><br><span class="line"> 2     book_list &#x3D; []</span><br><span class="line"> 3     for i in range(1,10001):</span><br><span class="line"> 4         book_list.append(models.Book(title&#x3D;&#39;新的%s书&#39;%i))</span><br><span class="line"> 5     models.Book.objects.bulk_create(book_list)  # 批量插入数据的方式</span><br><span class="line"> 6     book_queryset &#x3D; models.Book.objects.all()</span><br><span class="line"> 7     return render(request,&#39;ab_bc.html&#39;,locals())</span><br><span class="line"> 8 &lt;&#x2F;head&gt;</span><br><span class="line"> 9 &lt;body&gt;</span><br><span class="line">10 &#123;% for book_obj in page_queryset %&#125;</span><br><span class="line">11     &lt;p&gt;&#123;&#123; book_obj.title &#125;&#125;&lt;&#x2F;p&gt;</span><br><span class="line">12 &#123;% endfor %&#125;</span><br><span class="line">13 &lt;&#x2F;body&gt;</span><br></pre></td></tr></table></figure>

<h1 id="五-自定义分页器"><a href="#五-自定义分页器" class="headerlink" title="五.自定义分页器"></a>五.自定义分页器</h1><p>分页器模板</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line">  1 class Pagination(object):</span><br><span class="line">  2     def __init__(self,current_page,all_count,per_page_num&#x3D;2,pager_count&#x3D;11):</span><br><span class="line">  3         &quot;&quot;&quot;</span><br><span class="line">  4         封装分页相关数据</span><br><span class="line">  5         :param current_page: 当前页</span><br><span class="line">  6         :param all_count:    数据库中的数据总条数</span><br><span class="line">  7         :param per_page_num: 每页显示的数据条数</span><br><span class="line">  8         :param pager_count:  最多显示的页码个数</span><br><span class="line">  9         </span><br><span class="line"> 10         用法:</span><br><span class="line"> 11         queryset &#x3D; model.objects.all()</span><br><span class="line"> 12         page_obj &#x3D; Pagination(current_page,all_count)</span><br><span class="line"> 13         page_data &#x3D; queryset[page_obj.start:page_obj.end]</span><br><span class="line"> 14         获取数据用page_data而不再使用原始的queryset</span><br><span class="line"> 15         获取前端分页样式用page_obj.page_html</span><br><span class="line"> 16         &quot;&quot;&quot;</span><br><span class="line"> 17         try:</span><br><span class="line"> 18             current_page &#x3D; int(current_page)</span><br><span class="line"> 19         except Exception as e:</span><br><span class="line"> 20             current_page &#x3D; 1</span><br><span class="line"> 21 </span><br><span class="line"> 22         if current_page &lt;1:</span><br><span class="line"> 23             current_page &#x3D; 1</span><br><span class="line"> 24 </span><br><span class="line"> 25         self.current_page &#x3D; current_page</span><br><span class="line"> 26 </span><br><span class="line"> 27         self.all_count &#x3D; all_count</span><br><span class="line"> 28         self.per_page_num &#x3D; per_page_num</span><br><span class="line"> 29 </span><br><span class="line"> 30 </span><br><span class="line"> 31         # 总页码</span><br><span class="line"> 32         all_pager, tmp &#x3D; divmod(all_count, per_page_num)</span><br><span class="line"> 33         if tmp:</span><br><span class="line"> 34             all_pager +&#x3D; 1</span><br><span class="line"> 35         self.all_pager &#x3D; all_pager</span><br><span class="line"> 36 </span><br><span class="line"> 37         self.pager_count &#x3D; pager_count</span><br><span class="line"> 38         self.pager_count_half &#x3D; int((pager_count - 1) &#x2F; 2)</span><br><span class="line"> 39 </span><br><span class="line"> 40     @property</span><br><span class="line"> 41     def start(self):</span><br><span class="line"> 42         return (self.current_page - 1) * self.per_page_num</span><br><span class="line"> 43 </span><br><span class="line"> 44     @property</span><br><span class="line"> 45     def end(self):</span><br><span class="line"> 46         return self.current_page * self.per_page_num</span><br><span class="line"> 47 </span><br><span class="line"> 48     def page_html(self):</span><br><span class="line"> 49         # 如果总页码 &lt; 11个：</span><br><span class="line"> 50         if self.all_pager &lt;&#x3D; self.pager_count:</span><br><span class="line"> 51             pager_start &#x3D; 1</span><br><span class="line"> 52             pager_end &#x3D; self.all_pager + 1</span><br><span class="line"> 53         # 总页码  &gt; 11</span><br><span class="line"> 54         else:</span><br><span class="line"> 55             # 当前页如果&lt;&#x3D;页面上最多显示11&#x2F;2个页码</span><br><span class="line"> 56             if self.current_page &lt;&#x3D; self.pager_count_half:</span><br><span class="line"> 57                 pager_start &#x3D; 1</span><br><span class="line"> 58                 pager_end &#x3D; self.pager_count + 1</span><br><span class="line"> 59 </span><br><span class="line"> 60             # 当前页大于5</span><br><span class="line"> 61             else:</span><br><span class="line"> 62                 # 页码翻到最后</span><br><span class="line"> 63                 if (self.current_page + self.pager_count_half) &gt; self.all_pager:</span><br><span class="line"> 64                     pager_end &#x3D; self.all_pager + 1</span><br><span class="line"> 65                     pager_start &#x3D; self.all_pager - self.pager_count + 1</span><br><span class="line"> 66                 else:</span><br><span class="line"> 67                     pager_start &#x3D; self.current_page - self.pager_count_half</span><br><span class="line"> 68                     pager_end &#x3D; self.current_page + self.pager_count_half + 1</span><br><span class="line"> 69 </span><br><span class="line"> 70         page_html_list &#x3D; []</span><br><span class="line"> 71         # 添加前面的nav和ul标签</span><br><span class="line"> 72         page_html_list.append(&#39;&#39;&#39;</span><br><span class="line"> 73                     &lt;nav aria-label&#x3D;&#39;Page navigation&gt;&#39;</span><br><span class="line"> 74                     &lt;ul class&#x3D;&#39;pagination&#39;&gt;</span><br><span class="line"> 75                 &#39;&#39;&#39;)</span><br><span class="line"> 76         first_page &#x3D; &#39;&lt;li&gt;&lt;a href&#x3D;&quot;?page&#x3D;%s&quot;&gt;首页&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;&#39; % (1)</span><br><span class="line"> 77         page_html_list.append(first_page)</span><br><span class="line"> 78 </span><br><span class="line"> 79         if self.current_page &lt;&#x3D; 1:</span><br><span class="line"> 80             prev_page &#x3D; &#39;&lt;li class&#x3D;&quot;disabled&quot;&gt;&lt;a href&#x3D;&quot;#&quot;&gt;上一页&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;&#39;</span><br><span class="line"> 81         else:</span><br><span class="line"> 82             prev_page &#x3D; &#39;&lt;li&gt;&lt;a href&#x3D;&quot;?page&#x3D;%s&quot;&gt;上一页&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;&#39; % (self.current_page - 1,)</span><br><span class="line"> 83 </span><br><span class="line"> 84         page_html_list.append(prev_page)</span><br><span class="line"> 85 </span><br><span class="line"> 86         for i in range(pager_start, pager_end):</span><br><span class="line"> 87             if i &#x3D;&#x3D; self.current_page:</span><br><span class="line"> 88                 temp &#x3D; &#39;&lt;li class&#x3D;&quot;active&quot;&gt;&lt;a href&#x3D;&quot;?page&#x3D;%s&quot;&gt;%s&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;&#39; % (i, i,)</span><br><span class="line"> 89             else:</span><br><span class="line"> 90                 temp &#x3D; &#39;&lt;li&gt;&lt;a href&#x3D;&quot;?page&#x3D;%s&quot;&gt;%s&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;&#39; % (i, i,)</span><br><span class="line"> 91             page_html_list.append(temp)</span><br><span class="line"> 92 </span><br><span class="line"> 93         if self.current_page &gt;&#x3D; self.all_pager:</span><br><span class="line"> 94             next_page &#x3D; &#39;&lt;li class&#x3D;&quot;disabled&quot;&gt;&lt;a href&#x3D;&quot;#&quot;&gt;下一页&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;&#39;</span><br><span class="line"> 95         else:</span><br><span class="line"> 96             next_page &#x3D; &#39;&lt;li&gt;&lt;a href&#x3D;&quot;?page&#x3D;%s&quot;&gt;下一页&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;&#39; % (self.current_page + 1,)</span><br><span class="line"> 97         page_html_list.append(next_page)</span><br><span class="line"> 98 </span><br><span class="line"> 99         last_page &#x3D; &#39;&lt;li&gt;&lt;a href&#x3D;&quot;?page&#x3D;%s&quot;&gt;尾页&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;&#39; % (self.all_pager,)</span><br><span class="line">100         page_html_list.append(last_page)</span><br><span class="line">101         # 尾部添加标签</span><br><span class="line">102         page_html_list.append(&#39;&#39;&#39;</span><br><span class="line">103                                            &lt;&#x2F;nav&gt;</span><br><span class="line">104                                            &lt;&#x2F;ul&gt;</span><br><span class="line">105                                        &#39;&#39;&#39;)</span><br><span class="line">106         return &#39;&#39;.join(page_html_list)</span><br></pre></td></tr></table></figure>

<p><strong>使用方式</strong></p>
<p>先在app01下面新建一个utils文件夹，并在其中建一个mypage.py文件，再将上面的模版复制进文件中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"> 1 from app01.utils.mypage import Pagination</span><br><span class="line"> 2 def ab_bc(request):</span><br><span class="line"> 3     # 先插入1000条件数据</span><br><span class="line"> 4     book_list &#x3D; []</span><br><span class="line"> 5     for i in range(1,10001):</span><br><span class="line"> 6         book_list.append(models.Book(title&#x3D;&#39;新的%s书&#39;%i))</span><br><span class="line"> 7     models.Book.objects.bulk_create(book_list)  # 批量插入数据的方式</span><br><span class="line"> 8     book_queryset &#x3D; models.Book.o   </span><br><span class="line"> 9     # 获取当前页</span><br><span class="line">10     current_page &#x3D; request.GET.get(&#39;page&#39;, 1)</span><br><span class="line">11     # 数据总条数</span><br><span class="line">12     all_count &#x3D; book_queryset.count()</span><br><span class="line">13     # 1 现生成一个自定义分页器类对象</span><br><span class="line">14     page_obj &#x3D; Pagination(current_page&#x3D;current_page,all_count&#x3D;all_count,pager_count&#x3D;9)</span><br><span class="line">15     # 2 针对真实的queryset数据进行切片操作</span><br><span class="line">16     page_queryset &#x3D; book_queryset[page_obj.start:page_obj.end]</span><br><span class="line">17     return render(request,&#39;ab_bc.html&#39;,locals())bjects.all()</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1 &lt;body&gt;</span><br><span class="line">2 &#123;% for book_obj in page_queryset %&#125;</span><br><span class="line">3     &lt;p&gt;&#123;&#123; book_obj.title &#125;&#125;&lt;&#x2F;p&gt;</span><br><span class="line">4 &#123;% endfor %&#125;</span><br><span class="line">5  &lt;!--渲染页面--&gt;</span><br><span class="line">6 &#123;&#123; page_obj.page_html|safe &#125;&#125;</span><br><span class="line">7 &lt;&#x2F;body&gt;</span><br><span class="line">8 &lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<h1 id="六-Ajax结合sweetalert实现二次删除"><a href="#六-Ajax结合sweetalert实现二次删除" class="headerlink" title="六.Ajax结合sweetalert实现二次删除"></a>六.Ajax结合sweetalert实现二次删除</h1><p>前期准备： <a href="https://github.com/lipis/bootstrap-sweetalert" target="_blank" rel="noopener">下载项目文件</a></p>
<p>建立一个satatic文件夹将此文件导入，在html文件中导入文件路径</p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200112225221952-1228871190.png" alt="img"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"> 1 # views.py</span><br><span class="line"> 2 </span><br><span class="line"> 3 from django.http import JsonResponse  # 可以实现返回一个字典</span><br><span class="line"> 4 import time</span><br><span class="line"> 5 def show_user(request):</span><br><span class="line"> 6     &quot;&quot;&quot;</span><br><span class="line"> 7     前后端如果是通过ajax进行交互 那么交互的媒介一般情况下都是一个字典</span><br><span class="line"> 8     :param request:</span><br><span class="line"> 9     :return:</span><br><span class="line">10     &quot;&quot;&quot;</span><br><span class="line">11     if request.method &#x3D;&#x3D; &#39;POST&#39;:</span><br><span class="line">12         time.sleep(3)</span><br><span class="line">13         </span><br><span class="line">14         back_dic &#x3D; &#123;&quot;code&quot;:1000,&#39;msg&#39;:&#39;&#39;&#125;</span><br><span class="line">15         </span><br><span class="line">16         delete_id &#x3D; request.POST.get(&#39;delete_id&#39;)</span><br><span class="line">17         </span><br><span class="line">18         models.Userinfo.objects.filter(pk&#x3D;delete_id).delete()</span><br><span class="line">19         </span><br><span class="line">20         back_dic[&#39;msg&#39;] &#x3D; &#39;删除成功，准备跑路！！！&#39;</span><br><span class="line">21         </span><br><span class="line">22         return JsonResponse(back_dic)</span><br><span class="line">23     user_queryset &#x3D; models.Userinfo.objects.all()</span><br><span class="line">24     return render(request,&#39;show_user.html&#39;,locals())</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"> 1 &lt;!DOCTYPE html&gt;</span><br><span class="line"> 2 &lt;html lang&#x3D;&quot;en&quot;&gt;</span><br><span class="line"> 3 &lt;head&gt;</span><br><span class="line"> 4     &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class="line"> 5     &lt;title&gt;Title&lt;&#x2F;title&gt;</span><br><span class="line"> 6     &lt;script src&#x3D;&quot;https:&#x2F;&#x2F;cdn.bootcss.com&#x2F;jquery&#x2F;3.4.1&#x2F;jquery.min.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line"> 7     &lt;link href&#x3D;&quot;https:&#x2F;&#x2F;cdn.bootcss.com&#x2F;twitter-bootstrap&#x2F;3.4.1&#x2F;css&#x2F;bootstrap.min.css&quot; rel&#x3D;&quot;stylesheet&quot;&gt;</span><br><span class="line"> 8     &lt;script src&#x3D;&quot;https:&#x2F;&#x2F;cdn.bootcss.com&#x2F;twitter-bootstrap&#x2F;3.4.1&#x2F;js&#x2F;bootstrap.min.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line"> 9     &#123;% load  static %&#125;</span><br><span class="line">10     &lt;link rel&#x3D;&quot;stylesheet&quot; href&#x3D;&quot;&#123;% static &#39;dist&#x2F;sweetalert.css&#39; %&#125;&quot;&gt;</span><br><span class="line">11     &lt;script src&#x3D;&quot;&#123;% static &#39;dist&#x2F;sweetalert.min.js&#39; %&#125;&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line">12     &lt;style&gt;</span><br><span class="line">13         div.sweet-alert h2 &#123;</span><br><span class="line">14             padding-top: 10px;</span><br><span class="line">15         &#125;</span><br><span class="line">16     &lt;&#x2F;style&gt;</span><br><span class="line">17 &lt;&#x2F;head&gt;</span><br><span class="line">18 &lt;body&gt;</span><br><span class="line">19 &lt;div class&#x3D;&quot;container&quot;&gt;</span><br><span class="line">20     &lt;div class&#x3D;&quot;row&quot;&gt;</span><br><span class="line">21         &lt;div class&#x3D;&quot;col-md-8 col-md-offset-2&quot;&gt;</span><br><span class="line">22             &lt;h2 class&#x3D;&quot;text-center&quot;&gt;数据展示&lt;&#x2F;h2&gt;</span><br><span class="line">23             &lt;table class&#x3D;&quot;table-hover table table-striped&quot;&gt;</span><br><span class="line">24                 &lt;thead&gt;</span><br><span class="line">25                 &lt;tr&gt;</span><br><span class="line">26                     &lt;th&gt;主键&lt;&#x2F;th&gt;</span><br><span class="line">27                     &lt;th&gt;用户名&lt;&#x2F;th&gt;</span><br><span class="line">28                     &lt;th&gt;密码&lt;&#x2F;th&gt;</span><br><span class="line">29                     &lt;th&gt;性别&lt;&#x2F;th&gt;</span><br><span class="line">30                     &lt;th&gt;操作&lt;&#x2F;th&gt;</span><br><span class="line">31                 &lt;&#x2F;tr&gt;</span><br><span class="line">32                 &lt;&#x2F;thead&gt;</span><br><span class="line">33                 &lt;tbody&gt;</span><br><span class="line">34                 &#123;% for user_obj in user_queryset %&#125;</span><br><span class="line">35                     &lt;tr&gt;</span><br><span class="line">36                         &lt;td&gt;&#123;&#123; user_obj.pk &#125;&#125;&lt;&#x2F;td&gt;</span><br><span class="line">37                         &lt;td&gt;&#123;&#123; user_obj.username &#125;&#125;&lt;&#x2F;td&gt;</span><br><span class="line">38                         &lt;td&gt;&#123;&#123; user_obj.password &#125;&#125;&lt;&#x2F;td&gt;</span><br><span class="line">39                         &lt;td&gt;&#123;&#123; user_obj.get_gender_display &#125;&#125;&lt;&#x2F;td&gt;</span><br><span class="line">40                         &lt;td&gt;</span><br><span class="line">41                             &lt;a href&#x3D;&quot;#&quot; class&#x3D;&quot;btn btn-primary btn-xs&quot;&gt;编辑&lt;&#x2F;a&gt;</span><br><span class="line">42                             &lt;a href&#x3D;&quot;#&quot; class&#x3D;&quot;btn btn-danger btn-xs cancel&quot; data_id&#x3D;&quot;&#123;&#123; user_obj.pk &#125;&#125;&quot;&gt;删除&lt;&#x2F;a&gt;</span><br><span class="line">43                         &lt;&#x2F;td&gt;</span><br><span class="line">44                     &lt;&#x2F;tr&gt;</span><br><span class="line">45                 &#123;% endfor %&#125;</span><br><span class="line">46                 &lt;&#x2F;tbody&gt;</span><br><span class="line">47 </span><br><span class="line">48             &lt;&#x2F;table&gt;</span><br><span class="line">49         &lt;&#x2F;div&gt;</span><br><span class="line">50     &lt;&#x2F;div&gt;</span><br><span class="line">51 &lt;&#x2F;div&gt;</span><br><span class="line">52 </span><br><span class="line">53 </span><br><span class="line">54 &lt;script&gt;</span><br><span class="line">55     $(&#39;.cancel&#39;).click(function () &#123;</span><br><span class="line">56         var $aEle &#x3D; $(this);</span><br><span class="line">57         swal(&#123;</span><br><span class="line">58                 title: &quot;你确定要删吗?&quot;,</span><br><span class="line">59                 text: &quot;你如果删了，你可要准备跑路啊!&quot;,</span><br><span class="line">60                 type: &quot;warning&quot;,</span><br><span class="line">61                 showCancelButton: true,</span><br><span class="line">62                 confirmButtonClass: &quot;btn-danger&quot;,</span><br><span class="line">63                 confirmButtonText: &quot;是的,老子就要删!&quot;,</span><br><span class="line">64                 cancelButtonText: &quot;惹不起惹不起!&quot;,</span><br><span class="line">65                 closeOnConfirm: false,</span><br><span class="line">66                 closeOnCancel: false,</span><br><span class="line">67                 showLoaderOnConfirm: true</span><br><span class="line">68             &#125;,</span><br><span class="line">69             function (isConfirm) &#123;</span><br><span class="line">70                 if (isConfirm) &#123;</span><br><span class="line">71                     &#x2F;&#x2F; 发送ajax请求</span><br><span class="line">72                     $.ajax(&#123;</span><br><span class="line">73                         url:&#39;&#39;,</span><br><span class="line">74                         type:&#39;post&#39;,</span><br><span class="line">75                         data:&#123;&#39;delete_id&#39;:$aEle.attr(&quot;data_id&quot;)&#125;,</span><br><span class="line">76                         success:function (data) &#123;  &#x2F;&#x2F; 回调函数会自动将二进制的json格式数据 解码并反序列成js中的数据类型</span><br><span class="line">77                             if (data.code &#x3D;&#x3D; 1000)&#123;</span><br><span class="line">78                                 swal(&quot;删了!&quot;, &quot;你准备跑路吧!&quot;, &quot;success&quot;);</span><br><span class="line">79                                 &#x2F;&#x2F; 方式1</span><br><span class="line">80                                 &#123;#window.location.reload()#&#125;</span><br><span class="line">81                                 &#x2F;&#x2F; 方式2 DOM操作动态修改</span><br><span class="line">82                                 $aEle.parent().parent().remove()  &#x2F;&#x2F; 将标签直接移除</span><br><span class="line">83                             &#125;else&#123;</span><br><span class="line">84                                 swal(&#39;发生了未知的错误&#39;, &quot;error&quot;);</span><br><span class="line">85                             &#125;</span><br><span class="line">86                         &#125;</span><br><span class="line">87                     &#125;);</span><br><span class="line">88 </span><br><span class="line">89                 &#125; else &#123;</span><br><span class="line">90                     swal(&quot;怂笔&quot;, &quot;你成功的刷新我对你的认知&quot;, &quot;error&quot;);</span><br><span class="line">91                 &#125;</span><br><span class="line">92             &#125;);</span><br><span class="line">93     &#125;)</span><br><span class="line">94 &lt;&#x2F;script&gt;</span><br><span class="line">95 &lt;&#x2F;body&gt;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/01/02/Django%E6%A1%86%E6%9E%B6%E4%B9%8BAjax/" data-id="ckd3ezcvk0000t4ut1msh641e" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Django/" rel="tag">Django</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Django框架模型层常用字段和事物操作" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/12/27/Django%E6%A1%86%E6%9E%B6%E6%A8%A1%E5%9E%8B%E5%B1%82%E5%B8%B8%E7%94%A8%E5%AD%97%E6%AE%B5%E5%92%8C%E4%BA%8B%E7%89%A9%E6%93%8D%E4%BD%9C/" class="article-date">
  <time datetime="2018-12-27T13:12:59.000Z" itemprop="datePublished">2018-12-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/12/27/Django%E6%A1%86%E6%9E%B6%E6%A8%A1%E5%9E%8B%E5%B1%82%E5%B8%B8%E7%94%A8%E5%AD%97%E6%AE%B5%E5%92%8C%E4%BA%8B%E7%89%A9%E6%93%8D%E4%BD%9C/">Django框架模型层常用字段和事物操作</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="一-models中常用的字段及参数"><a href="#一-models中常用的字段及参数" class="headerlink" title="一.models中常用的字段及参数"></a>一.models中常用的字段及参数</h1><h2 id="常用字段"><a href="#常用字段" class="headerlink" title="常用字段"></a>常用字段</h2><p><strong>AutoField</strong></p>
<p>int自增列，必须填入参数 primary_key=True。当model中如果没有自增列，则自动会创建一个列名为id的列。</p>
<p><strong>IntegerField</strong></p>
<p>一个整数类型,范围在 -2147483648 to 2147483647。(一般不用它来存手机号（自带正负号导致位数不够)，直接用字符串存，)</p>
<p><strong>CharField</strong></p>
<p>字符类型，必须提供max_length参数， max_length表示字符长度。</p>
<p>补充注意： 这里需要知道的是Django中的CharField对应的MySQL数据库中的varchar类型，没有设置对应char类型的字段，但是Django允许我们自定义新的字段</p>
<p>如何自定义char字段类型</p>
<ul>
<li>大胆推测，字段是不是类</li>
</ul>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200109212854513-1453222851.png" alt="img"></p>
<ul>
<li>自己根据源码写类似的Char字段</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> 1 # 在models.py文件下创建自己的Char字段</span><br><span class="line"> 2 # 导入模块</span><br><span class="line"> 3 from django.db.models import Field</span><br><span class="line"> 4 </span><br><span class="line"> 5 # 自定义继承field的Char类型字段</span><br><span class="line"> 6 class RealCharField(Fied)</span><br><span class="line"> 7     # 也需要长度设置</span><br><span class="line"> 8     def __init__(self, max_length, *args, **kwargs)</span><br><span class="line"> 9         self.max_length &#x3D; max_length</span><br><span class="line">10     # 拦截父类的方法，操作完之后利用super调用父类的方法，让其带着数据再回去</span><br><span class="line">11         super().__init__(max_length&#x3D;max_length,*args,**kwargs)</span><br><span class="line">12     def db_type(self, connection):</span><br><span class="line">13         return &#39;char(%s)&#39;%self.max_length</span><br><span class="line">14</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1 #上面已经写好了自定义Char字段</span><br><span class="line">2 </span><br><span class="line">3 # 在models.py中直接引用我们设置好的models就可以了</span><br><span class="line">4 class Movie(models.Model):</span><br><span class="line">5     testfield &#x3D; RealCharField(max_length&#x3D;32, null&#x3D;True)</span><br><span class="line">6 </span><br><span class="line">7 # 这样在通过数据库迁移命令就可以导入数据库了</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line">  1 AutoField(Field)</span><br><span class="line">  2         - int自增列，必须填入参数 primary_key&#x3D;True</span><br><span class="line">  3 </span><br><span class="line">  4     BigAutoField(AutoField)</span><br><span class="line">  5         - bigint自增列，必须填入参数 primary_key&#x3D;True(值超过十位数可以用的字段)</span><br><span class="line">  6 </span><br><span class="line">  7         注：当model中如果没有自增列，则自动会创建一个列名为id的列 </span><br><span class="line">  8         from django.db import models</span><br><span class="line">  9 </span><br><span class="line"> 10         class UserInfo(models.Model):</span><br><span class="line"> 11             # 自动创建一个列名为id的且为自增的整数列</span><br><span class="line"> 12             username &#x3D; models.CharField(max_length&#x3D;32)</span><br><span class="line"> 13 </span><br><span class="line"> 14         class Group(models.Model):</span><br><span class="line"> 15             # 自定义自增列</span><br><span class="line"> 16             nid &#x3D; models.AutoField(primary_key&#x3D;True)</span><br><span class="line"> 17             name &#x3D; models.CharField(max_length&#x3D;32)</span><br><span class="line"> 18 </span><br><span class="line"> 19     SmallIntegerField(IntegerField):</span><br><span class="line"> 20         - 小整数 -32768 ～ 32767</span><br><span class="line"> 21 </span><br><span class="line"> 22     PositiveSmallIntegerField(PositiveIntegerRelDbTypeMixin, IntegerField)</span><br><span class="line"> 23         - 正小整数(不带符号）) 0 ～ 32767</span><br><span class="line"> 24     IntegerField(Field)</span><br><span class="line"> 25         - 整数列(有符号的) -2147483648 ～ 2147483647</span><br><span class="line"> 26 </span><br><span class="line"> 27     PositiveIntegerField(PositiveIntegerRelDbTypeMixin, IntegerField)</span><br><span class="line"> 28         - 正整数 0 ～ 2147483647</span><br><span class="line"> 29 </span><br><span class="line"> 30     BigIntegerField(IntegerField):</span><br><span class="line"> 31         - 长整型(有符号的) -9223372036854775808 ～ 9223372036854775807</span><br><span class="line"> 32 </span><br><span class="line"> 33     BooleanField(Field)</span><br><span class="line"> 34         - 布尔值类型（给该字段传值，传True对应生成1，传False对应生成0）</span><br><span class="line"> 35 </span><br><span class="line"> 36     NullBooleanField(Field):</span><br><span class="line"> 37         - 可以为空的布尔值</span><br><span class="line"> 38 </span><br><span class="line"> 39     CharField(Field)</span><br><span class="line"> 40         - 字符类型</span><br><span class="line"> 41         - 必须提供max_length参数， max_length表示字符长度</span><br><span class="line"> 42 </span><br><span class="line"> 43     TextField(Field)</span><br><span class="line"> 44         - 文本类型（存储大段文本，图片等）</span><br><span class="line"> 45 </span><br><span class="line"> 46     EmailField(CharField)：</span><br><span class="line"> 47         - 字符串类型，Django Admin以及ModelForm中提供验证机制（用校验组件可以校验必须是邮箱格式）</span><br><span class="line"> 48 </span><br><span class="line"> 49     IPAddressField(Field)</span><br><span class="line"> 50         - 字符串类型，Django Admin以及ModelForm中提供验证 IPV4 机制</span><br><span class="line"> 51 </span><br><span class="line"> 52     GenericIPAddressField(Field)</span><br><span class="line"> 53         - 字符串类型，Django Admin以及ModelForm中提供验证 Ipv4和Ipv6</span><br><span class="line"> 54         - 参数：</span><br><span class="line"> 55             protocol，用于指定Ipv4或Ipv6， &#39;both&#39;,&quot;ipv4&quot;,&quot;ipv6&quot;</span><br><span class="line"> 56             unpack_ipv4， 如果指定为True，则输入::ffff:192.0.2.1时候，可解析为192.0.2.1，开启此功能，需要protocol&#x3D;&quot;both&quot;</span><br><span class="line"> 57 </span><br><span class="line"> 58     URLField(CharField)</span><br><span class="line"> 59         - 字符串类型，Django Admin以及ModelForm中提供验证 URL</span><br><span class="line"> 60 </span><br><span class="line"> 61     SlugField(CharField)</span><br><span class="line"> 62         - 字符串类型，Django Admin以及ModelForm中提供验证支持 字母、数字、下划线、连接符（减号）</span><br><span class="line"> 63 </span><br><span class="line"> 64     CommaSeparatedIntegerField(CharField)</span><br><span class="line"> 65         - 字符串类型，格式必须为逗号分割的数字</span><br><span class="line"> 66 </span><br><span class="line"> 67     UUIDField(Field)</span><br><span class="line"> 68         - 字符串类型，Django Admin以及ModelForm中提供对UUID格式的验证</span><br><span class="line"> 69 </span><br><span class="line"> 70     FilePathField(Field)</span><br><span class="line"> 71         - 字符串，Django Admin以及ModelForm中提供读取文件夹下文件的功能</span><br><span class="line"> 72         - 参数：</span><br><span class="line"> 73                 path,                      文件夹路径</span><br><span class="line"> 74                 match&#x3D;None,                正则匹配</span><br><span class="line"> 75                 recursive&#x3D;False,           递归下面的文件夹</span><br><span class="line"> 76                 allow_files&#x3D;True,          允许文件</span><br><span class="line"> 77                 allo w_folders&#x3D;False,       允许文件夹</span><br><span class="line"> 78 </span><br><span class="line"> 79     FileField(Field)</span><br><span class="line"> 80         - 字符串，路径保存在数据库，文件上传到指定目录</span><br><span class="line"> 81         - 参数：</span><br><span class="line"> 82             upload_to &#x3D; &quot;指定文件路径&quot;      上传文件的保存路径（通过这个参数可以直接自动将数据保存到指定路径）</span><br><span class="line"> 83             storage &#x3D; None      存储组件，默认django.core.files.storage.FileSystemStorage</span><br><span class="line"> 84 </span><br><span class="line"> 85     ImageField(FileField)</span><br><span class="line"> 86         - 字符串，路径保存在数据库，文件上传到指定目录</span><br><span class="line"> 87         - 参数：</span><br><span class="line"> 88             upload_to &#x3D; &quot;&quot;      上传文件的保存路径</span><br><span class="line"> 89             storage &#x3D; None      存储组件，默认django.core.files.storage.FileSystemStorage</span><br><span class="line"> 90             width_field&#x3D;None,   上传图片的高度保存的数据库字段名（字符串）</span><br><span class="line"> 91             height_field&#x3D;None   上传图片的宽度保存的数据库字段名（字符串）</span><br><span class="line"> 92 </span><br><span class="line"> 93     DateTimeField(DateField)</span><br><span class="line"> 94         - 日期+时间格式 YYYY-MM-DD HH:MM[:ss[.uuuuuu]][TZ]</span><br><span class="line"> 95 </span><br><span class="line"> 96     DateField(DateTimeCheckMixin, Field)</span><br><span class="line"> 97         - 日期格式      YYYY-MM-DD</span><br><span class="line"> 98 </span><br><span class="line"> 99     TimeField(DateTimeCheckMixin, Field)</span><br><span class="line">100         - 时间格式      HH:MM[:ss[.uuuuuu]]</span><br><span class="line">101 </span><br><span class="line">102     DurationField(Field)</span><br><span class="line">103         - 长整数，时间间隔，数据库中按照bigint存储，ORM中获取的值为datetime.timedelta类型</span><br><span class="line">104 </span><br><span class="line">105     FloatField(Field)</span><br><span class="line">106         - 浮点型</span><br><span class="line">107 </span><br><span class="line">108     DecimalField(Field)</span><br><span class="line">109         - 10进制小数</span><br><span class="line">110         - 参数：</span><br><span class="line">111             max_digits，小数总长度</span><br><span class="line">112             decimal_places，小数位长度</span><br><span class="line">113 </span><br><span class="line">114     BinaryField(Field)</span><br><span class="line">115         - 二进制类型</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"> 1 ORM字段与mysql字段的对应关系 </span><br><span class="line"> 2 </span><br><span class="line"> 3 对应关系：</span><br><span class="line"> 4     &#39;AutoField&#39;: &#39;integer AUTO_INCREMENT&#39;,</span><br><span class="line"> 5     &#39;BigAutoField&#39;: &#39;bigint AUTO_INCREMENT&#39;,</span><br><span class="line"> 6     &#39;BinaryField&#39;: &#39;longblob&#39;,</span><br><span class="line"> 7     &#39;BooleanField&#39;: &#39;bool&#39;,</span><br><span class="line"> 8     &#39;CharField&#39;: &#39;varchar(%(max_length)s)&#39;,</span><br><span class="line"> 9     &#39;CommaSeparatedIntegerField&#39;: &#39;varchar(%(max_length)s)&#39;,</span><br><span class="line">10     &#39;DateField&#39;: &#39;date&#39;,</span><br><span class="line">11     &#39;DateTimeField&#39;: &#39;datetime&#39;,</span><br><span class="line">12     &#39;DecimalField&#39;: &#39;numeric(%(max_digits)s, %(decimal_places)s)&#39;,</span><br><span class="line">13     &#39;DurationField&#39;: &#39;bigint&#39;,</span><br><span class="line">14     &#39;FileField&#39;: &#39;varchar(%(max_length)s)&#39;,</span><br><span class="line">15     &#39;FilePathField&#39;: &#39;varchar(%(max_length)s)&#39;,</span><br><span class="line">16     &#39;FloatField&#39;: &#39;double precision&#39;,</span><br><span class="line">17     &#39;IntegerField&#39;: &#39;integer&#39;,</span><br><span class="line">18     &#39;BigIntegerField&#39;: &#39;bigint&#39;,</span><br><span class="line">19     &#39;IPAddressField&#39;: &#39;char(15)&#39;,</span><br><span class="line">20     &#39;GenericIPAddressField&#39;: &#39;char(39)&#39;,</span><br><span class="line">21     &#39;NullBooleanField&#39;: &#39;bool&#39;,</span><br><span class="line">22     &#39;OneToOneField&#39;: &#39;integer&#39;,</span><br><span class="line">23     &#39;PositiveIntegerField&#39;: &#39;integer UNSIGNED&#39;,</span><br><span class="line">24     &#39;PositiveSmallIntegerField&#39;: &#39;smallint UNSIGNED&#39;,</span><br><span class="line">25     &#39;SlugField&#39;: &#39;varchar(%(max_length)s)&#39;,</span><br><span class="line">26     &#39;SmallIntegerField&#39;: &#39;smallint&#39;,</span><br><span class="line">27     &#39;TextField&#39;: &#39;longtext&#39;,</span><br><span class="line">28     &#39;TimeField&#39;: &#39;time&#39;,</span><br><span class="line">29     &#39;UUIDField&#39;: &#39;char(32)&#39;,</span><br></pre></td></tr></table></figure>

<h2 id="字段参数"><a href="#字段参数" class="headerlink" title="字段参数"></a>字段参数</h2><p><strong>null</strong></p>
<p>用于表示某个字段可以为空。</p>
<p><strong>unique</strong></p>
<p>如果设置为unique=True 则该字段在此表中必须是唯一的 。</p>
<p><strong>db_index</strong></p>
<p>如果db_index=True 则代表着为此字段设置索引。</p>
<p><strong>default</strong></p>
<p>为该字段设置默认值。</p>
<p><strong>DateField和DateTimeField</strong></p>
<p>两个参数</p>
<p><strong>auto_now_add</strong></p>
<p>配置auto_now_add=True，创建数据记录的时候会把当前时间添加到数据库。</p>
<p><strong>auto_now</strong></p>
<p>配置上auto_now=True，每次更新数据记录的时候会更新该字段。</p>
<h2 id="关系字段"><a href="#关系字段" class="headerlink" title="关系字段"></a>关系字段</h2><p><strong>ForeignKey</strong></p>
<p>外键类型在ORM中用来表示外键关联关系，一般把ForeignKey字段设置在 ‘一对多’中’多’的一方。</p>
<p>ForeignKey可以和其他表做关联关系同时也可以和自身做关联关系。</p>
<h2 id="字段参数-1"><a href="#字段参数-1" class="headerlink" title="字段参数"></a>字段参数</h2><p><strong>to</strong></p>
<p>设置要关联的表</p>
<p><strong>to_field</strong></p>
<p>设置要关联的表的字段</p>
<p><strong>on_delete</strong></p>
<p>当删除关联表中的数据时，当前表与其关联的行的行为。</p>
<p><strong>models.CASCADE</strong></p>
<p>删除关联数据，与之关联也删除（jdango1.x版本默认级联跟新级联删除）</p>
<p><strong>db_constraint</strong></p>
<p>是否在数据库中创建外键约束，默认为True。</p>
<p><strong>models.DO_NOTHING</strong> 删除关联数据，引发错误IntegrityError</p>
<p><strong>models.PROTECT</strong> 删除关联数据，引发错误ProtectedError</p>
<p><strong>models.SET_NULL</strong> 删除关联数据，与之关联的值设置为null（前提FK字段需要设置为可空）</p>
<p><strong>models.SET_DEFAULT</strong> 删除关联数据，与之关联的值设置为默认值（前提FK字段需要设置默认值）</p>
<p><strong>models.SET</strong></p>
<p>删除关联数据， a. 与之关联的值设置为指定值，设置：models.SET(值) b. 与之关联的值设置为可执行对象的返回值，设置：models.SET(可执行对象)</p>
<p><strong>OneToOneField</strong></p>
<p>一对一字段。</p>
<p>通常一对一字段用来扩展已有字段。(通俗的说就是一个人的所有信息不是放在一张表里面的，简单的信息一张表，隐私的信息另一张表，之间通过一对一外键关联)</p>
<p><strong>字段参数</strong></p>
<p><strong>to</strong></p>
<p>设置要关联的表。</p>
<p><strong>to_field</strong></p>
<p>设置要关联的字段。</p>
<p><strong>on_delete</strong></p>
<p>当删除关联表中的数据时，当前表与其关联的行的行为。(参考上面的例子)</p>
<h1 id="二-choices参数"><a href="#二-choices参数" class="headerlink" title="二.choices参数"></a>二.choices参数</h1><p>当数据能够被完全列举（例如用户的性别，学历，婚否，在职状态，客户来源等），你就可以考虑使用choices参数</p>
<p>通过choices参数我们可以解决一个问题：将能够列举的数据存入数据库时只存入对应数据的数字，取出来的时候会将此数字对应的数据展示给用户</p>
<p>下面是具体操作示范</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">class Userinfo(models.Model):</span><br><span class="line">    name &#x3D; models.CharField(max_length&#x3D;32)</span><br><span class="line">    # 将gender字段提前列举并通过choices参数传给下面的gender</span><br><span class="line">    gender_choices &#x3D; (</span><br><span class="line">        (1,&#39;男&#39;),</span><br><span class="line">        (2, &#39;女&#39;),</span><br><span class="line">        (3, &#39;其他&#39;),</span><br><span class="line">    )</span><br><span class="line">    gender &#x3D; models.IntegerField(choices&#x3D;gender_choices)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1 # 此时gender以数字的形式 </span><br><span class="line">2     models.Userinfo.objects.create(name&#x3D;&#39;jason&#39;,gender&#x3D;1)</span><br><span class="line">3     models.Userinfo.objects.create(name&#x3D;&#39;tank&#39;,gender&#x3D;2)</span><br><span class="line">4     models.Userinfo.objects.create(name&#x3D;&#39;egon&#39;,gender&#x3D;3)</span><br><span class="line">5     models.Userinfo.objects.create(name&#x3D;&#39;sean&#39;,gender&#x3D;10)</span><br><span class="line">6  # 可以存入没有对应关系的数字，但是取的时候由于没有对应关系取出来的还是数字</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> 1 # 取出数据</span><br><span class="line"> 2 user_obj &#x3D; models.Userinfo.objects.get(pk&#x3D;1)</span><br><span class="line"> 3     print(user_obj.name)</span><br><span class="line"> 4     print(user_obj.gender)</span><br><span class="line"> 5     # 输出结果</span><br><span class="line"> 6     # jason</span><br><span class="line"> 7     # 1</span><br><span class="line"> 8     # 取出的时候要以get_字段名_display()的方式</span><br><span class="line"> 9     print(user_obj.get_gender_display())</span><br><span class="line">10     # 男</span><br><span class="line">11 </span><br><span class="line">12     user_obj1 &#x3D; models.Userinfo.objects.get(pk&#x3D;4)</span><br><span class="line">13     print(user_obj1.get_gender_display())</span><br><span class="line">14     # 10</span><br></pre></td></tr></table></figure>

<h1 id="三-数据库查询优化"><a href="#三-数据库查询优化" class="headerlink" title="三.数据库查询优化"></a>三.数据库查询优化</h1><h2 id="1）惰性查询"><a href="#1）惰性查询" class="headerlink" title="1）惰性查询"></a>1）惰性查询</h2><p>当你只是去命令查询操作数据库而不需要用这个数据的时候，django就不会去查询以增加效率，除非你要打印或者使用，才会帮你去调用</p>
<h2 id="2）only与defer"><a href="#2）only与defer" class="headerlink" title="2）only与defer"></a>2）only与defer</h2><ul>
<li><strong>only作用</strong></li>
</ul>
<p>括号内传字段 得到的结果是一个列表套数据对象 该对象内只含有括号内指定的字段属性<br>对象点该字段属性是不会走数据库的 但是你一旦点了非括号内的字段 也能够拿到数据，但是是重新走的数据库查询</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1  res &#x3D; models.Book.objects.only(&#39;title&#39;)  # 這些對象内部只有title屬性</span><br><span class="line">2     # print(res)</span><br><span class="line">3     for r in res:</span><br><span class="line">4         # print(r.title)</span><br><span class="line">5         print(r.price)</span><br><span class="line">6         # 此时需要重新走数据库查询</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>defer作用</strong></li>
</ul>
<p>defer与only相反<br>括号内传字段 得到的结果是一个列表套数据对象 该对象内没有括号内指定的字段属性<br>对象点该字段属性会重复走数据库 但是你一旦点了非括号内的字段 就不走数据库了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1  res &#x3D; models.Book.objects.defer(&#39;title&#39;)  # defer与only互为反关系</span><br><span class="line">2     for r in res:</span><br><span class="line">3         print(r.title)</span><br><span class="line">4         # 此时查title需要重新做数据库</span><br></pre></td></tr></table></figure>

<h2 id="3）selected-related与prefetch-related"><a href="#3）selected-related与prefetch-related" class="headerlink" title="3）selected_related与prefetch_related"></a>3）selected_related与prefetch_related</h2><ul>
<li>selectd_relted作用</li>
</ul>
<p>内部是连表操作 现将关系表全部链接起来 之后再一次性查询出来 封装到对象中<br>数据对象之后在获取任意表中的数据的时候都不需要再走数据库了 因为全部封装成了对象的属性</p>
<p>select_related括号内只能传外键字段 并且不能是多对多字段 只能是一对多和一对一，但是可以多个字段一起查<br>select_related(外键字段1__外键字段2__外键字段3…)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1 res &#x3D; models.Book.objects.select_related(&#39;authors&#39;)</span><br><span class="line">2 for r in res:</span><br><span class="line">3     print(r.publish.name)</span><br><span class="line">4     print(r.publish.addr)</span><br></pre></td></tr></table></figure>

<ul>
<li>prefetch_related作用：</li>
</ul>
<p>prefetch_related内部是子查询 但是给你的感觉是连表操作<br>内部通过子查询将外键管理表中的数据页全部给你封装到对象中<br>之后对象点当前表或者外键关联表中的字段也都不需要走数据库了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1 res &#x3D; models.Book.objects.prefetch_related(&#39;publish&#39;)</span><br><span class="line">2     # print(res)</span><br><span class="line">3 </span><br><span class="line">4 for r in res:</span><br><span class="line">5     print(r.publish.name)</span><br></pre></td></tr></table></figure>

<p>优缺点比较：各有优劣，具体情况具体分析</p>
<ul>
<li><p>select_related连表操作 好处在于只走一次sql查询</p>
<p>耗时耗在 连接表的操作 ,表的数据越大连接时间越长</p>
</li>
<li><p>prefetch_related子查询操作给人的感觉很像联表查询，他走数据库的查询次数取决于你要查询的数据多少，耗时耗在查询次数</p>
</li>
</ul>
<h1 id="四-事物操作"><a href="#四-事物操作" class="headerlink" title="四.事物操作"></a>四.事物操作</h1><p>django orm开启事务操作</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">from django.db import transaction</span><br><span class="line">with transaction.atomic():    </span><br><span class="line"># 在with代码块中执行的orm语句同属于一个事务    </span><br><span class="line">    pass</span><br><span class="line"># 代码块运行结束 事务就结束了，可以直接在下面写其他代码了</span><br></pre></td></tr></table></figure>

<h1 id="五-MTV与MVC模型框架"><a href="#五-MTV与MVC模型框架" class="headerlink" title="五.MTV与MVC模型框架"></a>五.MTV与MVC模型框架</h1><p>MTV模型：Django是MTV框架</p>
<p>M:models T:templates V:views</p>
<p>MVC M:models V:views C:controller # 控制器(路由分发 urls.py)</p>
<p>本质:MTV本质也是MVC</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/12/27/Django%E6%A1%86%E6%9E%B6%E6%A8%A1%E5%9E%8B%E5%B1%82%E5%B8%B8%E7%94%A8%E5%AD%97%E6%AE%B5%E5%92%8C%E4%BA%8B%E7%89%A9%E6%93%8D%E4%BD%9C/" data-id="ckd3ezcwe0004t4utc8yl7bq0" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Django框架模型层和ORM" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/12/19/Django%E6%A1%86%E6%9E%B6%E6%A8%A1%E5%9E%8B%E5%B1%82%E5%92%8CORM/" class="article-date">
  <time datetime="2018-12-19T12:02:38.000Z" itemprop="datePublished">2018-12-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/12/19/Django%E6%A1%86%E6%9E%B6%E6%A8%A1%E5%9E%8B%E5%B1%82%E5%92%8CORM/">Django框架模型层和ORM</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="模型层以及orm查询"><a href="#模型层以及orm查询" class="headerlink" title="模型层以及orm查询"></a>模型层以及orm查询</h1><h2 id="一-单表查询"><a href="#一-单表查询" class="headerlink" title="一.单表查询"></a>一.单表查询</h2><h3 id="1）前期准备工作"><a href="#1）前期准备工作" class="headerlink" title="1）前期准备工作"></a>1）前期准备工作</h3><p>新建一个数据库（用navicate就行）<br><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200109013101922-919973169.png" alt="img"></p>
<ul>
<li>修改settings配置</li>
</ul>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200109013313971-115501094.png" alt="img"></p>
<ul>
<li>添加代码</li>
</ul>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200109013326554-1818424613.png" alt="img"></p>
<ul>
<li>开始在models.py文件中创建表类</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1 class Movie(models.Model):</span><br><span class="line">2     title &#x3D; models.CharField(max_length&#x3D;32)</span><br><span class="line">3     price &#x3D; models.DecimalField(max_digits&#x3D;8, decimal_places&#x3D;2)</span><br><span class="line">4     publish_time &#x3D; models.DateField()   # 表示添加的时间是年月日</span><br><span class="line">5     &#39;&#39;&#39;</span><br><span class="line">6     补充：DateField中有两个参数，一个是auto_now:表示每一次修改数据都会将时间保存跟新，</span><br><span class="line">7     另一个是auto_now_add,表示只添加开始创建的时间，后面不会改变</span><br><span class="line">8     &#39;&#39;&#39;</span><br><span class="line">9     # publish_time &#x3D; models.DateTimeField() 表示添加的时间是年月日时分秒（带有time）</span><br></pre></td></tr></table></figure>

<ul>
<li>通过python mange.py makemigrations和python mange.py migration执行数据库迁移命令</li>
</ul>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200109013420173-1949453893.png" alt="img"></p>
<ul>
<li>设置如何在Django中单独测试某一个py文件</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"> 1 # 将manage.py文件中的前四行代码（添加环境变量用的）拷贝到test.py(任意一个test.py文件都可以），然后再在test.py文件中写上下面两句代码即可</span><br><span class="line"> 2 import django、</span><br><span class="line"> 3 django.setup()</span><br><span class="line"> 4 </span><br><span class="line"> 5 from app01 import models</span><br><span class="line"> 6 models.Movie.objects.all</span><br><span class="line"> 7 </span><br><span class="line"> 8 # 这样在test文件中直接运行py文件就可以执行并看到效果</span><br><span class="line"> 9 </span><br><span class="line">10 </span><br><span class="line">11 # 整体设置代码如下</span><br><span class="line">12 import os</span><br><span class="line">13 if __name__ &#x3D;&#x3D; &quot;__main__&quot;:   os.environ.setdefault(&quot;DJANGO_SETTINGS_MODULE&quot;, &quot;day53.settings&quot;)</span><br><span class="line">14     import django</span><br><span class="line">15     django.setup()</span><br><span class="line">16 </span><br><span class="line">17     from app01 import models</span><br><span class="line">18     models.Movie.objects.all()</span><br></pre></td></tr></table></figure>

<h3 id="2-单表查询必知必会16条"><a href="#2-单表查询必知必会16条" class="headerlink" title="2)单表查询必知必会16条"></a>2)单表查询必知必会16条</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">1.create()</span><br><span class="line">2.all()</span><br><span class="line">3.filter()</span><br><span class="line">4.update()</span><br><span class="line">5.delete()</span><br><span class="line">6.first()</span><br><span class="line">7.last()</span><br><span class="line">8.get()</span><br><span class="line">9.values()</span><br><span class="line">10.values_list()</span><br><span class="line">11.order_by()</span><br><span class="line">12.count()</span><br><span class="line">13.exclude()</span><br><span class="line">14.exists()</span><br><span class="line">15.reverse()</span><br><span class="line">16.distinct()</span><br></pre></td></tr></table></figure>

<h4 id="补充："><a href="#补充：" class="headerlink" title="补充："></a>补充：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"> 1 # 只要是queryset对象就可以无限制的调用queryset对象的方法</span><br><span class="line"> 2                 res &#x3D; models.User.objects.filter(**kwargs).filter().filter().update()&#x2F;delete()&#x2F;values()</span><br><span class="line"> 3 #只要是queryset对象就可以直接点query查看当前queryset对象内部的sql语句</span><br><span class="line"> 4                 queryset_obj.query</span><br><span class="line"> 5 #公告的方法 查看所有orm语句内部的sql语句</span><br><span class="line"> 6 #有一段固定的日志文件配置 拷贝到配置文件中即可</span><br><span class="line"> 7 LOGGING &#x3D; &#123;</span><br><span class="line"> 8     &#39;version&#39;: 1,</span><br><span class="line"> 9     &#39;disable_existing_loggers&#39;: False,</span><br><span class="line">10     &#39;handlers&#39;: &#123;</span><br><span class="line">11         &#39;console&#39;: &#123;</span><br><span class="line">12             &#39;level&#39;: &#39;DEBUG&#39;,</span><br><span class="line">13             &#39;class&#39;: &#39;logging.StreamHandler&#39;,</span><br><span class="line">14         &#125;,</span><br><span class="line">15     &#125;,</span><br><span class="line">16     &#39;loggers&#39;: &#123;</span><br><span class="line">17         &#39;django.db.backends&#39;: &#123;</span><br><span class="line">18             &#39;handlers&#39;: [&#39;console&#39;],</span><br><span class="line">19             &#39;propagate&#39;: True,</span><br><span class="line">20             &#39;level&#39;: &#39;DEBUG&#39;,</span><br><span class="line">21         &#125;,</span><br><span class="line">22     &#125;</span><br><span class="line">23 &#125;</span><br></pre></td></tr></table></figure>

<h4 id="1-create"><a href="#1-create" class="headerlink" title="1.create()"></a>1.create()</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> 1  # 1. create() :给数据库表添加内容，注意使用create是有返回值的，返回值就是当前被创建的数据的对象本身</span><br><span class="line"> 2     # 由于之前设置的时候没有给默认时间，这里可以手动填写时间</span><br><span class="line"> 3     models.Movie.objects.create(title&#x3D;&#39;西游记&#39;, price&#x3D;666.66, publish_time&#x3D;&#39;2018-1-1&#39;)</span><br><span class="line"> 4     res &#x3D; models.Movie.objects.create(title&#x3D;&#39;红楼梦&#39;, price&#x3D;555.55, publish_time&#x3D;&#39;2018-1-1&#39;)</span><br><span class="line"> 5     print(res)</span><br><span class="line"> 6     # 也可以进行修改让其自动添加时间（现在是为了方便）</span><br><span class="line"> 7     from datetime import date</span><br><span class="line"> 8     ctime &#x3D; date.today()</span><br><span class="line"> 9     models.Movie.objects.create(title&#x3D;&#39;水浒传&#39;, price&#x3D;888.88, publish_time&#x3D;ctime)</span><br><span class="line">10     models.Movie.objects.create(title&#x3D;&#39;三国演义&#39;, price&#x3D;999.99, publish_time&#x3D;ctime)</span><br><span class="line">11</span><br></pre></td></tr></table></figure>

<h4 id="2-all"><a href="#2-all" class="headerlink" title="2.all()"></a>2.all()</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1  # 2.all()查询数据库所有内容对象返回的是一个queryset</span><br><span class="line">2     # res &#x3D; models.Movie.objects.all()</span><br><span class="line">3     # print(res)</span><br></pre></td></tr></table></figure>

<h4 id="3-filter"><a href="#3-filter" class="headerlink" title="3.filter()"></a>3.filter()</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> 1 # 3.filter() 指定条件筛选，返回的是queryset对象 &lt;QuerySet [&lt;Movie: Movie object&gt;]&gt;,若不指定条件则查询所有</span><br><span class="line"> 2     res &#x3D; models.Movie.objects.filter(id&#x3D;1)</span><br><span class="line"> 3     print(res)</span><br><span class="line"> 4     # pk表示主键</span><br><span class="line"> 5     res &#x3D; models.Movie.objects.filter(pk&#x3D;1)</span><br><span class="line"> 6     print(res)</span><br><span class="line"> 7     # 括号内可以传多个条件，条件之间是and关系</span><br><span class="line"> 8     res &#x3D; models.Movie.objects.filter(pk&#x3D;1, title&#x3D;&#39;水浒传&#39;)</span><br><span class="line"> 9     print(res)</span><br><span class="line">10     # 只要是queryset对象  就可以通过 点query 的方式查看到获取到当前对象内部sql语句</span><br><span class="line">11     print(res.query)  # SELECT &#96;app01_movie&#96;.&#96;id&#96;, &#96;app01_movie&#96;.&#96;title&#96;, &#96;app01_movie&#96;.&#96;price&#96;, &#96;app01_movie&#96;.&#96;publish_time&#96; FROM &#96;app01_movie&#96; WHERE (&#96;app01_movie&#96;.&#96;id&#96; &#x3D; 1 AND &#96;app01_movie&#96;.&#96;title&#96; &#x3D; 水浒传)</span><br></pre></td></tr></table></figure>

<h4 id="4-get"><a href="#4-get" class="headerlink" title="4.get()"></a>4.get()</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1  # 4.get() 直接获取条件查询得到的数据的对象本身(和create创建时返回的是一样的）  不推荐使用  当查询条件不存在的时候直接报错</span><br><span class="line">2     res &#x3D; models.Movie.objects.get(pk&#x3D;1)</span><br><span class="line">3     print(res)</span><br><span class="line">4     res &#x3D; models.Movie.objects.get(pk&#x3D;5)</span><br><span class="line">5     print(res)  # 报错信息：app01.models.DoesNotExist: Movie matching query does not exist.</span><br><span class="line">6     res &#x3D; models.Movie.objects.filter(pk&#x3D;5)  # 而使用filter查询找不到会返回一个空列表</span><br><span class="line">7     print(res)</span><br></pre></td></tr></table></figure>

<h4 id="5-values"><a href="#5-values" class="headerlink" title="5.values()"></a>5.values()</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1 # 5.values()  查询指定字段下的所有值，可以多个字段一起查，结果是列表套字典的形式</span><br><span class="line">2     res &#x3D; models.Movie.objects.values(&#39;title&#39;, &#39;price&#39;)</span><br><span class="line">3     #查询结果：&lt;QuerySet [&#123;&#39;title&#39;: &#39;西游记&#39;, &#39;price&#39;: Decimal(&#39;666.66&#39;)&#125;, &#123;&#39;title&#39;: &#39;水浒传&#39;, &#39;price&#39;: Decimal(&#39;888.88&#39;)&#125;, &#123;&#39;title&#39;: &#39;三国演义&#39;, &#39;price&#39;: Decimal(&#39;999.99&#39;)&#125;, &#123;&#39;title&#39;: &#39;西游记&#39;, &#39;price&#39;: Decimal(&#39;666.66&#39;)&#125;]&gt;</span><br><span class="line">4     print(res)</span><br><span class="line">5     print(res.query)</span><br><span class="line">6     # SELECT &#96;app01_movie&#96;.&#96;title&#96;, &#96;app01_movie&#96;.&#96;price&#96; FROM &#96;app01_movie&#96;</span><br></pre></td></tr></table></figure>

<h4 id="6-values-list"><a href="#6-values-list" class="headerlink" title="6.values_list()"></a>6.values_list()</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1  # 6.values_list() 查询指定字段下的所有值，可以多个字段一起查，结果是列表套元组的形式</span><br><span class="line">2     res &#x3D; models.Movie.objects.values_list(&#39;title&#39;, &#39;price&#39;)</span><br><span class="line">3     # &lt; QuerySet[(&#39;西游记&#39;, Decimal(&#39;666.66&#39;)), (&#39;水浒传&#39;, Decimal(&#39;888.88&#39;)), (&#39;三国演义&#39;, Decimal(&#39;999.99&#39;)), (</span><br><span class="line">4     # &#39;红楼梦&#39;, Decimal(&#39;666.66&#39;))] &gt;</span><br><span class="line">5     print(res)</span><br></pre></td></tr></table></figure>

<h4 id="7-first"><a href="#7-first" class="headerlink" title="7.first()"></a>7.first()</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1     # # 7.first() 查询所得结果的第一个元素对象，若不给前置条件则默认获得全部数据的第一个数据对象</span><br><span class="line">2     res1 &#x3D; models.Movie.objects.filter() # &lt;QuerySet [&lt;Movie: Movie object&gt;, &lt;Movie: Movie object&gt;, &lt;Movie: Movie object&gt;, &lt;Movie: Movie object&gt;]&gt;</span><br><span class="line">3     res2 &#x3D; models.Movie.objects.filter().first() # Movie object</span><br><span class="line">4     res3 &#x3D; models.Movie.objects.first()</span><br><span class="line">5 </span><br><span class="line">6     print(res1)</span><br><span class="line">7     print(res2)</span><br><span class="line">8     print(res3)</span><br></pre></td></tr></table></figure>

<h4 id="8-last"><a href="#8-last" class="headerlink" title="8.last()"></a>8.last()</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1   # 8.last()  查询所得结果的最后一个元素对象，若不给前置条件则默认获得全部数据的最后一个数据对象</span><br><span class="line">2     res1 &#x3D; models.Movie.objects.filter().last()</span><br><span class="line">3     res &#x3D; models.Movie.objects.last()</span><br><span class="line">4     print(res1)</span><br><span class="line">5     print(res)</span><br></pre></td></tr></table></figure>

<h4 id="9-update"><a href="#9-update" class="headerlink" title="9.update()"></a>9.update()</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1     # 9.update()  表示跟新数据,获取指定数据对象后可以进行修改，但不能在未有此数据的情况下添加数据，并且也有返回值，返回值是被影响的行数</span><br><span class="line">2     res &#x3D; models.Movie.objects.filter(pk&#x3D;1).update(title&#x3D;&#39;聊斋志异&#39;)</span><br><span class="line">3     res2 &#x3D; models.Movie.objects.filter(pk&#x3D;5).update(title&#x3D;&#39;西游记&#39;, price&#x3D;777.77, publish_time&#x3D;&#39;2018-10-1&#39;)</span><br><span class="line">4     print(res)</span><br><span class="line">5     print(res2)</span><br></pre></td></tr></table></figure>

<h4 id="10-delete"><a href="#10-delete" class="headerlink" title="10.delete()"></a>10.delete()</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1     # 10.delete()  删除数据 返回结果(1, &#123;&#39;app01.Movie&#39;: 1&#125;)</span><br><span class="line">2     res &#x3D; models.Movie.objects.filter(pk &#x3D; 1).delete()</span><br><span class="line">3     # 不用主键为条件可以删除多个同一条件的元素 (3, &#123;&#39;app01.Movie&#39;: 3&#125;)</span><br><span class="line">4     res &#x3D; models.Movie.objects.filter(price &#x3D; 11).delete()</span><br><span class="line">5     print(res)</span><br></pre></td></tr></table></figure>

<h4 id="11-count"><a href="#11-count" class="headerlink" title="11.count()"></a>11.count()</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1  # 11.count()  统计数据条数，返回值是数据条数</span><br><span class="line">2         # 不给条件会查询所有数据条数，</span><br><span class="line">3         res &#x3D; models.Movie.objects.count()</span><br><span class="line">4         # 会通过条件来查询数据条数</span><br><span class="line">5         res2 &#x3D; models.Movie.objects.filter(price&#x3D;100).count()</span><br><span class="line">6         print(res)</span><br><span class="line">7         print(res2)</span><br></pre></td></tr></table></figure>

<h4 id="12-order-by"><a href="#12-order-by" class="headerlink" title="12.order_by"></a>12.order_by</h4><p>order_by</p>
<h4 id="13-exclude"><a href="#13-exclude" class="headerlink" title="13.exclude()"></a>13.exclude()</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1         # 13.exclude()  将指定筛选条件的数据对象排除之后获取剩下的所有数据对象</span><br><span class="line">2         # 返回结果是一个queryset，&lt;QuerySet [&lt;Movie: 三国演义&gt;, &lt;Movie: 红楼梦&gt;, &lt;Movie: sjal&gt;, &lt;Movie: nqks&gt;, &lt;Movie: skxsl&gt;]&gt;</span><br><span class="line">3         res &#x3D; models.Movie.objects.exclude(pk&#x3D;2)</span><br><span class="line">4         print(res)</span><br><span class="line">5         print(res.query)</span><br><span class="line">6         # SELECT &#96;app01_movie&#96;.&#96;id&#96;, &#96;app01_movie&#96;.&#96;title&#96;, &#96;app01_movie&#96;.&#96;price&#96;, &#96;app01_movie&#96;.&#96;publish_time&#96; FROM &#96;app01_movie&#96; WHERE NOT (&#96;app01_movie&#96;.&#96;id&#96; &#x3D; 2)</span><br></pre></td></tr></table></figure>

<h4 id="14-exists"><a href="#14-exists" class="headerlink" title="14.exists()"></a>14.exists()</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1     # 14.exists()   返回的是布尔值  判断指定筛选条件的数据是否存在</span><br><span class="line">2     res &#x3D; models.Movie.objects.filter(pk&#x3D;1000).exists()</span><br><span class="line">3     print(res)</span><br></pre></td></tr></table></figure>

<h4 id="15-reverse"><a href="#15-reverse" class="headerlink" title="15.reverse()"></a>15.reverse()</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">    # 15.reverse()  反转, 将升序改为降序，返回的结果是一个queryset对象</span><br><span class="line">    res &#x3D; models.Movie.objects.order_by(&#39;price&#39;).reverse()</span><br><span class="line">    print(res)</span><br><span class="line">    print(res.query)</span><br><span class="line"># SELECT &#96;app01_movie&#96;.&#96;id&#96;, &#96;app01_movie&#96;.&#96;title&#96;, &#96;app01_movie&#96;.&#96;price&#96;, &#96;app01_movie&#96;.&#96;publish_time&#96; FROM &#96;app01_movie&#96; ORDER BY &#96;app01_movie&#96;.&#96;price&#96; DESC</span><br></pre></td></tr></table></figure>

<h4 id="16-distinct"><a href="#16-distinct" class="headerlink" title="16.distinct()"></a>16.distinct()</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 16.distinct()  去重:把重复的数据去掉，去重的前提 必须是由完全一样的数据的才可以</span><br><span class="line">#返回的结果是一个queryset</span><br><span class="line">res &#x3D; models.Movie.objects.values(&#39;price&#39;).distinct()</span><br><span class="line">print(res)</span><br><span class="line">print(res.query)</span><br><span class="line"># SELECT DISTINCT &#96;app01_movie&#96;.&#96;price&#96; FROM &#96;app01_movie&#96;</span><br></pre></td></tr></table></figure>

<h3 id="3-神奇的双下划线查询"><a href="#3-神奇的双下划线查询" class="headerlink" title="3)神奇的双下划线查询"></a>3)神奇的双下划线查询</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"> 1     # 1.__gt:表是大于</span><br><span class="line"> 2     # 查询价格大于100的电影</span><br><span class="line"> 3     res &#x3D; models.Movie.objects.filter(price__gt&#x3D;100)</span><br><span class="line"> 4     # 返回的结果是一个queryset数据对象列表</span><br><span class="line"> 5     print(res)</span><br><span class="line"> 6     print(res.query)</span><br><span class="line"> 7     # # SELECT &#96;app01_movie&#96;.&#96;id&#96;, &#96;app01_movie&#96;.&#96;title&#96;, &#96;app01_movie&#96;.&#96;price&#96;, &#96;app01_movie&#96;.&#96;publish_time&#96; FROM &#96;app01_movie&#96; WHERE &#96;app01_movie&#96;.&#96;price&#96; &gt; 100</span><br><span class="line"> 8 </span><br><span class="line"> 9      # 2.__lt:表示小于</span><br><span class="line">10         # 查询价格小于200的电影</span><br><span class="line">11         res &#x3D; models.Movie.objects.filter(price__lt&#x3D;200)</span><br><span class="line">12         # 返回的结果是一个queryset数据对象列表</span><br><span class="line">13         print(res)</span><br><span class="line">14         print(res.query)</span><br><span class="line">15     # SELECT &#96;app01_movie&#96;.&#96;id&#96;, &#96;app01_movie&#96;.&#96;title&#96;, &#96;app01_movie&#96;.&#96;price&#96;, &#96;app01_movie&#96;.&#96;publish_time&#96; FROM &#96;app01_movie&#96; WHERE &#96;app01_movie&#96;.&#96;price&#96; &lt; 200</span><br><span class="line">16 </span><br><span class="line">17     # 3.__gte:表示大于等于</span><br><span class="line">18     # 查询价格大于等于888.88的电影</span><br><span class="line">19     res &#x3D; models.Movie.objects.filter(price__gte&#x3D;888.88)</span><br><span class="line">20     print(res)</span><br><span class="line">21     print(res.query)</span><br><span class="line">22     # SELECT &#96;app01_movie&#96;.&#96;id&#96;, &#96;app01_movie&#96;.&#96;title&#96;, &#96;app01_movie&#96;.&#96;price&#96;, &#96;app01_movie&#96;.&#96;publish_time&#96; FROM &#96;app01_movie&#96; WHERE &#96;app01_movie&#96;.&#96;price&#96; &gt;&#x3D; 88.8799999999999954525264911353588104248046875</span><br><span class="line">23     # 4.__lte:表示小于等于</span><br><span class="line">24     # 查询价格小于等于666.66的电影</span><br><span class="line">25     res &#x3D; models.Movie.objects.filter(price__lte&#x3D;666.66)</span><br><span class="line">26     print(res)</span><br><span class="line">27     print(res.query)</span><br><span class="line">28     # SELECT &#96;app01_movie&#96;.&#96;id&#96;, &#96;app01_movie&#96;.&#96;title&#96;, &#96;app01_movie&#96;.&#96;price&#96;, &#96;app01_movie&#96;.&#96;publish_time&#96; FROM &#96;app01_movie&#96; WHERE &#96;app01_movie&#96;.&#96;price&#96; &lt;&#x3D; 666.6599999999999681676854379475116729736328125</span><br><span class="line">29 </span><br><span class="line">30     # 5.__in:表示获取一个可迭代对象里面的数据</span><br><span class="line">31     #查询价格是666 或888 或999(注意：由于python解释器的精度问题，查询的时候可能会出现找不到数据的情况）</span><br><span class="line">32     res &#x3D; models.Movie.objects.filter(price__in&#x3D;[888.88, 666.66, 999.99])</span><br><span class="line">33     print(res)</span><br><span class="line">34     # # &lt;QuerySet []&gt;</span><br><span class="line">35     print(res.query)</span><br><span class="line">36     # # #SELECT &#96;app01_movie&#96;.&#96;id&#96;, &#96;app01_movie&#96;.&#96;title&#96;, &#96;app01_movie&#96;.&#96;price&#96;, &#96;app01_movie&#96;.&#96;publish_time&#96; FROM &#96;app01_movie&#96; WHERE &#96;app01_movie&#96;.&#96;price&#96; IN (888.8799999999999954525264911353588104248046875, 666.6599999999999681676854379475116729736328125, 999.990000000000009094947017729282379150390625)</span><br><span class="line">37     res1 &#x3D; models.Movie.objects.filter(price__in&#x3D;(888, 666, 999))</span><br><span class="line">38     # 元组字典都可以，都是返回一个queryset数据对象列表</span><br><span class="line">39     res2 &#x3D; models.Movie.objects.filter(price__in&#x3D;[888, 666, 999])</span><br><span class="line">40     print(res1)</span><br><span class="line">41     print(res2)</span><br><span class="line">42     # # &lt; QuerySet[ &lt; Movie: 水浒传 &gt;, &lt; Movie: 三国演义 &gt;, &lt; Movie: 红楼梦 &gt;] &gt;</span><br><span class="line">43     print(res1.query)</span><br><span class="line">44     # # SELECT &#96;app01_movie&#96;.&#96;id&#96;, &#96;app01_movie&#96;.&#96;title&#96;, &#96;app01_movie&#96;.&#96;price&#96;, &#96;app01_movie&#96;.&#96;publish_time&#96; FROM &#96;app01_movie&#96; WHERE &#96;app01_movie&#96;.&#96;price&#96; IN (888, 666, 999)</span><br><span class="line">45 </span><br><span class="line">46     # 6.__range:表示在一个可迭代对象里面循环遍历，顾头顾尾</span><br><span class="line">47     # 查询价格在200到900之间的电影</span><br><span class="line">48     res &#x3D; models.Movie.objects.filter(price__range&#x3D;(200,999))</span><br><span class="line">49     print(res)</span><br><span class="line">50     print(res.query)</span><br><span class="line">51     # &lt;QuerySet [&lt;Movie: 水浒传&gt;, &lt;Movie: 三国演义&gt;, &lt;Movie: 红楼梦&gt;]&gt;</span><br><span class="line">52     # SELECT &#96;app01_movie&#96;.&#96;id&#96;, &#96;app01_movie&#96;.&#96;title&#96;, &#96;app01_movie&#96;.&#96;price&#96;, &#96;app01_movie&#96;.&#96;publish_time&#96; FROM &#96;app01_movie&#96; WHERE &#96;app01_movie&#96;.&#96;price&#96; BETWEEN 200 AND 999</span><br><span class="line">53 </span><br><span class="line">54     # 7.__contains：模糊查询，有大小写区别</span><br><span class="line">55     #   __icontains:模糊查询，忽略大小写</span><br><span class="line">56 </span><br><span class="line">57     # 查询电影名中包含字母s的电影</span><br><span class="line">58     &#39;&#39;&#39;</span><br><span class="line">59     模糊查询：</span><br><span class="line">60         关键字 like</span><br><span class="line">61         关键符号：%  _</span><br><span class="line">62     &#39;&#39;&#39;</span><br><span class="line">63 res1 &#x3D; models.Movie.objects.filter(title__contains&#x3D;&#39;s&#39;) # 默认是区分大小写</span><br><span class="line">64 print(res1)</span><br><span class="line">65 print(res1.query)</span><br><span class="line">66 # &lt;QuerySet [&lt;Movie: sjal&gt;, &lt;Movie: nqks&gt;, &lt;Movie: skxsl&gt;]&gt;</span><br><span class="line">67 # SELECT &#96;app01_movie&#96;.&#96;id&#96;, &#96;app01_movie&#96;.&#96;title&#96;, &#96;app01_movie&#96;.&#96;price&#96;, &#96;app01_movie&#96;.&#96;publish_time&#96; FROM &#96;app01_movie&#96; WHERE &#96;app01_movie&#96;.&#96;title&#96; LIKE BINARY %s%</span><br><span class="line">68 </span><br><span class="line">69 res2 &#x3D; models.Movie.objects.filter(title__icontains&#x3D;&#39;s&#39;) # 默认是不区分大小的</span><br><span class="line">70 print(res2)</span><br><span class="line">71 print(res2.query)</span><br><span class="line">72 # &lt;QuerySet [&lt;Movie: sjal&gt;, &lt;Movie: nqks&gt;, &lt;Movie: skxsl&gt;, &lt;Movie: SNAJD&gt;, &lt;Movie: SNAKJK&gt;]&gt;</span><br><span class="line">73 # SELECT &#96;app01_movie&#96;.&#96;id&#96;, &#96;app01_movie&#96;.&#96;title&#96;, &#96;app01_movie&#96;.&#96;price&#96;, &#96;app01_movie&#96;.&#96;publish_time&#96; FROM &#96;app01_movie&#96; WHERE &#96;app01_movie&#96;.&#96;title&#96; LIKE %s%</span><br><span class="line">74 </span><br><span class="line">75 # 8.__year:指定年份查询</span><br><span class="line">76 #   __month:指定月份查询</span><br><span class="line">77 res &#x3D; models.Movie.objects.filter(publish_time__year&#x3D;2019)</span><br><span class="line">78 print(res)</span><br><span class="line">79 print(res.query)</span><br><span class="line">80 # &lt;QuerySet [&lt;Movie: sjal&gt;, &lt;Movie: nqks&gt;]&gt;</span><br><span class="line">81 # SELECT &#96;app01_movie&#96;.&#96;id&#96;, &#96;app01_movie&#96;.&#96;title&#96;, &#96;app01_movie&#96;.&#96;price&#96;, &#96;app01_movie&#96;.&#96;publish_time&#96; FROM &#96;app01_movie&#96; WHERE &#96;app01_movie&#96;.&#96;publish_time&#96; BETWEEN 2019-01-01 AND 2019-12-31</span><br><span class="line">82 </span><br><span class="line">83 res &#x3D; models.Movie.objects.filter(publish_time__month&#x3D;1)</span><br><span class="line">84 print(res)</span><br><span class="line">85 print(res.query)</span><br><span class="line">86 # &lt;QuerySet [&lt;Movie: 水浒传&gt;, &lt;Movie: 三国演义&gt;, &lt;Movie: 红楼梦&gt;]&gt;</span><br><span class="line">87 # SELECT &#96;app01_movie&#96;.&#96;id&#96;, &#96;app01_movie&#96;.&#96;title&#96;, &#96;app01_movie&#96;.&#96;price&#96;, &#96;app01_movie&#96;.&#96;publish_time&#96; FROM &#96;app01_movie&#96; WHERE EXTRACT(MONTH FROM &#96;app01_movie&#96;.&#96;publish_time&#96;) &#x3D; 1</span><br><span class="line">88 </span><br><span class="line">89 #</span><br></pre></td></tr></table></figure>

<h3 id="4）外键字段的增删改查"><a href="#4）外键字段的增删改查" class="headerlink" title="4）外键字段的增删改查"></a>4）外键字段的增删改查</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"> 1 # 外键字段的增删改查</span><br><span class="line"> 2 # 一对多  书籍对出版社</span><br><span class="line"> 3 # 1.增 create</span><br><span class="line"> 4 # 可以通过直接赋值的方式</span><br><span class="line"> 5 models.Book.objects.create(title&#x3D;&#39;三国演义&#39;, price&#x3D;123.12,publish_id&#x3D;2)</span><br><span class="line"> 6 # 或者通过数据对象(在models类中创建书籍对出版社时建立了一个publish外键字段，这个字段支持传对象给他）</span><br><span class="line"> 7 publish_obj &#x3D; models.Publish.objects.get(pk&#x3D;1)</span><br><span class="line"> 8 print(publish_obj)</span><br><span class="line"> 9 # # Publish object</span><br><span class="line">10 models.Book.objects.create(title&#x3D;&#39;水浒传&#39;, price&#x3D;134.12, publish&#x3D;publish_obj)</span><br><span class="line">11 </span><br><span class="line">12 #改 update</span><br><span class="line">13 models.Book.objects.filter(pk&#x3D;1).update(publish_id&#x3D;3)</span><br><span class="line">14 </span><br><span class="line">15 # 通过get直接拿到主键值为4的出版社数据对象</span><br><span class="line">16 publish_obj &#x3D; models.Publish.objects.get(pk&#x3D;4)</span><br><span class="line">17 # 将此对象传给Book里面主键为1的创建时用到的publish虚拟外键字段</span><br><span class="line">18 models.Book.objects.filter(pk&#x3D;1).update(publish&#x3D;publish_obj)</span><br><span class="line">19 </span><br><span class="line">20 # 删</span><br><span class="line">21 &#39;&#39;&#39;</span><br><span class="line">22   外键字段在1.X版本中默认就是级联更新级联删除的</span><br><span class="line">23 &#39;&#39;&#39;</span><br><span class="line">24 </span><br><span class="line">25 # 多对多</span><br><span class="line">26 # 1.给书籍作者绑定关系 add</span><br><span class="line">27 </span><br><span class="line">28 # 通过获取书籍对象来对跨表找到作者信息并人为添加一个主键信息</span><br><span class="line">29 book_obj &#x3D; models.Book.objects.filter(pk&#x3D;1).first()</span><br><span class="line">30 print(book_obj.authors)  # 打印结果app01.Author.None  书籍对象点虚拟字段authors就类似于已经跨到书籍和作者的第三张关系表中</span><br><span class="line">31 book_obj.authors.add(1)  #给书籍绑定一个主键为1的作者</span><br><span class="line">32 book_obj.authors.add(2,3)  # 也支持同时传多个参数</span><br><span class="line">33 </span><br><span class="line">34 </span><br><span class="line">35 # 通过方法获取某一条作者信息数据对象，通过add的方法将对象添加进去</span><br><span class="line">36 author_obj &#x3D; models.Author.objects.get(pk&#x3D;1)</span><br><span class="line">37 author_obj1 &#x3D; models.Author.objects.get(pk&#x3D;3)</span><br><span class="line">38 </span><br><span class="line">39 book_obj.authors.add(author_obj)</span><br><span class="line">40 book_obj.authors.add(author_obj1)</span><br><span class="line">41 &#39;&#39;&#39;</span><br><span class="line">42 总结</span><br><span class="line">43    add专门给第三张关系表添加数据</span><br><span class="line">44         括号内即可以传数字也可以传对象  并且都支持传多个</span><br><span class="line">45 &#39;&#39;&#39;</span><br><span class="line">46 # 2 移除书籍与作者的绑定关系  remove</span><br><span class="line">47 book_obj &#x3D; models.Book.objects.filter(pk&#x3D;1).first()</span><br><span class="line">48 book_obj.authors.remove(2)</span><br><span class="line">49 book_obj.authors.remove(1,3)</span><br><span class="line">50 author_obj &#x3D; models.Author.objects.get(pk&#x3D;2)</span><br><span class="line">51 author_obj1 &#x3D; models.Author.objects.get(pk&#x3D;3)</span><br><span class="line">52 book_obj.authors.remove(author_obj)</span><br><span class="line">53 book_obj.authors.remove(author_obj,author_obj1)</span><br><span class="line">54 &quot;&quot;&quot;</span><br><span class="line">55 remove专门给第三张关系表移除数据</span><br><span class="line">56     括号内即可以传数字也可以传对象  并且都支持传多个</span><br><span class="line">57 &quot;&quot;&quot;</span><br><span class="line">58 # 3 修改书籍与作者的关系   set</span><br><span class="line">59 book_obj &#x3D; models.Book.objects.filter(pk&#x3D;1).first()</span><br><span class="line">60 book_obj.authors.set((3,))</span><br><span class="line">61 book_obj.authors.set((2,3))</span><br><span class="line">62 author_obj &#x3D; models.Author.objects.get(pk&#x3D;2)</span><br><span class="line">63 author_obj1 &#x3D; models.Author.objects.get(pk&#x3D;3)</span><br><span class="line">64 book_obj.authors.set((author_obj,))</span><br><span class="line">65 book_obj.authors.set([author_obj,author_obj1])</span><br><span class="line">66 </span><br><span class="line">67 &quot;&quot;&quot;</span><br><span class="line">68 set 修改书籍与作者的关系</span><br><span class="line">69     括号内支持传数字和对象 但是需要是可迭代对象</span><br><span class="line">70 &quot;&quot;&quot;</span><br><span class="line">71 # 4 清空书籍与作者关系</span><br><span class="line">72 book_obj &#x3D; models.Book.objects.filter(pk&#x3D;1).first()</span><br><span class="line">73 book_obj.authors.clear()  # 去第三张表中清空书籍为1的所有数据</span><br><span class="line">74 &quot;&quot;&quot;</span><br><span class="line">75 clear()  清空关系</span><br><span class="line">76 不需要任何的参数</span><br><span class="line">77 &quot;&quot;&quot;</span><br></pre></td></tr></table></figure>

<h1 id="二-跨表查询"><a href="#二-跨表查询" class="headerlink" title="二.跨表查询"></a>二.跨表查询</h1><h3 id="1-跨表查询的方式"><a href="#1-跨表查询的方式" class="headerlink" title="1) 跨表查询的方式"></a>1) 跨表查询的方式</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">    1.子查询  将一张表的查询结果当做另外一张表的查询条件</span><br><span class="line">        正常解决问题的思路 分步操作</span><br><span class="line">    2.链表查询</span><br><span class="line">        inner join</span><br><span class="line">        left join</span><br><span class="line">        right join</span><br><span class="line">        union</span><br><span class="line">建议:在写sql语句或者orm语句的时候 千万不要想着一次性将语句写完 一定要写一点查一点再写一点</span><br></pre></td></tr></table></figure>

<h3 id="2-正反向查询"><a href="#2-正反向查询" class="headerlink" title="2)正反向查询"></a>2)正反向查询</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">正向</span><br><span class="line">    跨表查询的时候 外键字段是否在当前数据对象中 如果在</span><br><span class="line">    查询另外一张关系表  叫正向</span><br><span class="line"></span><br><span class="line">反向</span><br><span class="line">    如果不在叫反向</span><br><span class="line"></span><br><span class="line">口诀</span><br><span class="line">    正向查询按外键字段</span><br><span class="line">    反向查询按表名小写以及视情况添加添加_set.all()</span><br></pre></td></tr></table></figure>

<h3 id="3）基于对象的跨表查询（子查询）"><a href="#3）基于对象的跨表查询（子查询）" class="headerlink" title="3）基于对象的跨表查询（子查询）"></a>3）基于对象的跨表查询（子查询）</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"> 1 # 基于对象的跨表查询（子查询）</span><br><span class="line"> 2 1.查询书籍pk为1的出版社名称</span><br><span class="line"> 3 book_obj &#x3D; models.Book.objects.filter(pk&#x3D;1).first()</span><br><span class="line"> 4 print(book_obj.publish)  #  结果：Publish object</span><br><span class="line"> 5 print(book_obj.publish.name)  # 西方出版社</span><br><span class="line"> 6 print(book_obj.publish.addr)  # 白宫</span><br><span class="line"> 7 </span><br><span class="line"> 8 # 2.查询书籍pk为2的所有作者的姓名</span><br><span class="line"> 9 book_obj &#x3D; models.Book.objects.filter(pk&#x3D;1).first()</span><br><span class="line">10 # 正向查询看外键字段</span><br><span class="line">11 print(book_obj.authors)</span><br><span class="line">12 # 结果：app01.Author.None 意味这没有写错</span><br><span class="line">13 print(book_obj.authors.all())  # 因为书籍对应的有多个作者，添加all获取所有，</span><br><span class="line">14 # 结果为：&lt;QuerySet [&lt;Author: Author object&gt;, &lt;Author: Author object&gt;, &lt;Author: Author object&gt;]&gt;</span><br><span class="line">15 author_list &#x3D; book_obj.authors.all()</span><br><span class="line">16 for author_obj in author_list:</span><br><span class="line">17     print(author_obj.name)</span><br><span class="line">18 </span><br><span class="line">19 </span><br><span class="line">20 # 3.查询作者pk为1的电话号码</span><br><span class="line">21 author_obj &#x3D; models.Author.objects.filter(pk&#x3D;1).first()</span><br><span class="line">22 print(author_obj.author_detail)</span><br><span class="line">23 print(author_obj.author_detail.phone)</span><br><span class="line">24 print(author_obj.author_detail.addr)</span><br></pre></td></tr></table></figure>

<h4 id="总结1："><a href="#总结1：" class="headerlink" title="总结1："></a>总结1：</h4><p>正向查询的时候 当外键字段对应的数据可以有多个的时候需要加.all()，这样就可以获取所有的对应信息，否则查到的结果为app.表名.None</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"> 1 # 4.查询出版社名称为东方出版社出版过的书籍</span><br><span class="line"> 2 publish_obj &#x3D; models.Publish.objects.filter(name&#x3D;&#39;东方出版社&#39;).first()</span><br><span class="line"> 3 print(publish_obj.book)  # 这样直接小写会报错AttributeError: &#39;Publish&#39; object has no attribute &#39;book&#39;</span><br><span class="line"> 4 改成</span><br><span class="line"> 5 print(publish_obj.book_set)  # app01.Book.None</span><br><span class="line"> 6 print(publish_obj.book_set.all())  # &lt;QuerySet [&lt;Book: Book object&gt;]&gt;</span><br><span class="line"> 7 print(publish_obj.book_set.all().first().title)</span><br><span class="line"> 8 </span><br><span class="line"> 9 # 5.查询作者为李四写过的书</span><br><span class="line">10 author_obj &#x3D; models.Author.objects.filter(name&#x3D;&#39;李四&#39;).first()</span><br><span class="line">11 print(author_obj.book_set)  # app01.Book.None</span><br><span class="line">12 print(author_obj.book_set.all())</span><br><span class="line">13 </span><br><span class="line">14 # 6.查询手机号为11234的作者姓名</span><br><span class="line">15 author_detail_obj &#x3D; models.AuthorDetail.objects.filter(phone&#x3D;11234).first()</span><br><span class="line">16 print(author_detail_obj.author)  # Author object  基于一对一关系不需要_set_all</span><br><span class="line">17 print(author_detail_obj.author.name)</span><br><span class="line">18 print(author_detail_obj.author.age)</span><br></pre></td></tr></table></figure>

<h4 id="总结2："><a href="#总结2：" class="headerlink" title="总结2："></a>总结2：</h4><p>　　基于对象的反向查询 表名小写是否需要加_set.all()　　</p>
<p>　　一对多和多对多的时候需要加　　</p>
<p>　　一对一不需要</p>
<h3 id="4）基于双下划线跨表查询-链表查询"><a href="#4）基于双下划线跨表查询-链表查询" class="headerlink" title="4）基于双下划线跨表查询(链表查询)"></a>4）基于双下划线跨表查询(链表查询)</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"> 1 # 基于双下划线跨表查询(链表查询)</span><br><span class="line"> 2 # 1.查询书籍pk为1的出版社名称</span><br><span class="line"> 3 # 正向</span><br><span class="line"> 4 res1 &#x3D; models.Book.objects.filter(pk&#x3D;1).values(&#39;title&#39;)</span><br><span class="line"> 5 print(res1)</span><br><span class="line"> 6 # 结果：&lt;QuerySet [&#123;&#39;title&#39;: &#39;三国演义&#39;&#125;]&gt;</span><br><span class="line"> 7 res2 &#x3D; models.Book.objects.filter(pk&#x3D;1).values(&#39;publish&#39;) # 写外键字段 就意味着你已经在外键字段管理的那张表中</span><br><span class="line"> 8 print(res2)</span><br><span class="line"> 9 # 结果：&lt;QuerySet [&#123;&#39;publish&#39;: 4&#125;]&gt;</span><br><span class="line">10 res3 &#x3D; models.Book.objects.filter(pk&#x3D;1).values(&#39;publish__name&#39;)</span><br><span class="line">11 print(res3)</span><br><span class="line">12 # &lt;QuerySet [&#123;&#39;publish__name&#39;: &#39;西方出版社&#39;&#125;]&gt;</span><br><span class="line">13 </span><br><span class="line">14 </span><br><span class="line">15 # 反向</span><br><span class="line">16 res &#x3D; models.Publish.objects.filter(book__pk&#x3D;1)</span><br><span class="line">17 print(res)</span><br><span class="line">18 # 结果：&lt;QuerySet [&lt;Publish: Publish object&gt;]&gt;</span><br><span class="line">19 res1 &#x3D; models.Publish.objects.filter(book__pk&#x3D;1).first()</span><br><span class="line">20 print(res1)</span><br><span class="line">21 # 结果： Publish object 后面再加.name就能拿到具体名字</span><br><span class="line">22 res2 &#x3D; models.Publish.objects.filter(book__pk&#x3D;1).values(&#39;name&#39;)</span><br><span class="line">23 print(res2)</span><br><span class="line">24 # 结果：&lt;QuerySet [&#123;&#39;name&#39;: &#39;西方出版社&#39;&#125;]&gt;</span><br><span class="line">25 </span><br><span class="line">26 # 3.查询作者是李四的年龄和手机号</span><br><span class="line">27     # 正向</span><br><span class="line">28     res &#x3D; models.Author.objects.filter(name&#x3D;&#39;李四&#39;).values(&#39;age&#39;,&#39;author_detail__phone&#39;)</span><br><span class="line">29     print(res)</span><br><span class="line">30     # 反向</span><br><span class="line">31     res &#x3D; models.AuthorDetail.objects.filter(author__name&#x3D;&#39;李四&#39;)  # 拿到jason的个人详情</span><br><span class="line">32     res &#x3D; models.AuthorDetail.objects.filter(author__name&#x3D;&#39;李四&#39;).values(&#39;phone&#39;,&#39;author__age&#39;)</span><br><span class="line">33     print(res)</span><br><span class="line">34 </span><br><span class="line">35     # 查询书籍pk为的1的作者的手机号</span><br><span class="line">36     res &#x3D; models.Book.objects.filter(pk&#x3D;1).values(&#39;authors__author_detail__phone&#39;)</span><br><span class="line">37     print(res)</span><br><span class="line">38 </span><br><span class="line">39     res &#x3D; models.AuthorDetail.objects.filter(author__book__pk&#x3D;1).values(&#39;phone&#39;)</span><br><span class="line">40     print(res)</span><br><span class="line">41 </span><br><span class="line">42     &quot;&quot;&quot;</span><br><span class="line">43     只要表之间有关系  你就可以通过正向的外键字段或者反向的表名小写 连续跨表操作</span><br><span class="line">44     &quot;&quot;&quot;</span><br></pre></td></tr></table></figure>

<h2 id="三-聚合查询"><a href="#三-聚合查询" class="headerlink" title="三.聚合查询"></a>三.聚合查询</h2><p>关键字<br>aggregate</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> 1    from django.db.models import Max,Min,Avg,Count,Sum</span><br><span class="line"> 2     # 聚合查询要导入的模块</span><br><span class="line"> 3     # 查询所有书的平均价格</span><br><span class="line"> 4     res &#x3D; models.Book.objects.aggregate(avg_num&#x3D;Avg(&#39;price&#39;))</span><br><span class="line"> 5     print(res)</span><br><span class="line"> 6     # 查询价格最贵的书</span><br><span class="line"> 7     res &#x3D; models.Book.objects.aggregate(max_num&#x3D;Max(&#39;price&#39;))</span><br><span class="line"> 8     print(res)</span><br><span class="line"> 9     # 全部使用一遍</span><br><span class="line">10     res &#x3D; models.Book.objects.aggregate(Avg(&quot;price&quot;), Max(&quot;price&quot;), Min(&quot;price&quot;),Count(&quot;pk&quot;),Sum(&#39;price&#39;))</span><br><span class="line">11     print(res)</span><br></pre></td></tr></table></figure>

<h2 id="四-分组查询"><a href="#四-分组查询" class="headerlink" title="四.分组查询"></a>四.分组查询</h2><p>关键字<br>annotate</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"> 1     # 1.统计每一本书的作者个数</span><br><span class="line"> 2     res &#x3D; models.Book.objects.annotate(author_num&#x3D;Count(&#39;authors&#39;)).values(&#39;title&#39;,&#39;author_num&#39;)</span><br><span class="line"> 3     print(res)</span><br><span class="line"> 4 </span><br><span class="line"> 5     # 2.统计出每个出版社卖的最便宜的书的价格</span><br><span class="line"> 6     res &#x3D; models.Publish.objects.annotate(min_price&#x3D;Min(&#39;book__price&#39;)).values(&#39;name&#39;,&#39;min_price&#39;,&#39;book__title&#39;)</span><br><span class="line"> 7     print(res)</span><br><span class="line"> 8 </span><br><span class="line"> 9     # 3.统计不止一个作者的图书</span><br><span class="line">10     res &#x3D; models.Book.objects.annotate(author_num&#x3D;Count(&#39;authors&#39;)).filter(author_num__gt&#x3D;1).values(&#39;title&#39;)</span><br><span class="line">11     print(res)</span><br><span class="line">12 </span><br><span class="line">13     # 4.查询各个作者出的书的总价格</span><br><span class="line">14     res &#x3D; models.Author.objects.annotate(price_sum&#x3D;Sum(&#39;book__price&#39;)).values(&#39;name&#39;,&#39;price_sum&#39;)</span><br><span class="line">15     print(res)</span><br><span class="line">16 </span><br><span class="line">17     # 5.如何按照表中的某一个指定字段分组</span><br><span class="line">18     &quot;&quot;&quot;</span><br><span class="line">19     res &#x3D; models.Book.objects.values(&#39;price&#39;).annotate()  就是以价格分组</span><br><span class="line">20     &quot;&quot;&quot;</span><br></pre></td></tr></table></figure>

<h2 id="五-F与Q查询"><a href="#五-F与Q查询" class="headerlink" title="五.F与Q查询"></a>五.F与Q查询</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"> 1     from django.db.models import F,Q</span><br><span class="line"> 2     # 1.查询库存数大于卖出数的书籍</span><br><span class="line"> 3     res &#x3D; models.Book.objects.filter(kucun__gt&#x3D;F(&#39;maichu&#39;))</span><br><span class="line"> 4     print(res)</span><br><span class="line"> 5 </span><br><span class="line"> 6     # 2.将所有书的价格提高100</span><br><span class="line"> 7     res &#x3D; models.Book.objects.update(price&#x3D;F(&#39;price&#39;) + 100)</span><br><span class="line"> 8     &quot;&quot;&quot;</span><br><span class="line"> 9     帮你获取到表中某个字段对应的值</span><br><span class="line">10     &quot;&quot;&quot;</span><br><span class="line">11     # Q能够改变查询的条件关系  and or not</span><br><span class="line">12     # 1.查询书的名字是python入门或者价格是1000的书籍</span><br><span class="line">13     res &#x3D; models.Book.objects.filter(title&#x3D;&#39;python入门&#39;,price&#x3D;1000)  # and关系</span><br><span class="line">14     res &#x3D; models.Book.objects.filter(Q(title&#x3D;&#39;python入门&#39;),Q(price&#x3D;1000))  # 逗号是and关系</span><br><span class="line">15     res &#x3D; models.Book.objects.filter(Q(title&#x3D;&#39;python入门&#39;)|Q(price&#x3D;1000))  # |是or关系</span><br><span class="line">16     res &#x3D; models.Book.objects.filter(~Q(title&#x3D;&#39;python入门&#39;)|Q(price&#x3D;1000))  # ~是not关系</span><br><span class="line">17     print(res.query)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> 1 高阶用法(了解)</span><br><span class="line"> 2                 应用场景</span><br><span class="line"> 3                     当你写的业务逻辑有组合查询</span><br><span class="line"> 4                         title price        1000</span><br><span class="line"> 5                         查询title中包含1000或者price中包含1000的数据   __icontains</span><br><span class="line"> 6                         参考点:django admin后台管理搜索功能  </span><br><span class="line"> 7                 q &#x3D; Q()</span><br><span class="line"> 8                 q.connector &#x3D; &#39;or&#39;  # 可以修改查询关系  and  or</span><br><span class="line"> 9                 q.children.append((&#39;title&#39;,1000))</span><br><span class="line">10                 q.children.append((&#39;price&#39;,1000))</span><br><span class="line">11                 res &#x3D; models.Book.objects.filter(q)  # 默认还是and关系  但是可以修改为or</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/12/19/Django%E6%A1%86%E6%9E%B6%E6%A8%A1%E5%9E%8B%E5%B1%82%E5%92%8CORM/" data-id="ckd3ezcwb0003t4utcbzjen0c" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Django/" rel="tag">Django</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Django框架路由层和视图层" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/12/15/Django%E6%A1%86%E6%9E%B6%E8%B7%AF%E7%94%B1%E5%B1%82%E5%92%8C%E8%A7%86%E5%9B%BE%E5%B1%82/" class="article-date">
  <time datetime="2018-12-15T13:11:33.000Z" itemprop="datePublished">2018-12-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/12/15/Django%E6%A1%86%E6%9E%B6%E8%B7%AF%E7%94%B1%E5%B1%82%E5%92%8C%E8%A7%86%E5%9B%BE%E5%B1%82/">Django框架路由层和视图层</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="一-Django框架中rom的表关系创建"><a href="#一-Django框架中rom的表关系创建" class="headerlink" title="一.Django框架中rom的表关系创建"></a>一.Django框架中rom的表关系创建</h2><h3 id="1-表与表的关系"><a href="#1-表与表的关系" class="headerlink" title="1).表与表的关系"></a>1).表与表的关系</h3><ul>
<li><p>一对一</p>
</li>
<li><p>一对多</p>
</li>
<li><p>多对多</p>
<p>具体sql语句及关系请查看[数据库基础链接](<a href="https://www.cnblogs.com/jiangxianseng/p/" target="_blank" rel="noopener">https://www.cnblogs.com/jiangxianseng/p/</a> <a href="https://www.cnblogs.com/jiangxianseng/p/12031335.html" target="_blank" rel="noopener">https://www.cnblogs.com/jiangxianseng/p/12031335.html</a> )</p>
</li>
</ul>
<h3 id="2-以图书管理系统为例，创建几张关系表"><a href="#2-以图书管理系统为例，创建几张关系表" class="headerlink" title="2)以图书管理系统为例，创建几张关系表"></a>2)以图书管理系统为例，创建几张关系表</h3><p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200107014522821-1473613271.png" alt="img"></p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200107014530203-264805306.png" alt="img"></p>
<p>注意：**在models.py中书写表关系的时候，要先写好基表，再写外键关系</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"> 1 # 先建立好三张基表</span><br><span class="line"> 2 from django.db import models</span><br><span class="line"> 3 </span><br><span class="line"> 4 # Create your models here.</span><br><span class="line"> 5 #书表</span><br><span class="line"> 6 class Book(models.Model):</span><br><span class="line"> 7     # id 是自动创建的，除非id名自定义</span><br><span class="line"> 8     title &#x3D; models.CharField(max_length&#x3D;255)</span><br><span class="line"> 9     # price为小数字段，表示总共8位数，其中小数占2位</span><br><span class="line">10     price &#x3D; models.DecimalField(max_digits&#x3D;8, decimal_places&#x3D;2)</span><br><span class="line">11 </span><br><span class="line">12 </span><br><span class="line">13 #出版社表</span><br><span class="line">14 class Publsh(models.Model):</span><br><span class="line">15     name &#x3D; models.CharField(max_length&#x3D;64)</span><br><span class="line">16     addr &#x3D; models.CharField(max_length&#x3D;64)</span><br><span class="line">17 </span><br><span class="line">18 </span><br><span class="line">19 # 作者表</span><br><span class="line">20 class Author(models.Model):</span><br><span class="line">21     name &#x3D; models.CharField(max_length&#x3D;64)</span><br><span class="line">22     # 比Int类型长一些</span><br><span class="line">23     phone &#x3D; models.BigIntegerField()</span><br></pre></td></tr></table></figure>

<ul>
<li><p>图书表</p>
<p>图书和出版社是一对多的关系</p>
<p>外键字段应该建立在多的一方</p>
</li>
</ul>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200107014543536-921336729.png" alt="img"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> 1 #书表</span><br><span class="line"> 2 class Book(models.Model):</span><br><span class="line"> 3     # id 是自动创建的，除非id名自定义</span><br><span class="line"> 4     title &#x3D; models.CharField(max_length&#x3D;255)</span><br><span class="line"> 5     # price为小数字段，表示总共8位数，其中小数占2位</span><br><span class="line"> 6     price &#x3D; models.DecimalField(max_digits&#x3D;8, decimal_places&#x3D;2)</span><br><span class="line"> 7     # 书籍表和出版社表是一对多关系，外键字段要建立在书籍表中</span><br><span class="line"> 8     Publish &#x3D; models.ForeignKey(to&#x3D;&#39;Publish&#39;) # 并且默认关联字段就是出版社表的主键字段，里面有个to_field参数能够修改关联的字段</span><br><span class="line"> 9     # 补充：to后面需要加引号，若Publish表在Book表上方，则不需要加引号</span><br><span class="line">10     # Publish &#x3D; models.ForeignKey(to&#x3D;Publish)</span><br><span class="line">11 </span><br><span class="line">12     # 书籍与作者是多对多关系,外键字段建立在较为频繁的书籍表中，通过ManytoManyField方法就能建立第三张表</span><br><span class="line">13     Authors &#x3D; models.ManyToManyField(to&#x3D;&#39;Author&#39;)</span><br><span class="line">14     # 补充注意：Authors字段只是一个虚拟字段，并不会在Book表中创建出来，只是告诉Django ORM为多对多关系创建一个第三方表</span><br><span class="line">15</span><br></pre></td></tr></table></figure>

<ul>
<li>出版社表</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1 #出版社表</span><br><span class="line">2 class Publish(models.Model):</span><br><span class="line">3     name &#x3D; models.CharField(max_length&#x3D;64)</span><br><span class="line">4     addr &#x3D; models.CharField(max_length&#x3D;64)</span><br><span class="line">5</span><br></pre></td></tr></table></figure>

<ul>
<li><p>作者表</p>
<p>图书表与作者表是多对多的关系</p>
<p>理论上外键字段在哪张表都一样，但是推荐外键字段建立在查询较为频繁的表中</p>
</li>
</ul>
<p>作者表与作者详情表是一对一关系</p>
<p>同样，还是推荐将外键字段建立在使用频率较高的表中</p>
<p>原因：就是为了方便后面我们基于ORM查询</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 作者表</span><br><span class="line">class Author(models.Model):</span><br><span class="line">    name &#x3D; models.CharField(max_length&#x3D;64)</span><br><span class="line">    # 比Int类型长一些</span><br><span class="line">    phone &#x3D; models.BigIntegerField()</span><br><span class="line"></span><br><span class="line">    # 作者表与作者详情表一对一关系</span><br><span class="line">    Author_detail &#x3D; models.OneToOneField(to&#x3D;&#39;AuthorDetail&#39;)</span><br></pre></td></tr></table></figure>

<ul>
<li>作者详情表</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1 # 作者详情表</span><br><span class="line">2 class AuthorDetail(models.Model):</span><br><span class="line">3     age &#x3D; models.IntegerField()</span><br><span class="line">4     addr &#x3D; models.CharField(max_length&#x3D;64)</span><br></pre></td></tr></table></figure>

<h3 id="3-开始创建"><a href="#3-开始创建" class="headerlink" title="3)开始创建"></a>3)开始创建</h3><p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200107014555174-1256716299.png" alt="img"></p>
<h3 id="4）查看"><a href="#4）查看" class="headerlink" title="4）查看"></a>4）查看</h3><p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200107014603374-2108214149.png" alt="img"></p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200107014648245-1772988687.png" alt="img"></p>
<p> <img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200107014657338-918332767.png" alt="img"></p>
<p>下载之后点一下apply，将新出现的数据库链接删除，重新点一下db.sqlite3,就会出现数据库了</p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200107014704103-1196569104.png" alt="img"></p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200107014715369-693269142.png" alt="img"></p>
<h2 id="二-Django请求生命周期流程图"><a href="#二-Django请求生命周期流程图" class="headerlink" title="二.Django请求生命周期流程图"></a>二.Django请求生命周期流程图</h2><p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200107014722547-1188946840.png" alt="img"></p>
<h2 id="三-路由层"><a href="#三-路由层" class="headerlink" title="三.路由层"></a>三.路由层</h2><p>一般我们刚创建好的Django框架中的urls.py里面存放的是总路由，即总的路由和视图函数或app的对应关系</p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200107014730727-809963832.png" alt="img"></p>
<p>由上面我们可以得到：</p>
<p>url方法第一个参数是一个正则表达式，路由匹配按照正则匹配， 一旦正则能够匹配到内容 会立刻执行对应的视图函数，不会再继续匹配了</p>
<p>注意：用户输入url尾缀路由若没有加最后的斜杠，django会默认将斜杠加上，看下图（将urls中的路由加上/）</p>
<p><strong>补充：</strong>你可以在配置文件settings中指定是否开启该功能<strong>APPEND_SLASH = True/False</strong>（默认是True处于打开状态，改为False则失效）</p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200107014736707-179633408.png" alt="img"></p>
<p>补充：网站首页一打开是非常不友好的，可以通过正则（^$)设置一下<img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200107014823558-1409170796.png" alt="img"></p>
<h3 id="1-无名分组和有名分组"><a href="#1-无名分组和有名分组" class="headerlink" title="1.无名分组和有名分组"></a>1.无名分组和有名分组</h3><p>基于路由层的路由是由正则表达式写的，我们可以在表达式后面来一个数字，如下,表示test后面必须加上四个一到九的数字才能访问</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url(r&#39;^test&#x2F;[0-9]&#123;4&#125;&#39;, views.test),</span><br></pre></td></tr></table></figure>

<p>但是，如果给正则表达式加一个括号，就表示分组的意思</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url(r&#39;^testadd&#x2F;([0-9]&#123;4&#125;)&#39;, views.testadd),</span><br></pre></td></tr></table></figure>

<p>会产生下面的报错信息</p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200107014900857-48030859.png" alt="img"></p>
<p>解决方法：</p>
<p>在视图函数中给一个形参接收这个数字就可以了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">def testadd(request, xxx):</span><br><span class="line">    return HttpResponse(&#39;testadd&#39;)</span><br></pre></td></tr></table></figure>

<h4 id="什么叫无名分组？"><a href="#什么叫无名分组？" class="headerlink" title="什么叫无名分组？"></a>什么叫无名分组？</h4><p>在路由匹配的时候给某段正则表达式加了括号，匹配的时候会将括号内的正则表达式匹配到的内容当作位置参数传递给对应的视图函数，因此视图函数就要多准备一个形参去接收这个位置参数</p>
<h4 id="什么叫有名分组？"><a href="#什么叫有名分组？" class="headerlink" title="什么叫有名分组？"></a>什么叫有名分组？</h4><p>给一段正则表达式起一个别名  匹配的时候会将括号内正则表达式匹配到的内容当做关键字参数传递给对应的视图函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#有名分组</span><br><span class="line"># \d+表示一个或多个数字，?P&lt;ttt&gt;固定写法，表示给正则表达式命名为ttt</span><br><span class="line">    url(r&#39;^testadd&#x2F;(?P&lt;ttt&gt;\d+)&#39;, views.testadd)</span><br></pre></td></tr></table></figure>



<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200107014955847-821524009.png" alt="img"></p>
<p><strong>解决方法:</strong>在视图函数中添加关键字形参去接收关键字实参</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># ttt就是接收关键字参数的</span><br><span class="line">def testadd(request, ttt):</span><br><span class="line">    return HttpResponse(&#39;testadd&#39;)</span><br></pre></td></tr></table></figure>

<p><strong>注意：</strong></p>
<ul>
<li><strong>无名有名不能混合使用</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">url(r&#39;^test&#x2F;(\d+)&#x2F;(?P&lt;year&gt;\d+)&#x2F;&#39;, views.test)</span><br><span class="line"># 会报找不到位置参数的错误</span><br></pre></td></tr></table></figure>

<ul>
<li>无名有名虽然不能混合使用，但是同一种命名方式 可以使用多个</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1 #无名叠加</span><br><span class="line">2 url(r&#39;^test&#x2F;(\d+)&#x2F;(\d+)&#x2F;&#39;,views.test)</span><br><span class="line">3 </span><br><span class="line">4 #有名叠加</span><br><span class="line">5 url(r&#39;^test&#x2F;(?P&lt;xxx&gt;\d+)&#x2F;(?P&lt;year&gt;\d+)&#x2F;&#39;,views.test),</span><br></pre></td></tr></table></figure>

<h3 id="2-反向解析"><a href="#2-反向解析" class="headerlink" title="2.反向解析"></a>2.反向解析</h3><p><strong>通过一些方法 能够得到一个结果 该结果可以访问到对应的url</strong></p>
<p>例如：可以通过html页面访问另一个url页面</p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200107015009858-2005594121.png" alt="img"></p>
<p>但是，如果将urls中的test名修改了，后面的html所有关于这个的url链接都将失效</p>
<p><strong>如何解决此问题？</strong></p>
<ul>
<li><p>第一步：</p>
<p>先给路由与视图函数对应关系 起一个名字（相当于赋予一个令牌）</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url(r&#39;^test&#x2F;&#39;,views.testadd,name&#x3D;&#39;add&#39;)</span><br></pre></td></tr></table></figure>

<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200107015022288-11967212.png" alt="img"></p>
<ul>
<li>第二步：若是前端解析，将｛% url ‘add’ %｝添加html中</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href&#x3D;&quot;&#123;% url &#39;add&#39; %&#125;&quot;&gt;2222&lt;&#x2F;a&gt;</span><br></pre></td></tr></table></figure>

<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200107015031571-737893503.png" alt="img"></p>
<ul>
<li>第三不：若是后端解析，<strong>先在view.py导入reverse模块</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> 1 url(r&#39;^test&#x2F;&#39;,views.testadd,name&#x3D;&#39;add&#39;)</span><br><span class="line"> 2 </span><br><span class="line"> 3 </span><br><span class="line"> 4 from django.shortcuts import  reverse</span><br><span class="line"> 5 </span><br><span class="line"> 6 def test(request):</span><br><span class="line"> 7     _url &#x3D; reverse(&#39;add&#39;)</span><br><span class="line"> 8     print(_url)</span><br><span class="line"> 9     </span><br><span class="line">10 # 通过reverse 模块就能拿到test路由名  </span><br><span class="line">11 # &#x2F;test&#x2F;</span><br><span class="line">12 # 注意：一定要提前命名name，否则reverse会找不到</span><br></pre></td></tr></table></figure>

<h3 id="3-有名无名反向解析"><a href="#3-有名无名反向解析" class="headerlink" title="3.有名无名反向解析"></a>3.有名无名反向解析</h3><p>分析：先在urls.py文件中建立有名无名分组</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 无名分组</span><br><span class="line">url(r&#39;^testadd&#x2F;([0-9]&#123;4&#125;)&#39;, views.testadd， name&#x3D;&#39;add&#39;),</span><br><span class="line">    </span><br><span class="line"> #有名分组</span><br><span class="line">url(r&#39;^test&#x2F;(?P&lt;ttt&gt;\d+)&#39;, views.test),</span><br></pre></td></tr></table></figure>

<p>然后views中导入reverse模块，运行home函数</p>
<ul>
<li>无名后端反向解析</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> 1 from django.shortcuts import render, HttpResponse, redirect, reverse</span><br><span class="line"> 2 </span><br><span class="line"> 3 def test(request, ttt):</span><br><span class="line"> 4     return HttpResponse(&#39;test&#39;)</span><br><span class="line"> 5 </span><br><span class="line"> 6 </span><br><span class="line"> 7 def testadd(request, xxx):</span><br><span class="line"> 8     return HttpResponse(&#39;testadd&#39;)</span><br><span class="line"> 9 </span><br><span class="line">10 </span><br><span class="line">11 def home(request):   </span><br><span class="line">12     _url &#x3D; reverse(&#39;add&#39;)</span><br><span class="line">13     print(_url)</span><br><span class="line">14     return HttpResponse(&#39;欢迎欢迎&#39;)</span><br></pre></td></tr></table></figure>

<p>运行后会报错，表示查找add时缺一个参数</p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200107015051134-2070155243.png" alt="img"></p>
<p><strong>报错原因：</strong> 访问这条url：<code>url(r&#39;^testadd/([0-9]{4})&#39;, views.testadd， name=&#39;add&#39;)</code></p>
<p>必须以/testadd/1234/这种形式，否则无法访问，因此结果的不确定性让Django无法做判断，因此需要人为的给予数字</p>
<p>解决方案：在<code>_url = reverse(&#39;add&#39;)</code>中随意给一个数字，例如</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">_url &#x3D; reverse(&#39;add&#39;, args&#x3D;(1234,))</span><br><span class="line"># 注意：此处要以元组的形式添加</span><br><span class="line">#补充：这个数字通常就是数据的主键值</span><br></pre></td></tr></table></figure>

<p>再次启动访问home的url就能得到<strong>/testadd/1234</strong>，通过他就能访问testadd这条url了</p>
<ul>
<li>无名前端反向解析</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">def home(request):</span><br><span class="line">    return render(request, &#39;home.html&#39;)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1 &lt;!--同样需要根据正则分组规则添加相应的数字--&gt;</span><br><span class="line">2 </span><br><span class="line">3 &lt;a href&#x3D;&quot;&#123;% url &#39;add&#39; 1234 %&#125;&quot;&gt;2222&lt;&#x2F;a&gt;</span><br><span class="line">4 &lt;a href&#x3D;&quot;&#123;% url &#39;add&#39; 5628 %&#125;&quot;&gt;2222&lt;&#x2F;a&gt;</span><br><span class="line">5 &lt;a href&#x3D;&quot;&#123;% url &#39;add&#39; 3637 %&#125;&quot;&gt;2222&lt;&#x2F;a&gt;</span><br><span class="line">6 &lt;a href&#x3D;&quot;&#123;% url &#39;add&#39; 3839 %&#125;&quot;&gt;2222&lt;&#x2F;a&gt;</span><br></pre></td></tr></table></figure>

<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200107015223134-2054748520.png" alt="img"></p>
<p>同上可以获得</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#　有名分组</span><br><span class="line">url(r&#39;^test&#x2F;(?P&lt;ttt&gt;\d+)&#39;, views.test)</span><br></pre></td></tr></table></figure>

<ul>
<li>有名后端反向解析</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1 # 在reverse中添加kwargs&#x3D;｛‘名字’：符合正则的符号｝</span><br><span class="line">2 def home(request):   </span><br><span class="line">3     _url &#x3D; reverse(&#39;add&#39;, kwargs&#x3D;&#123;&#39;year&#39;:11&#125;)  # 标准写法</span><br><span class="line">4     _url &#x3D; reverse(&#39;add&#39;, args&#x3D;(11,)</span><br><span class="line">5     print(_url)</span><br><span class="line">6     return HttpResponse(&#39;欢迎欢迎&#39;)</span><br></pre></td></tr></table></figure>

<ul>
<li>有名前端反向解析</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;% url &#39;add&#39; 1 %&#125;  # 推荐使用</span><br><span class="line">&#123;% url &#39;add&#39; year&#x3D; 1 %&#125;  # 标准的</span><br></pre></td></tr></table></figure>

<h4 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1 # 无名分组反向解析：</span><br><span class="line">2 </span><br><span class="line">3 url(r&#39;^testadd&#x2F;(\d+)&#x2F;&#39;,views.testadd,name&#x3D;&#39;add&#39;)</span><br><span class="line">4         #前端解析</span><br><span class="line">5             &#123;% url &#39;add&#39; 1 %&#125;</span><br><span class="line">6         #后端解析</span><br><span class="line">7             reverse(&#39;add&#39;,args&#x3D;(12,))</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> 1 有名分组反向解析：</span><br><span class="line"> 2 </span><br><span class="line"> 3 url(r&#39;^testadd&#x2F;(\d+)&#x2F;&#39;,views.testadd,name&#x3D;&#39;add&#39;)</span><br><span class="line"> 4 </span><br><span class="line"> 5 #前端解析</span><br><span class="line"> 6 &#123;% url &#39;add&#39; 1 %&#125;  # 推荐使用</span><br><span class="line"> 7 &#123;% url &#39;add&#39; year &#x3D; 1&#125; # 标准使用</span><br><span class="line"> 8 #后端解析</span><br><span class="line"> 9 _url &#x3D; reveerse(&#39;add&#39;, args&#x3D;(11,) # 推荐使用</span><br><span class="line">10 _url &#x3D; reveerse(&#39;add&#39;, kwargs&#x3D;&#123;&#39;year&#39;:11&#125; # 标准使用</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#伪代码</span><br><span class="line">url(r&#39;^edit_user&#x2F;(\d+)&#x2F;&#39;,views.edit_user,names&#x3D;&#39;edit&#39;)</span><br><span class="line"></span><br><span class="line">    &#123;% for user_obj in user_queryset %&#125;</span><br><span class="line">        &lt;a href&#x3D;&quot;edit_user&#x2F;&#123;&#123; user_obj.id &#125;&#125;&#x2F;&quot;&gt;编辑&lt;&#x2F;a&gt;</span><br><span class="line">        &lt;a href&#x3D;&quot;&#123;% url &#39;edit&#39; user_obj.id %&#125;&quot;&gt;编辑&lt;&#x2F;a&gt;</span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line"> def edit_user(request,edit_id):</span><br><span class="line">        reverse(&#39;edit&#39;,args&#x3D;(edit_id,))</span><br><span class="line"></span><br><span class="line">    &quot;&quot;&quot;</span><br></pre></td></tr></table></figure>

<h3 id="4-路由分发"><a href="#4-路由分发" class="headerlink" title="4.路由分发"></a>4.路由分发</h3><h4 id="1-什么是路由分发？"><a href="#1-什么是路由分发？" class="headerlink" title="1).什么是路由分发？"></a>1).什么是路由分发？</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">    当django项目比较庞大的时候 路由与视图函数对应关系较多</span><br><span class="line">总路由代码太多冗长</span><br><span class="line">考虑到总路由代码不好维护 django支持每个app都可以有自己的urls.py</span><br><span class="line">并且总路由不再做路由与视图函数的对应关系 而仅仅只做一个分发任务的操作</span><br><span class="line"></span><br><span class="line">根据请求的不同 识别出当前请求需要访问的功能属于哪个app然后自动</span><br><span class="line">下发到对应app里面的urls.py中 然后由app里面的urls.py做路由与视图函数的匹配</span><br><span class="line"></span><br><span class="line">不仅如此每个app除了可以有自己的urls.py之外 还可以有自己的static文件夹 templates模板文件</span><br><span class="line">基于上面的特点 基于django分小组开发 会变得额外的简单</span><br><span class="line">每个人只需要开发自己的app即可 之后只需要创建一个空的django项目</span><br><span class="line">将多个人的app全部拷贝项目下 配置文件注册</span><br><span class="line">总路由分发一次</span><br></pre></td></tr></table></figure>

<h4 id="2-如何实现一个简单的路由分发"><a href="#2-如何实现一个简单的路由分发" class="headerlink" title="2).如何实现一个简单的路由分发"></a>2).如何实现一个简单的路由分发</h4><p>第一步：在控制台通过命令行创建多个app文件夹，并将app在settings中注册</p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200107015242858-730497930.png" alt="img"></p>
<p>第二步：建立urls，导入include模块，各种导入，看下图</p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200107015257097-658719102.png" alt="img"></p>
<p>注意事项：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns &#x3D; [</span><br><span class="line">    url(r&#39;^admin&#x2F;&#39;, admin.site.urls),    </span><br><span class="line">    url(r&#39;^app01&#x2F;&#39;, include(app01_urls)),</span><br><span class="line">    url(r&#39;^app02&#x2F;&#39;, include(app02_urls)),</span><br><span class="line">]</span><br><span class="line"># 在总路由^app01&#x2F;后面千万不能添加$,否则无法找到</span><br></pre></td></tr></table></figure>

<p>补充：简写写法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 将导入和路由对应关系全部拿掉，用app.urls的方法</span><br><span class="line">    # from app01 import urls as app01_urls</span><br><span class="line">    # from app02 import urls as app02_urls</span><br><span class="line">    # url(r&#39;^app01&#x2F;&#39;,include(app01_urls)),</span><br><span class="line">    # url(r&#39;^app02&#x2F;&#39;,include(app02_urls))</span><br><span class="line">    </span><br><span class="line">    # 简写</span><br><span class="line">    url(r&#39;^app01&#x2F;&#39;,include(&#39;app01.urls&#39;)),</span><br><span class="line">    url(r&#39;^app02&#x2F;&#39;,include(&#39;app02.urls&#39;))</span><br></pre></td></tr></table></figure>

<h3 id="5-名称空间（了解）"><a href="#5-名称空间（了解）" class="headerlink" title="5.名称空间（了解）"></a>5.名称空间（了解）</h3><p>问题：如果在不同的app中的路由对应关系中添加了相同的name，那么在反向解析的时候能否准确找到</p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200107015313343-1932884372.png" alt="img"></p>
<p>结果是一定的，不能准确找到，那如何解决这个问题？</p>
<p><strong>可以再主路由对应列表中添加namespace属性</strong>，如下所示</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">url(r&#39;^app01&#x2F;&#39;, include(&#39;app01.urls&#39;, namespace&#x3D;&#39;app01&#39;))</span><br><span class="line">url(r&#39;^app02&#x2F;&#39;, include(&#39;app02.urls&#39;, namespace&#x3D;&#39;app02&#39;))</span><br><span class="line">后端解析</span><br><span class="line">reverse(&#39;app01:id&#39;)</span><br><span class="line">reverse(&#39;app02:id&#39;)</span><br><span class="line"></span><br><span class="line">前端解析</span><br><span class="line">&#123;% url &#39;app01:index&#39; %&#125;</span><br><span class="line">&#123;% url &#39;app02:index&#39; %&#125;</span><br></pre></td></tr></table></figure>

<p><strong>如何避免使用这种方法？</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1 # 在给路由与视图函数起别名(name的名字)的时候只需要保证永远不出现冲突的情况即可</span><br><span class="line">2 # 通常情况下我们推荐期别名的时候加上当前应用的应用名前缀</span><br><span class="line">3 #例如</span><br><span class="line">4 url(r&#39;^index&#x2F;&#39;,views.index,name&#x3D;&#39;app01_index&#39;)</span><br><span class="line">5 url(r&#39;^index&#x2F;&#39;,views.index,name&#x3D;&#39;app02_index&#39;)</span><br></pre></td></tr></table></figure>

<h3 id="6-虚拟环境"><a href="#6-虚拟环境" class="headerlink" title="6.虚拟环境"></a>6.虚拟环境</h3><p>为什么使用虚拟环境？</p>
<p>我们想做到针对不同的项目 只安装项目所需要的功能模块 项目用不到的一概不装 来避免加载资源时的消耗</p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200107015319807-385254209.png" alt="img"></p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200107015329861-74562135.png" alt="img"></p>
<p>注意：这次创建需要用以前创立好的虚拟环境来创立</p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200107015350849-487608561.png" alt="img"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">虚拟环境就类似于一个纯净的python解释器环境</span><br><span class="line">每创建一个虚拟幻境就类似于你重新下载一个python解释器</span><br><span class="line">另外虚拟环境不推荐使用太多，可以创建几个玩一玩，否则占用资源</span><br></pre></td></tr></table></figure>

<h3 id="7-DJango版本区别"><a href="#7-DJango版本区别" class="headerlink" title="7.DJango版本区别"></a>7.DJango版本区别</h3><p><strong>路由层：</strong></p>
<ul>
<li>用的是url，第一个参数是正则表达式</li>
<li>2.x和3.x用的path，第一个参数不是正则表达式，写的是什么就匹配什么，精确匹配</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1.x版本</span><br><span class="line">urlpatterns &#x3D; [</span><br><span class="line">    url(r&#39;^admin&#x2F;&#39;, admin.site.urls),</span><br><span class="line">]</span><br><span class="line">2.x和3.x版本</span><br><span class="line">urlpatterns &#x3D; [</span><br><span class="line">   path(&#39;admin&#x2F;&#39;, admin.site.urls),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>如果觉得path不好用 2.x、3.x给你提供了一个跟url一样的功能 re_path 等价于1.x里面的url功能</p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200107015405563-1384343011.png" alt="img"></p>
<p>虽然path不支持正则表达式 但是它给你提供了五种默认的转换器</p>
<ul>
<li>str:匹配除了路径分隔符（/）之外的非空字符串，这是默认的形式</li>
<li>int:匹配正整数，包含0。</li>
<li>slug,匹配字母、数字以及横杠、下划线组成的字符串。</li>
<li>uuid,匹配格式化的uuid，如 075194d3-6885-417e-a8a8-6c931e272f00。</li>
<li>path,匹配任何非空字符串，包含了路径分隔符（/）（不能用？）</li>
</ul>
<p>除了默认的五种转换器之外 还支持你自定义转换器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1 class MonthConverter:</span><br><span class="line">2         regex&#x3D;&#39;\d&#123;2&#125;&#39; # 属性名必须为regex</span><br><span class="line">3     </span><br><span class="line">4     def to_python(self, value):</span><br><span class="line">5         return int(value)</span><br><span class="line">6 </span><br><span class="line">7     def to_url(self, value):</span><br><span class="line">8         return value # 匹配的regex是两个数字，返回的结果也必须是两个数字</span><br></pre></td></tr></table></figure>

<h3 id="8-伪静态"><a href="#8-伪静态" class="headerlink" title="8.伪静态"></a>8.伪静态</h3><p>伪静态 url以.html结尾 给人的感觉好像是这个文件是写死的 内容不会轻易的改变 伪静态</p>
<p>为了提高你的网站被搜索引擎收藏的力度 提供网站的SEO查询效率</p>
<p>但是 无论你怎么做优化 都抗不过RMB玩家</p>
<h2 id="四-视图层"><a href="#四-视图层" class="headerlink" title="四.视图层"></a>四.视图层</h2><p>1)JsonResponse</p>
<p>视图函数必须要返回一个HttpResponse对象，因为比如这三板斧都是直接或间接的继承HTTresponse</p>
<ul>
<li>HttpResponse</li>
</ul>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200107015411423-503214024.png" alt="img"></p>
<ul>
<li>render</li>
</ul>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200107015418697-1926595043.png" alt="img"></p>
<ul>
<li>redirect</li>
</ul>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200107015423686-1432951746.png" alt="img"></p>
<p><strong>JsonResponse</strong></p>
<p>前后端数据交互</p>
<p>举例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">from django.http import JsonResponse</span><br><span class="line">def xxx(request):</span><br><span class="line">    user_dict &#x3D; &#123;&#39;username&#39;:&#39;jason&#39;,&#39;password&#39;:&#39;123&#39;&#125;</span><br><span class="line">    json_str&#x3D;json.dumps(user_dict)</span><br><span class="line">    return HttpResponse(json_str)</span><br></pre></td></tr></table></figure>

<p>若添加中文进去,就会发生自动转码的事情，如下图</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">from django.http import JsonResponse</span><br><span class="line">def xxx(request):</span><br><span class="line">    user_dict &#x3D; &#123;&#39;username&#39;:&#39;jason好帅哦 我好喜欢!&#39;,&#39;password&#39;:&#39;123&#39;&#125;</span><br><span class="line">    json_str&#x3D;json.dumps(user_dict)</span><br><span class="line">    return HttpResponse(json_str)</span><br></pre></td></tr></table></figure>

<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200107015441969-103073430.png" alt="img"></p>
<p>原因：</p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200107015452327-509882785.png" alt="img"></p>
<p>所以只要将ensure_ascii修改成False即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">json_str &#x3D; json.dumps(user_dict,ensure_ascii&#x3D;False)</span><br></pre></td></tr></table></figure>

<p>也可以使用JsonResponse</p>
<h3 id="return-JsonResponse-user-dict-json-dumps-params-‘ensure-ascii’-False"><a href="#return-JsonResponse-user-dict-json-dumps-params-‘ensure-ascii’-False" class="headerlink" title="return JsonResponse(user_dict,json_dumps_params={‘ensure_ascii’:False})"></a>return JsonResponse(user_dict,json_dumps_params={‘ensure_ascii’:False})</h3><p>若是一个列表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">l &#x3D; [1,2,3,4,5,6,7,8,9,]</span><br><span class="line">return JsonResponse(l,safe&#x3D;False)  # 序列化非字典格式数据 需要将safe改为False</span><br></pre></td></tr></table></figure>

<h2 id="forml表单"><a href="#forml表单" class="headerlink" title="forml表单"></a>forml表单</h2><p>1.必须做的事<br>　　method必须是post<br>　　enctype必须是formdata<br>2.暂时需要做的<br>　　提交post请求需要将中间件里面的一个csrfmiddleware注释掉</p>
<p>后端如何获取用户上传的文件<br>　　file_obj = request.FILES.get(‘前端input框name属性值’)<br>　　file_obj.name # 文件名<br>　　for line in file_obj:<br>　　print(line)</p>
<p># django中推荐以下写法<br>　　for chunk in file_obj.chunks():<br>　　print(chunk)</p>
<h2 id="render原理"><a href="#render原理" class="headerlink" title="render原理"></a>render原理</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">def ab_render(request):</span><br><span class="line">　　temp &#x3D; Template(&quot;&lt;h1&gt;&#123;&#123; user_dict &#125;&#125;&#123;&#123; user_dict.username &#125;&#125;&#123;&#123; user_dict.password &#125;&#125;&lt;&#x2F;h1&gt;&quot;)</span><br><span class="line">　　user_dict &#x3D; Context(&#123;&#39;user_dict&#39;:&#123;&#39;username&#39;:&#39;jason&#39;,&#39;password&#39;:123&#125;&#125;)</span><br><span class="line">　　res &#x3D; temp.render(user_dict)</span><br><span class="line">　　return HttpResponse(res)</span><br></pre></td></tr></table></figure>

<p>补充：视图函数不一定是函数，也有可能是类</p>
<p>FBV:基于函数的视图<br>CBV:基于类的视图</p>
<p>CBV基本写法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">from django.views import View</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class MyLogin(View):</span><br><span class="line">        def get(self,request):</span><br><span class="line">            return render(request,&#39;login.html&#39;)</span><br><span class="line">        def post(self,request):</span><br><span class="line">            return HttpResponse(&#39;我是类里面的post方法&#39;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">url(r&#39;^login&#x2F;&#39;,views.MyLogin.as_view())</span><br></pre></td></tr></table></figure>

<p>朝login提交get请求会自动执行MyLogin里面的get方法<br>而提交post请求也会自动执行MyLogin里面的post方法<br>为什么MyLogin针对不同的请求方法能够自动执行对应的方法</p>
<p>研究源码的突破口<br>url(r’^login/‘,views.MyLogin.as_view())</p>
<p>猜想</p>
<p>as_view要么是类里面定义的普通函数 @staticmethod<br>要么是类里面定义的绑定给类的方法 @classmethod<br>看源码发现是绑定给类的方法@classonlymethod，变成类绑定方法，并且as_view返回的是一个view函数<br>url(r’^login/‘,views.MyLogin.as_view())<br>等价于<br>url(r’^login/‘,views.MyLogin.view)<br>FBV和VBV在路由匹配上是一样的，都是路由与函数内存地址的对应关系<br>并且这个view函数引用了外部的类，他就是一个闭包函数，这个方法给自己定义一些属性，返回一个self.dispatch，我们都知道对象.属性的查找顺序是先查找对象自己的，再查找类的，然后再查找父类的，这里吗就会按顺序找到父类view 的dispatch方法<br>dispatch方法中会先判断请求方式是不是默认的八个请求方式：get，post，put。patch，delete，head，options，trace<br>然后通过反射getattr从我们自己写的类的对象中找请求方式，没有就会报错，该请求方式不允许，有就会调用这个方法并执行，这就是为什么cbv模式下能够自动执行我们定义的方法</p>
<p><img src="https://img2020.cnblogs.com/blog/1843708/202005/1843708-20200528004835109-1203781986.png" alt="img"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/12/15/Django%E6%A1%86%E6%9E%B6%E8%B7%AF%E7%94%B1%E5%B1%82%E5%92%8C%E8%A7%86%E5%9B%BE%E5%B1%82/" data-id="ckd3ezcwo000at4utdeewf4gx" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Django/" rel="tag">Django</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Django框架基础配置" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/12/09/Django%E6%A1%86%E6%9E%B6%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE/" class="article-date">
  <time datetime="2018-12-08T17:50:03.000Z" itemprop="datePublished">2018-12-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/12/09/Django%E6%A1%86%E6%9E%B6%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE/">Django框架基础配置</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>下面全部以登陆功能为例来演示这些功能</p>
<h2 id="一：静态文件的配置"><a href="#一：静态文件的配置" class="headerlink" title="一：静态文件的配置"></a>一：静态文件的配置</h2><ul>
<li>什么是静态文件？</li>
</ul>
<p>网站所使用的提前写好的，后面不在进行修改的配置文件，例如</p>
<p>css文件；</p>
<p>js文件；</p>
<p>常用的第三方组件：</p>
<p>bootstrap</p>
<p>sweetalert</p>
<p>fontawesome</p>
<ul>
<li><p>如何配置静态文件</p>
<p>网站所用到的html文件统一放到templates文件夹中  那针对网站所使用到的静态文件也应该单独找一个文件夹来存储  这个文件夹 默认情况下都叫static  注意：该文件夹需要手动自己创建  并且该文件夹内部通常是以下结构  static  -css  网站所用到的所有的css文件  -js  网站所用到的所有的js文件  -image  网站所用到的所有的图片文件  第三方文件</p>
</li>
</ul>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202002/1843708-20200204135357955-824414350.png" alt="img"></p>
<p>这样引入会发现无法正常引用</p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202002/1843708-20200204135409559-471794405.png" alt="img"></p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202002/1843708-20200204135454476-1136184019.png" alt="img"></p>
<p>补充：用户在浏览器窗口之所以输入网址能够拿到对应的资源 是因为后端开设相关的资源</p>
<p>那如何解决找不到资源的问题呢？</p>
<ul>
<li><p>配置django静态文件</p>
<p>django在配置文件中给你暴露了配置文件的配置信息 你只需要按照固定的写法书写即可暴露对应的静态文件资源</p>
</li>
</ul>
<p>第一步：找到位置</p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202002/1843708-20200204135505610-212321043.png" alt="img"></p>
<p>第二步：书写配置代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">STATICFILES_DIRS &#x3D; [os.path.join(BASE_DIR, &#39;static&#39;)]</span><br></pre></td></tr></table></figure>

<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202002/1843708-20200204135520284-832804882.png" alt="img"></p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202002/1843708-20200204135534677-502661780.png" alt="img"></p>
<ul>
<li><p>如何解决动态绑定问题</p>
<p>什么是接口前缀，通俗的说配置中的staic就是类似一个令牌，想访问资源必须带有staic接口前缀（可以修改，但是必须与配置中的一样）,只有接口前缀（令牌）相同，才会拿着后面的路径依次去配置文件夹中的STATICEFILES_DIRS中的文件夹路径下面列表中的每一个文件夹下查找对应的资源，顺序是从上往下依次查找 如果都没有找到才会报错</p>
</li>
</ul>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202002/1843708-20200204135545364-596887061.png" alt="img"></p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202002/1843708-20200204135551781-706644850.png" alt="img"></p>
<p>加入已经写好了一千个html页面，每一个页面都用了static接口前缀，然后有个需求，配置中的static接口前缀需要修改，如何快速解决将那一千个页面的接口前缀也修改了，这就需要用到接口前缀了</p>
<p>只需要添加下面几句代码，不论你接口前缀怎么修改，都会保持一致</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% load static %&#125;  &lt;!--加一行这个--&gt;</span><br><span class="line">    &lt;link rel&#x3D;&quot;stylesheet&quot; href&#x3D;&quot;&#123;% static &#39;bootstrap-3.3.7-dist&#x2F;css&#x2F;bootstrap.min.css&#39; %&#125;&quot;&gt;  &lt;!--在导入百分号和static即可动态绑定接口前缀--&gt;</span><br><span class="line">    &lt;script src&#x3D;&quot;&#123;% static &#39;bootstrap-3.3.7-dist&#x2F;js&#x2F;bootstrap.min.js&#39; %&#125;&quot;&gt;&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>

<h2 id="二-快速写一个简单的登陆页面"><a href="#二-快速写一个简单的登陆页面" class="headerlink" title="二.快速写一个简单的登陆页面"></a>二.快速写一个简单的登陆页面</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class&#x3D;&quot;container&quot;&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;row&quot;&gt;</span><br><span class="line">        &lt;div class&#x3D;&quot;col-md-8 col-md-offset-2&quot;&gt;</span><br><span class="line">            &lt;h2 class&#x3D;&quot;text-center&quot;&gt;登录&lt;&#x2F;h2&gt;</span><br><span class="line">            &lt;form action&#x3D;&quot;&quot; method&#x3D;&quot;post&quot;&gt;</span><br><span class="line">                &lt;p&gt;username:&lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;username&quot; class&#x3D;&quot;form-control&quot;&gt;&lt;&#x2F;p&gt;</span><br><span class="line">                &lt;p&gt;password:&lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;password&quot; class&#x3D;&quot;form-control&quot;&gt;&lt;&#x2F;p&gt;</span><br><span class="line">                &lt;input type&#x3D;&quot;submit&quot; class&#x3D;&quot;btn btn-success &quot;&gt;</span><br><span class="line">            &lt;&#x2F;form&gt;</span><br><span class="line">        &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">form表单</span><br><span class="line">    form表单默认是以get请求提交数据的(get请求会在url后面携带明文数据)</span><br><span class="line">        http:&#x2F;&#x2F;127.0.0.1:8000&#x2F;login&#x2F;?username&#x3D;admin&amp;password&#x3D;123</span><br><span class="line">    action</span><br><span class="line">        1.不写 默认朝当前地址提交数据</span><br><span class="line">        2.全路径</span><br><span class="line">        3.后缀(&#x2F;index)</span><br><span class="line">    提交post请求的时候 需要先去配置文件中的中间件注释掉一行，因为中间件类似于保安，会检查请求和响应的数据是否安全（后面中间件有重点介绍）</span><br><span class="line">        MIDDLEWARE &#x3D; [</span><br><span class="line">            &#39;django.middleware.security.SecurityMiddleware&#39;,</span><br><span class="line">            &#39;django.contrib.sessions.middleware.SessionMiddleware&#39;,</span><br><span class="line">            &#39;django.middleware.common.CommonMiddleware&#39;,</span><br><span class="line">            # &#39;django.middleware.csrf.CsrfViewMiddleware&#39;,</span><br><span class="line">            &#39;django.contrib.auth.middleware.AuthenticationMiddleware&#39;,</span><br><span class="line">            &#39;django.contrib.messages.middleware.MessageMiddleware&#39;,</span><br><span class="line">            &#39;django.middleware.clickjacking.XFrameOptionsMiddleware&#39;,</span><br><span class="line">        ]</span><br></pre></td></tr></table></figure>

<h2 id="三-request方法"><a href="#三-request方法" class="headerlink" title="三.request方法"></a>三.request方法</h2><p>1).同一个视图函数可以处理不同的请求</p>
<p>eg: get请求来 应该只需要返回一个html文件 post请求来 应该获取用户提交的数据 然后做进一步处理 因此必须要能够判断出当前请求到底是什么请求</p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202002/1843708-20200204135604696-594190163.png" alt="img"></p>
<p>request是一个对象，一个get请求就有下面这么多的方法和属性</p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202002/1843708-20200204135650630-1922126841.png" alt="img"></p>
<p>2).method方法</p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202002/1843708-20200204135816140-1493964605.png" alt="img"></p>
<p><strong>总结：method可以获取前端的请求方法，并且是一个大写的GET或POST字符串</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">通常情况下针对不同的请求应该做不同的处理 而一般情况下get请求次数要远远多于post请求</span><br><span class="line">所以我们应该针对非get请求作出逻辑判断 将get请求直接写在函数体内而不做判断</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="comment"># 要给用户返回一个登陆页面</span></span><br><span class="line">    <span class="comment"># print('我被触发了')</span></span><br><span class="line">    <span class="comment"># 获取前端请求方式</span></span><br><span class="line">    <span class="comment"># if request.method == 'GET':</span></span><br><span class="line">    <span class="comment">#     # get逻辑</span></span><br><span class="line">    <span class="comment">#     return render(request, 'login.html')</span></span><br><span class="line">    <span class="comment"># elif request.method == 'POST':</span></span><br><span class="line">    <span class="comment">#     # post逻辑</span></span><br><span class="line">    <span class="comment">#     # print(request.method,type(request.method))  # GET &lt;class 'str'&gt;  POST &lt;class 'str'&gt;</span></span><br><span class="line">    <span class="comment">#     # 获取数据 之后...</span></span><br><span class="line">    <span class="comment">#     return HttpResponse('收到了你的数据 马上处理')</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    为了减少代码的层级:一般情况下视图函数处理get请求较多 所以可以直接再函数体内先写get请求对应的逻辑</span></span><br><span class="line"><span class="string">    将其他请求利用request.method做出区分</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'POST'</span>:</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">'收到了'</span>)</span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">'login.html'</span>)</span><br></pre></td></tr></table></figure>

<p>3).request.POST</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">print(request.POST)  </span><br><span class="line"># 获取post请求携带的数据 &lt;QueryDict: &#123;&#39;username&#39;: [&#39;admin&#39;], &#39;password&#39;: [&#39;123&#39;]&#125;&gt; </span><br><span class="line"># 可以把它当成是一个大字典</span><br><span class="line"></span><br><span class="line"># 注意，总这些键是由前端传的name属性决定的</span><br><span class="line">&lt;p&gt;username:&lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;username&quot; class&#x3D;&quot;form-control&quot;&gt;&lt;&#x2F;p&gt;</span><br><span class="line"></span><br><span class="line"># 若没有name属性，即时在前端input框内提交了数据，也不会朝后端发送这个数据</span><br></pre></td></tr></table></figure>

<p><strong>因此：在input框中一定要有name属性</strong></p>
<p>4).如何获取post里面的数据（get和getlist）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"># 例如：在前端页面中有以下三个input框需要输入数据传入后端</span><br><span class="line">&lt;p&gt;username:&lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;username&quot; class&#x3D;&quot;form-control&quot;&gt;&lt;&#x2F;p&gt;</span><br><span class="line">&lt;p&gt;username:&lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;username&quot; class&#x3D;&quot;form-control&quot;&gt;&lt;&#x2F;p&gt;</span><br><span class="line"></span><br><span class="line"># 并且有两个相同的name属性</span><br><span class="line">&lt;p&gt;password:&lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;password&quot; class&#x3D;&quot;form-control&quot;&gt;&lt;&#x2F;p&gt;</span><br><span class="line"></span><br><span class="line"># 可通过get的方式</span><br><span class="line">print(request.POST)</span><br><span class="line">username &#x3D; request.POST.get(&#39;usernamr&#39;)</span><br><span class="line">password &#x3D; request.POST.get(&#39;password&#39;)</span><br><span class="line">print(username, type(usernsme))</span><br><span class="line">print(password, type(password))</span><br><span class="line"></span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">&lt;QueryDict: &#123;&#39;username&#39;: [&#39;admin&#39;, &#39;jason&#39;], &#39;password&#39;: [&#39;123&#39;]&#125;&gt;</span><br><span class="line">jason &lt;class &#39;str&#39;&gt;</span><br><span class="line">123 &lt;class &#39;str&#39;&gt;</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">#相同的name属性得到的是一个字典套集合的形式，</span><br><span class="line"></span><br><span class="line"># 通过结果我们可以发现数据都是字符串，如果数据是一个列表，那么get获取数据只能只是列表最后一个数据，不能全部获取</span><br><span class="line"></span><br><span class="line">username &#x3D; request.POST.getlist(&#39;usernamr&#39;)</span><br><span class="line"># 通过getlist的方式可以获取整个列表</span><br></pre></td></tr></table></figure>

<p>5)如何获取GET请求的数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">GET请求和POST请求是一样的，只不过GET请求获取的是url后面携带的数据：url?xxx&#x3D;xxx&amp;yyy&#x3D;yyy</span><br><span class="line"> # 获取符合get请求携带参数特点的数据  url?xxx&#x3D;xxx&amp;yyy&#x3D;yyy</span><br><span class="line"> print(request.GET)  </span><br><span class="line"># &lt;QueryDict: &#123;&#39;username&#39;: [&#39;admin&#39;], &#39;password&#39;: [&#39;123&#39;]&#125;&gt;</span><br><span class="line">print(request.GET.get(&#39;username&#39;),type(request.GET.get(&#39;username&#39;)))</span><br><span class="line"># admin &lt;class ’str‘&gt;</span><br><span class="line">print(request.GET.getlist(&#39;password&#39;),type(request.GET.getlist(&#39;password&#39;)))</span><br><span class="line"># [&#39;123&#39;] &lt;class &#39;list&#39;&gt;</span><br><span class="line"></span><br><span class="line">只要符合这个url?xxx&#x3D;xxx&amp;yyy&#x3D;yyy格式，request.GET都能获取数据</span><br></pre></td></tr></table></figure>

<h2 id="四-链接数据库"><a href="#四-链接数据库" class="headerlink" title="四.链接数据库"></a>四.链接数据库</h2><ul>
<li>先找到database</li>
</ul>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202002/1843708-20200204135828638-798318562.png" alt="img"></p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202002/1843708-20200204135840328-83318567.png" alt="img"></p>
<ul>
<li>找到对应的数据库</li>
</ul>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202002/1843708-20200204135845130-1026936053.png" alt="img"></p>
<ul>
<li>下载驱动尝试链接数据库</li>
</ul>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202002/1843708-20200204135851256-512479350.png" alt="img"></p>
<ul>
<li>链接成功后就能找到数据库表了</li>
</ul>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202002/1843708-20200204135858803-1505346103.png" alt="img"></p>
<ul>
<li>一些简单操作（注意：pycharm由于功能太多，所以不能做到面面俱到）</li>
</ul>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202002/1843708-20200204135905802-2078485201.png" alt="img"></p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202002/1843708-20200204135913705-323570701.png" alt="img"></p>
<h2 id="五-Django链接数据库"><a href="#五-Django链接数据库" class="headerlink" title="五.Django链接数据库"></a>五.Django链接数据库</h2><ul>
<li>先去配置文件中配置相关参数</li>
</ul>
<p>在settings中找到下面这个配置信息，进行修改</p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202002/1843708-20200204135922691-1432970650.png" alt="img"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">DATABASES &#x3D; &#123;</span><br><span class="line">    &#39;default&#39;: &#123;</span><br><span class="line">        &#39;ENGINE&#39;: &#39;django.db.backends.mysql&#39;,  # 数据库类别</span><br><span class="line">        &#39;NAME&#39;: &#39;day49&#39;,  # 库的名字</span><br><span class="line">        &#39;HOST&#39;: &#39;127.0.0.1&#39;,</span><br><span class="line">        &#39;PORT&#39;: 3306,</span><br><span class="line">        &#39;USER&#39;: &#39;root&#39;,</span><br><span class="line">        &#39;PASSWORD&#39;: &#39;123&#39;,</span><br><span class="line">        &#39;CHARSET&#39;: &#39;utf8&#39;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>下面的错误表示Djiango使用的是mysqldb这个模块，这个版本是不兼容的，需要切换成pymysql模块</strong></p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202002/1843708-20200204135931009-387281956.png" alt="img"></p>
<ul>
<li>在项目名或者应用名下面的__ init __.py文件中告诉django使用pymysql链接数据库而不是用默认的mysqldb</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import pymysql</span><br><span class="line">pymysql.install_as_MYSQLdb()</span><br></pre></td></tr></table></figure>

<h2 id="六-django中的ORM"><a href="#六-django中的ORM" class="headerlink" title="六.django中的ORM"></a>六.django中的ORM</h2><p>注意：django不能自动创建库，需要自己手动创建，但是可以自动创建表</p>
<p>orm对应关系如下</p>
<table>
<thead>
<tr>
<th align="center">类名</th>
<th align="center">表名</th>
</tr>
</thead>
<tbody><tr>
<td align="center">属性名</td>
<td align="center">字段值</td>
</tr>
<tr>
<td align="center">对象</td>
<td align="center">记录</td>
</tr>
</tbody></table>
<p>作用:能够让一个不会数据库操作的小白也能够通过Python面向对象语法 句点符来简单快捷的操作数据</p>
<ul>
<li>首先需要先去对应的应用下的models.py中书写你的模型类</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">class User(models.Model):</span><br><span class="line">        # id int primary key auto_increment</span><br><span class="line">        id &#x3D; models.AutoField(primary_key&#x3D;True)</span><br><span class="line">        # name varchar(32)</span><br><span class="line">        name &#x3D; models.CharField(max_length&#x3D;32)</span><br><span class="line">        # password int</span><br><span class="line">        password &#x3D; models.IntegerField()</span><br></pre></td></tr></table></figure>

<ul>
<li>执行数据库迁移命令(就是将models.py中建立的类同步到数据库中)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.python3 manage.py makemigrations  # 仅仅是将你对数据库的改动记录到某个小本本上(migrations文件夹)</span><br><span class="line"></span><br><span class="line">2.python3 manage.py migrate  # 将改动真正的同步到数据库中</span><br></pre></td></tr></table></figure>

<ul>
<li>执行第一步会产生下面的效果</li>
</ul>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202002/1843708-20200204140025505-1942172736.png" alt="img"></p>
<ul>
<li>执行第二步之后</li>
</ul>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202002/1843708-20200204140033161-1078043982.png" alt="img"> </p>
<p><strong>补充知识点：</strong></p>
<ul>
<li>快捷命令输入</li>
</ul>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202002/1843708-20200204140042541-113136339.png" alt="img"> </p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202002/1843708-20200204140047600-333526206.png" alt="img"></p>
<ul>
<li>如果主键名为id，可以不设置，django默认设置主键，如果设置了，以自定义的id为主键</li>
</ul>
<h2 id="七-如何在django中进行数据库字段的增删改查"><a href="#七-如何在django中进行数据库字段的增删改查" class="headerlink" title="七.如何在django中进行数据库字段的增删改查"></a>七.如何在django中进行数据库字段的增删改查</h2><ul>
<li>字段的增</li>
</ul>
<p>可以直接在models.py中进行字段的增，但是注意有两种方式（因为数据库中可能已经存入各种数据了，新添加一个字段，那些已经有数据的字段需要进行修改）</p>
<p>第一种是设置默认值，例如</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">email &#x3D; models.EmailField(default&#x3D;&#39;123@qq.com&#39;)</span><br></pre></td></tr></table></figure>

<p>第二种是允许新设置的字段可以为空，例如(CharField需要设置max_length)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hobby &#x3D; models.CharField(null&#x3D;True,max_length&#x3D;32)</span><br></pre></td></tr></table></figure>

<ul>
<li>字段的查改删都可以通过直接操作models.py文件中的类属性</li>
</ul>
<p>唯一需要注意的就是凡是涉及到字段的操作都需要进行数据库迁移命令，否则操作无效</p>
<h2 id="八-如何在django中进行数据库记录的增删改查"><a href="#八-如何在django中进行数据库记录的增删改查" class="headerlink" title="八.如何在django中进行数据库记录的增删改查"></a>八.如何在django中进行数据库记录的增删改查</h2><ul>
<li>查</li>
</ul>
<p>第一步，在需要进行数据库信息查询的文件中导入models文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">from app01 import models</span><br></pre></td></tr></table></figure>

<p>第二步，通过filter的方法可以拿到所需要的数据列表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">res &#x3D; models.User.objects.filter(name&#x3D;username)  # 该方法返回的结果你可以看成是一个列表套数据对象的形式，其中User表示表名，name表示字段名，后一个username是前端返回来的数据，即查询条件</span><br><span class="line">print(res) # &lt;QuerySet [&lt;User: User object&gt;]&gt;</span><br></pre></td></tr></table></figure>

<p>第三步，该数据列表支持索引取值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">user_obj &#x3D; res[0]  # QuerySet支持索引取值但是不支持负数 并且也不推荐直接索引取值</span><br><span class="line">user_obj &#x3D; res.first() # 索引和first（）这两种方法都可以</span><br><span class="line"># print(user_obj.name,user_obj.password)</span><br></pre></td></tr></table></figure>

<p>补充：当查询条件不存在的时候，是一个queryset[]空列表，不会报错</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">filter括号内直接放多个关键字参数 并且多个关键字参数之间是and关系</span><br><span class="line">res &#x3D; models.User.objects.filter(username&#x3D;&#39;jason&#39;,password&#x3D;&#39;123&#39;)  # select * from user where username&#x3D;&#39;jason&#39; and password&#x3D;&#39;123&#39;;</span><br></pre></td></tr></table></figure>

<ul>
<li>查所有数据</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1.filter() 括号内不写拿所有</span><br><span class="line">&lt;QuerySet [&lt;User: jason&gt;, &lt;User: egon&gt;, &lt;User: sean&gt;, &lt;User: admin&gt;]&gt;</span><br><span class="line"></span><br><span class="line">2.all() 查询所有数据</span><br><span class="line">&lt;QuerySet [&lt;User: jason&gt;, &lt;User: egon&gt;, &lt;User: sean&gt;, &lt;User: admin&gt;]&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>增</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1.create()</span><br><span class="line">    user_obj &#x3D; models.User.objects.create(name&#x3D;username,password&#x3D;password)</span><br><span class="line">    print(user_obj,user_obj.name)</span><br><span class="line">    # 该方法有返回值 返回值就是当前被创建的对象本身</span><br><span class="line">2.对象的绑定方法</span><br><span class="line">    # 1 先生成一个User对象</span><br><span class="line">    user_obj &#x3D; models.User(name&#x3D;username,password&#x3D;password)</span><br><span class="line">    # 2 调用对象的绑定方法</span><br><span class="line">    user_obj.save()</span><br></pre></td></tr></table></figure>

<ul>
<li>删</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># 简单的删除逻辑</span><br><span class="line"># 用户通过点击删除键就能删除数据，需要获取指定数据的id，通过这个id来操作数据的删除</span><br><span class="line">第一步：在前端删除键上可以绑定数据的id，这样发送get请求就会带上id</span><br><span class="line"></span><br><span class="line"> &lt;a href&#x3D;&quot;&#x2F;delete_user&#x2F;?delete_id&#x3D;&#123;&#123; user_obj.id &#125;&#125;&quot; class&#x3D;&quot;btn btn-danger btn-xs&quot;&gt;删除&lt;&#x2F;a&gt;</span><br><span class="line">    </span><br><span class="line">第二步：后端通过id来获取数据</span><br><span class="line"></span><br><span class="line">def del_user(request):</span><br><span class="line">    # 如何获取用户想逃删除的数据id</span><br><span class="line">    delete_id &#x3D; request.GET.get(&quot;delete_id&quot;)</span><br><span class="line">    # 直接根据id删除数据</span><br><span class="line">    models.User.objects.filter(id&#x3D;delete_id).delete()  # 将filter过滤出来的数据全部删除</span><br><span class="line">    # 重定向到展示页</span><br><span class="line">    return redirect(&#39;&#x2F;home&#x2F;&#39;)</span><br></pre></td></tr></table></figure>

<ul>
<li>改</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">改和删前面基本一致</span><br><span class="line">后面有两种方法</span><br><span class="line">def edit_user(request):</span><br><span class="line">    # 获取用户想要修改的数据id值</span><br><span class="line">    edit_id &#x3D; request.GET.get(&#39;edit_id&#39;)</span><br><span class="line">    if request.method &#x3D;&#x3D; &#39;POST&#39;:</span><br><span class="line">        # 获取用户修改之后的用户名和密码</span><br><span class="line">        username &#x3D; request.POST.get(&#39;username&#39;)</span><br><span class="line">        password &#x3D; request.POST.get(&#39;password&#39;)</span><br><span class="line">        # 修改数据</span><br><span class="line">        # 方式1(推荐)</span><br><span class="line">        # models.User.objects.filter(id&#x3D;edit_id).update(name&#x3D;username,password&#x3D;password)</span><br><span class="line">        # 方式2(了解)</span><br><span class="line">        # 1 先获取数据对象</span><br><span class="line">        edit_obj &#x3D; models.User.objects.filter(id&#x3D;edit_id).first()</span><br><span class="line">        # 2 再修改对象属性</span><br><span class="line">        edit_obj.name &#x3D; username</span><br><span class="line">        edit_obj.password &#x3D; password</span><br><span class="line">        # 3 调用对象的绑定方法保存</span><br><span class="line">        edit_obj.save()</span><br><span class="line">        # 再次跳转到数据展示页</span><br><span class="line">        return redirect(&#39;&#x2F;home&#x2F;&#39;)</span><br><span class="line">    # 根据id获取数据对象 并且展示到html页面上</span><br><span class="line">    edit_obj &#x3D; models.User.objects.filter(id&#x3D;edit_id).first()</span><br><span class="line"></span><br><span class="line">    return render(request,&#39;edit_user.html&#39;,&#123;&#39;edit_obj&#39;:edit_obj&#125;)</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/12/09/Django%E6%A1%86%E6%9E%B6%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE/" data-id="ckd3ezcw00001t4utgriyhqrj" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Django/" rel="tag">Django</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Django框架简介和安装" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/12/05/Django%E6%A1%86%E6%9E%B6%E7%AE%80%E4%BB%8B%E5%92%8C%E5%AE%89%E8%A3%85/" class="article-date">
  <time datetime="2018-12-05T13:34:33.000Z" itemprop="datePublished">2018-12-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/12/05/Django%E6%A1%86%E6%9E%B6%E7%AE%80%E4%BB%8B%E5%92%8C%E5%AE%89%E8%A3%85/">Django框架简介和安装</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Django框架简介"><a href="#Django框架简介" class="headerlink" title="Django框架简介"></a>Django框架简介</h1><h2 id="1、web框架本质"><a href="#1、web框架本质" class="headerlink" title="1、web框架本质"></a>1、web框架本质</h2><p>所有的Web应用本质就是一个socket服务端，用户使用的浏览器就是socket客户端</p>
<p><strong>软件开发架构：</strong>C/S架构和B/S架构，B/S架构本质也是C/S</p>
<p><strong>1、纯手撸简易版web框架</strong>，实现根据用户输入的后缀不同内容返回不同的结果</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"> <span class="number">1</span> <span class="keyword">import</span> socket</span><br><span class="line"> <span class="number">2</span> </span><br><span class="line"> <span class="number">3</span> server = socket.socket()</span><br><span class="line"> <span class="number">4</span> server.bind((<span class="string">'127.0.0.1'</span>, <span class="number">9876</span>))</span><br><span class="line"> <span class="number">5</span> server.listen(<span class="number">5</span>)</span><br><span class="line"> <span class="number">6</span> </span><br><span class="line"> <span class="number">7</span> </span><br><span class="line"> <span class="number">8</span> <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line"> <span class="number">9</span>     conn, addr = server.accept()</span><br><span class="line"><span class="number">10</span>     data = conn.recv(<span class="number">1024</span>)</span><br><span class="line"><span class="number">11</span>     <span class="comment"># Http协议的响应信息,HTTP/1.1表示当前协议为Http。1.1是协议的版本。200表示成功， OK表示好的</span></span><br><span class="line"><span class="number">12</span>     conn.send(<span class="string">b'HTTP/1.1 200 OK\r\n\r\n'</span>)</span><br><span class="line"><span class="number">13</span>     <span class="comment"># print(data)</span></span><br><span class="line"><span class="number">14</span>     data = data.decode(<span class="string">'utf8'</span>)  <span class="comment"># 返回的是一串字符串，第二个字符串就是用户输入的后缀</span></span><br><span class="line"><span class="number">15</span>     <span class="comment"># 获取用户输入的后缀内容</span></span><br><span class="line"><span class="number">16</span>     target_url = data.split(<span class="string">'\r\n'</span>)[<span class="number">0</span>].split(<span class="string">' '</span>)[<span class="number">1</span>]</span><br><span class="line"><span class="number">17</span>     <span class="comment"># 判断用户输入的内容返回不同的内容</span></span><br><span class="line"><span class="number">18</span>     <span class="keyword">if</span> target_url == <span class="string">'index'</span>:</span><br><span class="line"><span class="number">19</span>         conn.send(<span class="string">b'index'</span>)</span><br><span class="line"><span class="number">20</span>     <span class="keyword">elif</span> target_url == <span class="string">'login'</span>:</span><br><span class="line"><span class="number">21</span>         conn.send(<span class="string">b'login'</span>)</span><br><span class="line"><span class="number">22</span>     <span class="keyword">else</span>:</span><br><span class="line"><span class="number">23</span>         conn.send(<span class="string">b'404 error'</span>)</span><br><span class="line"><span class="number">24</span>     conn.close()</span><br></pre></td></tr></table></figure>

<p>由于socket代码是我们自己写的，HTTP数据也是我们自己处理的太过麻烦，所以有了<strong>wsgiref模块</strong></p>
<p><strong>2、wsgiref模块</strong></p>
<p>wsgiref模块可以帮我们封装我们写的web框架中的socket server部分</p>
<p>根据功能不同拆分成不同的文件：</p>
<p>urls.py：路由与视图函数的对应关系</p>
<p>views.py：里面就是存放一堆视图函数（视图函数可以是函数也可以是类）</p>
<p>templates文件夹（模板文件夹）：里面放一堆HTML文件</p>
<p>用户在浏览器窗口输入url之所以能获取相应的资源是因为后端早已经开设相应的资源接口</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"> <span class="number">1</span> <span class="keyword">from</span> wsgiref.simple_server <span class="keyword">import</span> make_server</span><br><span class="line"> <span class="number">2</span> <span class="keyword">from</span> urls <span class="keyword">import</span> urls</span><br><span class="line"> <span class="number">3</span> <span class="keyword">from</span> views <span class="keyword">import</span> *</span><br><span class="line"> <span class="number">4</span> </span><br><span class="line"> <span class="number">5</span> </span><br><span class="line"> <span class="number">6</span> <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(env, response)</span>:</span></span><br><span class="line"> <span class="number">7</span>     <span class="string">'''</span></span><br><span class="line"><span class="string"> 8     :param env: 请求相关的所有数据，接收的是大字典，里面的PATH_INFO参数就是用户输入的url后缀</span></span><br><span class="line"><span class="string"> 9     :param response: 响应相关的所有数据</span></span><br><span class="line"><span class="string">10     :return: 返回浏览器接收的内容</span></span><br><span class="line"><span class="string">11     '''</span></span><br><span class="line"><span class="number">12</span>     response(<span class="string">'200 OK'</span>, [])</span><br><span class="line"><span class="number">13</span>     target_url = env.get(<span class="string">'PATH_INFO'</span>)</span><br><span class="line"><span class="number">14</span>     <span class="comment"># 此处应该根据用户输入进行逻辑判断，为减少代码用for循环实现</span></span><br><span class="line"><span class="number">15</span>     <span class="comment"># 先定义一个变量存储可能匹配的函数名</span></span><br><span class="line"><span class="number">16</span>     func = <span class="literal">None</span></span><br><span class="line"><span class="number">17</span>     <span class="keyword">for</span> url <span class="keyword">in</span> urls:</span><br><span class="line"><span class="number">18</span>         <span class="comment"># 判断用户输入的是否与urls一致</span></span><br><span class="line"><span class="number">19</span>         <span class="keyword">if</span> target_url == url[<span class="number">0</span>]:</span><br><span class="line"><span class="number">20</span>             func = url[<span class="number">1</span>]</span><br><span class="line"><span class="number">21</span>             <span class="comment"># 一旦有响应就立刻结束，调转到响应url</span></span><br><span class="line"><span class="number">22</span>             <span class="keyword">break</span></span><br><span class="line"><span class="number">23</span>     <span class="comment"># 判断是否有匹配上的</span></span><br><span class="line"><span class="number">24</span>     <span class="keyword">if</span> func:</span><br><span class="line"><span class="number">25</span>         <span class="comment"># 加括号调用</span></span><br><span class="line"><span class="number">26</span>         res = func(env)</span><br><span class="line"><span class="number">27</span>     <span class="keyword">else</span>:</span><br><span class="line"><span class="number">28</span>         res = error(env)</span><br><span class="line"><span class="number">29</span>     <span class="keyword">return</span> [res.encode(<span class="string">'utf-8'</span>)]</span><br><span class="line"><span class="number">30</span> </span><br><span class="line"><span class="number">31</span> </span><br><span class="line"><span class="number">32</span> <span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line"><span class="number">33</span>     <span class="comment"># 监听'127.0.0.1:9876'一旦有访问就调用run执行</span></span><br><span class="line"><span class="number">34</span>     server = make_server(<span class="string">'127.0.0.1'</span>, <span class="number">9876</span>, run)</span><br><span class="line"><span class="number">35</span>     <span class="comment"># 启动服务端</span></span><br><span class="line"><span class="number">36</span>     server.serve_forever()</span><br></pre></td></tr></table></figure>

<p>基于wsgiref模块已经文件拆分的特点，在后端开设相应的资源接口1. 先在urls文件中写url与函数对应的关系。2. 再去views文件中写对应的函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> <span class="keyword">from</span> views <span class="keyword">import</span> *</span><br><span class="line"><span class="number">2</span> urls = [</span><br><span class="line"><span class="number">3</span>     (<span class="string">'/index'</span>, index),</span><br><span class="line"><span class="number">4</span>     (<span class="string">'/login'</span>, login),</span><br><span class="line"><span class="number">5</span>     (<span class="string">'/get_time'</span>, get_time),</span><br><span class="line"><span class="number">6</span> ]</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(env)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'index'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">(env)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'login'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">error</span><span class="params">(env)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'404 error'</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> <span class="comment"># 需要返回一个HTML页面能实时获取时间的</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">import</span> time</span><br><span class="line"><span class="number">3</span> <span class="function"><span class="keyword">def</span> <span class="title">get_time</span><span class="params">(env)</span>:</span></span><br><span class="line"><span class="number">4</span>     current_time = time.strftime(<span class="string">'%Y-%m-%d %X'</span>)</span><br><span class="line"><span class="number">5</span>     <span class="keyword">with</span> open(<span class="string">r'E:\Python\templates\get_time.html'</span>,<span class="string">'r'</span>,encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:</span><br><span class="line"><span class="number">6</span>         data = f.read()</span><br><span class="line"><span class="number">7</span>     <span class="comment"># 将HTML中的文本xxx替换成当前时间</span></span><br><span class="line"><span class="number">8</span>     data = data.replace(<span class="string">'xxx'</span>,current_time)</span><br><span class="line"><span class="number">9</span>     <span class="keyword">return</span> data</span><br></pre></td></tr></table></figure>

<p><strong>动静态网页：</strong>静态网页：数据是写死的，不变的</p>
<p>动态网页：数据是动态获取的，比如获取当前时间，从数据库中获取数据</p>
<p><strong>3、jinja2模块</strong></p>
<p>提供了一个可以在HTML页面上书写类似于python后端的代码，来操作数据（模板语法）</p>
<p><strong>下载：</strong>pip3 install jinja2</p>
<p>flask框架模板语法使用的就是jinja2模块，所有下载了flask框架就自动下载了jinja2模块</p>
<p>jinja2模板语法非常贴近python语法，但是并不是所有的框架使用的都是jinja2模板语法</p>
<p>模板语法：在HTML中使用类似于python语法，本质在后端实现的，前端根本不识别</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> <span class="keyword">from</span> jinja2 <span class="keyword">import</span> Template</span><br><span class="line"><span class="number">2</span> <span class="function"><span class="keyword">def</span> <span class="title">get_info</span><span class="params">(env)</span>:</span></span><br><span class="line"><span class="number">3</span>     user_dic = &#123;<span class="string">'username'</span>: <span class="string">'shen'</span>, <span class="string">'password'</span>: <span class="number">123</span>, <span class="string">'hobby'</span>: [<span class="string">'study'</span>,<span class="string">'read'</span>]&#125;</span><br><span class="line"><span class="number">4</span>     <span class="keyword">with</span> open(<span class="string">r'E:\Python\templates\get_info.html'</span>,<span class="string">'r'</span>, encoding=<span class="string">'utf8'</span>) <span class="keyword">as</span> f:</span><br><span class="line"><span class="number">5</span>         data = f.read()</span><br><span class="line"><span class="number">6</span>     temp = Template(data)</span><br><span class="line"><span class="number">7</span>     res = temp.render(xxx=user_dic)</span><br><span class="line"><span class="number">8</span>     <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> <span class="number">1</span> &#123;&#123;xxx&#125;&#125;</span><br><span class="line"> 2     &lt;p&gt;&#123;&#123;xxx.username&#125;&#125;&lt;/p&gt;</span><br><span class="line"> 3     &lt;p&gt;&#123;&#123;xxx['password']&#125;&#125;&lt;/p&gt;</span><br><span class="line"> 4     &lt;p&gt;&#123;&#123;xxx.get('hobby')&#125;&#125;&lt;/p&gt;</span><br><span class="line"> 5     &lt;p&gt;&#123;&#123;xxx.get('hobby')[0]&#125;&#125;&lt;/p&gt;</span><br><span class="line"> 6     &lt;p&gt;&#123;&#123;xxx.get('hobby').1&#125;&#125;&lt;/p&gt;</span><br><span class="line"> <span class="number">7</span>     </span><br><span class="line"> <span class="number">8</span>     &#123;%<span class="keyword">for</span> user_dict <span class="keyword">in</span> xxx %&#125;</span><br><span class="line"> <span class="number">9</span>         &lt;tr&gt;</span><br><span class="line">10             &lt;td&gt;&#123;&#123; user_dict.password &#125;&#125;&lt;/td&gt;</span><br><span class="line">11             &lt;td&gt;&#123;&#123; user_dict.username &#125;&#125;&lt;/td&gt;</span><br><span class="line">12             &lt;td&gt;&#123;&#123; user_dict.hobby &#125;&#125;&lt;/td&gt;</span><br><span class="line">13         &lt;/tr&gt;</span><br><span class="line"><span class="number">14</span>     &#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>

<p><strong>4、获取数据库中的数据展示到前端页面</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">1、路由与视图函数对应关系</span><br><span class="line"></span><br><span class="line">2、视图函数</span><br><span class="line"></span><br><span class="line">3、模板文件夹</span><br><span class="line"></span><br><span class="line">4、模板语法（是在后端实现的，前端根本不识别）</span><br><span class="line"></span><br><span class="line">&#123;&#123;&#125;&#125; :和变量有关</span><br><span class="line"></span><br><span class="line">&#123;% %&#125;:和逻辑有关，for循环等</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_user</span><span class="params">(env)</span>:</span></span><br><span class="line">    conn = pymysql.connect(</span><br><span class="line">        host=<span class="string">'127.0.0.1'</span>,</span><br><span class="line">        port=<span class="number">3306</span>,</span><br><span class="line">        database=<span class="string">'dome'</span>,</span><br><span class="line">        charset=<span class="string">'utf8'</span>,</span><br><span class="line">        user=<span class="string">'root'</span>,</span><br><span class="line">        password=<span class="string">'2694'</span>,</span><br><span class="line">        autocommit=<span class="literal">True</span></span><br><span class="line">    )</span><br><span class="line">    cursor = conn.cursor(pymysql.cursors.DictCursor)</span><br><span class="line">    sql = <span class="string">'select * from user_info'</span></span><br><span class="line">    cursor.execute(sql)</span><br><span class="line">    data = cursor.fetchall()</span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">r'E:\Python\templates\get_user.html'</span>,<span class="string">'r'</span>,encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        res = f.read()</span><br><span class="line">    tmp = Template(res)</span><br><span class="line">    res = tmp.render(xxx=data)</span><br><span class="line">    <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-md-8 col-md-offset-2"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">"table table-hover table-bordered"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">th</span>&gt;</span>id<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">th</span>&gt;</span>username<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">th</span>&gt;</span>password<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">th</span>&gt;</span>hobby<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">                    &#123;%for user_dic in xxx %&#125;</span><br><span class="line">                        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; user_dic.id &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; user_dic.username &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; user_dic.password &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; user_dic.hobby &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">                    &#123;% endfor %&#125;</span><br><span class="line">                <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="2、python三大主流web框架"><a href="#2、python三大主流web框架" class="headerlink" title="2、python三大主流web框架"></a>2、python三大主流web框架</h2><h3 id="1、Django"><a href="#1、Django" class="headerlink" title="1、Django"></a>1、Django</h3><p>优点：大而全，自身携带的组件和功能特别多</p>
<p>缺点：笨重，当功能不多时不需要使用很多其他的功能</p>
<h3 id="2、flask"><a href="#2、flask" class="headerlink" title="2、flask"></a>2、flask</h3><p>优点：小而精，自身携带的组件和功能特别少，但是第三方支持该框架的模块特别特别多，叠加起来甚至可以超过Django</p>
<p>缺点：受限于第三方模块</p>
<h3 id="3、tornado"><a href="#3、tornado" class="headerlink" title="3、tornado"></a>3、tornado</h3><p>异步非阻塞，天然支持高并发，甚至可以开发游戏服务器</p>
<p>这三种框架基本都遵循下面三个步骤</p>
<p>A:socket<br>B:路由分发<br>C:模板渲染<br>　　　　　　django<br>　　　　　　　　A:用的别人的 wsgiref<br>　　　　　　　　B:自己写的<br>　　　　　　　　C:自己写的</p>
<p>　　　　　　flask<br>　　　　　　　　A:用的被人的 werkzeug<br>　　　　　　　　B:自己写的<br>　　　　　　　　C:用的别人的 jinja2</p>
<p>　　　　　　tornado<br>　　　　　　　　A，B，C都是自己的</p>
<h2 id="3、Django框架"><a href="#3、Django框架" class="headerlink" title="3、Django框架"></a>3、Django框架</h2><h3 id="1、注意事项"><a href="#1、注意事项" class="headerlink" title="1、注意事项"></a>1、注意事项</h3><ul>
<li>计算机名称不能有中文</li>
<li>项目文件名也不能有中文</li>
<li>一个pycharm窗口就是单独的完整的项目</li>
<li>python解释器的版本最好是3.6的，3.7版本会报错，下面有解决方法演示</li>
</ul>
<h3 id="2、版本"><a href="#2、版本" class="headerlink" title="2、版本"></a>2、版本</h3><p>1.xx版本与2.xx版本</p>
<p>推荐使用1.11.09~1.11.13</p>
<p>如果已经安装不需要手动卸载，重新安装会自动先卸载之前的版本再安装</p>
<p>下载版本图如下：</p>
<p><img src="https://img2018.cnblogs.com/common/1843708/202001/1843708-20200104002549939-1971578748.png" alt="img"></p>
<p><strong>两种下载方式</strong></p>
<ul>
<li>第一种方式</li>
</ul>
<p>通过从cmd输入命令行pip install django == 1.11.11</p>
<ul>
<li>第二种方式</li>
</ul>
<p>在pycharm的settings中找到project interpreter选项，在里面添加django1.11.11版本就行</p>
<h3 id="4、测试是否安装成功"><a href="#4、测试是否安装成功" class="headerlink" title="4、测试是否安装成功"></a>4、测试是否安装成功</h3><p>命令行输入django-admin</p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200104002910288-1935152069.png" alt="img"></p>
<h3 id="5、创建Django项目"><a href="#5、创建Django项目" class="headerlink" title="5、创建Django项目"></a>5、创建Django项目</h3><p>创建django项目有两种方式，一种是通过命令行的形式，一种是通过pycharm的方式，下面先介绍命令行形式创建</p>
<h4 id="1）命令行创建django"><a href="#1）命令行创建django" class="headerlink" title="1）命令行创建django"></a>1）命令行创建django</h4><ul>
<li><p>创建django项目</p>
</li>
<li><p>1.通过命令行创建 1.创建django项目 <strong>django-admin startproject mysite(项目名)</strong> 效果:创建一个mysite的文件夹</p>
<p>mysite文件夹下的内容文件 </p>
</li>
<li><p>-mysite </p>
<ul>
<li>　　–<strong>init</strong>.py </li>
<li>–settings.py   #项目配置文件，包括数据库的使用和静态文件的配置 </li>
<li>–urls.py     #路由与视图函数对应的关系（项目的总路由） </li>
<li>–wsgi.py </li>
<li>-manage.py   # django的入口文件</li>
</ul>
</li>
</ul>
<p><strong>注意：</strong>通过命令行创建时如果不在C盘创建，例如在D盘创建，可以通过D:回车来改变根目录，这样创建的项目就在D盘中了</p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200104003040067-470205153.png" alt="img"></p>
<p> <img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200104003056464-101412825.png" alt="img"></p>
<p> <img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200104003108336-324354699.png" alt="img"></p>
<p> 启动django项目</p>
<p><strong>注意：</strong>通过cd mysite先切换到项目目录下</p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200104003145574-430313827.png" alt="img"></p>
<p><strong>启动项目命令行：</strong></p>
<p><strong>python manage.py runserver # django默认的端口号是8000</strong></p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200104003228893-1583592937.png" alt="img"></p>
<p><strong>注意：版本不兼容可能会出现一下错误</strong></p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200104003302186-15176844.png" alt="img"></p>
<p> 修改方法</p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200104003322276-1594059379.png" alt="img"></p>
<ul>
<li><p>尝试访问一次</p>
<p>将ip地址和断口号填写到浏览器就能够第一次访问django框架展示的欢迎页面</p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200104003434324-436108267.png" alt="img"></p>
</li>
<li><p>开始创建具有独立功能的app</p>
<p><strong>创建app的命令行</strong></p>
<p><strong>python manage.py startapp app01</strong></p>
<p>app01  </p>
</li>
<li><p>–migrations   文件夹 数据库改动记录（日志）</p>
</li>
<li><p>​      —-<strong>init</strong>.py</p>
</li>
<li><p>–<strong>init</strong>.py</p>
</li>
<li><p>–admin.py   django后台管理</p>
</li>
<li><p>–apps.py    注册app相关</p>
</li>
<li><p>–models.py   模型类(ORM)</p>
</li>
<li><p>–tests.py     测试文件（写一些测试代码）</p>
</li>
<li><p>–views.py    视图函数(<strong><em>\</em></strong>)</p>
</li>
</ul>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200104003711708-1350482172.png" alt="img"></p>
<p> <img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200104003726519-1706850418.png" alt="img"></p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200104003730506-2004988885.png" alt="img"></p>
<p>通过在8000端口后面加上/admin回车可以访问admin界面</p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200104003804200-87188063.png" alt="img"></p>
<p>解释：什么叫app</p>
<p>app指的是application(应用)，不是我们手机上所使用的那种app，django其实是一个专注于开发app的web框架，一个空的django项目就类似于是一所大学，app就类似于大学里面的各个学院，每个app其实就类似于不同的功能模块 例如一个购物网站，里面有不同的比如用户模块，订单相关的模块，投诉相关的模块，每个功能模块就有一个与之相关的app，不同的模块推荐使用不同的app去开发，并且django支持多app</p>
<p>注意：1.app命名应该做到见名知意(若实在是一时想不起名字可以用数字代替一下)</p>
<p>2.刚才启动的时候文件夹会多一个db.sqlite3的小数据库</p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200104003826237-919442335.png" alt="img"></p>
<h4 id="2）pycharm创建django"><a href="#2）pycharm创建django" class="headerlink" title="2）pycharm创建django"></a>2）pycharm创建django</h4><p>第一步：打开pycharm，进行创建<img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200104003917311-1131960917.png" alt="img"></p>
<p> 不要选择虚拟环境</p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200104003928491-1074359922.png" alt="img"></p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200104004000526-1155275885.png" alt="img"></p>
<p> 在刚才修改文件路径名之后成功创建项目<img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200104004029658-660785568.png" alt="img"></p>
<p>第二步：启动项目</p>
<p>在控制台输入python manage.py runserver即可启动，也可以通过快捷方式点击</p>
<p>python manage.py runserver host：post 这样可以指定ip和端口，不写默认本地和8000端口</p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200104004053072-2036981515.png" alt="img"></p>
<p> <img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200104004105131-972120030.png" alt="img"></p>
<p> 补充：若开启多个项目发现端口不够用或者无法找到那个快捷启动按钮，可以通过下面这个方法来解决<img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200104004131347-1436438719.png" alt="img"></p>
<p> 修改端口号<img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200104004149961-1337181819.png" alt="img"></p>
<p> 添加快捷启动服务<img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200104004234939-927139874.png" alt="img"></p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200104004247811-893053592.png" alt="img"></p>
<p> 简化命令行命令</p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200104004319509-370517111.png" alt="img"></p>
<p> 例如可以简化命令行创建app<img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200104004339299-1887111957.png" alt="img"></p>
<p> 第三步：修改配置</p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200104004359436-848671848.png" alt="img"></p>
<p> 注册app（创建app后一定要去注册，）<img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200104004418507-1355598684.png" alt="img"></p>
<p> 中间件</p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200104004431179-865797680.png" alt="img"></p>
<p> templates配置问题</p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200104004558986-1004010739.png" alt="img"></p>
<p> 手动添加环境变量</p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200104004621699-823945830.png" alt="img"></p>
<p> 数据库的绑定</p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200104004651558-1941720332.png" alt="img"></p>
<p> <img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200104004706265-1674524839.png" alt="img"></p>
<p><strong>注意：\</strong>命令行创建模式和pycharm创建模式的对比**</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&quot;&quot;&quot;</span><br><span class="line">1.使用命令行创建的django项目是不会自动创建templates摸版本文件夹 你只能自己手动创建</span><br><span class="line">2.命令行创建的django项目不但没有templates文件夹配置文件中也没有填写路径，需要自己手动添加os.path.join(BASE_DIR, &#39;templates&#39;)</span><br><span class="line">而pycharm创建的会自动添加templates文件夹配置文件和路径以及app注册</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure>

<p><strong>容易犯的错误</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.代码修改了始终没有效果</span><br><span class="line">    1.在同一个端口起了多个服务 一直跑的是最开始的那个服务</span><br><span class="line">    2.浏览器缓存问题</span><br></pre></td></tr></table></figure>

<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200104004812045-136250503.png" alt="img"></p>
<h3 id="8、小白必会三板斧"><a href="#8、小白必会三板斧" class="headerlink" title="8、小白必会三板斧"></a>8、小白必会三板斧</h3><p>1.HttpResponse</p>
<p>2.render</p>
<p>3.redirect</p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200104005039446-505749702.png" alt="img"></p>
<p> <img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200104005055622-1326847110.png" alt="img"></p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200104005118690-1338742957.png" alt="img"></p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200104005202338-596677413.png" alt="img"></p>
<p> HttpResponse</p>
<p>　　　　 返回字符串</p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200104005227355-966040618.png" alt="img"></p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200104005249578-1857938280.png" alt="img"></p>
<p> <img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200104005306103-1853226920.png" alt="img"></p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200104005327878-1019827210.png" alt="img"></p>
<p> <img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200104005339388-1356468246.png" alt="img"></p>
<p> <img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200104005347086-5303542.png" alt="img"></p>
<p> render</p>
<p>　　　　 返回html页面 并且可以给html页面传数据</p>
<p>　　　　 模板的渲染(将数据在后端按照模板语法放入html对应的位置)</p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200104005441441-1879747278.png" alt="img"></p>
<p> redirect</p>
<p>重定向</p>
<p>补充：return redirect(‘url’）里面的url可以填写别人的网站全路径，也可以填写自己网站的url后缀名</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/12/05/Django%E6%A1%86%E6%9E%B6%E7%AE%80%E4%BB%8B%E5%92%8C%E5%AE%89%E8%A3%85/" data-id="ckd3ezcwl0008t4utborvflc0" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Django/" rel="tag">Django</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-并发编程基础" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/11/29/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%9F%BA%E7%A1%80/" class="article-date">
  <time datetime="2018-11-28T17:09:46.000Z" itemprop="datePublished">2018-11-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/11/29/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%9F%BA%E7%A1%80/">并发编程基础</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="并发编程"><a href="#并发编程" class="headerlink" title="并发编程"></a>并发编程</h2><h3 id="1-操作系统发展史"><a href="#1-操作系统发展史" class="headerlink" title="1) 操作系统发展史"></a>1) 操作系统发展史</h3><h4 id="1-1-穿孔卡片"><a href="#1-1-穿孔卡片" class="headerlink" title="1.1 穿孔卡片 -"></a>1.1 穿孔卡片 -</h4><ul>
<li>读取数据速度特别慢</li>
<li>CPU的利用率极低</li>
<li>单用户(一份代码)使用</li>
</ul>
<h4 id="1-2-批处理"><a href="#1-2-批处理" class="headerlink" title="1.2 批处理"></a>1.2 批处理</h4><ul>
<li><p>读取数据速度特别慢</p>
</li>
<li><p>CPU的利用率极低</p>
</li>
<li><p>联机（多份代码）使用</p>
</li>
<li><p>效率还是很低</p>
</li>
</ul>
<h4 id="1-3-脱机批处理（现代操作系统的设计原理）"><a href="#1-3-脱机批处理（现代操作系统的设计原理）" class="headerlink" title="1.3 脱机批处理（现代操作系统的设计原理）"></a>1.3 脱机批处理（现代操作系统的设计原理）</h4><ul>
<li>读取数据速度提高</li>
<li>CPU的利用率提高</li>
<li>每次运行期间发出I/O请求后后,高速 的cpu便会处于空闲</li>
</ul>
<h3 id="2-多道技术-基于单核背景下产生的"><a href="#2-多道技术-基于单核背景下产生的" class="headerlink" title="2)多道技术(基于单核背景下产生的)"></a>2)多道技术(基于单核背景下产生的)</h3><h4 id="单道-串行"><a href="#单道-串行" class="headerlink" title="单道:(串行)"></a>单道:(串行)</h4><ul>
<li>比如: a,b程序同时需要使用cpu，会让a程序先使用，b等待a使用完毕后，b才能使用cpu。</li>
</ul>
<h4 id="多道"><a href="#多道" class="headerlink" title="多道:"></a>多道:</h4><ul>
<li>比如: a,b程序需要使用cpu，a先使用，b等待a，直到a进入“IO或执行时间过长” a会（切换 + 保存状态），然后b可以使用cpu，待b执行遇到 “IO或执行时间过长” 再将cpu执行权限交给a，直到两个程序结束。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">多路复用:</span><br><span class="line"><span class="comment"># 空间上的复用（*******）:多个程序使用一个CPU。</span></span><br><span class="line">将内存分为几部分，每个部分放入一个程序，这样，同一时间内存中就有了多道程序</span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">空间上的复用最大的问题是：程序之间的内存必须分割，这种分割需要在硬件层面实现，由操作系统控制。如果内存彼此不分割，则一个程序可以访问另外一个程序的内存，</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">首先丧失的是安全性，比如你的qq程序可以访问操作系统的内存，这意味着你的qq可以拿到操作系统的所有权限。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">其次丧失的是稳定性，某个程序崩溃时有可能把别的程序的内存也给回收了，比方说把操作系统的内存给回收了，则操作系统崩溃。</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">时间上的复用（*******）:即切换 + 保存状态</span><br><span class="line">当一个程序在等待I/O时，另一个程序可以使用cpu，如果内存中可以同时存放足够多的作业，则cpu的利用率可以接近<span class="number">100</span>%，类似于我们小学数学所学的统筹方法。（操作系统采用了多道技术后，可以控制进程的切换，或者说进程之间去争抢cpu的执行权限。这种切换不仅会在一个进程遇到io时进行，一个进程占用cpu时间过长也会切换，或者说被操作系统夺走cpu的执行权限）</span><br><span class="line">    </span><br><span class="line"><span class="number">1</span>) 当执行程序遇到IO时，操作系统会将CPU的执行权限剥夺。</span><br><span class="line">优点: CPU的执行效率提高</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>) 当执行程序执行时间过长时，操作系统会将CPU的执行权限剥夺。    </span><br><span class="line">缺点: 程序的执行效率低</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">    特点：</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">　　（1）多路性。若干个用户同时使用一台计算机。微观上看是各用户轮流使用计算机；宏观上看是各用户并行工作。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">　　（2）交互性。用户可根据系统对请求的响应结果，进一步向系统提出新的请求。这种能使用户与系统进行人机对话的工作方式，明显地有别于批处理系统，因而，分时系统又被称为交互式系统。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">　　（3）独立性。用户之间可以相互独立操作，互不干扰。系统保证各用户程序运行的完整性，不会发生相互混淆或破坏现象。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">　　（4）及时性。系统可对用户的输入及时作出响应。分时系统性能的主要指标之一是响应时间，它是指：从终端发出命令到系统予以应答所需的时间。</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>

<p><img src="https://user-images.githubusercontent.com/57135669/88485351-c6cc7e80-cfa7-11ea-85de-7b83fac73242.png" alt="并1"><br><img src="https://user-images.githubusercontent.com/57135669/88485355-c92ed880-cfa7-11ea-9860-fc5d13052db8.png" alt="并2"></p>
<h4 id="并发与并行-（-）"><a href="#并发与并行-（-）" class="headerlink" title="并发与并行:（***）"></a>并发与并行:（<strong>***</strong>）</h4><p><strong>并发:</strong> 在单核（一个cpu）情况下，当执行两个a,b程序时，a先执行，当a遇到IO时，b开始争抢cpu的执行权限，再让b执行，他们看起像同时运行。</p>
<p><strong>并行:</strong> 在多核（多个cpu）的情况下，当执行两个a,b程序时，a与b同时执行。他们是真正意义上的同时运行。</p>
<p><strong>面试题:</strong> 在单核情况下能否实现并行？ 不行</p>
<h3 id="3-进程"><a href="#3-进程" class="headerlink" title="3) 进程"></a>3) 进程</h3><h4 id="1-什么是进程？"><a href="#1-什么是进程？" class="headerlink" title="1.什么是进程？"></a>1.什么是进程？</h4><p>正在进行的一个过程或者说一个任务。是系统进行资源分配和调度的基本单位，是操作系统结构的基础。</p>
<p>进程是操作系统中最基本、重要的概念。是多道程序系统出现后，为了刻画系统内部出现的动态情况，描述系统内部各道程序的活动规律引进的一个抽象概念,所有多道程序设计操作系统都建立在进程的基础上。</p>
<h4 id="2-进程与程序"><a href="#2-进程与程序" class="headerlink" title="2.进程与程序:"></a>2.进程与程序:</h4><ul>
<li>程序: 一对代码文件。</li>
<li>进程: 执行代码的过程，称之为进程。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 举个例子</span></span><br><span class="line">想象一位tom猫正在给他的宿敌jerry做奶油蛋糕。</span><br><span class="line"></span><br><span class="line">他有做奶油蛋糕的食谱及所需的所有原料:面粉、鸡蛋、奶油等。</span><br><span class="line"></span><br><span class="line">在这个比喻中：</span><br><span class="line"></span><br><span class="line">做蛋糕的食谱就是程序</span><br><span class="line"></span><br><span class="line">tom猫就是处理器(cpu)</span><br><span class="line"></span><br><span class="line">而做蛋糕的各种原料就是输入数据</span><br><span class="line"></span><br><span class="line">进程就是tom阅读食谱、取来各种原料以及烘制蛋糕等一系列动作的总和</span><br><span class="line"></span><br><span class="line">现在假设tom猫的主人站在门外需要tom去开门</span><br><span class="line"></span><br><span class="line">tom想了想，给主人开门的任务比给jerry鼠做蛋糕的任务更重要，于是tom立马先记下照着食谱做到第几步(保存进程的当前状态)，然后跑去给主人开门。这里，我们看到处理机从一个进程(做蛋糕)切换到另一个高优先级的进程(开门)，每个进程拥有各自的程序(食谱和开锁)。开门之后，tom又回来从他离开时的那一步继续做蛋糕</span><br><span class="line"></span><br><span class="line">需要强调的是：同一个程序执行两次，那也是两个进程，比如打开快播，虽然都是同一个软件，但是一个可以播放苍井空,一个可以播放饭岛爱,分别做不同的事情也不会混乱</span><br></pre></td></tr></table></figure>

<h4 id="3-进程调度-了解"><a href="#3-进程调度-了解" class="headerlink" title="3 进程调度: (了解)"></a>3 进程调度: (了解)</h4><ul>
<li><p>先来先服务调度算法(了解)</p>
<p>比如程序 a，b，若a先来，则让a先服务，待a服务完毕后，b再服务。</p>
<p>缺点: 执行效率低。</p>
</li>
<li><p>短作业优先调度算法(了解)</p>
<p>执行时间越短，则先先调度。</p>
<p>缺点: 导致执行时间长的程序，需要等待所有时间短的程序执行完毕后，才能执行。</p>
<p>现代操作系统的进程调度算法: 时间片轮转法 + 多级反馈队列 (知道)</p>
</li>
<li><p>时间片轮转法</p>
</li>
</ul>
<p>时间片轮转(Round Robin，RR)法的基本思路是让每个进程在就绪队列中的等待时间与享受服务的时间成比例。在时间片轮转法中，需要将CPU的处理时间分成固定大小的时间片，例如，几十毫秒至几百毫秒。如果一个进程在被调度选中之后用完了系统规定的时间片，但又未完成要求的任务，则它自行释放自己所占有的CPU而排到就绪队列的末尾，等待下一次调度。同时，进程调度程序又去调度当前就绪队列中的第一个进程。</p>
<p>比如同时有10个程序需要执行，操作系统会给你10秒，然后时间片轮转法会将10秒分成10等分。</p>
<ul>
<li>多级反馈队列:</li>
</ul>
<p>1级队列: 优先级最高，先执行次队列中程序。</p>
<p>2级队列: 优先级以此类推</p>
<p>3级队列:</p>
<ul>
<li><pre><code class="python">前面介绍的各种用作进程调度的算法都有一定的局限性。如短进程优先的调度算法，仅照顾了短进程而忽略了长进程，而且如果并未指明进程的长度，则短进程优先和基于进程长度的抢占式调度算法都将无法使用。
而多级反馈队列调度算法则不必事先知道各种进程所需的执行时间，而且还可以满足各种类型进程的需要，因而它是目前被公认的一种较好的进程调度算法。在采用多级反馈队列调度算法的系统中，调度算法的实施过程如下所述。
(<span class="number">1</span>) 应设置多个就绪队列，并为各个队列赋予不同的优先级。第一个队列的优先级最高，第二个队列次之，其余各队列的优先权逐个降低。该算法赋予各个队列中进程执行时间片的大小也各不相同，在优先权愈高的队列中，为每个进程所规定的执行时间片就愈小。例如，第二个队列的时间片要比第一个队列的时间片长一倍，……，第i+<span class="number">1</span>个队列的时间片要比第i个队列的时间片长一倍。
(<span class="number">2</span>) 当一个新进程进入内存后，首先将它放入第一队列的末尾，按FCFS原则排队等待调度。当轮到该进程执行时，如它能在该时间片内完成，便可准备撤离系统；如果它在一个时间片结束时尚未完成，调度程序便将该进程转入第二队列的末尾，再同样地按FCFS原则等待调度执行；如果它在第二队列中运行一个时间片后仍未完成，再依次将它放入第三队列，……，如此下去，当一个长作业(进程)从第一队列依次降到第n队列后，在第n 队列便采取按时间片轮转的方式运行。

(<span class="number">3</span>) 仅当第一队列空闲时，调度程序才调度第二队列中的进程运行；仅当第<span class="number">1</span>～(i<span class="number">-1</span>)队列均空时，才会调度第i队列中的进程运行。如果处理机正在第i队列中为某进程服务时，又有新进程进入优先权较高的队列(第<span class="number">1</span>～(i<span class="number">-1</span>)中的任何一个队列)，则此时新进程将抢占正在运行进程的处理机，即由调度程序把正在运行的进程放回到第i队列的末尾，把处理机分配给新到的高优先权进程。
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### 4) 同步与异步(*******):</span><br><span class="line"></span><br><span class="line">同步与异步 指的是 “提交任务的方式”。</span><br><span class="line"></span><br><span class="line">同步（串行）: 两个a，b程序都要提交并执行，假如a先提交执行，b必须等a执行完毕后，才能提交任务。</span><br></pre></td></tr></table></figure>
一个任务的完成需要依赖另外一个任务时，只有等待被依赖的任务完成后，依赖的任务才能算完成，这是一种可靠的任务序列。要么成功都成功，失败都失败，两个任务的状态可以保持一致。
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">异步（并发）: 两个a，b程序都要提交并执行，假如a先提交并执行，b无需等a执行完毕，就可以直接提交任务。</span><br></pre></td></tr></table></figure>
不需要等待被依赖的任务完成，只是通知被依赖的任务要完成什么工作，依赖的任务也立即执行，只要自己完成了整个任务就算完成了。至于被依赖的任务最终是否真正完成，依赖它的任务无法确定，所以它是不可靠的任务序列。
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### 5)阻塞与非阻塞(*******):</span><br><span class="line"></span><br><span class="line">- 阻塞（等待）: 凡是遇到IO都会阻塞。</span><br><span class="line"></span><br><span class="line">  IO: input &#x2F;output , time.sleep(3) , 文件的读写 , 数据的传输</span><br><span class="line"></span><br><span class="line">- 非阻塞 (不等待) : 除了IO都是非阻塞 （比如: 从1+1开始计算到100万这种计算过程不是阻塞）</span><br><span class="line"></span><br><span class="line">#### 6) 进程的三种状态（*******）:</span><br><span class="line"></span><br><span class="line">- 就绪态: 同步与异步</span><br><span class="line">- 运行态: 程序的执行时间过长 ----&gt; 将程序返回给就绪态(这是非阻塞)</span><br><span class="line">- 阻塞态: 遇到IO</span><br><span class="line"></span><br><span class="line">![并3](https:&#x2F;&#x2F;user-images.githubusercontent.com&#x2F;57135669&#x2F;88485365-d3e96d80-cfa7-11ea-9ab0-36f3669b1421.png)</span><br><span class="line"></span><br><span class="line">**面试题:** 阻塞与同步是一样的吗？非阻塞与异步是一样的吗？</span><br><span class="line"></span><br><span class="line">答:</span><br><span class="line">IO密集型:这时阻塞与同步是不一样的,</span><br><span class="line">计算密集型:这是阻塞与同步看起来一样,但是本质上仍然不一样</span><br><span class="line">同步与异步:提交任务的方式</span><br><span class="line"></span><br><span class="line">阻塞与非阻塞: 进程的状态。</span><br><span class="line"></span><br><span class="line">异步非阻塞: ----&gt; cpu的利用率最大化!</span><br><span class="line"></span><br><span class="line">#### 7) 创建进程的方式:</span><br><span class="line"></span><br><span class="line">但凡是硬件，都需要有操作系统去管理，只要有操作系统，就有进程的概念，就需要有创建进程的方式，一些操作系统只为一个应用程序设计，比如扫地机器人，一旦启动，所有的进程都已经存在。</span><br><span class="line"></span><br><span class="line">　　而对于通用系统（跑很多应用程序），需要有系统运行过程中创建或撤销进程的能力，主要分为4中形式创建新的进程：</span><br><span class="line"></span><br><span class="line">　　1. 系统初始化（查看进程linux中用ps命令，windows中用任务管理器，前台进程负责与用户交互，后台运行的进程与用户无关，运行在后台并且只在需要时才唤醒的进程，称为守护进程，如电子邮件、web页面、新闻、打印）</span><br><span class="line"></span><br><span class="line">　　2. 一个进程在运行过程中开启了子进程（如nginx开启多进程，os.fork,subprocess.Popen等）</span><br><span class="line"></span><br><span class="line">　　3. 用户的交互式请求，而创建一个新进程（如用户用鼠标双击任意一款软件图片:qq,微信,暴风影音等）</span><br><span class="line"></span><br><span class="line">　　4. 一个批处理作业的初始化（只在大型机的批处理系统中应用）</span><br><span class="line"></span><br><span class="line">　　无论哪一种，新进程的创建都是由一个已经存在的进程执行了一个用于创建进程的系统调用而创建的。　</span><br><span class="line"></span><br><span class="line">##### **multiprocess模块**</span><br><span class="line"></span><br><span class="line">仔细说来，multiprocess不是一个模块而是python中一个操作、管理进程的包。 之所以叫multi是取自multiple的多功能的意思,在这个包中几乎包含了和进程有关的所有子模块。由于提供的子模块非常多，为了方便大家归类记忆，我将这部分大致分为四个部分：创建进程部分，进程同步部分，进程池部分，进程之间数据共享。</span><br><span class="line"></span><br><span class="line">##### **Process类创建进程的两种方式**</span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;python</span><br><span class="line">from multiprocessing import Process</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 方式1: 直接调用Process</span><br><span class="line">def task(name):  # 任务  # name &#x3D;&#x3D; &#39;jason_sb&#39;</span><br><span class="line">    print(f&#39;start...&#123;name&#125;的子进程&#39;)</span><br><span class="line">    time.sleep(3)</span><br><span class="line">    print(f&#39;end...&#123;name&#125;的子进程&#39;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    # target&#x3D;任务(函数地址) ---&gt; 创建一个子进程</span><br><span class="line">    # 异步提交了三个任务</span><br><span class="line">    p_obj1 &#x3D; Process(target&#x3D;task, args&#x3D;(&#39;jason_sb&#39;, ))</span><br><span class="line">    p_obj1.start()  # 告诉操作系统，去创建一个子进程</span><br><span class="line">    p_obj1.join()  # 告诉主进程，等待子进程结束后，再结束</span><br><span class="line"></span><br><span class="line">    p_obj2 &#x3D; Process(target&#x3D;task, args&#x3D;(&#39;sean_sb&#39;, ))</span><br><span class="line">    p_obj2.start()  # 告诉操作系统，去创建一个子进程</span><br><span class="line">    p_obj2.join()  # 告诉主进程，等待子进程结束后，再结束</span><br><span class="line"></span><br><span class="line">    p_obj3 &#x3D; Process(target&#x3D;task, args&#x3D;(&#39;大饼_sb&#39;, ))</span><br><span class="line">    p_obj3.start()  # 告诉操作系统，去创建一个子进程</span><br><span class="line">    p_obj3.join()  # 告诉主进程，等待子进程结束后，再结束</span><br><span class="line"></span><br><span class="line">    print(&#39;正在执行当前主进程...&#39;)</span><br><span class="line"></span><br><span class="line">    list1 &#x3D; []</span><br><span class="line"></span><br><span class="line">    for line in range(10):</span><br><span class="line">        p_obj &#x3D; Process(target&#x3D;task, args&#x3D;(&#39;jason_sb&#39;,))</span><br><span class="line">        p_obj.start()</span><br><span class="line">        list1.append(p_obj)</span><br><span class="line"></span><br><span class="line">    for obj in list1:</span><br><span class="line">        obj.join()</span><br><span class="line"></span><br><span class="line">    print(&#39;主进程&#39;)</span><br><span class="line"># 方式二:</span><br><span class="line">from multiprocessing import Process</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class MyProcess(Process):</span><br><span class="line">    def run(self):</span><br><span class="line">        print(f&#39;start...&#123;self.name&#125;的子进程&#39;)</span><br><span class="line">        time.sleep(3)</span><br><span class="line">        print(f&#39;end...&#123;self.name&#125;的子进程&#39;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    list1 &#x3D; []</span><br><span class="line"></span><br><span class="line">    for line in range(10):</span><br><span class="line">        obj &#x3D; MyProcess()</span><br><span class="line">        obj.start()</span><br><span class="line">        list1.append(obj)</span><br><span class="line"></span><br><span class="line">    for obj in list1:</span><br><span class="line">        obj.join()</span><br><span class="line"></span><br><span class="line">    print(&#39;主进程...&#39;)</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
<p>‘’’<br>强调:在Windows操作系统中由于没有fork(linux操作系统中创建进程的机制)，在创建子进程的时候会自动 import 启动它的这个文件，而在 import 的时候又执行了整个文件。因此如果将process()直接写在文件中就会无限递归创建子进程报错。所以必须把创建子进程的部分使用if <strong>name ==‘</strong>main’ 判断保护起来，import 的时候 ，就不会递归运行了。</p>
<p>‘’’</p>
<h4 id="8-回收进程的两种方式"><a href="#8-回收进程的两种方式" class="headerlink" title="8)回收进程的两种方式"></a>8)回收进程的两种方式</h4><ul>
<li>join让主进程等待子进程结束，并回收子进程资源，主进程再结束并回收资源。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 第一种</span></span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span>  Process</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="comment">#任务</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">task</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'start...'</span>)</span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    print(<span class="string">'end...'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    p = Process(target=task)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 告诉操作系统帮你开启一个新的进程</span></span><br><span class="line">    p.start()</span><br><span class="line">    <span class="comment"># 告诉操作系统等待子进程结束</span></span><br><span class="line">    p.join()</span><br><span class="line"></span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    print(<span class="string">'主进程结束'</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>主进程 “正常结束” ，子进程与主进程一并被回收资源。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 第二种</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string"> 主进程 “正常结束” ，子进程与主进程一并被回收资源。</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span>  Process</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="comment">#任务</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">task</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'start...'</span>)</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    print(<span class="string">'end...'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    p = Process(target=task)</span><br><span class="line">    <span class="comment"># 告诉操作系统帮你开启一个新的进程</span></span><br><span class="line">    p.start()</span><br><span class="line"></span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    print(<span class="string">'主进程结束'</span>)</span><br></pre></td></tr></table></figure>

<h4 id="9-僵尸进程与孤儿进程（了解）"><a href="#9-僵尸进程与孤儿进程（了解）" class="headerlink" title="9)僵尸进程与孤儿进程（了解）"></a>9)僵尸进程与孤儿进程（了解）</h4><ul>
<li><p><strong>僵尸进程 (有坏处):</strong></p>
<p>在子进程结束后，主进程没有正常结束, 子进程PID不会被回收。 <strong>缺点:</strong> 操作系统中的PID号是有限的，如有子进程PID号无法正常回收，则会占用PID号,造成资源浪费,若PID号满了,则无法创建新的进程。</p>
<p>词语解释:PID</p>
<p>进程pID（英语：processID）、PID）是大多数操作系统的内核用于唯一标识进程的一个数值。（简言之，就是进程的绰号。）这一数值可以作为许多函数调用的参数，以使调整进程优先级、kill(命令)进程之类的进程控制行为成为可能。</p>
</li>
<li><p><strong>孤儿进程（没有坏处）</strong>:</p>
<p>在子进程没有结束时，主进程没有“正常结束”, 子进程PID不会被回收。</p>
<p><strong>操作系统优化机制（孤儿院）:</strong> 当主进程意外终止，操作系统会检测是否有正在运行的子进程，会他们放入孤儿院中，让操作系统帮你自动回收。</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">僵尸进程</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在子进程中调用可以拿到子进程对象,.pid可以获取pid号</span></span><br><span class="line"><span class="comment"># 在主进程中调用可以拿到主进程对象,.pid可以获取pid号</span></span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> current_process</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="comment"># current_porcess模块中的current_process().pid和os模块的os.getpid()</span></span><br><span class="line"><span class="comment"># 都可以获取子进程和主进程的pid号</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="comment"># 任务</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">task</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">f'start...<span class="subst">&#123;current_process().pid&#125;</span>'</span>)</span><br><span class="line">    time.sleep(<span class="number">3</span>)</span><br><span class="line">    print(<span class="string">f'end.....<span class="subst">&#123;current_process().pid&#125;</span>'</span>)</span><br><span class="line">    print(<span class="string">'子进程结束了'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    p = Process(target=task)</span><br><span class="line"></span><br><span class="line">    p.start()</span><br><span class="line"></span><br><span class="line">    print(<span class="string">f'进入主进程的IO---&gt;<span class="subst">&#123;current_process().pid&#125;</span>'</span>)</span><br><span class="line"></span><br><span class="line">    print(<span class="string">f'进入主进程的IO---&gt;<span class="subst">&#123;os.getpid()&#125;</span>'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 主进程结束</span></span><br><span class="line">    print(<span class="string">'主进程结束...'</span>)</span><br><span class="line">    print(<span class="string">f'查看主进程<span class="subst">&#123;os.getpid()&#125;</span>'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 为了让主程序异常报错结束</span></span><br><span class="line">    f = open(<span class="string">'tank.txt'</span>)</span><br><span class="line">    print(<span class="string">f'查看主进程<span class="subst">&#123;os.getpid()&#125;</span>'</span>)</span><br></pre></td></tr></table></figure>

<h4 id="10-守护进程"><a href="#10-守护进程" class="headerlink" title="10)守护进程"></a>10)守护进程</h4><p>当主进程结束时，子进程也必须结束，并回收。</p>
<p>主进程创建守护进程</p>
<p>　　其一：守护进程会在主进程代码执行结束后就终止</p>
<p>　　其二：守护进程内无法再开启子进程,否则抛出异常：AssertionError: daemonic processes are not allowed to have children</p>
<p>注意：进程之间是互相独立的，主进程代码运行结束，守护进程随即终止</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Myprocess</span><span class="params">(Process)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,person)</span>:</span></span><br><span class="line">        super().__init__()</span><br><span class="line">        self.person = person</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(os.getpid(),self.name)</span><br><span class="line">        print(<span class="string">'%s正在和女主播聊天'</span> %self.person)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p=Myprocess(<span class="string">'炮王'</span>)</span><br><span class="line">p.daemon=<span class="literal">True</span>  <span class="comment"># 一定要在p.start()前设置,设置p为守护进程,禁止p创建子进程,并且父进程代码执行结束,p即终止运行</span></span><br><span class="line">p.start()</span><br><span class="line">time.sleep(<span class="number">10</span>)  <span class="comment"># 在sleep时查看进程id对应的进程ps -ef|grep id</span></span><br><span class="line">print(<span class="string">'主'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 一个迷惑性的例子</span></span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="number">123</span>)</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    print(<span class="string">"end123"</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bar</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="number">456</span>)</span><br><span class="line">    time.sleep(<span class="number">3</span>)</span><br><span class="line">    print(<span class="string">"end456"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p1=Process(target=foo)</span><br><span class="line">p2=Process(target=bar)</span><br><span class="line"></span><br><span class="line">p1.daemon=<span class="literal">True</span></span><br><span class="line">p1.start()</span><br><span class="line">p2.start()</span><br><span class="line">time.sleep(<span class="number">0.1</span>)</span><br><span class="line">print(<span class="string">"main-------"</span>)<span class="comment">#打印该行则主进程代码结束,则守护进程p1应该被终止.#可能会有p1任务执行的打印信息123,因为主进程打印main----时,p1也执行了,但是随即被终止.</span></span><br></pre></td></tr></table></figure>

<h4 id="11-进程间数据隔离"><a href="#11-进程间数据隔离" class="headerlink" title="11)进程间数据隔离"></a>11)进程间数据隔离</h4><p><strong>进程隔离</strong>是为保护操作系统中进程互不干扰而设计的一组不同硬件和软件的技术</p>
<p>这个技术是为了避免进程A写入进程B的情况发生。 进程的隔离实现，使用了虚拟地址空间。进程A的虚拟地址和进程B的虚拟地址不同，这样就防止进程A将数据信息写入进程B</p>
<p>进程隔离的安全性通过禁止进程间内存的访问可以方便实现</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process</span><br><span class="line">n=<span class="number">100</span> </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">work</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">global</span> n  </span><br><span class="line">    n=<span class="number">0</span></span><br><span class="line">    print(<span class="string">'子进程内: '</span>,n)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    p=Process(target=work)</span><br><span class="line">    p.start()</span><br><span class="line">    print(<span class="string">'主进程内: '</span>,n)</span><br></pre></td></tr></table></figure>

<h4 id="12-进程互斥锁-multiprocess-Lock"><a href="#12-进程互斥锁-multiprocess-Lock" class="headerlink" title="12)进程互斥锁(multiprocess.Lock)"></a>12)进程互斥锁(multiprocess.Lock)</h4><p>进程之间数据不共享,但是共享同一套文件系统,所以访问同一个文件,或同一个打印终端,是没有问题的,</p>
<p>而共享带来的是竞争，竞争带来的结果就是错乱，如何控制，就是加锁处理</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#文件db的内容为：&#123;"count":1&#125;</span></span><br><span class="line"><span class="comment">#注意一定要用双引号，不然json无法识别</span></span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process,Lock</span><br><span class="line"><span class="keyword">import</span> time,json,random</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">search</span><span class="params">()</span>:</span></span><br><span class="line">    dic=json.load(open(<span class="string">'db'</span>))</span><br><span class="line">    print(<span class="string">'\033[43m剩余票数%s\033[0m'</span> %dic[<span class="string">'count'</span>])</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">()</span>:</span></span><br><span class="line">    dic=json.load(open(<span class="string">'db'</span>))</span><br><span class="line">    time.sleep(<span class="number">0.1</span>) <span class="comment">#模拟读数据的网络延迟</span></span><br><span class="line">    <span class="keyword">if</span> dic[<span class="string">'count'</span>] &gt;<span class="number">0</span>:</span><br><span class="line">        dic[<span class="string">'count'</span>]-=<span class="number">1</span></span><br><span class="line">        time.sleep(<span class="number">0.2</span>) <span class="comment">#模拟写数据的网络延迟</span></span><br><span class="line">        json.dump(dic,open(<span class="string">'db'</span>,<span class="string">'w'</span>))</span><br><span class="line">        print(<span class="string">'\033[43m购票成功\033[0m'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">task</span><span class="params">()</span>:</span></span><br><span class="line">    search()</span><br><span class="line">    get()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">100</span>): <span class="comment">#模拟并发100个客户端抢票</span></span><br><span class="line">        p=Process(target=task)</span><br><span class="line">        p.start()</span><br><span class="line"><span class="comment"># 引发问题:数据写入错乱</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">互斥锁保证数据安全</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process,Lock</span><br><span class="line"><span class="keyword">import</span> time,json,random</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">search</span><span class="params">()</span>:</span></span><br><span class="line">    dic=json.load(open(<span class="string">'db'</span>))</span><br><span class="line">    print(<span class="string">'\033[43m剩余票数%s\033[0m'</span> %dic[<span class="string">'count'</span>])</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">()</span>:</span></span><br><span class="line">    dic=json.load(open(<span class="string">'db'</span>))</span><br><span class="line">    time.sleep(random.random())  <span class="comment"># 模拟读数据的网络延迟</span></span><br><span class="line">    <span class="keyword">if</span> dic[<span class="string">'count'</span>] &gt;<span class="number">0</span>:</span><br><span class="line">        dic[<span class="string">'count'</span>]-=<span class="number">1</span></span><br><span class="line">        time.sleep(random.random())  <span class="comment"># 模拟写数据的网络延迟</span></span><br><span class="line">        json.dump(dic,open(<span class="string">'db'</span>,<span class="string">'w'</span>))</span><br><span class="line">        print(<span class="string">'\033[32m购票成功\033[0m'</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">'\033[31m购票失败\033[0m'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">task</span><span class="params">(lock)</span>:</span></span><br><span class="line">    search()</span><br><span class="line">    lock.acquire()  <span class="comment"># 将买票这一环节由并发变成了串行，牺牲了运行效率但是保证了数据的安全</span></span><br><span class="line">    get()</span><br><span class="line">    lock.release()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    lock = Lock()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">100</span>):  <span class="comment"># 模拟并发100个客户端抢票</span></span><br><span class="line">        p=Process(target=task,args=(lock,))</span><br><span class="line">        p.start()</span><br><span class="line">总结:加锁可以保证多个进程修改同一块数据时，同一时间只能有一个任务可以进行修改，即串行的修改，没错，速度是慢了，</span><br><span class="line">    </span><br><span class="line">    但牺牲了速度却保证了数据安全。</span><br><span class="line"></span><br><span class="line">问题:虽然可以用文件共享数据显示进程间数据通信但问题是</span><br><span class="line"></span><br><span class="line">效率低(共享数据基于文件，而文件是硬盘上的数据)</span><br><span class="line">需要自己加锁处理</span><br></pre></td></tr></table></figure>

<h4 id="13-队列"><a href="#13-队列" class="headerlink" title="13)队列:"></a>13)队列:</h4><p>FIFO:先进先出简写，指的就是队列<br>FILO:先进后出，指的就是堆栈</p>
<p>先进先出 进—-》 [3, 2, 1] —-》 出 1, 2, 3 ,先存放的数据，就先取出来。</p>
<p>相当于一个第三方的管道，可以存放数据。</p>
<p>应用: 让进程之间数据进行交互。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">基本用法</span><br><span class="line">Queue([maxsize]) <span class="comment"># 创建共享的进程队列 队列底层使用管道和锁定实现。</span></span><br><span class="line"><span class="comment"># 参数 ：maxsize是队列中允许的最大项数。如果省略此参数，则无大小限制。</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">代码实现</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Queue</span><br><span class="line">q=Queue(<span class="number">3</span>)  <span class="comment"># 创建一个最大只能容纳3个数据的队列</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">常用方法</span></span><br><span class="line"><span class="string">put ,get ,put_nowait,get_nowait,full,empty</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line">q.put(<span class="number">3</span>)  <span class="comment"># 往队列中存放数据</span></span><br><span class="line">q.put(<span class="number">3</span>)</span><br><span class="line">q.put(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">q.put(<span class="number">3</span>)  <span class="comment"># 如果队列已经满了，程序就会停在这里，等待数据被别人取走，再将数据放入队列。如果队列中的数据一直不被取走，程序就会永远停在这里。</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    q.put_nowait(<span class="number">3</span>) <span class="comment"># 可以使用put_nowait，如果队列满了不会阻塞，但是会因为队列满了而报错。</span></span><br><span class="line"><span class="keyword">except</span>:  <span class="comment"># 因此我们可以用一个try语句来处理这个错误。这样程序不会一直阻塞下去，但是会丢掉这个消息。</span></span><br><span class="line">    print(<span class="string">'队列已经满了'</span>)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="comment"># 因此，我们再放入数据之前，可以先看一下队列的状态，如果已经满了，就不继续put了。</span></span><br><span class="line">print(q.full())  <span class="comment"># 判断队列中数据是否已存放满了</span></span><br><span class="line"></span><br><span class="line">print(q.get())  <span class="comment"># 从队列中获取数据</span></span><br><span class="line">print(q.get())</span><br><span class="line">print(q.get())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(q.get()) <span class="comment"># 同put方法一样，如果队列已经空了，那么继续取就会出现阻塞。</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    q.get_nowait(<span class="number">3</span>) <span class="comment"># 可以使用get_nowait，如果队列满了不会阻塞，但是会因为没取到值而报错。</span></span><br><span class="line"><span class="keyword">except</span>: <span class="comment"># 因此我们可以用一个try语句来处理这个错误。这样程序不会一直阻塞下去。</span></span><br><span class="line">    print(<span class="string">'队列已经空了'</span>)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">print(q.empty())  <span class="comment"># 判断队列中数据是否已经被全部取出</span></span><br><span class="line">基于队列实现进程间通信</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process, Queue</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(q)</span>:</span></span><br><span class="line">    q.put(<span class="string">'hello'</span>)  <span class="comment">#调用主函数中p进程传递过来的进程参数 put函数为向队列中添加一条数据。</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    q = Queue()  <span class="comment"># 创建一个Queue对象</span></span><br><span class="line">    p = Process(target=f, args=(q,)) <span class="comment">#创建一个进程</span></span><br><span class="line">    p.start()</span><br><span class="line">    print(q.get())  <span class="comment"># 从队列中获取数据</span></span><br><span class="line">    p.join()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Queue,Process</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">producer</span><span class="params">(q)</span>:</span></span><br><span class="line">    q.put(<span class="string">'hello big baby!'</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">consumer</span><span class="params">(q)</span>:</span></span><br><span class="line">    print(q.get())</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    q = Queue()</span><br><span class="line">    p = Process(target=producer,args=(q,))</span><br><span class="line">    p.start()</span><br><span class="line">    p1 = Process(target=consumer,args=(q,))</span><br><span class="line">    p1.start()</span><br></pre></td></tr></table></figure>

<h4 id="13-IPC机制（进程间实现通信）"><a href="#13-IPC机制（进程间实现通信）" class="headerlink" title="13)IPC机制（进程间实现通信）"></a>13)IPC机制（进程间实现通信）</h4><p>Inter-Process Communication</p>
<p>我们知道进程之间数据是相互隔离的，要想实现进程间的通信(IPC机制),就必须借助于一些技术才可以，比如multiprocessing模块中的：队列和管道，这两种方式都是可以实现进程间数据传输的，由于队列是管道+锁的方式实现，所以我们着重研究队列即可</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> JoinableQueue</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">task1</span><span class="params">(q)</span>:</span></span><br><span class="line">    x = <span class="number">100</span></span><br><span class="line">    q.put(x)</span><br><span class="line">    print(<span class="string">'添加数据'</span>)</span><br><span class="line"></span><br><span class="line">    time.sleep(<span class="number">3</span>)</span><br><span class="line">    print(q.get())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">task2</span><span class="params">(q)</span>:</span></span><br><span class="line">    <span class="comment"># 想要在task2中获取task1的x</span></span><br><span class="line">    res = q.get()</span><br><span class="line">    print(<span class="string">f'获取的数据是<span class="subst">&#123;res&#125;</span>'</span>)</span><br><span class="line">    q.put(<span class="number">9527</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="comment"># 产生队列</span></span><br><span class="line">    q = JoinableQueue(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 产生两个不同的子进程</span></span><br><span class="line">    p1 = Process(target=task1, args=(q, ))</span><br><span class="line">    p2 = Process(target=task2, args=(q, ))</span><br><span class="line"></span><br><span class="line">    p1.start()</span><br><span class="line">    p2.start()</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">基于队列实现进程间通信   </span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process, Queue</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(q)</span>:</span></span><br><span class="line">    q.put(<span class="string">'hello'</span>)  <span class="comment">#调用主函数中p进程传递过来的进程参数 put函数为向队列中添加一条数据。</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    q = Queue()  <span class="comment"># 创建一个Queue对象</span></span><br><span class="line">    p = Process(target=f, args=(q,)) <span class="comment">#创建一个进程</span></span><br><span class="line">    p.start()</span><br><span class="line">    print(q.get())  <span class="comment"># 从队列中获取数据</span></span><br><span class="line">    p.join()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Queue,Process</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">producer</span><span class="params">(q)</span>:</span></span><br><span class="line">    q.put(<span class="string">'hello big baby!'</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">consumer</span><span class="params">(q)</span>:</span></span><br><span class="line">    print(q.get())</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    q = Queue()</span><br><span class="line">    p = Process(target=producer,args=(q,))</span><br><span class="line">    p.start()</span><br><span class="line">    p1 = Process(target=consumer,args=(q,))</span><br><span class="line">    p1.start()</span><br></pre></td></tr></table></figure>

<h4 id="14-生产者消费者模型"><a href="#14-生产者消费者模型" class="headerlink" title="14)生产者消费者模型"></a>14)生产者消费者模型</h4><p><strong>生产者消费者模型</strong></p>
<p>在并发编程中使用生产者和消费者模式能够解决绝大多数并发问题。该模式通过平衡生产线程和消费线程的工作能力来提高程序的整体处理数据的速度。</p>
<p><strong>什么是生产者消费者模式</strong></p>
<p>生产者消费者模式是通过一个容器来解决生产者和消费者的强耦合问题。生产者和消费者彼此之间不直接通讯，而通过阻塞队列来进行通讯，所以生产者生产完数据(做包子的)之后不用等待消费者(吃包子的)处理，直接扔给阻塞队列(盘子)，消费者不找生产者要数据，而是直接从阻塞队列里取，阻塞队列就相当于一个缓冲区，平衡了生产者和消费者的处理能力。</p>
<p><strong>为什么要使用生产者和消费者模式</strong></p>
<p>在线程世界里，生产者就是生产数据的线程，消费者就是消费数据的线程。在多线程开发当中，如果生产者处理速度很快，而消费者处理速度很慢，那么生产者就必须等待消费者处理完，才能继续生产数据。同样的道理，如果消费者的处理能力大于生产者，那么消费者就必须等待生产者。为了解决这个问题于是引入了生产者和消费者模式。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">基于队列实现生产者消费者模型</span><br><span class="line"><span class="comment"># 第一个例子</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process,Queue</span><br><span class="line"><span class="keyword">import</span> time,random,os</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">consumer</span><span class="params">(q)</span>:</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        res=q.get()</span><br><span class="line">        time.sleep(random.randint(<span class="number">1</span>,<span class="number">3</span>))</span><br><span class="line">        print(<span class="string">'%s 吃 %s'</span> %(os.getpid(),res))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">producer</span><span class="params">(q)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">        time.sleep(random.randint(<span class="number">1</span>,<span class="number">3</span>))</span><br><span class="line">        res=<span class="string">'包子%s'</span> %i</span><br><span class="line">        q.put(res)</span><br><span class="line">        print(<span class="string">'%s 生产了 %s'</span> %(os.getpid(),res))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    q=Queue()</span><br><span class="line">    <span class="comment">#生产者们:即厨师们</span></span><br><span class="line">    p1=Process(target=producer,args=(q,))</span><br><span class="line"></span><br><span class="line">    <span class="comment">#消费者们:即吃货们</span></span><br><span class="line">    c1=Process(target=consumer,args=(q,))</span><br><span class="line"></span><br><span class="line">    <span class="comment">#开始</span></span><br><span class="line">    p1.start()</span><br><span class="line">    c1.start()</span><br><span class="line">    print(<span class="string">'主'</span>)</span><br><span class="line">    </span><br><span class="line">   </span><br><span class="line"></span><br><span class="line"><span class="comment"># 第二个例子</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> JoinableQueue</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 生产者: 生产数据 ---》 队列</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">producer</span><span class="params">(name, food, q)</span>:</span></span><br><span class="line">    msg = <span class="string">f'<span class="subst">&#123;name&#125;</span> 生产了 <span class="subst">&#123;food&#125;</span> 食物'</span></span><br><span class="line">    <span class="comment"># 生产一个食物，添加到队列中</span></span><br><span class="line">    q.put(food)</span><br><span class="line">    print(msg)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 消费者: 使用数据 《---  列队</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">customer</span><span class="params">(name, q)</span>:</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            time.sleep(<span class="number">0.5</span>)</span><br><span class="line">            <span class="comment"># 若报错，则跳出循环</span></span><br><span class="line">            food = q.get_nowait()</span><br><span class="line">            msg = <span class="string">f'<span class="subst">&#123;name&#125;</span> 吃了 <span class="subst">&#123;food&#125;</span> 食物!'</span></span><br><span class="line">            print(msg)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    q = JoinableQueue()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 创建两个生产者</span></span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">        p1 = Process(target=producer, args=(<span class="string">'tank1'</span>, <span class="string">f'Pig饲料<span class="subst">&#123;line&#125;</span>'</span>, q))</span><br><span class="line">        p1.start()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 创建两个消费者</span></span><br><span class="line">    c1 = Process(target=customer, args=(<span class="string">'jason'</span>, q))</span><br><span class="line">    c2 = Process(target=customer, args=(<span class="string">'sean'</span>, q))</span><br><span class="line">    c1.start()</span><br><span class="line">    c2.start()</span><br></pre></td></tr></table></figure>

<h3 id="4-线程"><a href="#4-线程" class="headerlink" title="4)线程"></a>4)线程</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">线程:</span><br><span class="line">    <span class="number">1.</span>什么是线程？</span><br><span class="line">        进程: 资源单位。</span><br><span class="line">        线程: 执行单位。</span><br><span class="line"></span><br><span class="line">        线程与进程都是虚拟的概念，为了更好表达某种事物。</span><br><span class="line"></span><br><span class="line">        注意: 开启一个进程，一定会自带一个线程，线程才是真正的执行者。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="number">2.</span>为什么要使用线程？</span><br><span class="line">        节省资源的占用。</span><br><span class="line"></span><br><span class="line">        - 开启进程:</span><br><span class="line">            - <span class="number">1</span>) 会产生一个内存空间，申请一块资源。</span><br><span class="line">            - <span class="number">2</span>) 会自带一个主线程</span><br><span class="line">            - <span class="number">3</span>) 开启子进程的速度要比开启子线程的速度慢</span><br><span class="line"></span><br><span class="line">        - 开启线程</span><br><span class="line">            - <span class="number">1</span>) 一个进程内可以开启多个线程，从进程的内存空间中申请执行单位。</span><br><span class="line">            - <span class="number">2</span>) 节省资源。</span><br><span class="line"></span><br><span class="line">        - 开启三个进程:</span><br><span class="line">            - 占用三份内存资源</span><br><span class="line"></span><br><span class="line">        - 开启三个线程:</span><br><span class="line">            - 从一个内存资源中，申请三个小的执行单位</span><br><span class="line"></span><br><span class="line">        - IO密集型用: 多线程</span><br><span class="line">            - IO(时间由用户定):</span><br><span class="line">                - 阻塞: 切换 + 保存状态</span><br><span class="line"></span><br><span class="line">        - 计算密集型用: 多进程</span><br><span class="line">            - 计算(时间由操作系统定):</span><br><span class="line">                - 计算时间很长 ---&gt; 切换 + 保存状态</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    注意: 进程与进程之间数据是隔离的，线程与线程之间的数据是共享的。</span><br></pre></td></tr></table></figure>

<h4 id="1-什么是线程"><a href="#1-什么是线程" class="headerlink" title="1) 什么是线程"></a>1) 什么是线程</h4><p>在传统操作系统中，每个进程有一个地址空间，而且默认就有一个控制线程</p>
<p>线程顾名思义，就是一条流水线工作的过程，一条流水线必须属于一个车间，一个车间的工作过程是一个进程</p>
<p>车间负责把资源整合到一起，是一个资源单位，而一个车间内至少有一个流水线</p>
<p>流水线的工作需要电源，电源就相当于cpu</p>
<p>所以，<strong>进程只是用来把资源集中到一起（进程只是一个资源单位，或者说资源集合），而线程才是cpu上的执行单位。</strong></p>
<p><strong>多线程（即多个控制线程）</strong>:在一个进程中存在多个控制线程，多个控制线程共享该进程的地址空间，相当于一个车间内有多条流水线，都共用一个车间的资源。</p>
<p>例如，北京地铁与上海地铁是不同的进程，而北京地铁里的13号线是一个线程，北京地铁所有的线路共享北京地铁所有的资源，比如所有的乘客可以被所有线路拉。</p>
<h4 id="2-线程的创建开销小"><a href="#2-线程的创建开销小" class="headerlink" title="2) 线程的创建开销小"></a>2) 线程的创建开销小</h4><p>创建进程的开销要远大于线程？</p>
<p>如果我们的软件是一个工厂，该工厂有多条流水线，流水线工作需要电源，电源只有一个即cpu（单核cpu）</p>
<p>一个车间就是一个进程，一个车间至少一条流水线（一个进程至少一个线程）</p>
<p>创建一个进程，就是创建一个车间（申请空间，在该空间内建至少一条流水线）</p>
<p>而建线程，就只是在一个车间内造一条流水线，无需申请空间，所以创建开销小</p>
<p><strong>进程之间是竞争关系，线程之间是协作关系？</strong></p>
<p>车间直接是竞争/抢电源的关系，竞争（不同的进程直接是竞争关系，是不同的程序员写的程序运行的，迅雷抢占其他进程的网速，360把其他进程当做病毒干死）<br>一个车间的不同流水线式协同工作的关系（同一个进程的线程之间是合作关系，是同一个程序写的程序内开启动，迅雷内的线程是合作关系，不会自己干自己）</p>
<h4 id="3-线程与进程的区别"><a href="#3-线程与进程的区别" class="headerlink" title="3)线程与进程的区别"></a>3)线程与进程的区别</h4><p>线程共享创建它的进程的地址空间;进程有自己的地址空间。</p>
<p>线程可以直接访问其进程的数据段;进程有自己的父进程数据段的副本。</p>
<p>线程可以直接与进程中的其他线程通信;进程必须使用进程间通信来与同级进程通信。</p>
<p>新线程很容易创建;新的进程需要父进程的复制。</p>
<p>线程可以对同一进程的线程进行相当大的控制;流程只能对子流程进行控制。</p>
<p>主线程的更改(取消、优先级更改等)可能会影响进程中其他线程的行为;对父进程的更改不会影响子进程。</p>
<h4 id="4-为何要用多线程"><a href="#4-为何要用多线程" class="headerlink" title="4)为何要用多线程"></a>4)为何要用多线程</h4><p>多线程指的是，在一个进程中开启多个线程，简单的讲：如果多个任务共用一块地址空间，那么必须在一个进程内开启多个线程。详细的讲分为4点：</p>
<ol>
<li>多线程共享一个进程的地址空间</li>
<li>线程比进程更轻量级，线程比进程更容易创建可撤销，在许多操作系统中，创建一个线程比创建一个进程要快10-100倍，在有大量线程需要动态和快速修改时，这一特性很有用</li>
<li>若多个线程都是cpu密集型的，那么并不能获得性能上的增强，但是如果存在大量的计算和大量的I/O处理，拥有多个线程允许这些活动彼此重叠运行，从而会加快程序执行的速度。</li>
<li>在多cpu系统中，为了最大限度的利用多核，可以开启多个线程，比开进程开销要小的多。（这一条并不适用于python）</li>
</ol>
<h4 id="5-多线程的应用举例"><a href="#5-多线程的应用举例" class="headerlink" title="5)多线程的应用举例"></a>5)多线程的应用举例</h4><p><img src="https://user-images.githubusercontent.com/57135669/88485366-d4820400-cfa7-11ea-8848-e70f2ef5cecd.png" alt="并4"></p>
<p>开启一个字处理软件进程，该进程肯定需要办不止一件事情，比如监听键盘输入，处理文字，定时自动将文字保存到硬盘，这三个任务操作的都是同一块数据，因而不能用多进程。只能在一个进程里并发地开启三个线程,如果是单线程，那就只能是，键盘输入时，不能处理文字和自动保存，自动保存时又不能输入和处理文字。</p>
<h4 id="6-经典的线程模型（了解）"><a href="#6-经典的线程模型（了解）" class="headerlink" title="6)经典的线程模型（了解）"></a>6)经典的线程模型（了解）</h4><p>多个线程共享同一个进程的地址空间中的资源，是对一台计算机上多个进程的模拟，有时也称线程为轻量级的进程</p>
<p>　　而对一台计算机上多个进程，则共享物理内存、磁盘、打印机等其他物理资源。</p>
<p>　　多线程的运行也多进程的运行类似，是cpu在多个线程之间的快速切换。</p>
<p><img src="https://user-images.githubusercontent.com/57135669/88485358-ce8c2300-cfa7-11ea-801a-35c60fefcc4e.png" alt="并5"></p>
<p>不同的进程之间是充满敌意的，彼此是抢占、竞争cpu的关系，如果迅雷会和QQ抢资源。而同一个进程是由一个程序员的程序创建，所以同一进程内的线程是合作关系，一个线程可以访问另外一个线程的内存地址，大家都是共享的，一个线程干死了另外一个线程的内存，那纯属程序员脑子有问题。</p>
<p>　　类似于进程，每个线程也有自己的堆栈</p>
<p><img src="https://user-images.githubusercontent.com/57135669/88485359-cf24b980-cfa7-11ea-9a64-1be5254ff1ee.png" alt="并6"></p>
<p>不同于进程，线程库无法利用时钟中断强制线程让出CPU，可以调用thread_yield运行线程自动放弃cpu，让另外一个线程运行。</p>
<p>　　</p>
<p>　　线程通常是有益的，但是带来了不小程序设计难度，线程的问题是：</p>
<p>　　1. 父进程有多个线程，那么开启的子线程是否需要同样多的线程</p>
<p>　　　如果是，那么附近中某个线程被阻塞，那么copy到子进程后，copy版的线程也要被阻塞吗，想一想nginx的多线程模式接收用户连接。</p>
<p>　　2. 在同一个进程中，如果一个线程关闭了问题，而另外一个线程正准备往该文件内写内容呢？</p>
<p>如果一个线程注意到没有内存了，并开始分配更多的内存，在工作一半时，发生线程切换，新的线程也发现内存不够用了，又开始分配更多的内存，这样内存就被分配了多次，这些问题都是多线程编程的典型问题，需要仔细思考和设计。</p>
<h4 id="7-POSIX线程（了解）"><a href="#7-POSIX线程（了解）" class="headerlink" title="7) POSIX线程（了解）"></a>7) POSIX线程（了解）</h4><p>为了实现可移植的线程程序,IEEE在IEEE标准1003.1c中定义了线程标准，它定义的线程包叫Pthread。大部分UNIX系统都支持该标准，简单介绍如下</p>
<p><img src="https://user-images.githubusercontent.com/57135669/88485360-cfbd5000-cfa7-11ea-8cfe-2739add1d085.png" alt="并7"></p>
<h4 id="8-在用户空间实现的线程（了解）"><a href="#8-在用户空间实现的线程（了解）" class="headerlink" title="8) 在用户空间实现的线程（了解）"></a>8) 在用户空间实现的线程（了解）</h4><p>线程的实现可以分为两类：用户级线程(User-Level Thread)和内核线线程(Kernel-Level Thread)，后者又称为内核支持的线程或轻量级进程。在多线程操作系统中，各个系统的实现方式并不相同，在有的系统中实现了用户级线程，有的系统中实现了内核级线程。</p>
<p>用户级线程内核的切换由用户态程序自己控制内核切换,不需要内核干涉，少了进出内核态的消耗，但不能很好的利用多核Cpu,目前Linux pthread大体是这么做的。</p>
<p><img src="https://user-images.githubusercontent.com/57135669/88485361-d0ee7d00-cfa7-11ea-877e-4418dc005bd1.png" alt="并8"></p>
<h4 id="9-在内核空间实现的线程（了解）"><a href="#9-在内核空间实现的线程（了解）" class="headerlink" title="9)在内核空间实现的线程（了解）"></a>9)在内核空间实现的线程（了解）</h4><p>内核级线程:切换由内核控制，当线程进行切换的时候，由用户态转化为内核态。切换完毕要从内核态返回用户态；可以很好的利用smp，即利用多核cpu。windows线程就是这样的。</p>
<p><img src="https://user-images.githubusercontent.com/57135669/88485362-d21faa00-cfa7-11ea-8b1f-31da80ec0e79.png" alt="并9"></p>
<h4 id="10-用户级与内核级线程的对比（了解）"><a href="#10-用户级与内核级线程的对比（了解）" class="headerlink" title="10)用户级与内核级线程的对比（了解）"></a>10)用户级与内核级线程的对比（了解）</h4><p><strong>一： 以下是用户级线程和内核级线程的区别：</strong></p>
<ol>
<li>内核支持线程是OS内核可感知的，而用户级线程是OS内核不可感知的。</li>
<li>用户级线程的创建、撤消和调度不需要OS内核的支持，是在语言（如Java）这一级处理的；而内核支持线程的创建、撤消和调度都需OS内核提供支持，而且与进程的创建、撤消和调度大体是相同的。</li>
<li>用户级线程执行系统调用指令时将导致其所属进程被中断，而内核支持线程执行系统调用指令时，只导致该线程被中断。</li>
<li>在只有用户级线程的系统内，CPU调度还是以进程为单位，处于运行状态的进程中的多个线程，由用户程序控制线程的轮换运行；在有内核支持线程的系统内，CPU调度则以线程为单位，由OS的线程调度程序负责线程的调度。</li>
<li>用户级线程的程序实体是运行在用户态下的程序，而内核支持线程的程序实体则是可以运行在任何状态下的程序。</li>
</ol>
<p><strong>二： 内核线程的优缺点</strong></p>
<p>　　<strong>优点：</strong></p>
<ol>
<li>当有多个处理机时，一个进程的多个线程可以同时执行。</li>
</ol>
<p>　　<strong>缺点：</strong></p>
<ol>
<li>由内核进行调度。</li>
</ol>
<p><strong>三： 用户进程的优缺点</strong></p>
<p>　　<strong>优点：</strong></p>
<ol>
<li>线程的调度不需要内核直接参与，控制简单。</li>
<li>可以在不支持线程的操作系统中实现。</li>
<li>创建和销毁线程、线程切换代价等线程管理的代价比内核线程少得多。</li>
<li>允许每个进程定制自己的调度算法，线程管理比较灵活。</li>
<li>线程能够利用的表空间和堆栈空间比内核级线程多。</li>
<li>同一进程中只能同时有一个线程在运行，如果有一个线程使用了系统调用而阻塞，那么整个进程都会被挂起。另外，页面失效也会产生同样的问题。</li>
</ol>
<p>　　<strong>缺点：</strong></p>
<ol>
<li>资源调度按照进程进行，多个处理机下，同一个进程中的线程只能在同一个处理机下分时复用</li>
</ol>
<h4 id="11-混合实现（了解）"><a href="#11-混合实现（了解）" class="headerlink" title="11) 混合实现（了解）"></a>11) 混合实现（了解）</h4><p>用户级与内核级的多路复用，内核同一调度内核线程，每个内核线程对应n个用户线程</p>
<p><img src="https://user-images.githubusercontent.com/57135669/88485363-d2b84080-cfa7-11ea-8dd5-33101161be6f.png" alt="并10"></p>
<h4 id="12-守护线程"><a href="#12-守护线程" class="headerlink" title="12)守护线程"></a>12)守护线程</h4><p>无论是进程还是线程，都遵循：守护xxx会等待主xxx运行完毕后被销毁</p>
<p>需要强调的是：运行完毕并非终止运行</p>
<h4 id="1-对主进程来说，运行完毕指的是主进程代码运行完毕"><a href="#1-对主进程来说，运行完毕指的是主进程代码运行完毕" class="headerlink" title="1.对主进程来说，运行完毕指的是主进程代码运行完毕"></a>1.对主进程来说，运行完毕指的是主进程代码运行完毕</h4><h4 id="2-对主线程来说，运行完毕指的是主线程所在的进程内所有非守护线程统统运行完毕，主线程才算运行完毕"><a href="#2-对主线程来说，运行完毕指的是主线程所在的进程内所有非守护线程统统运行完毕，主线程才算运行完毕" class="headerlink" title="2.对主线程来说，运行完毕指的是主线程所在的进程内所有非守护线程统统运行完毕，主线程才算运行完毕"></a>2.对主线程来说，运行完毕指的是主线程所在的进程内所有非守护线程统统运行完毕，主线程才算运行完毕</h4><p>详细解释：</p>
<h4 id="1-主进程在其代码结束后就已经算运行完毕了（守护进程在此时就被回收）-然后主进程会一直等非守护的子进程都运行完毕后回收子进程的资源-否则会产生僵尸进程-，才会结束，"><a href="#1-主进程在其代码结束后就已经算运行完毕了（守护进程在此时就被回收）-然后主进程会一直等非守护的子进程都运行完毕后回收子进程的资源-否则会产生僵尸进程-，才会结束，" class="headerlink" title="1 主进程在其代码结束后就已经算运行完毕了（守护进程在此时就被回收）,然后主进程会一直等非守护的子进程都运行完毕后回收子进程的资源(否则会产生僵尸进程)，才会结束，"></a>1 主进程在其代码结束后就已经算运行完毕了（守护进程在此时就被回收）,然后主进程会一直等非守护的子进程都运行完毕后回收子进程的资源(否则会产生僵尸进程)，才会结束，</h4><h4 id="2-主线程在其他非守护线程运行完毕后才算运行完毕（守护线程在此时就被回收）。因为主线程的结束意味着进程的结束，进程整体的资源都将被回收，而进程必须保证非守护线程都运行完毕后才能结束。"><a href="#2-主线程在其他非守护线程运行完毕后才算运行完毕（守护线程在此时就被回收）。因为主线程的结束意味着进程的结束，进程整体的资源都将被回收，而进程必须保证非守护线程都运行完毕后才能结束。" class="headerlink" title="2 主线程在其他非守护线程运行完毕后才算运行完毕（守护线程在此时就被回收）。因为主线程的结束意味着进程的结束，进程整体的资源都将被回收，而进程必须保证非守护线程都运行完毕后才能结束。"></a>2 主线程在其他非守护线程运行完毕后才算运行完毕（守护线程在此时就被回收）。因为主线程的结束意味着进程的结束，进程整体的资源都将被回收，而进程必须保证非守护线程都运行完毕后才能结束。</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sayhi</span><span class="params">(name)</span>:</span></span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    print(<span class="string">'%s say hello'</span> %name)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    t=Thread(target=sayhi,args=(<span class="string">'egon'</span>,))</span><br><span class="line">    t.setDaemon(<span class="literal">True</span>) <span class="comment">#必须在t.start()之前设置</span></span><br><span class="line">    t.start()</span><br><span class="line"></span><br><span class="line">    print(<span class="string">'主线程'</span>)</span><br><span class="line">    print(t.is_alive())</span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    主线程</span></span><br><span class="line"><span class="string">    True</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">迷惑人的例子</span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="number">123</span>)</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    print(<span class="string">"end123"</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bar</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="number">456</span>)</span><br><span class="line">    time.sleep(<span class="number">3</span>)</span><br><span class="line">    print(<span class="string">"end456"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">t1=Thread(target=foo)</span><br><span class="line">t2=Thread(target=bar)</span><br><span class="line"></span><br><span class="line">t1.daemon=<span class="literal">True</span></span><br><span class="line">t1.start()</span><br><span class="line">t2.start()</span><br><span class="line">print(<span class="string">"main-------"</span>)</span><br></pre></td></tr></table></figure>

<h4 id="13-线程池"><a href="#13-线程池" class="headerlink" title="13)线程池"></a>13)线程池</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> ThreadPoolExecutor</span><br><span class="line"> <span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="comment"># pool只能创建100个线程</span></span><br><span class="line"> pool = ThreadPoolExecutor(<span class="number">100</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">def</span> <span class="title">task</span><span class="params">(line)</span>:</span></span><br><span class="line">     print(line)</span><br><span class="line">     time.sleep(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">     <span class="keyword">for</span> line <span class="keyword">in</span> range(<span class="number">1000</span>):</span><br><span class="line">        pool.submit(task, line)</span><br></pre></td></tr></table></figure>

<h4 id="14-其他方法"><a href="#14-其他方法" class="headerlink" title="14)其他方法"></a>14)其他方法</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br></pre></td><td class="code"><pre><span class="line">一 开启线程的两种方式</span><br><span class="line"><span class="comment">#方式一</span></span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sayhi</span><span class="params">(name)</span>:</span></span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    print(<span class="string">'%s say hello'</span> %name)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    t=Thread(target=sayhi,args=(<span class="string">'egon'</span>,))</span><br><span class="line">    t.start()</span><br><span class="line">    print(<span class="string">'主线程'</span>)</span><br><span class="line">    </span><br><span class="line"><span class="comment">#方式二</span></span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sayhi</span><span class="params">(Thread)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,name)</span>:</span></span><br><span class="line">        super().__init__()</span><br><span class="line">        self.name=name</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">        time.sleep(<span class="number">2</span>)</span><br><span class="line">        print(<span class="string">'%s say hello'</span> % self.name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    t = Sayhi(<span class="string">'tony'</span>)</span><br><span class="line">    t.start()</span><br><span class="line">    print(<span class="string">'主线程'</span>)</span><br><span class="line"><span class="number">343434</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">二 在一个进程下开启多个线程与在一个进程下开启多个子进程的区别</span><br><span class="line">开启速度</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">work</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'hello'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="comment">#在主进程下开启线程</span></span><br><span class="line">    t=Thread(target=work)</span><br><span class="line">    t.start()</span><br><span class="line">    print(<span class="string">'主线程/主进程'</span>)</span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    打印结果:</span></span><br><span class="line"><span class="string">    hello</span></span><br><span class="line"><span class="string">    主线程/主进程</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#在主进程下开启子进程</span></span><br><span class="line">    t=Process(target=work)</span><br><span class="line">    t.start()</span><br><span class="line">    print(<span class="string">'主线程/主进程'</span>)</span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    打印结果:</span></span><br><span class="line"><span class="string">    主线程/主进程</span></span><br><span class="line"><span class="string">    hello</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">进程编号</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">work</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'hello'</span>,os.getpid())</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="comment">#part1:在主进程下开启多个线程,每个线程都跟主进程的pid一样</span></span><br><span class="line">    t1=Thread(target=work)</span><br><span class="line">    t2=Thread(target=work)</span><br><span class="line">    t1.start()</span><br><span class="line">    t2.start()</span><br><span class="line">    print(<span class="string">'主线程/主进程pid'</span>,os.getpid())</span><br><span class="line"></span><br><span class="line">    <span class="comment">#part2:开多个进程,每个进程都有不同的pid</span></span><br><span class="line">    p1=Process(target=work)</span><br><span class="line">    p2=Process(target=work)</span><br><span class="line">    p1.start()</span><br><span class="line">    p2.start()</span><br><span class="line">    print(<span class="string">'主线程/主进程pid'</span>,os.getpid())</span><br><span class="line">同一进程内的线程共享数据</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span>  threading <span class="keyword">import</span> Thread</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">work</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">global</span> n</span><br><span class="line">    n=<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="comment"># n=100</span></span><br><span class="line">    <span class="comment"># p=Process(target=work)</span></span><br><span class="line">    <span class="comment"># p.start()</span></span><br><span class="line">    <span class="comment"># p.join()</span></span><br><span class="line">    <span class="comment"># print('主',n) #毫无疑问子进程p已经将自己的全局的n改成了0,但改的仅仅是它自己的,查看父进程的n仍然为100</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    n=<span class="number">1</span></span><br><span class="line">    t=Thread(target=work)</span><br><span class="line">    t.start()</span><br><span class="line">    t.join()</span><br><span class="line">    print(<span class="string">'主'</span>,n) <span class="comment">#查看结果为0,因为同一进程内的线程之间共享进程内的数据</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">四 练习</span><br><span class="line"></span><br><span class="line">练习<span class="number">1</span></span><br><span class="line">多线程并发的socket服务端</span><br><span class="line"></span><br><span class="line"><span class="comment">#_*_coding:utf-8_*_</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line">s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)</span><br><span class="line">s.bind((<span class="string">'127.0.0.1'</span>,<span class="number">8080</span>))</span><br><span class="line">s.listen(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">action</span><span class="params">(conn)</span>:</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        data=conn.recv(<span class="number">1024</span>)</span><br><span class="line">        print(data)</span><br><span class="line">        conn.send(data.upper())</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        conn,addr=s.accept()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        p=threading.Thread(target=action,args=(conn,))</span><br><span class="line">        p.start()</span><br><span class="line">客户端</span><br><span class="line"></span><br><span class="line"><span class="comment">#_*_coding:utf-8_*_</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)</span><br><span class="line">s.connect((<span class="string">'127.0.0.1'</span>,<span class="number">8080</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    msg=input(<span class="string">'&gt;&gt;: '</span>).strip()</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> msg:<span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">    s.send(msg.encode(<span class="string">'utf-8'</span>))</span><br><span class="line">    data=s.recv(<span class="number">1024</span>)</span><br><span class="line">    print(data)</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">练习<span class="number">2</span></span><br><span class="line">三个任务，一个接收用户输入，一个将用户输入的内容格式化成大写，一个将格式化后的结果存入文件</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line">msg_l=[]</span><br><span class="line">format_l=[]</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">talk</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        msg=input(<span class="string">'&gt;&gt;: '</span>).strip()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> msg:<span class="keyword">continue</span></span><br><span class="line">        msg_l.append(msg)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">format_msg</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">if</span> msg_l:</span><br><span class="line">            res=msg_l.pop()</span><br><span class="line">            format_l.append(res.upper())</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">save</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">if</span> format_l:</span><br><span class="line">            <span class="keyword">with</span> open(<span class="string">'db.txt'</span>,<span class="string">'a'</span>,encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:</span><br><span class="line">                res=format_l.pop()</span><br><span class="line">                f.write(<span class="string">'%s\n'</span> %res)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    t1=Thread(target=talk)</span><br><span class="line">    t2=Thread(target=format_msg)</span><br><span class="line">    t3=Thread(target=save)</span><br><span class="line">    t1.start()</span><br><span class="line">    t2.start()</span><br><span class="line">    t3.start()</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">五 线程相关的其他方法</span><br><span class="line">Thread实例对象的方法</span><br><span class="line">  <span class="comment"># isAlive(): 返回线程是否活动的。</span></span><br><span class="line">  <span class="comment"># getName(): 返回线程名。</span></span><br><span class="line">  <span class="comment"># setName(): 设置线程名。</span></span><br><span class="line"></span><br><span class="line">threading模块提供的一些方法：</span><br><span class="line">  <span class="comment"># threading.currentThread(): 返回当前的线程变量。</span></span><br><span class="line">  <span class="comment"># threading.enumerate(): 返回一个包含正在运行的线程的list。正在运行指线程启动后、结束前，不包括启动前和终止后的线程。</span></span><br><span class="line">  <span class="comment"># threading.activeCount(): 返回正在运行的线程数量，与len(threading.enumerate())有相同的结果。</span></span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">work</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">import</span> time</span><br><span class="line">    time.sleep(<span class="number">3</span>)</span><br><span class="line">    print(threading.current_thread().getName())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="comment">#在主进程下开启线程</span></span><br><span class="line">    t=Thread(target=work)</span><br><span class="line">    t.start()</span><br><span class="line"></span><br><span class="line">    print(threading.current_thread().getName())</span><br><span class="line">    print(threading.current_thread()) <span class="comment">#主线程</span></span><br><span class="line">    print(threading.enumerate()) <span class="comment">#连同主线程在内有两个运行的线程</span></span><br><span class="line">    print(threading.active_count())</span><br><span class="line">    print(<span class="string">'主线程/主进程'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    打印结果:</span></span><br><span class="line"><span class="string">    MainThread</span></span><br><span class="line"><span class="string">    &lt;_MainThread(MainThread, started 140735268892672)&gt;</span></span><br><span class="line"><span class="string">    [&lt;_MainThread(MainThread, started 140735268892672)&gt;, &lt;Thread(Thread-1, started 123145307557888)&gt;]</span></span><br><span class="line"><span class="string">    主线程/主进程</span></span><br><span class="line"><span class="string">    Thread-1</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">主线程等待子线程结束</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sayhi</span><span class="params">(name)</span>:</span></span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    print(<span class="string">'%s say hello'</span> %name)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    t=Thread(target=sayhi,args=(<span class="string">'egon'</span>,))</span><br><span class="line">    t.start()</span><br><span class="line">    t.join()</span><br><span class="line">    print(<span class="string">'主线程'</span>)</span><br><span class="line">    print(t.is_alive())</span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    egon say hello</span></span><br><span class="line"><span class="string">    主线程</span></span><br><span class="line"><span class="string">    False</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">八 死锁现象与递归锁</span><br><span class="line">进程也有死锁与递归锁，在进程那里忘记说了，放到这里一切说了额</span><br><span class="line"></span><br><span class="line">所谓死锁： 是指两个或两个以上的进程或线程在执行过程中，因争夺资源而造成的一种互相等待的现象，若无外力作用，它们都将无法推进下去。此时称系统处于死锁状态或系统产生了死锁，这些永远在互相等待的进程称为死锁进程，如下就是死锁</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread,Lock</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">mutexA=Lock()</span><br><span class="line">mutexB=Lock()</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThread</span><span class="params">(Thread)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.func1()</span><br><span class="line">        self.func2()</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">func1</span><span class="params">(self)</span>:</span></span><br><span class="line">        mutexA.acquire()</span><br><span class="line">        print(<span class="string">'\033[41m%s 拿到A锁\033[0m'</span> %self.name)</span><br><span class="line"></span><br><span class="line">        mutexB.acquire()</span><br><span class="line">        print(<span class="string">'\033[42m%s 拿到B锁\033[0m'</span> %self.name)</span><br><span class="line">        mutexB.release()</span><br><span class="line"></span><br><span class="line">        mutexA.release()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">func2</span><span class="params">(self)</span>:</span></span><br><span class="line">        mutexB.acquire()</span><br><span class="line">        print(<span class="string">'\033[43m%s 拿到B锁\033[0m'</span> %self.name)</span><br><span class="line">        time.sleep(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">        mutexA.acquire()</span><br><span class="line">        print(<span class="string">'\033[44m%s 拿到A锁\033[0m'</span> %self.name)</span><br><span class="line">        mutexA.release()</span><br><span class="line"></span><br><span class="line">        mutexB.release()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">        t=MyThread()</span><br><span class="line">        t.start()</span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">Thread-1 拿到A锁</span></span><br><span class="line"><span class="string">Thread-1 拿到B锁</span></span><br><span class="line"><span class="string">Thread-1 拿到B锁</span></span><br><span class="line"><span class="string">Thread-2 拿到A锁</span></span><br><span class="line"><span class="string">然后就卡住，死锁了</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">解决方法，递归锁，在Python中为了支持在同一线程中多次请求同一资源，python提供了可重入锁RLock。</span><br><span class="line"></span><br><span class="line">这个RLock内部维护着一个Lock和一个counter变量，counter记录了acquire的次数，从而使得资源可以被多次require。直到一个线程所有的acquire都被release，其他的线程才能获得资源。上面的例子如果使用RLock代替Lock，则不会发生死锁：</span><br><span class="line"></span><br><span class="line">mutexA=mutexB=threading.RLock() <span class="comment">#一个线程拿到锁，counter加1,该线程内又碰到加锁的情况，则counter继续加1，这期间所有其他线程都只能等待，等待该线程释放所有锁，即counter递减到0为止</span></span><br><span class="line">九 信号量Semaphore</span><br><span class="line">同进程的一样</span><br><span class="line"></span><br><span class="line">Semaphore管理一个内置的计数器，</span><br><span class="line">每当调用acquire()时内置计数器<span class="number">-1</span>；</span><br><span class="line">调用release() 时内置计数器+<span class="number">1</span>；</span><br><span class="line">计数器不能小于<span class="number">0</span>；当计数器为<span class="number">0</span>时，acquire()将阻塞线程直到其他线程调用release()。</span><br><span class="line"></span><br><span class="line">实例：(同时只有<span class="number">5</span>个线程可以获得semaphore,即可以限制最大连接数为<span class="number">5</span>)：</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread,Semaphore</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="comment"># def func():</span></span><br><span class="line"><span class="comment">#     if sm.acquire():</span></span><br><span class="line"><span class="comment">#         print (threading.currentThread().getName() + ' get semaphore')</span></span><br><span class="line"><span class="comment">#         time.sleep(2)</span></span><br><span class="line"><span class="comment">#         sm.release()</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">()</span>:</span></span><br><span class="line">    sm.acquire()</span><br><span class="line">    print(<span class="string">'%s get sm'</span> %threading.current_thread().getName())</span><br><span class="line">    time.sleep(<span class="number">3</span>)</span><br><span class="line">    sm.release()</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    sm=Semaphore(<span class="number">5</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">23</span>):</span><br><span class="line">        t=Thread(target=func)</span><br><span class="line">        t.start()</span><br><span class="line">与进程池是完全不同的概念，进程池Pool(<span class="number">4</span>)，最大只能产生<span class="number">4</span>个进程，而且从头到尾都只是这四个进程，不会产生新的，而信号量是产生一堆线程/进程</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">十 Event</span><br><span class="line">同进程的一样</span><br><span class="line"></span><br><span class="line">线程的一个关键特性是每个线程都是独立运行且状态不可预测。如果程序中的其 他线程需要通过判断某个线程的状态来确定自己下一步的操作,这时线程同步问题就会变得非常棘手。为了解决这些问题,我们需要使用threading库中的Event对象。 对象包含一个可由线程设置的信号标志,它允许线程等待某些事件的发生。在 初始情况下,Event对象中的信号标志被设置为假。如果有线程等待一个Event对象, 而这个Event对象的标志为假,那么这个线程将会被一直阻塞直至该标志为真。一个线程如果将一个Event对象的信号标志设置为真,它将唤醒所有等待这个Event对象的线程。如果一个线程等待一个已经被设置为真的Event对象,那么它将忽略这个事件, 继续执行</span><br><span class="line"></span><br><span class="line">event.isSet()：返回event的状态值；</span><br><span class="line">event.wait()：如果 event.isSet()==<span class="literal">False</span>将阻塞线程；</span><br><span class="line">event.set()： 设置event的状态值为<span class="literal">True</span>，所有阻塞池的线程激活进入就绪状态， 等待操作系统调度；</span><br><span class="line">event.clear()：恢复event的状态值为<span class="literal">False</span>。</span><br><span class="line"><span class="number">55555</span></span><br><span class="line"></span><br><span class="line">例如，有多个工作线程尝试链接MySQL，我们想要在链接前确保MySQL服务正常才让那些工作线程去连接MySQL服务器，如果连接不成功，都会去尝试重新连接。那么我们就可以采用threading.Event机制来协调各个工作线程的连接操作</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread,Event</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time,random</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">conn_mysql</span><span class="params">()</span>:</span></span><br><span class="line">    count=<span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> event.is_set():</span><br><span class="line">        <span class="keyword">if</span> count &gt; <span class="number">3</span>:</span><br><span class="line">            <span class="keyword">raise</span> TimeoutError(<span class="string">'链接超时'</span>)</span><br><span class="line">        print(<span class="string">'&lt;%s&gt;第%s次尝试链接'</span> % (threading.current_thread().getName(), count))</span><br><span class="line">        event.wait(<span class="number">0.5</span>)</span><br><span class="line">        count+=<span class="number">1</span></span><br><span class="line">    print(<span class="string">'&lt;%s&gt;链接成功'</span> %threading.current_thread().getName())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check_mysql</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'\033[45m[%s]正在检查mysql\033[0m'</span> % threading.current_thread().getName())</span><br><span class="line">    time.sleep(random.randint(<span class="number">2</span>,<span class="number">4</span>))</span><br><span class="line">    event.set()</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    event=Event()</span><br><span class="line">    conn1=Thread(target=conn_mysql)</span><br><span class="line">    conn2=Thread(target=conn_mysql)</span><br><span class="line">    check=Thread(target=check_mysql)</span><br><span class="line"></span><br><span class="line">    conn1.start()</span><br><span class="line">    conn2.start()</span><br><span class="line">    check.start()</span><br><span class="line">获得cpu数量</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">print(os.cpu_count())</span><br></pre></td></tr></table></figure>

<h4 id="15）GIL-globl-interpreter-lock-全局解释锁"><a href="#15）GIL-globl-interpreter-lock-全局解释锁" class="headerlink" title="15）GIL(globl interpreter lock)全局解释锁"></a>15）GIL(globl interpreter lock)全局解释锁</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">定义：</span></span><br><span class="line"><span class="string">In CPython, the global interpreter lock, or GIL, is a mutex that prevents multiple </span></span><br><span class="line"><span class="string">native threads from executing Python bytecodes at once. This lock is necessary mainly </span></span><br><span class="line"><span class="string">because CPython’s memory management is not thread-safe. (However, since the GIL </span></span><br><span class="line"><span class="string">exists, other features have grown to depend on the guarantees that it enforces.)</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">结论：在Cpython解释器中，同一个进程下开启的多线程，同一时刻只能有一个线程执行，无法利用多核优势</span><br></pre></td></tr></table></figure>

<p><img src="https://user-images.githubusercontent.com/57135669/88485364-d350d700-cfa7-11ea-88b1-49c4cc3cf756.png" alt="并11"></p>
<p><strong>注意：GIL并不是Python的特性，它是在实现Python解析器(CPython)时所引入的一个概念， Python完全可以不依赖于GIL</strong></p>
<p><strong>什么是GIL?</strong></p>
<p>GIL本质就是一个互斥锁，相当于执行权限，每个进程内都会存在一把CIL,同一个进程内多个线程必须抢到GIL之后才能使用Cpytho解释器来执行自己的代码，即同一个进程内的多个线程只能使用并发，无法使用并行</p>
<p><strong>为什么要使用GIL?</strong></p>
<p>因为cpython中的垃圾回收机制不是线程安全的，就是为了数据安全才设置的GIL</p>
<p>GIL全局解释器锁的优缺点:</p>
<p>优点: 保证数据的安全</p>
<p>缺点: 单个进程下，开启多个线程，牺牲执行效率，无法实现并行，只能实现并发。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">IO密集型下使用多线程.</span><br><span class="line">计算密集型下使用多进程.</span><br><span class="line"></span><br><span class="line">IO密集型任务，每个任务<span class="number">4</span>s</span><br><span class="line">    - 单核:</span><br><span class="line">        - 开启线程比进程节省资源。</span><br><span class="line">        </span><br><span class="line">    - 多核:</span><br><span class="line">        - 多线程: </span><br><span class="line">            - 开启<span class="number">4</span>个子线程: <span class="number">16</span>s </span><br><span class="line">            </span><br><span class="line">        - 多进程:</span><br><span class="line">            - 开启<span class="number">4</span>个进程: <span class="number">16</span>s + 申请开启资源消耗的时间</span><br><span class="line">        </span><br><span class="line">    </span><br><span class="line">计算密集型任务，每个任务<span class="number">4</span>s</span><br><span class="line">    - 单核:</span><br><span class="line">        - 开启线程比进程节省资源。</span><br><span class="line">        </span><br><span class="line">    - 多核:</span><br><span class="line">        - 多线程:</span><br><span class="line">            - 开启<span class="number">4</span>个子线程: <span class="number">16</span>s</span><br><span class="line">            </span><br><span class="line">        - 多进程:</span><br><span class="line">            - 开启多个进程: <span class="number">4</span>s</span><br></pre></td></tr></table></figure>

<h4 id="16-协程"><a href="#16-协程" class="headerlink" title="16)协程"></a>16)协程</h4><p><strong>协程:单线程实现并发</strong></p>
<p>注意:协程是程序员想出来的，操作系统里面只有进程和线程的概念，操作系统调度的是线程</p>
<p>在单线程下实现多个任务遇到IO就切换就可以降低单线程的IO时间，从而最大限度的提升单线程的效率（若不是遇到io，比如遇到计算就切反而会降低效率）</p>
<p>注意：yield并不能解决遇到io就切换的操作</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> gevent <span class="keyword">import</span> monkey  <span class="comment"># 猴子补丁</span></span><br><span class="line"></span><br><span class="line">monkey.patch_all()</span><br><span class="line"><span class="keyword">from</span> gevent <span class="keyword">import</span> spawn</span><br><span class="line"><span class="keyword">from</span> gevent <span class="keyword">import</span> joinall</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="comment"># 注意，gevent模块不能识别他本身以外的IO类型,本身time模块已经封装一份在gevent内，可</span></span><br><span class="line"><span class="comment"># 以调用gevent内部的sleep，如果需要其他类型的IO，则需要打一个猴子补丁</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">play</span><span class="params">(name)</span>:</span></span><br><span class="line">    print(<span class="string">"%s paly 1 "</span>%name)</span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    print(<span class="string">"%s paly 2 "</span>%name)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">eat</span><span class="params">(name)</span>:</span></span><br><span class="line">    print(<span class="string">"%s eat 1"</span>%name)</span><br><span class="line">    time.sleep(<span class="number">5</span>)</span><br><span class="line">    print(<span class="string">"%s eat 2"</span>%name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">time_start = time.time()</span><br><span class="line">g1 = spawn(play, <span class="string">'tank'</span>)</span><br><span class="line">g2 = spawn(play, <span class="string">'sean'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># g1.join()</span></span><br><span class="line"><span class="comment"># g2.join()</span></span><br><span class="line">joinall([g1, g2]) <span class="comment"># 取代join</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">'主进程'</span>, time.time()-time_start)</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/11/29/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%9F%BA%E7%A1%80/" data-id="ckd3ezcxq001dt4ut2i3p4ook" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%BD%91%E7%BB%9C%E5%92%8C%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/" rel="tag">网络和并发编程</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-网络编程基础" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/11/25/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E5%9F%BA%E7%A1%80/" class="article-date">
  <time datetime="2018-11-25T12:09:29.000Z" itemprop="datePublished">2018-11-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/11/25/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E5%9F%BA%E7%A1%80/">网络编程基础</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="网络编程"><a href="#网络编程" class="headerlink" title="网络编程:"></a>网络编程:</h1><h2 id="1-软件开发架构"><a href="#1-软件开发架构" class="headerlink" title="1.软件开发架构"></a>1.软件开发架构</h2><ul>
<li><p><strong>C/S架构:(应用类</strong>)</p>
<p> Client: 客户端</p>
<p> Server: 服务端</p>
<p> 比如: 微信客户端、QQ客户端等…</p>
<ul>
<li><p>优点:软件使用稳点,节省网络资源</p>
</li>
<li><p>缺点:安装麻烦,需要占用手机或计算机内存资源,每次跟新都需要下载更新版本</p>
</li>
</ul>
</li>
</ul>
<p><img src="https://user-images.githubusercontent.com/57135669/88485172-85879f00-cfa6-11ea-9cf6-dd3888c443bb.png" alt="网编1"></p>
<ul>
<li><p><strong>B/S架构:(web类)</strong></p>
<p> Browser(本质上也是一个客户端): 浏览器 S</p>
<p> erver: 服务端</p>
<p> 比如: 在浏览器上输入一个 网址 就可以访问服务器</p>
<ul>
<li>优点:软件的使用方便,不需要下载和更新</li>
<li>缺点:极度依赖网络环境</li>
</ul>
</li>
</ul>
<p><img src="https://user-images.githubusercontent.com/57135669/88485175-87e9f900-cfa6-11ea-870e-83cf1414ec18.png" alt="网编2"></p>
<p>客户端与服务端都需要唯一的地址，但是客户端不需要固定地址，而服务端需要固定地址，并且保证一直稳定运行提供服务，并且支持并发</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 世界五大浏览器</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">一.IE浏览器： </span></span><br><span class="line"><span class="string">IE是微软公司旗下浏览器，是目国内用户量最多的浏览器。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">二.Opera浏览器（欧朋浏览器）： </span></span><br><span class="line"><span class="string">Opera是挪威Opera Software ASA公司旗下的浏览器,使用自己研发的Presto内核。2016年奇虎360和昆仑万维收购了Oprea浏览器，改用当时Google开源的webkit内核</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">三.Safari浏览器</span></span><br><span class="line"><span class="string">2003年，苹果公司在苹果手机上开发Safari浏览器，利用自己得天独厚的手机市场份额使Safari浏览器迅速成为世界主流浏览器。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">四.Firefox浏览器：</span></span><br><span class="line"><span class="string">采用Gecko作为内核。Gecko是一个开源的项目，代码完全公开，因此受到很多人的青睐。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">五.Chrome浏览器： </span></span><br><span class="line"><span class="string">Chrome浏览器是google旗下的浏览器,最开始Chrome采用webkit作为浏览器内核，直到2013年，google宣布不再使用苹果的webkit内核，开始使用webkit的分支内核Blink。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 四大浏览器内核</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">四大内核分别是：</span></span><br><span class="line"><span class="string">Trident（也称IE内核,IE浏览器内核）、</span></span><br><span class="line"><span class="string">webkit(Safari浏览器内核)、</span></span><br><span class="line"><span class="string">Blink(Chrome浏览器内核,Opera浏览器内核)、</span></span><br><span class="line"><span class="string">Gecko(Firefox浏览器内核)。</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">不同的浏览器由于内核不同会在前端开发时遇到兼容问题</span><br></pre></td></tr></table></figure>

<h2 id="2-互联网协议"><a href="#2-互联网协议" class="headerlink" title="2.互联网协议"></a>2.互联网协议</h2><ul>
<li>如何实现计算机与计算机之间进行无障碍通信<ul>
<li>物理链接介质(电话线,网线,网卡等)</li>
<li>互联网协议(一套所有计算机都遵循的标准)</li>
</ul>
</li>
</ul>
<p>补充:</p>
<p>以太网: 以太网是目前应用最普遍的局域网技术</p>
<p> 第一类是经典以太网，第二类是交换式以太网，使用了一种称为<a href="https://baike.baidu.com/item/交换机/103532" target="_blank" rel="noopener">交换机</a>的设备连接不同的计算机</p>
<p>交换机:所有链接了同一个交换机的电脑彼此都是互联的</p>
<p>了解:</p>
<p>三层交换机:即具有交换机又具有路由器功能</p>
<p>四层交换机:能够根据你走的什么协议找到对应的应用</p>
<p>互联网协议按照功能不同可以分为osi （开放系统互联(Open System Interconnection)） 七层或tcp/ip五层或tcp/ip四层</p>
<p><img src="https://user-images.githubusercontent.com/57135669/88485177-89b3bc80-cfa6-11ea-96f6-a3f0e2938b4c.png" alt="网编3"></p>
<h3 id="物理层"><a href="#物理层" class="headerlink" title="物理层:"></a>物理层:</h3><p>物理链接介质,接收和传递电信号(高低电平),即一堆二进制字符0111010101010</p>
<p>物理层无法获取具体数据内容以及分解字符串,故将电信号传给数据链路层</p>
<h3 id="数据链路层-遵循ARP协议"><a href="#数据链路层-遵循ARP协议" class="headerlink" title="数据链路层(遵循ARP协议)"></a>数据链路层(遵循ARP协议)</h3><p>地址解析协议，即ARP（Address Resolution Protocol），是根据IP地址获取物理地址的一个TCP/IP协议。</p>
<p>拿到物理层电信号后:</p>
<p> 我要知道数据是什么？</p>
<p> 我要知道数据是给谁的？</p>
<p>“以太网协议”:</p>
<p>将一组电信号称为一组数据报或者数据帧</p>
<p>1)规定一套分组的方式:</p>
<p> 获取电信号真实数据。</p>
<p> 电信号是一个数据报。</p>
<p> 报头(head): 18个字节,发送者（源地址）, 6个: 接收者（目标地址）,6个: 数据类型6个</p>
<p> 数据(data):电信号具体的数据（最短45个字节，最长1500字节）</p>
<ol>
<li>规定每一台电脑必须要有一个网卡（电脑插入网线的地方）:</li>
</ol>
<ul>
<li>每一块网卡都会有一串世界上独一无二的数字: - 12位16进制的数字，称之为 “mac地址” : - 前6位: 产商号 - 后6位: 流水号</li>
<li>mac地址作用（<strong>***</strong>）: 标识全世界上一台独一无二的计算机。</li>
</ul>
<p>3)工作的方式:</p>
<p>单播:</p>
<p>广播:</p>
<p>缺点:</p>
<p>广播风暴:只能在局域网内实现通信, 无法跨局域实现通信</p>
<h3 id="网络层"><a href="#网络层" class="headerlink" title="网络层"></a>网络层</h3><p>规定计算机都必须有一个ip地址,ip协议可以跨局域网传输</p>
<ul>
<li><p>ip地址（ip协议):点分十进制的数字组成 180.101.49.11</p>
<p>最小范围: 0.0.0.0 -</p>
<p>最大范围: 255.255.255.255</p>
</li>
<li><p>ip的版本:</p>
<ul>
<li>IPV4:</li>
<li>IPV6:</li>
</ul>
<p>ip的作用:</p>
<p>用于表示全世界某一台计算机的位置在局域网的位置。</p>
<p>总结: ip地址 + mac地址: 标识全世界某一个局域网内的，某一台计算机。</p>
</li>
</ul>
<h3 id="传输层"><a href="#传输层" class="headerlink" title="传输层:"></a>传输层:</h3><p>tcp与udp都是基于 “端口” 实现通信的。</p>
<ul>
<li>TCP协议 (Transmission Control Protocol) : 传输控制协议,提供的是面向连接、可靠的字节流服务。当客户和服务器彼此交换数据前，必须先在双方之间建立一个TCP连接，之后才能传输数据。TCP提供超时重发，丢弃重复数据，检验数据，流量控制等功能，保证数据能从一端传到另一端。</li>
<li>UDP协议 (User Datagram Protocol) : 用户数据报协议，是一个简单的面向数据报的运输层协议。UDP不提供可靠性，它只是把应用程序传给IP层的数据报发送出去，但是并不能保证它们能到达目的地。由于UDP在传输数据报前不用在客户和服务器之间建立一个连接，且没有超时重发等机制，故而传输速度很快</li>
</ul>
<p>主要是软件与软件之间进行通信。</p>
<ul>
<li><strong>port端口:</strong> 0～65535用来标识一台计算机之上<strong>基于网络通信</strong>的应用软件，0～1024操作系统自己用的，一般情况下8000之后的端口我们可以任意使用，8000之前的通常会有相应的程序默认使用 用于标识计算机中某一个独一无二软件。</li>
</ul>
<h4 id="三次握手和四次挥手"><a href="#三次握手和四次挥手" class="headerlink" title="三次握手和四次挥手"></a>三次握手和四次挥手</h4><p><strong>三次握手</strong></p>
<p>建立双向通道的过程称之为三次握手,建立通道的发起者可以是客户端也可以是服务端，下面我们就以客户端先主动发起为例</p>
<ul>
<li><p>客户端会朝服务端发送一个请求询问服务端:”我能不能挖一条通往你家的地道”</p>
</li>
<li><p>服务端收到请求，回复说:”好吧 你挖吧”，由于TCP是双向通道，客户端挖向服务端的通道只能给客户端朝服务端发消息使用，服务端要向给客户端发消息是没办法走这一条通道的，需要自己挖一条通往客户端的通道</p>
<p>所以服务端在回复同意客户端挖通道的同时还会问一句:”那我能不能也挖一条通往你家的通道”</p>
</li>
<li><p>客户端收到服务端请求后客户端到服务端的通道就挖成功了，然后也会同意服务端的请求，服务端挖向客户端的通道也会成功</p>
</li>
</ul>
<p>总结:之所以称之为三次握手就是因为中间的服务端的同意，和请求合并成了一次请求</p>
<p><strong>四次挥手</strong></p>
<p>建立一个连接需要三次握手，而终止一个连接要经过四次握手</p>
<p>当服务端或者客户端不想再与对方进行通信之后，双方任意一方都可以主动发起断开链接的请求，我们还是以客户端主动发起为例</p>
<ul>
<li><p>客户端由于已经没有任何需要发送给服务端的消息了，所以发起断开客户端到服务端的通道请求</p>
</li>
<li><p>服务端收到该请求后同意了 至此客户端到服务端的单项通道断开</p>
</li>
<li><p>服务端这个时候不会立刻朝客户端发器请求说那我也断开到你家的通道吧，服务端需要想想我手上还有没有需要发送给客户端的消息，如果还有的话，那我不能立马断开，先把数据发完才能断</p>
<p>等服务端检查完毕之后发送也没有数据要给客户端了，这个时候就会朝客户端发起断开服务端到客户端的通道请求</p>
</li>
<li><p>客户端同意该请求，至此四次挥手完成</p>
</li>
</ul>
<p>总结:挥手必须是四次，中间的两次不能合并成一次，原因就在于需要检查是否还有数据需要给对方发送</p>
<ul>
<li><p>反馈机制: 客户端往服务端发送请求,服务端必须返回响应,告诉客户端收到请求了，并且将服务端的数据一并返回给客户端。</p>
<p>C–&gt;S: 一次请求，必须有一次响应。</p>
<p>缺点:</p>
<p>洪水攻击: 指的是通过伪造大量的请求，往对方服务器发送请求,导致对方服务器响应跟不上，以至于瘫痪。linux系统有个参数可以限制。</p>
<p>半连接池listen: 限制用户在同一个时间段内的访问数量。</p>
</li>
</ul>
<p>总结： mac地址 + ip地址 + port端口: 标识的是全世界范围内某一个局域网内某一台计算机上的某一个软件。</p>
<h3 id="应用层"><a href="#应用层" class="headerlink" title="应用层:"></a>应用层:</h3><ul>
<li>http协议</li>
<li>ftp协议</li>
</ul>
<h2 id="3-socket套接字通信"><a href="#3-socket套接字通信" class="headerlink" title="3.socket套接字通信"></a>3.socket套接字通信</h2><p><img src="https://user-images.githubusercontent.com/57135669/88485182-90423400-cfa6-11ea-8cb7-5d5d18670b90.png" alt="网编4"></p>
<ul>
<li><p>什么是socket？</p>
<p>socket是一个模块, 又称套接字，用来封装 互联网协议(应用层以下的层)。</p>
</li>
<li><p>为什么要有socket？</p>
<p>socket可以实现 互联网协议应用层以下的层的工作。提高开发效率</p>
</li>
<li><p>怎么使用socket？</p>
<p>import socket</p>
<p>写socket套接字:</p>
<p>Client (客户端)/Server(服务端)</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">客户端</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取套接字</span></span><br><span class="line">client = socket.socket()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 尝试与服务端建立链接</span></span><br><span class="line">client.connect(</span><br><span class="line">   (<span class="string">'127.0.0.1'</span>, <span class="number">8472</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">   <span class="comment"># 输入向服务端发送的信息</span></span><br><span class="line">   send_data = input(<span class="string">'客户端&gt;&gt;&gt;: '</span>)</span><br><span class="line"></span><br><span class="line">   <span class="comment"># 将信息编码</span></span><br><span class="line">   client.send(send_data.encode(<span class="string">'utf-8'</span>))</span><br><span class="line">   <span class="comment"># 接收服务端端的数据,1024表示接收数据长度,可修改</span></span><br><span class="line">   data = client.recv(<span class="number">1024</span>)</span><br><span class="line">   <span class="comment"># 判断是否服务端申请关闭通道</span></span><br><span class="line">   <span class="keyword">if</span> data.decode(<span class="string">'utf-8'</span>) == <span class="string">'q'</span>:</span><br><span class="line">       <span class="keyword">break</span></span><br><span class="line">   <span class="keyword">if</span> len(data) == <span class="number">0</span>:</span><br><span class="line">       <span class="keyword">break</span></span><br><span class="line">   <span class="comment"># 打印数据信息</span></span><br><span class="line">   print(data.decode(<span class="string">'utf-8'</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭通道</span></span><br><span class="line">client.close()</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">服务端优先启动</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取套接字(类似于买了一个手机)</span></span><br><span class="line">server = socket.socket()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 绑定ip和端口地址(类似于手机绑定手机卡)</span></span><br><span class="line">server.bind(</span><br><span class="line">    (<span class="string">'127.0.0.1'</span>, <span class="number">8472</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 半连接池(监听链接)</span></span><br><span class="line">server.listen(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="comment"># 接收客户端链接信息</span></span><br><span class="line">    conn, addr = server.accept()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:  <span class="comment"># 监听代码块是否有异常出现</span></span><br><span class="line">            <span class="comment"># 获取客服端数据</span></span><br><span class="line">            data = conn.recv(<span class="number">1024</span>) <span class="comment"># 设置接收数据长度</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># 判断是否接收数据0</span></span><br><span class="line">            <span class="keyword">if</span> len(data) == <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="comment"># 判断客户端是否申请断绝联系</span></span><br><span class="line">            <span class="keyword">if</span> data.decode(<span class="string">'utf-8'</span>) == <span class="string">'q'</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            print(data.decode(<span class="string">'utf-8'</span>))</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 向客服端发送信息</span></span><br><span class="line">            send_data = input(<span class="string">'服务端&gt;&gt;&gt;: '</span>)</span><br><span class="line">            conn.send(send_data.encode(<span class="string">'utf-8'</span>))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 将异常收集返回出来</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            print(e)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 关闭通道</span></span><br><span class="line">    conn.close()</span><br></pre></td></tr></table></figure>

<h3 id="粘包问题"><a href="#粘包问题" class="headerlink" title="粘包问题"></a>粘包问题</h3><ul>
<li><ol>
<li>问题: 无法确认对方发送过来数据的大小。</li>
</ol>
</li>
<li><ol>
<li>问题: 在发送数据间隔短并且数据量小的情况下，会将所有数据一次性发送。</li>
</ol>
</li>
</ul>
<p>解决: 确认对方数据的大小。</p>
<h3 id="解决粘包问题（struct模块）"><a href="#解决粘包问题（struct模块）" class="headerlink" title="解决粘包问题（struct模块）"></a>解决粘包问题（struct模块）</h3><p>无论哪一端先发送数据</p>
<p>客户端 :</p>
<p>1.先制作报头，并发送 （struct）</p>
<p>2.发送真实数据</p>
<p>服务端:</p>
<p>1接收报头，并解包获取真实数据长度</p>
<p>2.根据真实数据长度 接收真实数据 ,recv(真实数据长度)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>struct模块</span><br><span class="line">是一个python内置的模块, 它可以将固定长度的数据，打包成固定格式的长度。</span><br><span class="line">模式i: <span class="number">4</span></span><br><span class="line"><span class="number">2.</span>作用:</span><br><span class="line">可以将真实数据，做成一个固定长度多的报头，客户端发送给服务端，服务端可以接收报头，</span><br><span class="line">然后对报头进行解包，获取真实数据的长度，进行接收即可</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"></span><br><span class="line">data =<span class="string">b'snjab'</span></span><br><span class="line"></span><br><span class="line">print(data)</span><br><span class="line"></span><br><span class="line">print(len(data))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打包制作报头</span></span><br><span class="line"></span><br><span class="line">header = struct.pack(<span class="string">'i'</span>, len(data))</span><br><span class="line"></span><br><span class="line">print(header)</span><br><span class="line"></span><br><span class="line">res = struct.unpack(<span class="string">'i'</span>, header)[<span class="number">0</span>]</span><br><span class="line">print(res)</span><br><span class="line"><span class="comment">#客户端</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"></span><br><span class="line">client = socket.socket()</span><br><span class="line"></span><br><span class="line">client.connect(</span><br><span class="line">    (<span class="string">'127.0.0.1'</span>, <span class="number">8978</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    movie_name = input(<span class="string">'请上传电影名称: '</span>)</span><br><span class="line">    <span class="comment"># 伪装一个电影长度</span></span><br><span class="line">    movie_len = <span class="number">10000</span></span><br><span class="line"></span><br><span class="line">    send_dic = &#123;<span class="string">'movie_name'</span>: movie_name,</span><br><span class="line">                <span class="string">"movie_len"</span>: movie_len&#125;</span><br><span class="line">    <span class="comment"># 改成json模式</span></span><br><span class="line">    json = json.dumps(send_dic)</span><br><span class="line">    <span class="comment"># print(json)</span></span><br><span class="line">    <span class="comment"># print(json.encode('utf-8'))</span></span><br><span class="line">    <span class="comment"># print(len(json.encode('utf-8')))</span></span><br><span class="line">    json_bytes = json.encode(<span class="string">'utf-8'</span>)</span><br><span class="line"></span><br><span class="line">    header = struct.pack(<span class="string">'i'</span>, json_bytes)</span><br><span class="line">    client.send(header)</span><br><span class="line">    client.send(json_bytes)</span><br><span class="line"><span class="comment"># 服务端</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">server = socket.socket()</span><br><span class="line"></span><br><span class="line">server.bind(</span><br><span class="line">    (<span class="string">'127.0.0.1'</span>, <span class="number">8978</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    conn, addr = server.accept()</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            header = conn.recv(<span class="number">4</span>)  <span class="comment"># 获取报头</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># 解开报头</span></span><br><span class="line">            json_len = struct.unpack(<span class="string">'i'</span>, header)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 接收真正长度</span></span><br><span class="line"></span><br><span class="line">            json_bytes_date = conn.recv(json_len)</span><br><span class="line"></span><br><span class="line">            json_data = json_bytes_date.decode(<span class="string">'utf-8'</span>)</span><br><span class="line"></span><br><span class="line">            back_dic = json.loads(json_data)</span><br><span class="line">            print(back_dic)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            print(e)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    conn.close()</span><br></pre></td></tr></table></figure>

<p>.UDP协议 （了解）</p>
<p>称之为数据包协议,不可靠协议</p>
<p>特点:</p>
<ul>
<li>不需要建立链接。</li>
<li>不需要知道对方是否收到。</li>
<li>数据不安全</li>
<li>传输速度快</li>
<li>能支持并发</li>
<li>不会粘包</li>
<li>无需先启动服务端再启动客户端</li>
</ul>
<p>优点:</p>
<ul>
<li>传输速度快</li>
<li>能支持并发</li>
<li>不会粘包</li>
</ul>
<p>缺点:</p>
<ul>
<li>数据不安全, 容易丢失</li>
</ul>
<p>应用场景: 早期的QQ聊天室。</p>
<p>2.TCP协议(称为流式协议):</p>
<p>优点:</p>
<ul>
<li>数据安全 缺点:</li>
<li>传输速度慢</li>
<li>粘包</li>
</ul>
<p>面试: TCP与UDP的区别, 简述优缺点即可。（<strong>***</strong>）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">server,不需要优先启动服务端</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line"><span class="comment"># socket.SOCK_DGRAM ------&gt;UPD协议</span></span><br><span class="line">server = socket.socket(type=socket.SOCK_DGRAM)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 服务端需要绑定一个地址,让别人知道服务端在哪</span></span><br><span class="line">server.bind(</span><br><span class="line">    (<span class="string">'127.0.0.1'</span>, <span class="number">8594</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 接收数据给服务端的用户地址</span></span><br><span class="line">    date, addr = server.recvfrom(<span class="number">1024</span>)</span><br><span class="line"></span><br><span class="line">    print(addr)</span><br><span class="line">    print(date.decode(<span class="string">'utf-8'</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 无论服务端还是客户端，发送消息时，都必须知道对方是谁</span></span><br><span class="line">    <span class="comment"># server.sendto(msg, addr)</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">客户端</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">client = socket.socket(type=socket.SOCK_DGRAM)</span><br><span class="line"></span><br><span class="line">address = (<span class="string">'127.0.0.1'</span>, <span class="number">8594</span>)</span><br><span class="line">print(address)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    msg = input(<span class="string">'客户端输入信息: '</span>).encode(<span class="string">'utf-8'</span>)</span><br><span class="line">    client.sendto(msg, address)</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/11/25/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E5%9F%BA%E7%A1%80/" data-id="ckd3ezcxt001it4utgtrm3drv" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%BD%91%E7%BB%9C%E5%92%8C%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/" rel="tag">网络和并发编程</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-MySQL数据库的隔离级别和锁" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/11/24/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB%E5%92%8C%E9%94%81/" class="article-date">
  <time datetime="2018-11-24T12:53:03.000Z" itemprop="datePublished">2018-11-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/11/24/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB%E5%92%8C%E9%94%81/">MySQL数据库的隔离级别和锁</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="事务是有隔离级别"><a href="#事务是有隔离级别" class="headerlink" title="事务是有隔离级别"></a>事务是有隔离级别</h3><p>read uncommited (读未提交)：不做任何隔离，具有脏读，不可重读，幻读的问题</p>
<p>read committed （读提交）：可以防止脏读，不能防止不可重复读和幻读的问题</p>
<p>repeated read（可重复读）：可以防止脏读，不可重复读，不能防止幻读（mysql的默认隔离级别）</p>
<p>serializable（串行化）：数据库运行为串行，以上问题都可以防止，但是性能低，相当于将整个库都加锁了</p>
<p><strong>下面的解释都用这个user表</strong></p>
<table>
<thead>
<tr>
<th align="left">name</th>
<th align="left">age</th>
</tr>
</thead>
<tbody><tr>
<td align="left">jason</td>
<td align="left">38</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left"></td>
<td align="left"></td>
</tr>
</tbody></table>
<h3 id="脏读（a-b同时开始事务，a-b再事务，没有哪一个结束，只有两个都进入事务后，才能结束期中一个事务，两个事务都是存活的）"><a href="#脏读（a-b同时开始事务，a-b再事务，没有哪一个结束，只有两个都进入事务后，才能结束期中一个事务，两个事务都是存活的）" class="headerlink" title="脏读（a,b同时开始事务，a,b再事务，没有哪一个结束，只有两个都进入事务后，才能结束期中一个事务，两个事务都是存活的）"></a>脏读（a,b同时开始事务，a,b再事务，没有哪一个结束，只有两个都进入事务后，才能结束期中一个事务，两个事务都是存活的）</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1 a  开启事务  将jason的年龄改成 18岁，但是没有提交事务</span><br><span class="line">2 b  开始事务  读取jason的年龄，发现是18岁。</span><br><span class="line"></span><br><span class="line">上述的问题，</span><br><span class="line">假设a事务回滚，b事务使用的数据就是错误的，就导致程序数据不正确。</span><br></pre></td></tr></table></figure>

<h3 id="不可重复度（a-b同时开始事务，a-b再事务，没有哪一个结束，只有两个都进入事务后，才能结束期中一个事务，两个事务都是存活的）"><a href="#不可重复度（a-b同时开始事务，a-b再事务，没有哪一个结束，只有两个都进入事务后，才能结束期中一个事务，两个事务都是存活的）" class="headerlink" title="不可重复度（a,b同时开始事务，a,b再事务，没有哪一个结束，只有两个都进入事务后，才能结束期中一个事务，两个事务都是存活的）"></a>不可重复度（a,b同时开始事务，a,b再事务，没有哪一个结束，只有两个都进入事务后，才能结束期中一个事务，两个事务都是存活的）</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1 a  开始事务  将jason的年龄改成18岁，但是提交了</span><br><span class="line">2 b  开启事务  读取jason的年龄就能读取a事务修改后的jason年龄18岁。</span><br></pre></td></tr></table></figure>

<h3 id="可重读读（a-b同时开始事务，a-b再事务，没有哪一个结束，只有两个都进入事务后，才能结束期中一个事务，两个事务都是存活的）"><a href="#可重读读（a-b同时开始事务，a-b再事务，没有哪一个结束，只有两个都进入事务后，才能结束期中一个事务，两个事务都是存活的）" class="headerlink" title="可重读读（a,b同时开始事务，a,b再事务，没有哪一个结束，只有两个都进入事务后，才能结束期中一个事务，两个事务都是存活的）"></a>可重读读（a,b同时开始事务，a,b再事务，没有哪一个结束，只有两个都进入事务后，才能结束期中一个事务，两个事务都是存活的）</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1 a  开始事务  将jason的年龄改成18岁，但是提交了</span><br><span class="line">2 b  开启事务  读取jason的年龄不能读取a事务修改后的jason年龄18岁。而是读取的是38岁</span><br></pre></td></tr></table></figure>

<h3 id="幻读（a-b同时开始事务，a-b再事务，没有哪一个结束，只有两个都进入事务后，才能结束期中一个事务，两个事务都是存活的）"><a href="#幻读（a-b同时开始事务，a-b再事务，没有哪一个结束，只有两个都进入事务后，才能结束期中一个事务，两个事务都是存活的）" class="headerlink" title="幻读（a,b同时开始事务，a,b再事务，没有哪一个结束，只有两个都进入事务后，才能结束期中一个事务，两个事务都是存活的）"></a>幻读（a,b同时开始事务，a,b再事务，没有哪一个结束，只有两个都进入事务后，才能结束期中一个事务，两个事务都是存活的）</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#概念和不可重读有点像，不可重复度是站在修改的基础上，而幻读是站在新增的基础上</span><br><span class="line">1 a  开始事务  将所有的的年龄改成18岁</span><br><span class="line">2 b  开始事务  新增一条数据数据name&#x3D;tank，age&#x3D;19，而且提交了。</span><br><span class="line">3 a  重新查， 发现有一条数据 的age&#x3D;19，这就是所谓的幻读。</span><br></pre></td></tr></table></figure>

<h3 id="如何看msql的隔离级别"><a href="#如何看msql的隔离级别" class="headerlink" title="如何看msql的隔离级别"></a>如何看msql的隔离级别</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select @@global.tx_isolation;</span><br></pre></td></tr></table></figure>

<h3 id="如何修改事务的隔离级别"><a href="#如何修改事务的隔离级别" class="headerlink" title="如何修改事务的隔离级别"></a>如何修改事务的隔离级别</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#修改配置文件</span><br><span class="line">transaction-isolation&#x3D;Read-Committed</span><br><span class="line">#修改后一定要重启数据库</span><br></pre></td></tr></table></figure>

<p><strong>为什么会出现“脏读”？</strong>因为没有“select”操作没有规矩。</p>
<p><strong>为什么会出现“不可重复读”？</strong>因为“update”操作没有规矩。</p>
<p><strong>为什么会出现“幻读”？</strong>因为“insert”和“delete”操作没有规矩。</p>
<p><strong>“读未提（Read Uncommitted）”能预防啥？</strong>啥都预防不了。</p>
<p><strong>“读提交（Read Committed）”能预防啥？</strong>使用“快照读（Snapshot Read）”，避免“脏读”，但是可能出现“不可重复读”和“幻读”。</p>
<p><strong>“可重复读（Repeated Red）”能预防啥？</strong>使用“快照读（Snapshot Read）”，锁住被读取记录，避免出现“脏读”、“不可重复读”，但是可能出现“幻读”。</p>
<p><strong>“串行化（Serializable）”能预防啥？</strong>排排坐，吃果果，有效避免“脏读”、“不可重复读”、“幻读”，不过效果谁用谁知道。</p>
<p><a href="https://baijiahao.baidu.com/s?id=1611918898724887602&amp;wfr=spider&amp;for=pc" target="_blank" rel="noopener">https://baijiahao.baidu.com/s?id=1611918898724887602&amp;wfr=spider&amp;for=pc</a></p>
<h3 id="数据库的乐观锁与悲观锁-是建立再事务的基础上"><a href="#数据库的乐观锁与悲观锁-是建立再事务的基础上" class="headerlink" title="数据库的乐观锁与悲观锁(是建立再事务的基础上)"></a>数据库的乐观锁与悲观锁(是建立再事务的基础上)</h3><h3 id="悲观锁"><a href="#悲观锁" class="headerlink" title="悲观锁"></a>悲观锁</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">悲观锁的概念，他觉有人会修改我读的数据。那我就再查的时候，对数据进行锁定。</span><br><span class="line"></span><br><span class="line">select age from user where id&#x3D;1 for update;</span><br><span class="line">比如 上面的查出来的 age &#x3D;18 </span><br><span class="line">update age改成age &#x3D; age+ 1</span><br><span class="line">如果别人开启了悲观锁这条数据就会被锁定卡住，只能等别人的事物结束才能操作，所以少用慎用 </span><br><span class="line">如果该次查询走了索引，那就是行锁，如果没有走索引就是表锁。</span><br><span class="line"></span><br><span class="line">如何释放锁呢？结束事务就释 放了锁。</span><br><span class="line">django中的orm是如果用悲观锁？</span><br><span class="line">user.objects.select_for_update().filter(id&#x3D;1).first()</span><br></pre></td></tr></table></figure>

<h3 id="乐观锁"><a href="#乐观锁" class="headerlink" title="乐观锁"></a>乐观锁</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">乐观锁的本质不是锁。他是通过代码来实现锁的。他觉的别人不会修改的他的数据。他就读数据不会被别人修改。最后再修改该条数据，再where条件中添加，之前查出来的数据。以保证数据的安全性</span><br><span class="line">select age from user where id&#x3D;1 ;</span><br><span class="line">比如 上面的查出来的 age &#x3D;18   </span><br><span class="line">20 </span><br><span class="line">update age改成age &#x3D; age+ 1  &#x3D;&#x3D;&#x3D;&#x3D;》19</span><br><span class="line"></span><br><span class="line">乐观锁：</span><br><span class="line">update age改成age &#x3D; age+ 1 where age &#x3D;18 and id &#x3D;1  &#x3D;&#x3D;&#x3D;&#x3D;》19</span><br><span class="line">如果我发现不是18,上面的影响行数是0，这样说明数据是不安全的，重新for循环或者其他方式获取数据重新执行</span><br><span class="line">#如果是可重复读，上面的乐观锁无效，必须改成read committed，因为可重复读会读取到之前的数据，所以乐观锁的条件就会成立</span><br><span class="line">a update age改成age &#x3D; age+ 1  &#x3D;&#x3D;&#x3D;&#x3D;》19 提交</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">b select age from user where id&#x3D;1; ---&gt;18</span><br><span class="line"></span><br><span class="line">update age改成age &#x3D; age+ 1 where age &#x3D;18 and id &#x3D;1  &#x3D;&#x3D;&#x3D;&#x3D;》19  ----&gt;数据已经被改</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/11/24/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB%E5%92%8C%E9%94%81/" data-id="ckd3ezcwx000kt4utb6bb560b" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MySQL/" rel="tag">MySQL</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">Next &amp;raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Django/" rel="tag">Django</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL/" rel="tag">MySQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/" rel="tag">Python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BD%91%E7%BB%9C%E5%92%8C%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/" rel="tag">网络和并发编程</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Django/" style="font-size: 16.67px;">Django</a> <a href="/tags/MySQL/" style="font-size: 13.33px;">MySQL</a> <a href="/tags/Python/" style="font-size: 20px;">Python</a> <a href="/tags/%E7%BD%91%E7%BB%9C%E5%92%8C%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/" style="font-size: 10px;">网络和并发编程</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">十二月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">一月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">十二月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">十一月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">十月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">九月 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/12/16/Django%E6%A1%86%E6%9E%B6%E6%A8%A1%E6%9D%BF%E5%B1%82/">Django框架模板层</a>
          </li>
        
          <li>
            <a href="/2019/01/02/Django%E6%A1%86%E6%9E%B6%E4%B9%8BAjax/">Django框架之Ajax</a>
          </li>
        
          <li>
            <a href="/2018/12/27/Django%E6%A1%86%E6%9E%B6%E6%A8%A1%E5%9E%8B%E5%B1%82%E5%B8%B8%E7%94%A8%E5%AD%97%E6%AE%B5%E5%92%8C%E4%BA%8B%E7%89%A9%E6%93%8D%E4%BD%9C/">Django框架模型层常用字段和事物操作</a>
          </li>
        
          <li>
            <a href="/2018/12/19/Django%E6%A1%86%E6%9E%B6%E6%A8%A1%E5%9E%8B%E5%B1%82%E5%92%8CORM/">Django框架模型层和ORM</a>
          </li>
        
          <li>
            <a href="/2018/12/15/Django%E6%A1%86%E6%9E%B6%E8%B7%AF%E7%94%B1%E5%B1%82%E5%92%8C%E8%A7%86%E5%9B%BE%E5%B1%82/">Django框架路由层和视图层</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 Mr Jiang<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>