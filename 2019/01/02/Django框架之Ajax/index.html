<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Django框架之Ajax | Mr Jiang</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="一.多对多关系创建的三种方式1）全自动（较为常用）1234567891 class Book(models.Model)2     titile &#x3D; models.CharField(max_length&#x3D;32)3     4     # 通过Django的ManyToManyField类方法快速创建第三张中间表5     authors &#x3D; models.ManyT">
<meta property="og:type" content="article">
<meta property="og:title" content="Django框架之Ajax">
<meta property="og:url" content="http://yoursite.com/2019/01/02/Django%E6%A1%86%E6%9E%B6%E4%B9%8BAjax/index.html">
<meta property="og:site_name" content="Mr Jiang">
<meta property="og:description" content="一.多对多关系创建的三种方式1）全自动（较为常用）1234567891 class Book(models.Model)2     titile &#x3D; models.CharField(max_length&#x3D;32)3     4     # 通过Django的ManyToManyField类方法快速创建第三张中间表5     authors &#x3D; models.ManyT">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200112224154791-255794900.png">
<meta property="og:image" content="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200112224307350-625986349.png">
<meta property="og:image" content="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200112224404240-542235347.png">
<meta property="og:image" content="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200112224326500-1113744219.png">
<meta property="og:image" content="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200112224507577-2131318994.png">
<meta property="og:image" content="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200112224544008-1699987451.png">
<meta property="og:image" content="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200112224601890-2000378963.png">
<meta property="og:image" content="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200112224717875-1786093194.png">
<meta property="og:image" content="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200112224810533-416708605.png">
<meta property="og:image" content="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200112224836636-1700755797.png">
<meta property="og:image" content="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200112224918251-1672914133.png">
<meta property="og:image" content="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200112224937996-2115546218.png">
<meta property="og:image" content="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200112225000406-492490093.png">
<meta property="og:image" content="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200112225009636-276363465.png">
<meta property="og:image" content="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200112225221952-1228871190.png">
<meta property="article:published_time" content="2019-01-02T15:17:01.000Z">
<meta property="article:modified_time" content="2020-07-26T18:23:56.418Z">
<meta property="article:author" content="Mr Jiang">
<meta property="article:tag" content="Django">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200112224154791-255794900.png">
  
    <link rel="alternate" href="/atom.xml" title="Mr Jiang" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 4.2.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Mr Jiang</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">头发还够，那就再多学点</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-Django框架之Ajax" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/01/02/Django%E6%A1%86%E6%9E%B6%E4%B9%8BAjax/" class="article-date">
  <time datetime="2019-01-02T15:17:01.000Z" itemprop="datePublished">2019-01-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Django框架之Ajax
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="一-多对多关系创建的三种方式"><a href="#一-多对多关系创建的三种方式" class="headerlink" title="一.多对多关系创建的三种方式"></a>一.多对多关系创建的三种方式</h1><h2 id="1）全自动（较为常用）"><a href="#1）全自动（较为常用）" class="headerlink" title="1）全自动（较为常用）"></a>1）全自动（较为常用）</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1 class Book(models.Model)</span><br><span class="line">2     titile &#x3D; models.CharField(max_length&#x3D;32)</span><br><span class="line">3     </span><br><span class="line">4     # 通过Django的ManyToManyField类方法快速创建第三张中间表</span><br><span class="line">5     authors &#x3D; models.ManyToManyField(to&#x3D;&#39;author&#39;)</span><br><span class="line">6     </span><br><span class="line">7     </span><br><span class="line">8 class Author(models.Model)</span><br><span class="line">9     name &#x3D; CharField(max_length&#x3D;32)</span><br></pre></td></tr></table></figure>

<ul>
<li>优点：自动创建第三章表，快速</li>
<li>缺点：第三张表只有三个字段，无法添加其余的字段</li>
</ul>
<h2 id="2-纯手动"><a href="#2-纯手动" class="headerlink" title="2)纯手动"></a>2)纯手动</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> 1 class Book(models.Model)</span><br><span class="line"> 2     titile &#x3D; models.CharField(max_length&#x3D;32)</span><br><span class="line"> 3 </span><br><span class="line"> 4     </span><br><span class="line"> 5     </span><br><span class="line"> 6 class Author(models.Model)</span><br><span class="line"> 7     name &#x3D; CharField(max_length&#x3D;32)</span><br><span class="line"> 8     </span><br><span class="line"> 9     </span><br><span class="line">10 # 手动创建第三张表并添加外键关系    </span><br><span class="line">11 class Book2Author(models.Model)</span><br><span class="line">12     book &#x3D; models.ForeignKey(to&#x3D;&#39;Book&#39;)</span><br><span class="line">13     author&#x3D;models.ForeignKey(to&#x3D;&#39;Author&#39;)</span><br><span class="line">14     create_time &#x3D; models.DateField(auto_now_add&#x3D;True)</span><br></pre></td></tr></table></figure>

<ul>
<li>优点：第三张表可以添加自己的扩展字段</li>
<li>缺点：orm查询的时候会带来不变</li>
</ul>
<h2 id="2）半自动（推荐使用）"><a href="#2）半自动（推荐使用）" class="headerlink" title="2）半自动（推荐使用）"></a>2）半自动（推荐使用）</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> 1 class Book(models.Model)</span><br><span class="line"> 2     titile &#x3D; models.CharField(max_length&#x3D;32)</span><br><span class="line"> 3     # 需要建一个外键字段，额外添加两个参数，through表示通过那一张表来表示第三张表，through_field表示哪两个字段是用来链接的</span><br><span class="line"> 4         authors &#x3D; models.ManyToManyField(to&#x3D;&#39;author&#39;，through&#x3D;‘Book2Author’， through_fields&#x3D;(&#39;book&#39;, &#39;author&#39;))</span><br><span class="line"> 5     </span><br><span class="line"> 6      </span><br><span class="line"> 7 class Author(models.Model)</span><br><span class="line"> 8     name &#x3D; CharField(max_length&#x3D;32)</span><br><span class="line"> 9     </span><br><span class="line">10   </span><br><span class="line">11 </span><br><span class="line">12 class Book2Author(models.Model)</span><br><span class="line">13     book &#x3D; models.ForeignKey(to&#x3D;&#39;Book&#39;)</span><br><span class="line">14     author&#x3D;models.ForeignKey(to&#x3D;&#39;Author&#39;)</span><br><span class="line">15     create_time &#x3D; models.DateField(auto_now_add&#x3D;True)</span><br></pre></td></tr></table></figure>

<ul>
<li><p>优点：第三张表可以任意扩展额外的字段，还可以使用orm的正反向查询</p>
</li>
<li><p>缺点：无法利用add，set，remove，claer这些方法</p>
</li>
</ul>
<p>虽然无法使用了 但是你还可以自己直接操作第三表</p>
<h1 id="二-Ajax介绍"><a href="#二-Ajax介绍" class="headerlink" title="二.Ajax介绍"></a>二.Ajax介绍</h1><h2 id="1）什么是Ajax？"><a href="#1）什么是Ajax？" class="headerlink" title="1）什么是Ajax？"></a>1）什么是Ajax？</h2><p>AJAX（Asynchronous Javascript And XML）翻译成中文就是“异步的Javascript和XML”。即使用Javascript语言与服务器进行异步交互，传输的数据为XML（当然，传输的数据不只是XML）。</p>
<p>AJAX 不是新的编程语言，而是一种使用现有标准的新方法。</p>
<p>AJAX 最大的优点是在不重新加载整个页面的情况下，可以与服务器交换数据并更新部分网页内容。（这一特点给用户的感受是在不知不觉中完成请求和响应过程）</p>
<p>AJAX 不需要任何浏览器插件，但需要用户允许JavaScript在浏览器上执行。</p>
<p>简单概括就是：异步提交，局部刷新</p>
<ul>
<li><p>同步交互：客户端发出一个请求后，需要等待服务器响应结束后，才能发出第二个请求；</p>
</li>
<li><p>异步交互：客户端发出一个请求后，无需等待服务器响应结束，就可以发出第二个请求。任务的结果是是通过异步回调机制 callback()</p>
</li>
<li><p>与后端交互的方法：</p>
</li>
</ul>
<table>
<thead>
<tr>
<th align="left">交互方式</th>
<th align="left">请求方式</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1.浏览器窗口输入回车</td>
<td align="left">get</td>
</tr>
<tr>
<td align="left">2.a标签href属性填写url点击</td>
<td align="left">get</td>
</tr>
<tr>
<td align="left">3.form表单</td>
<td align="left">get/post</td>
</tr>
<tr>
<td align="left">4.Ajax</td>
<td align="left">get/post</td>
</tr>
</tbody></table>
<p>Ajax并不是一门新的语言 它其实就是基于js写的一个功能模块而已 由于原生js书写ajax较为繁琐 所以我们直接学jQuery封装号的ajax模块操作</p>
<h2 id="2）Ajax的语法"><a href="#2）Ajax的语法" class="headerlink" title="2）Ajax的语法"></a>2）Ajax的语法</h2><p>举例：</p>
<p>需求：<img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200112224154791-255794900.png" alt="img"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> 1 # views.py</span><br><span class="line"> 2 def index(request):</span><br><span class="line"> 3     if request.method &#x3D;&#x3D; &#39;POST&#39;:</span><br><span class="line"> 4         i1 &#x3D; request.POST.get(&#39;i1&#39;)</span><br><span class="line"> 5         i2 &#x3D; request.POST.get(&#39;i2&#39;)</span><br><span class="line"> 6         # i1 和 i2 是字符串类型  需要先做类型转换</span><br><span class="line"> 7         i3 &#x3D; int(i1) + int(i2)</span><br><span class="line"> 8         return HttpResponse(i3)</span><br><span class="line"> 9     return render(request,&#39;index.html&#39;)</span><br><span class="line">10</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"> 1 # index.py</span><br><span class="line"> 2 </span><br><span class="line"> 3 &lt;input type&#x3D;&quot;text&quot; id&#x3D;&quot;i1&quot;&gt; + &lt;input type&#x3D;&quot;text&quot; id&#x3D;&quot;i2&quot;&gt; &#x3D; &lt;input type&#x3D;&quot;text&quot; id&#x3D;&quot;i3&quot;&gt;</span><br><span class="line"> 4 &lt;button id&#x3D;&quot;d1&quot;&gt;按钮&lt;&#x2F;button&gt;</span><br><span class="line"> 5 &lt;script&gt;</span><br><span class="line"> 6     &#x2F;&#x2F;绑定事件</span><br><span class="line"> 7     $(&#39;#d1&#39;).click(function () &#123;</span><br><span class="line"> 8         &#x2F;&#x2F; 获取两个框里面内容 朝后端提交异步请求</span><br><span class="line"> 9         &#x2F;&#x2F; ajax基本语法</span><br><span class="line">10         $.ajax(&#123;</span><br><span class="line">11             &#x2F;&#x2F; 1.到底朝哪个后端提交数据</span><br><span class="line">12             url:&#39;&#39;,  &#x2F;&#x2F; 控制数据的提交路径  有三种写法 跟form表单的action属性一致</span><br><span class="line">13             &#x2F;&#x2F; 2.指定当前请求方式</span><br><span class="line">14             type:&#39;post&#39;,</span><br><span class="line">15             &#x2F;&#x2F; 3.提交的数据</span><br><span class="line">16             data:&#123;&#39;i1&#39;:$(&#39;#i1&#39;).val(),&#39;i2&#39;:$(&#39;#i2&#39;).val()&#125;,</span><br><span class="line">17             &#x2F;&#x2F; 4.ajax是异步提交 所以需要给一个回调函数来处理返回的结果</span><br><span class="line">18             success:function (data) &#123;  &#x2F;&#x2F; data就是异步提交的返回结果</span><br><span class="line">19                 &#x2F;&#x2F; 将异步回调的结果通过DOM操作渲染到第三个input框中</span><br><span class="line">20                 $(&#39;#i3&#39;).val(data)</span><br><span class="line">21             &#125;</span><br><span class="line">22         &#125;)</span><br><span class="line">23     &#125;)</span><br><span class="line">24 &lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>

<p>3)前后端传输数据的编码格式</p>
<ul>
<li>urlencoded</li>
<li>formdata</li>
<li>application/json</li>
</ul>
<h3 id="1-form表单提交的数据"><a href="#1-form表单提交的数据" class="headerlink" title="1).form表单提交的数据"></a>1).form表单提交的数据</h3><p>默认是urlencoded编码格式传输数据 <strong>urlencoded数据格式:</strong>username=jason&amp;password=123</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1 # 简单代码</span><br><span class="line">2 &lt;form action&#x3D;&quot;&quot; method&#x3D;&quot;post&quot;&gt;</span><br><span class="line">3     &lt;p&gt;&lt;&#x2F;p&gt;</span><br><span class="line">4     &lt;p&gt;&lt;&#x2F;p&gt;</span><br><span class="line">5     &lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;username&quot;&gt;</span><br><span class="line">6     &lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;password&quot;&gt;</span><br><span class="line">7     &lt;input type&#x3D;&quot;submit&quot; &gt;</span><br><span class="line">8</span><br></pre></td></tr></table></figure>

<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200112224307350-625986349.png" alt="img"></p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200112224404240-542235347.png" alt="img"></p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200112224326500-1113744219.png" alt="img"></p>
<p>补充：django后端针对该格式的数据 会自动解析并帮你打包到request.POST中以键值对的形式存在</p>
<p>取出数据的方式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if request.method &#x3D;&#x3D; &#39;POST&#39;:    print(request.POST)</span><br><span class="line">    </span><br><span class="line"># &lt;QueryDict: &#123;&#39;username&#39;: [&#39;ajska&#39;], &#39;password&#39;: [&#39;123&#39;]&#125;&gt;</span><br></pre></td></tr></table></figure>

<p><strong>若再form表单中的enctype属性是以默认urlencoded格式,input中type属性是file格式，上传文件，只是上传的文件名，具体文件内容并没有上传上去，只有将格式改为form-data格式，通过request.files才能拿到最终数据</strong>,<strong>并且此时在网页中通过检查也无法轻易获取数据了</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action&#x3D;&quot;&quot; method&#x3D;&quot;post&quot; enctype&#x3D;&quot;multipart&#x2F;form-data&quot;&gt;</span><br><span class="line">    &lt;input type&#x3D;&quot;file&quot; name&#x3D;&quot;myfile&quot;&gt;</span><br></pre></td></tr></table></figure>

<p><strong>formdata数据格式还是可以传普通送键值对数据</strong> ，django后端针对符合urlencoded编码格式数据(普通键值对)还是统一解析到request.POST中 而针对formdata文件数据就会自动解析放到request.FILES中</p>
<h3 id="2-ajax提交的数据"><a href="#2-ajax提交的数据" class="headerlink" title="2)ajax提交的数据"></a>2)ajax提交的数据</h3><p><strong>前后端数据交互 编码格式与数据格式一定要一致</strong></p>
<ul>
<li><strong>默认也是urlnecoded编码格式</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> 1 &lt;script&gt;</span><br><span class="line"> 2 </span><br><span class="line"> 3     $(&#39;#d1&#39;).click(function () &#123;</span><br><span class="line"> 4         $.ajax(&#123;</span><br><span class="line"> 5             url:&#39;&#39;,</span><br><span class="line"> 6             type:&#39;post&#39;,</span><br><span class="line"> 7             data:&#123;&#39;username&#39;:&#39;jason&#39;,&#39;password&#39;:123&#125;,</span><br><span class="line"> 8             success:function (data) &#123;</span><br><span class="line"> 9                 alert(data)</span><br><span class="line">10             &#125;</span><br><span class="line">11         &#125;)</span><br><span class="line">12     &#125;)</span><br><span class="line">13  &lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>

<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200112224507577-2131318994.png" alt="img"></p>
<ul>
<li><p><strong>但是Ajax也能发送application/json格式数据</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> 1 $(&#39;#d2&#39;).on(&#39;click&#39;,function () &#123;</span><br><span class="line"> 2         $.ajax(&#123;</span><br><span class="line"> 3             url:&#39;&#39;,</span><br><span class="line"> 4             type:&#39;post&#39;,</span><br><span class="line"> 5             &#x2F;&#x2F; 修改content-Type参数</span><br><span class="line"> 6             contentType:&#39;application&#x2F;json&#39;,&#x2F;&#x2F;通过JSON.stringify出来成json格式</span><br><span class="line"> 7             data:JSON.stringify(&#123;&#39;username&#39;:&#39;jason&#39;,&#39;password&#39;:123&#125;),  &#x2F;&#x2F; 将数据序列化成json格式字符串</span><br><span class="line"> 8             success:function (data) &#123;</span><br><span class="line"> 9                 alert(data)</span><br><span class="line">10             &#125;</span><br><span class="line">11         &#125;)</span><br><span class="line">12     &#125;)</span><br></pre></td></tr></table></figure>

<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200112224544008-1699987451.png" alt="img"> </p>
</li>
</ul>
<p>此时后端无法拿到数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1 def ab_ct(request):</span><br><span class="line">2     if request.method &#x3D;&#x3D; &#39;POST&#39;:</span><br><span class="line">3         print(request.POST)</span><br><span class="line">4         print(request.FILES)</span><br></pre></td></tr></table></figure>

<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200112224601890-2000378963.png" alt="img"></p>
<p>数据已经传到requset.body中了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(request.body)</span><br></pre></td></tr></table></figure>

<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200112224717875-1786093194.png" alt="img"></p>
<p>这个数据既不在POST中，也不在FILES中，以json格式存在body中</p>
<p>我们可以自己解码反序列化拿到数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1 # 自己处理json格式数据</span><br><span class="line">2 json_bytes &#x3D; request.body</span><br><span class="line">3 # 先解码</span><br><span class="line">4 json_str &#x3D; json_bytes.decode(&#39;utf-8&#39;)</span><br><span class="line">5 # 再反序列化</span><br><span class="line">6 json_dict &#x3D; json.loads(json_str)</span><br><span class="line">7 #补充：json.loads能够自动解码并序列化</span><br><span class="line">8 json_dict &#x3D; json.loads(json_bytes)</span><br><span class="line">9 print(json_dict,type(json_dict))</span><br></pre></td></tr></table></figure>

<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200112224810533-416708605.png" alt="img"></p>
<ul>
<li><strong>ajax也能提交文件格式</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"> 1 &lt;input type&#x3D;&quot;file&quot; name&#x3D;&quot;myfile&quot; id&#x3D;&quot;i1&quot;&gt;</span><br><span class="line"> 2 &lt;button id&#x3D;&quot;d3&quot;&gt;ajax发送文件数据&lt;&#x2F;button&gt;</span><br><span class="line"> 3 &lt;script&gt;</span><br><span class="line"> 4  $(&#39;#d3&#39;).click(function () &#123;</span><br><span class="line"> 5         &#x2F;&#x2F; 1 需要先借助new方法生成一个内置对象</span><br><span class="line"> 6         var myFormData &#x3D; new FormData();</span><br><span class="line"> 7         &#x2F;&#x2F; 2 传普通键值对  当普通键值对较多的时候 我们可以利用for循环来添加</span><br><span class="line"> 8         myFormData.append(&#39;username&#39;,&#39;jason&#39;);</span><br><span class="line"> 9         myFormData.append(&#39;password&#39;,123);</span><br><span class="line">10         &#x2F;&#x2F; 3 传文件</span><br><span class="line">11         myFormData.append(&#39;myfile&#39;,$(&#39;#i1&#39;)[0].files[0]);  &#x2F;&#x2F; 获取input框内部用户上传的文件对象</span><br><span class="line">12         &#x2F;&#x2F; 发送ajax请求</span><br><span class="line">13         $.ajax(&#123;</span><br><span class="line">14             url:&#39;&#39;,</span><br><span class="line">15             type:&#39;post&#39;,</span><br><span class="line">16             data:myFormData,</span><br><span class="line">17             &#x2F;&#x2F; 发送formdata对象需要指定两个关键性的参数</span><br><span class="line">18 </span><br><span class="line">19             processData:false,  &#x2F;&#x2F; 让浏览器不要对你的数据进行任何的操作</span><br><span class="line">20             contentType:false,  &#x2F;&#x2F; 不要使用任何编码格式 对象formdata自带编码格式并且django能够识别该对象</span><br><span class="line">21 </span><br><span class="line">22             success:function (data) &#123;</span><br><span class="line">23                 alert(data)</span><br><span class="line">24             &#125;</span><br><span class="line">25         &#125;)</span><br><span class="line">26     &#125;)</span><br><span class="line">27 &lt;&#x2F;script&gt;</span><br><span class="line">28 def ab_ct(request):</span><br><span class="line">29     if request.method &#x3D;&#x3D; &#39;POST&#39;:</span><br><span class="line">30         print(request.POST)</span><br><span class="line">31         print(request.FILES)</span><br><span class="line">32     return render(request,&#39;ab_ct.html&#39;)</span><br></pre></td></tr></table></figure>



<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200112224836636-1700755797.png" alt="img"></p>
<h1 id="三-django内置序列化"><a href="#三-django内置序列化" class="headerlink" title="三.django内置序列化"></a>三.django内置序列化</h1><p>举例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> 1 def ab_se(request):</span><br><span class="line"> 2     # 拿到所有数据库的对象集</span><br><span class="line"> 3     user_queryset &#x3D; models.Userinfo.objects.all()</span><br><span class="line"> 4     user_list &#x3D; []</span><br><span class="line"> 5     for user_obj in user_queryset:</span><br><span class="line"> 6         user_list.append(&#123;</span><br><span class="line"> 7             &#39;username&#39;:user_obj.username,</span><br><span class="line"> 8             &#39;password&#39;:user_obj.password,</span><br><span class="line"> 9             &#39;gender&#39;:user_obj.get_gender_display(),</span><br><span class="line">10         &#125;)</span><br><span class="line">11      # 变成json格式</span><br><span class="line">12     res &#x3D; json.dumps(user_list)    </span><br><span class="line">13     return render(request,&#39;ab_se.html&#39;,locals())</span><br><span class="line">14</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">&#123;&#123; res &#125;&#125;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br></pre></td></tr></table></figure>

<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200112224918251-1672914133.png" alt="img"></p>
<p><strong>将数据库里面的数据通过json序列化 变成大字典的形式就是序列化</strong></p>
<p>通过 <a href="http://www.bejson.com/" target="_blank" rel="noopener">http://www.bejson.com/</a> 这个网站可以在线校验</p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200112224937996-2115546218.png" alt="img"></p>
<p>以上操作完全可以用Django的内置序列化模块 serializers处理，并且处理的更好</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1 from app01 import models</span><br><span class="line">2 from django.core import serializers</span><br><span class="line">3 def ab_se(request):</span><br><span class="line">4     user_queryset &#x3D; models.Userinfo.objects.all()</span><br><span class="line">5     # 传入需要修改的格式，以及需要序列化的对象集合</span><br><span class="line">6     res &#x3D; serializers.serialize(&#39;json&#39;,user_queryset) </span><br><span class="line">7     return HttpResponse(res)</span><br></pre></td></tr></table></figure>

<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200112225000406-492490093.png" alt="img"></p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200112225009636-276363465.png" alt="img"></p>
<h1 id="四：Django批量插入"><a href="#四：Django批量插入" class="headerlink" title="四：Django批量插入"></a>四：Django批量插入</h1><h2 id="1-普通批量插入"><a href="#1-普通批量插入" class="headerlink" title="1).普通批量插入"></a>1).普通批量插入</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> 1 def ab_bc(request):</span><br><span class="line"> 2     # 先插入1000条件数据</span><br><span class="line"> 3     for i in range(1,1001):</span><br><span class="line"> 4         models.Book.objects.create(title&#x3D;&#39;第%s本书&#39;%i)</span><br><span class="line"> 5     book_queryset &#x3D; models.Book.objects.all()</span><br><span class="line"> 6     return render(request,&#39;ab_bc.html&#39;,locals())</span><br><span class="line"> 7 &lt;&#x2F;head&gt;</span><br><span class="line"> 8 &lt;body&gt;</span><br><span class="line"> 9 &#123;% for book_obj in page_queryset %&#125;</span><br><span class="line">10     &lt;p&gt;&#123;&#123; book_obj.title &#125;&#125;&lt;&#x2F;p&gt;</span><br><span class="line">11 &#123;% endfor %&#125;</span><br><span class="line">12 &lt;&#x2F;body&gt;</span><br></pre></td></tr></table></figure>

<h2 id="2-快速批量插入"><a href="#2-快速批量插入" class="headerlink" title="2)快速批量插入"></a>2)快速批量插入</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> 1 def ab_bc(request):</span><br><span class="line"> 2     book_list &#x3D; []</span><br><span class="line"> 3     for i in range(1,10001):</span><br><span class="line"> 4         book_list.append(models.Book(title&#x3D;&#39;新的%s书&#39;%i))</span><br><span class="line"> 5     models.Book.objects.bulk_create(book_list)  # 批量插入数据的方式</span><br><span class="line"> 6     book_queryset &#x3D; models.Book.objects.all()</span><br><span class="line"> 7     return render(request,&#39;ab_bc.html&#39;,locals())</span><br><span class="line"> 8 &lt;&#x2F;head&gt;</span><br><span class="line"> 9 &lt;body&gt;</span><br><span class="line">10 &#123;% for book_obj in page_queryset %&#125;</span><br><span class="line">11     &lt;p&gt;&#123;&#123; book_obj.title &#125;&#125;&lt;&#x2F;p&gt;</span><br><span class="line">12 &#123;% endfor %&#125;</span><br><span class="line">13 &lt;&#x2F;body&gt;</span><br></pre></td></tr></table></figure>

<h1 id="五-自定义分页器"><a href="#五-自定义分页器" class="headerlink" title="五.自定义分页器"></a>五.自定义分页器</h1><p>分页器模板</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line">  1 class Pagination(object):</span><br><span class="line">  2     def __init__(self,current_page,all_count,per_page_num&#x3D;2,pager_count&#x3D;11):</span><br><span class="line">  3         &quot;&quot;&quot;</span><br><span class="line">  4         封装分页相关数据</span><br><span class="line">  5         :param current_page: 当前页</span><br><span class="line">  6         :param all_count:    数据库中的数据总条数</span><br><span class="line">  7         :param per_page_num: 每页显示的数据条数</span><br><span class="line">  8         :param pager_count:  最多显示的页码个数</span><br><span class="line">  9         </span><br><span class="line"> 10         用法:</span><br><span class="line"> 11         queryset &#x3D; model.objects.all()</span><br><span class="line"> 12         page_obj &#x3D; Pagination(current_page,all_count)</span><br><span class="line"> 13         page_data &#x3D; queryset[page_obj.start:page_obj.end]</span><br><span class="line"> 14         获取数据用page_data而不再使用原始的queryset</span><br><span class="line"> 15         获取前端分页样式用page_obj.page_html</span><br><span class="line"> 16         &quot;&quot;&quot;</span><br><span class="line"> 17         try:</span><br><span class="line"> 18             current_page &#x3D; int(current_page)</span><br><span class="line"> 19         except Exception as e:</span><br><span class="line"> 20             current_page &#x3D; 1</span><br><span class="line"> 21 </span><br><span class="line"> 22         if current_page &lt;1:</span><br><span class="line"> 23             current_page &#x3D; 1</span><br><span class="line"> 24 </span><br><span class="line"> 25         self.current_page &#x3D; current_page</span><br><span class="line"> 26 </span><br><span class="line"> 27         self.all_count &#x3D; all_count</span><br><span class="line"> 28         self.per_page_num &#x3D; per_page_num</span><br><span class="line"> 29 </span><br><span class="line"> 30 </span><br><span class="line"> 31         # 总页码</span><br><span class="line"> 32         all_pager, tmp &#x3D; divmod(all_count, per_page_num)</span><br><span class="line"> 33         if tmp:</span><br><span class="line"> 34             all_pager +&#x3D; 1</span><br><span class="line"> 35         self.all_pager &#x3D; all_pager</span><br><span class="line"> 36 </span><br><span class="line"> 37         self.pager_count &#x3D; pager_count</span><br><span class="line"> 38         self.pager_count_half &#x3D; int((pager_count - 1) &#x2F; 2)</span><br><span class="line"> 39 </span><br><span class="line"> 40     @property</span><br><span class="line"> 41     def start(self):</span><br><span class="line"> 42         return (self.current_page - 1) * self.per_page_num</span><br><span class="line"> 43 </span><br><span class="line"> 44     @property</span><br><span class="line"> 45     def end(self):</span><br><span class="line"> 46         return self.current_page * self.per_page_num</span><br><span class="line"> 47 </span><br><span class="line"> 48     def page_html(self):</span><br><span class="line"> 49         # 如果总页码 &lt; 11个：</span><br><span class="line"> 50         if self.all_pager &lt;&#x3D; self.pager_count:</span><br><span class="line"> 51             pager_start &#x3D; 1</span><br><span class="line"> 52             pager_end &#x3D; self.all_pager + 1</span><br><span class="line"> 53         # 总页码  &gt; 11</span><br><span class="line"> 54         else:</span><br><span class="line"> 55             # 当前页如果&lt;&#x3D;页面上最多显示11&#x2F;2个页码</span><br><span class="line"> 56             if self.current_page &lt;&#x3D; self.pager_count_half:</span><br><span class="line"> 57                 pager_start &#x3D; 1</span><br><span class="line"> 58                 pager_end &#x3D; self.pager_count + 1</span><br><span class="line"> 59 </span><br><span class="line"> 60             # 当前页大于5</span><br><span class="line"> 61             else:</span><br><span class="line"> 62                 # 页码翻到最后</span><br><span class="line"> 63                 if (self.current_page + self.pager_count_half) &gt; self.all_pager:</span><br><span class="line"> 64                     pager_end &#x3D; self.all_pager + 1</span><br><span class="line"> 65                     pager_start &#x3D; self.all_pager - self.pager_count + 1</span><br><span class="line"> 66                 else:</span><br><span class="line"> 67                     pager_start &#x3D; self.current_page - self.pager_count_half</span><br><span class="line"> 68                     pager_end &#x3D; self.current_page + self.pager_count_half + 1</span><br><span class="line"> 69 </span><br><span class="line"> 70         page_html_list &#x3D; []</span><br><span class="line"> 71         # 添加前面的nav和ul标签</span><br><span class="line"> 72         page_html_list.append(&#39;&#39;&#39;</span><br><span class="line"> 73                     &lt;nav aria-label&#x3D;&#39;Page navigation&gt;&#39;</span><br><span class="line"> 74                     &lt;ul class&#x3D;&#39;pagination&#39;&gt;</span><br><span class="line"> 75                 &#39;&#39;&#39;)</span><br><span class="line"> 76         first_page &#x3D; &#39;&lt;li&gt;&lt;a href&#x3D;&quot;?page&#x3D;%s&quot;&gt;首页&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;&#39; % (1)</span><br><span class="line"> 77         page_html_list.append(first_page)</span><br><span class="line"> 78 </span><br><span class="line"> 79         if self.current_page &lt;&#x3D; 1:</span><br><span class="line"> 80             prev_page &#x3D; &#39;&lt;li class&#x3D;&quot;disabled&quot;&gt;&lt;a href&#x3D;&quot;#&quot;&gt;上一页&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;&#39;</span><br><span class="line"> 81         else:</span><br><span class="line"> 82             prev_page &#x3D; &#39;&lt;li&gt;&lt;a href&#x3D;&quot;?page&#x3D;%s&quot;&gt;上一页&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;&#39; % (self.current_page - 1,)</span><br><span class="line"> 83 </span><br><span class="line"> 84         page_html_list.append(prev_page)</span><br><span class="line"> 85 </span><br><span class="line"> 86         for i in range(pager_start, pager_end):</span><br><span class="line"> 87             if i &#x3D;&#x3D; self.current_page:</span><br><span class="line"> 88                 temp &#x3D; &#39;&lt;li class&#x3D;&quot;active&quot;&gt;&lt;a href&#x3D;&quot;?page&#x3D;%s&quot;&gt;%s&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;&#39; % (i, i,)</span><br><span class="line"> 89             else:</span><br><span class="line"> 90                 temp &#x3D; &#39;&lt;li&gt;&lt;a href&#x3D;&quot;?page&#x3D;%s&quot;&gt;%s&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;&#39; % (i, i,)</span><br><span class="line"> 91             page_html_list.append(temp)</span><br><span class="line"> 92 </span><br><span class="line"> 93         if self.current_page &gt;&#x3D; self.all_pager:</span><br><span class="line"> 94             next_page &#x3D; &#39;&lt;li class&#x3D;&quot;disabled&quot;&gt;&lt;a href&#x3D;&quot;#&quot;&gt;下一页&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;&#39;</span><br><span class="line"> 95         else:</span><br><span class="line"> 96             next_page &#x3D; &#39;&lt;li&gt;&lt;a href&#x3D;&quot;?page&#x3D;%s&quot;&gt;下一页&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;&#39; % (self.current_page + 1,)</span><br><span class="line"> 97         page_html_list.append(next_page)</span><br><span class="line"> 98 </span><br><span class="line"> 99         last_page &#x3D; &#39;&lt;li&gt;&lt;a href&#x3D;&quot;?page&#x3D;%s&quot;&gt;尾页&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;&#39; % (self.all_pager,)</span><br><span class="line">100         page_html_list.append(last_page)</span><br><span class="line">101         # 尾部添加标签</span><br><span class="line">102         page_html_list.append(&#39;&#39;&#39;</span><br><span class="line">103                                            &lt;&#x2F;nav&gt;</span><br><span class="line">104                                            &lt;&#x2F;ul&gt;</span><br><span class="line">105                                        &#39;&#39;&#39;)</span><br><span class="line">106         return &#39;&#39;.join(page_html_list)</span><br></pre></td></tr></table></figure>

<p><strong>使用方式</strong></p>
<p>先在app01下面新建一个utils文件夹，并在其中建一个mypage.py文件，再将上面的模版复制进文件中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"> 1 from app01.utils.mypage import Pagination</span><br><span class="line"> 2 def ab_bc(request):</span><br><span class="line"> 3     # 先插入1000条件数据</span><br><span class="line"> 4     book_list &#x3D; []</span><br><span class="line"> 5     for i in range(1,10001):</span><br><span class="line"> 6         book_list.append(models.Book(title&#x3D;&#39;新的%s书&#39;%i))</span><br><span class="line"> 7     models.Book.objects.bulk_create(book_list)  # 批量插入数据的方式</span><br><span class="line"> 8     book_queryset &#x3D; models.Book.o   </span><br><span class="line"> 9     # 获取当前页</span><br><span class="line">10     current_page &#x3D; request.GET.get(&#39;page&#39;, 1)</span><br><span class="line">11     # 数据总条数</span><br><span class="line">12     all_count &#x3D; book_queryset.count()</span><br><span class="line">13     # 1 现生成一个自定义分页器类对象</span><br><span class="line">14     page_obj &#x3D; Pagination(current_page&#x3D;current_page,all_count&#x3D;all_count,pager_count&#x3D;9)</span><br><span class="line">15     # 2 针对真实的queryset数据进行切片操作</span><br><span class="line">16     page_queryset &#x3D; book_queryset[page_obj.start:page_obj.end]</span><br><span class="line">17     return render(request,&#39;ab_bc.html&#39;,locals())bjects.all()</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1 &lt;body&gt;</span><br><span class="line">2 &#123;% for book_obj in page_queryset %&#125;</span><br><span class="line">3     &lt;p&gt;&#123;&#123; book_obj.title &#125;&#125;&lt;&#x2F;p&gt;</span><br><span class="line">4 &#123;% endfor %&#125;</span><br><span class="line">5  &lt;!--渲染页面--&gt;</span><br><span class="line">6 &#123;&#123; page_obj.page_html|safe &#125;&#125;</span><br><span class="line">7 &lt;&#x2F;body&gt;</span><br><span class="line">8 &lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<h1 id="六-Ajax结合sweetalert实现二次删除"><a href="#六-Ajax结合sweetalert实现二次删除" class="headerlink" title="六.Ajax结合sweetalert实现二次删除"></a>六.Ajax结合sweetalert实现二次删除</h1><p>前期准备： <a href="https://github.com/lipis/bootstrap-sweetalert" target="_blank" rel="noopener">下载项目文件</a></p>
<p>建立一个satatic文件夹将此文件导入，在html文件中导入文件路径</p>
<p><img src="https://img2018.cnblogs.com/i-beta/1843708/202001/1843708-20200112225221952-1228871190.png" alt="img"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"> 1 # views.py</span><br><span class="line"> 2 </span><br><span class="line"> 3 from django.http import JsonResponse  # 可以实现返回一个字典</span><br><span class="line"> 4 import time</span><br><span class="line"> 5 def show_user(request):</span><br><span class="line"> 6     &quot;&quot;&quot;</span><br><span class="line"> 7     前后端如果是通过ajax进行交互 那么交互的媒介一般情况下都是一个字典</span><br><span class="line"> 8     :param request:</span><br><span class="line"> 9     :return:</span><br><span class="line">10     &quot;&quot;&quot;</span><br><span class="line">11     if request.method &#x3D;&#x3D; &#39;POST&#39;:</span><br><span class="line">12         time.sleep(3)</span><br><span class="line">13         </span><br><span class="line">14         back_dic &#x3D; &#123;&quot;code&quot;:1000,&#39;msg&#39;:&#39;&#39;&#125;</span><br><span class="line">15         </span><br><span class="line">16         delete_id &#x3D; request.POST.get(&#39;delete_id&#39;)</span><br><span class="line">17         </span><br><span class="line">18         models.Userinfo.objects.filter(pk&#x3D;delete_id).delete()</span><br><span class="line">19         </span><br><span class="line">20         back_dic[&#39;msg&#39;] &#x3D; &#39;删除成功，准备跑路！！！&#39;</span><br><span class="line">21         </span><br><span class="line">22         return JsonResponse(back_dic)</span><br><span class="line">23     user_queryset &#x3D; models.Userinfo.objects.all()</span><br><span class="line">24     return render(request,&#39;show_user.html&#39;,locals())</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"> 1 &lt;!DOCTYPE html&gt;</span><br><span class="line"> 2 &lt;html lang&#x3D;&quot;en&quot;&gt;</span><br><span class="line"> 3 &lt;head&gt;</span><br><span class="line"> 4     &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class="line"> 5     &lt;title&gt;Title&lt;&#x2F;title&gt;</span><br><span class="line"> 6     &lt;script src&#x3D;&quot;https:&#x2F;&#x2F;cdn.bootcss.com&#x2F;jquery&#x2F;3.4.1&#x2F;jquery.min.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line"> 7     &lt;link href&#x3D;&quot;https:&#x2F;&#x2F;cdn.bootcss.com&#x2F;twitter-bootstrap&#x2F;3.4.1&#x2F;css&#x2F;bootstrap.min.css&quot; rel&#x3D;&quot;stylesheet&quot;&gt;</span><br><span class="line"> 8     &lt;script src&#x3D;&quot;https:&#x2F;&#x2F;cdn.bootcss.com&#x2F;twitter-bootstrap&#x2F;3.4.1&#x2F;js&#x2F;bootstrap.min.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line"> 9     &#123;% load  static %&#125;</span><br><span class="line">10     &lt;link rel&#x3D;&quot;stylesheet&quot; href&#x3D;&quot;&#123;% static &#39;dist&#x2F;sweetalert.css&#39; %&#125;&quot;&gt;</span><br><span class="line">11     &lt;script src&#x3D;&quot;&#123;% static &#39;dist&#x2F;sweetalert.min.js&#39; %&#125;&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line">12     &lt;style&gt;</span><br><span class="line">13         div.sweet-alert h2 &#123;</span><br><span class="line">14             padding-top: 10px;</span><br><span class="line">15         &#125;</span><br><span class="line">16     &lt;&#x2F;style&gt;</span><br><span class="line">17 &lt;&#x2F;head&gt;</span><br><span class="line">18 &lt;body&gt;</span><br><span class="line">19 &lt;div class&#x3D;&quot;container&quot;&gt;</span><br><span class="line">20     &lt;div class&#x3D;&quot;row&quot;&gt;</span><br><span class="line">21         &lt;div class&#x3D;&quot;col-md-8 col-md-offset-2&quot;&gt;</span><br><span class="line">22             &lt;h2 class&#x3D;&quot;text-center&quot;&gt;数据展示&lt;&#x2F;h2&gt;</span><br><span class="line">23             &lt;table class&#x3D;&quot;table-hover table table-striped&quot;&gt;</span><br><span class="line">24                 &lt;thead&gt;</span><br><span class="line">25                 &lt;tr&gt;</span><br><span class="line">26                     &lt;th&gt;主键&lt;&#x2F;th&gt;</span><br><span class="line">27                     &lt;th&gt;用户名&lt;&#x2F;th&gt;</span><br><span class="line">28                     &lt;th&gt;密码&lt;&#x2F;th&gt;</span><br><span class="line">29                     &lt;th&gt;性别&lt;&#x2F;th&gt;</span><br><span class="line">30                     &lt;th&gt;操作&lt;&#x2F;th&gt;</span><br><span class="line">31                 &lt;&#x2F;tr&gt;</span><br><span class="line">32                 &lt;&#x2F;thead&gt;</span><br><span class="line">33                 &lt;tbody&gt;</span><br><span class="line">34                 &#123;% for user_obj in user_queryset %&#125;</span><br><span class="line">35                     &lt;tr&gt;</span><br><span class="line">36                         &lt;td&gt;&#123;&#123; user_obj.pk &#125;&#125;&lt;&#x2F;td&gt;</span><br><span class="line">37                         &lt;td&gt;&#123;&#123; user_obj.username &#125;&#125;&lt;&#x2F;td&gt;</span><br><span class="line">38                         &lt;td&gt;&#123;&#123; user_obj.password &#125;&#125;&lt;&#x2F;td&gt;</span><br><span class="line">39                         &lt;td&gt;&#123;&#123; user_obj.get_gender_display &#125;&#125;&lt;&#x2F;td&gt;</span><br><span class="line">40                         &lt;td&gt;</span><br><span class="line">41                             &lt;a href&#x3D;&quot;#&quot; class&#x3D;&quot;btn btn-primary btn-xs&quot;&gt;编辑&lt;&#x2F;a&gt;</span><br><span class="line">42                             &lt;a href&#x3D;&quot;#&quot; class&#x3D;&quot;btn btn-danger btn-xs cancel&quot; data_id&#x3D;&quot;&#123;&#123; user_obj.pk &#125;&#125;&quot;&gt;删除&lt;&#x2F;a&gt;</span><br><span class="line">43                         &lt;&#x2F;td&gt;</span><br><span class="line">44                     &lt;&#x2F;tr&gt;</span><br><span class="line">45                 &#123;% endfor %&#125;</span><br><span class="line">46                 &lt;&#x2F;tbody&gt;</span><br><span class="line">47 </span><br><span class="line">48             &lt;&#x2F;table&gt;</span><br><span class="line">49         &lt;&#x2F;div&gt;</span><br><span class="line">50     &lt;&#x2F;div&gt;</span><br><span class="line">51 &lt;&#x2F;div&gt;</span><br><span class="line">52 </span><br><span class="line">53 </span><br><span class="line">54 &lt;script&gt;</span><br><span class="line">55     $(&#39;.cancel&#39;).click(function () &#123;</span><br><span class="line">56         var $aEle &#x3D; $(this);</span><br><span class="line">57         swal(&#123;</span><br><span class="line">58                 title: &quot;你确定要删吗?&quot;,</span><br><span class="line">59                 text: &quot;你如果删了，你可要准备跑路啊!&quot;,</span><br><span class="line">60                 type: &quot;warning&quot;,</span><br><span class="line">61                 showCancelButton: true,</span><br><span class="line">62                 confirmButtonClass: &quot;btn-danger&quot;,</span><br><span class="line">63                 confirmButtonText: &quot;是的,老子就要删!&quot;,</span><br><span class="line">64                 cancelButtonText: &quot;惹不起惹不起!&quot;,</span><br><span class="line">65                 closeOnConfirm: false,</span><br><span class="line">66                 closeOnCancel: false,</span><br><span class="line">67                 showLoaderOnConfirm: true</span><br><span class="line">68             &#125;,</span><br><span class="line">69             function (isConfirm) &#123;</span><br><span class="line">70                 if (isConfirm) &#123;</span><br><span class="line">71                     &#x2F;&#x2F; 发送ajax请求</span><br><span class="line">72                     $.ajax(&#123;</span><br><span class="line">73                         url:&#39;&#39;,</span><br><span class="line">74                         type:&#39;post&#39;,</span><br><span class="line">75                         data:&#123;&#39;delete_id&#39;:$aEle.attr(&quot;data_id&quot;)&#125;,</span><br><span class="line">76                         success:function (data) &#123;  &#x2F;&#x2F; 回调函数会自动将二进制的json格式数据 解码并反序列成js中的数据类型</span><br><span class="line">77                             if (data.code &#x3D;&#x3D; 1000)&#123;</span><br><span class="line">78                                 swal(&quot;删了!&quot;, &quot;你准备跑路吧!&quot;, &quot;success&quot;);</span><br><span class="line">79                                 &#x2F;&#x2F; 方式1</span><br><span class="line">80                                 &#123;#window.location.reload()#&#125;</span><br><span class="line">81                                 &#x2F;&#x2F; 方式2 DOM操作动态修改</span><br><span class="line">82                                 $aEle.parent().parent().remove()  &#x2F;&#x2F; 将标签直接移除</span><br><span class="line">83                             &#125;else&#123;</span><br><span class="line">84                                 swal(&#39;发生了未知的错误&#39;, &quot;error&quot;);</span><br><span class="line">85                             &#125;</span><br><span class="line">86                         &#125;</span><br><span class="line">87                     &#125;);</span><br><span class="line">88 </span><br><span class="line">89                 &#125; else &#123;</span><br><span class="line">90                     swal(&quot;怂笔&quot;, &quot;你成功的刷新我对你的认知&quot;, &quot;error&quot;);</span><br><span class="line">91                 &#125;</span><br><span class="line">92             &#125;);</span><br><span class="line">93     &#125;)</span><br><span class="line">94 &lt;&#x2F;script&gt;</span><br><span class="line">95 &lt;&#x2F;body&gt;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/01/02/Django%E6%A1%86%E6%9E%B6%E4%B9%8BAjax/" data-id="ckd3f45j90001n4ut9mdw7ufb" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Django/" rel="tag">Django</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2018/12/27/Django%E6%A1%86%E6%9E%B6%E6%A8%A1%E5%9E%8B%E5%B1%82%E5%B8%B8%E7%94%A8%E5%AD%97%E6%AE%B5%E5%92%8C%E4%BA%8B%E7%89%A9%E6%93%8D%E4%BD%9C/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Django框架模型层常用字段和事物操作</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Django/" rel="tag">Django</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL/" rel="tag">MySQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/" rel="tag">Python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BD%91%E7%BB%9C%E5%92%8C%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/" rel="tag">网络和并发编程</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Django/" style="font-size: 16.67px;">Django</a> <a href="/tags/MySQL/" style="font-size: 13.33px;">MySQL</a> <a href="/tags/Python/" style="font-size: 20px;">Python</a> <a href="/tags/%E7%BD%91%E7%BB%9C%E5%92%8C%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/" style="font-size: 10px;">网络和并发编程</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">一月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">十二月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">十一月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">十月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">九月 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/01/02/Django%E6%A1%86%E6%9E%B6%E4%B9%8BAjax/">Django框架之Ajax</a>
          </li>
        
          <li>
            <a href="/2018/12/27/Django%E6%A1%86%E6%9E%B6%E6%A8%A1%E5%9E%8B%E5%B1%82%E5%B8%B8%E7%94%A8%E5%AD%97%E6%AE%B5%E5%92%8C%E4%BA%8B%E7%89%A9%E6%93%8D%E4%BD%9C/">Django框架模型层常用字段和事物操作</a>
          </li>
        
          <li>
            <a href="/2018/12/19/Django%E6%A1%86%E6%9E%B6%E6%A8%A1%E5%9E%8B%E5%B1%82%E5%92%8CORM/">Django框架模型层和ORM</a>
          </li>
        
          <li>
            <a href="/2018/12/16/Django%E6%A1%86%E6%9E%B6%E6%A8%A1%E6%9D%BF%E5%B1%82/">Django框架模板层</a>
          </li>
        
          <li>
            <a href="/2018/12/15/Django%E6%A1%86%E6%9E%B6%E8%B7%AF%E7%94%B1%E5%B1%82%E5%92%8C%E8%A7%86%E5%9B%BE%E5%B1%82/">Django框架路由层和视图层</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 Mr Jiang<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>